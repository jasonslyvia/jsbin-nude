/* *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved. 
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0  
 
THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE, 
MERCHANTABLITY OR NON-INFRINGEMENT. 
 
See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var TypeScript;(function(a){function b(a,b){return(a&b)!=0}function m(a){return a}function r(a,b){var c="";for(var d=1;d<1<<31;d<<=1)if((b&d)!=0)for(var e in a)if(a[e]==d){c.length>0&&(c+="|"),c+=e;break}return c}a.hasFlag=b,function(a){a._map=[],a.None=0,a.Comma=1,a.SColon=2,a.Asg=4,a.BinOp=8,a.RBrack=16,a.RCurly=32,a.RParen=64,a.Dot=128,a.Colon=256,a.PrimType=512,a.AddOp=1024,a.LCurly=2048,a.PreOp=4096,a.RegExp=8192,a.LParen=16384,a.LBrack=32768,a.Scope=65536,a.In=1<<17,a.SCase=1<<18,a.Else=1<<19,a.Catch=1<<20,a.Var=1<<21,a.Stmt=1<<22,a.While=1<<23,a.ID=1<<24,a.Prefix=1<<25,a.Literal=1<<26,a.RLit=1<<27,a.Func=1<<28,a.EOF=1<<29,a.TypeScriptS=1<<30,a.ExprStart=a.SColon|a.AddOp|a.LCurly|a.PreOp|a.RegExp|a.LParen|a.LBrack|a.ID|a.Prefix|a.RLit|a.Func|a.Literal,a.StmtStart=a.ExprStart|a.SColon|a.Var|a.Stmt|a.While|a.TypeScriptS,a.Postfix=a.Dot|a.LParen|a.LBrack}(a.ErrorRecoverySet||(a.ErrorRecoverySet={}));var c=a.ErrorRecoverySet;(function(a){a._map=[],a.None=0,a.Statements=1,a.FunctionDecls=2,a.ModuleDecls=4,a.ClassDecls=8,a.InterfaceDecls=16,a.TypedFuncDecls=32,a.TypedDecls=64,a.TypedFuncSignatures=256,a.TypedSignatures=512,a.AmbientDecls=1024,a.Properties=2048,a.Block=a.Statements|a.FunctionDecls|a.TypedFuncDecls|a.TypedDecls,a.Global=a.Statements|a.FunctionDecls|a.ModuleDecls|a.ClassDecls|a.InterfaceDecls|a.AmbientDecls,a.FunctionBody=a.Statements|a.FunctionDecls,a.ModuleMembers=a.TypedFuncDecls|a.FunctionDecls|a.ModuleDecls|a.ClassDecls|a.InterfaceDecls|a.TypedDecls|a.Statements|a.AmbientDecls,a.ClassMembers=a.TypedFuncDecls|a.FunctionDecls|a.Statements|a.TypedDecls|a.Properties,a.InterfaceMembers=a.TypedFuncSignatures|a.TypedSignatures,a.QuickParse=a.Global|a.Properties})(a.AllowedElements||(a.AllowedElements={}));var d=a.AllowedElements;(function(a){a._map=[],a.None=0,a.Private=1,a.Public=2,a.Readonly=4,a.Ambient=8,a.Exported=16,a.Getter=32,a.Setter=64,a.Static=128})(a.Modifiers||(a.Modifiers={}));var e=a.Modifiers;(function(a){a._map=[],a.None=0,a.ExplicitSemicolon=1,a.AutomaticSemicolon=2,a.Writeable=4,a.Error=8,a.DotLHSPartial=16,a.DotLHS=32,a.IsStatement=64,a.StrictMode=128,a.PossibleOptionalParameter=256,a.ClassBaseConstructorCall=512,a.OptionalName=1024})(a.ASTFlags||(a.ASTFlags={}));var f=a.ASTFlags;(function(a){a._map=[],a.None=0,a.Exported=1,a.Private=2,a.Public=4,a.Ambient=8,a.Static=16,a.LocalStatic=32,a.GetAccessor=64,a.SetAccessor=128})(a.DeclFlags||(a.DeclFlags={}));var g=a.DeclFlags;(function(a){a._map=[],a.None=0,a.Exported=1,a.Private=2,a.Public=4,a.Ambient=8,a.Static=16,a.LocalStatic=32,a.GetAccessor=64,a.SetAccessor=128,a.IsEnum=256,a.ShouldEmitModuleDecl=512,a.IsWholeFile=1024,a.IsDynamic=2048})(a.ModuleFlags||(a.ModuleFlags={}));var h=a.ModuleFlags;(function(a){a._map=[],a.None=0,a.Exported=1,a.Private=2,a.Public=4,a.Ambient=8,a.Static=16,a.LocalStatic=32,a.GetAccessor=64,a.SetAccessor=128,a.Property=256,a.Readonly=512,a.ModuleMember=1024,a.InterfaceMember=2048,a.ClassMember=4096,a.BuiltIn=8192,a.TypeSetDuringScopeAssignment=16384,a.Constant=32768,a.Optional=65536,a.RecursivelyReferenced=1<<17,a.Bound=1<<18})(a.SymbolFlags||(a.SymbolFlags={}));var i=a.SymbolFlags;(function(a){a._map=[],a.None=0,a.Exported=1,a.Private=2,a.Public=4,a.Ambient=8,a.Static=16,a.LocalStatic=32,a.GetAccessor=64,a.SetAccessor=128,a.AutoInit=256,a.Property=512,a.Readonly=1024,a.Class=2048,a.ClassProperty=4096,a.ClassBodyProperty=8192,a.ClassConstructorProperty=16384,a.ClassSuperMustBeFirstCallInConstructor=32768,a.Constant=65536})(a.VarFlags||(a.VarFlags={}));var j=a.VarFlags;(function(a){a._map=[],a.None=0,a.Exported=1,a.Private=2,a.Public=4,a.Ambient=8,a.Static=16,a.LocalStatic=32,a.GetAccessor=64,a.SetAccessor=128,a.Definition=256,a.Signature=512,a.Method=1024,a.HasReturnExpression=2048,a.CallMember=4096,a.ConstructMember=8192,a.HasSelfReference=16384,a.IsFatArrowFunction=32768,a.IndexerMember=65536,a.IsFunctionExpression=1<<17,a.ClassMethod=1<<18,a.ClassPropertyMethodExported=1<<19})(a.FncFlags||(a.FncFlags={}));var k=a.FncFlags;(function(a){a._map=[],a.None=0,a.IsIndexer=1,a.IsStringIndexer=2,a.IsNumberIndexer=4})(a.SignatureFlags||(a.SignatureFlags={}));var l=a.SignatureFlags;a.ToDeclFlags=m,function(a){a._map=[],a.None=0,a.HasImplementation=1,a.HasSelfReference=2,a.MergeResult=4,a.IsEnum=8,a.BuildingName=16,a.HasBaseType=32,a.HasBaseTypeOfObject=64,a.IsClass=128}(a.TypeFlags||(a.TypeFlags={}));var n=a.TypeFlags;(function(a){a._map=[],a.SuccessfulComparison=0,a.SourceIsNullTargetIsVoidOrUndefined=1,a.RequiredPropertyIsMissing=2,a.IncompatibleSignatures=4,a.SourceSignatureHasTooManyParameters=3,a.IncompatibleReturnTypes=16,a.IncompatiblePropertyTypes=32,a.IncompatibleParameterTypes=64})(a.TypeRelationshipFlags||(a.TypeRelationshipFlags={}));var o=a.TypeRelationshipFlags;(function(a){a._map=[],a.ES3=0,a.ES5=1})(a.CodeGenTarget||(a.CodeGenTarget={}));var p=a.CodeGenTarget;(function(a){a._map=[],a.Synchronous=0,a.Asynchronous=1,a.Local=2})(a.ModuleGenTarget||(a.ModuleGenTarget={}));var q=a.ModuleGenTarget;a.codeGenTarget=p.ES3,a.moduleGenTarget=q.Synchronous,a.optimizeModuleCodeGen=!0,a.flagsToString=r})(TypeScript||(TypeScript={}));var TypeScript;(function(a){(function(a){a._map=[],a._map[0]="None",a.None=0,a._map[1]="Empty",a.Empty=1,a._map[2]="EmptyExpr",a.EmptyExpr=2,a._map[3]="True",a.True=3,a._map[4]="False",a.False=4,a._map[5]="This",a.This=5,a._map[6]="Super",a.Super=6,a._map[7]="QString",a.QString=7,a._map[8]="Regex",a.Regex=8,a._map[9]="Null",a.Null=9,a._map[10]="ArrayLit",a.ArrayLit=10,a._map[11]="ObjectLit",a.ObjectLit=11,a._map[12]="Void",a.Void=12,a._map[13]="Comma",a.Comma=13,a._map[14]="Pos",a.Pos=14,a._map[15]="Neg",a.Neg=15,a._map[16]="Delete",a.Delete=16,a._map[17]="Await",a.Await=17,a._map[18]="In",a.In=18,a._map[19]="Dot",a.Dot=19,a._map[20]="From",a.From=20,a._map[21]="Is",a.Is=21,a._map[22]="InstOf",a.InstOf=22,a._map[23]="Typeof",a.Typeof=23,a._map[24]="NumberLit",a.NumberLit=24,a._map[25]="Name",a.Name=25,a._map[26]="TypeRef",a.TypeRef=26,a._map[27]="Index",a.Index=27,a._map[28]="Call",a.Call=28,a._map[29]="New",a.New=29,a._map[30]="Asg",a.Asg=30,a._map[31]="AsgAdd",a.AsgAdd=31,a._map[32]="AsgSub",a.AsgSub=32,a._map[33]="AsgDiv",a.AsgDiv=33,a._map[34]="AsgMul",a.AsgMul=34,a._map[35]="AsgMod",a.AsgMod=35,a._map[36]="AsgAnd",a.AsgAnd=36,a._map[37]="AsgXor",a.AsgXor=37,a._map[38]="AsgOr",a.AsgOr=38,a._map[39]="AsgLsh",a.AsgLsh=39,a._map[40]="AsgRsh",a.AsgRsh=40,a._map[41]="AsgRs2",a.AsgRs2=41,a._map[42]="QMark",a.QMark=42,a._map[43]="LogOr",a.LogOr=43,a._map[44]="LogAnd",a.LogAnd=44,a._map[45]="Or",a.Or=45,a._map[46]="Xor",a.Xor=46,a._map[47]="And",a.And=47,a._map[48]="Eq",a.Eq=48,a._map[49]="Ne",a.Ne=49,a._map[50]="Eqv",a.Eqv=50,a._map[51]="NEqv",a.NEqv=51,a._map[52]="Lt",a.Lt=52,a._map[53]="Le",a.Le=53,a._map[54]="Gt",a.Gt=54,a._map[55]="Ge",a.Ge=55,a._map[56]="Add",a.Add=56,a._map[57]="Sub",a.Sub=57,a._map[58]="Mul",a.Mul=58,a._map[59]="Div",a.Div=59,a._map[60]="Mod",a.Mod=60,a._map[61]="Lsh",a.Lsh=61,a._map[62]="Rsh",a.Rsh=62,a._map[63]="Rs2",a.Rs2=63,a._map[64]="Not",a.Not=64,a._map[65]="LogNot",a.LogNot=65,a._map[66]="IncPre",a.IncPre=66,a._map[67]="DecPre",a.DecPre=67,a._map[68]="IncPost",a.IncPost=68,a._map[69]="DecPost",a.DecPost=69,a._map[70]="TypeAssertion",a.TypeAssertion=70,a._map[71]="FuncDecl",a.FuncDecl=71,a._map[72]="Member",a.Member=72,a._map[73]="VarDecl",a.VarDecl=73,a._map[74]="ArgDecl",a.ArgDecl=74,a._map[75]="Return",a.Return=75,a._map[76]="Break",a.Break=76,a._map[77]="Continue",a.Continue=77,a._map[78]="Throw",a.Throw=78,a._map[79]="For",a.For=79,a._map[80]="ForIn",a.ForIn=80,a._map[81]="If",a.If=81,a._map[82]="While",a.While=82,a._map[83]="DoWhile",a.DoWhile=83,a._map[84]="Block",a.Block=84,a._map[85]="Case",a.Case=85,a._map[86]="Switch",a.Switch=86,a._map[87]="Try",a.Try=87,a._map[88]="TryCatch",a.TryCatch=88,a._map[89]="TryFinally",a.TryFinally=89,a._map[90]="Finally",a.Finally=90,a._map[91]="Catch",a.Catch=91,a._map[92]="List",a.List=92,a._map[93]="Script",a.Script=93,a._map[94]="Class",a.Class=94,a._map[95]="Interface",a.Interface=95,a._map[96]="Module",a.Module=96,a._map[97]="Import",a.Import=97,a._map[98]="With",a.With=98,a._map[99]="Label",a.Label=99,a._map[100]="LabeledStatement",a.LabeledStatement=100,a._map[101]="EBStart",a.EBStart=101,a._map[102]="GotoEB",a.GotoEB=102,a._map[103]="EndCode",a.EndCode=103,a._map[104]="Error",a.Error=104,a._map[105]="Comment",a.Comment=105,a._map[106]="Debugger",a.Debugger=106,a.GeneralNode=a.FuncDecl,a.LastAsg=a.AsgRs2})(a.NodeType||(a.NodeType={}));var b=a.NodeType})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function e(a){var b=668265261;return a=a^61^a>>>16,a+=a<<3,a^=a>>>4,a*=b,a^=a>>>15,a}function f(a,b){return b^(a>>5)+a}var b=function(){function a(){this.prototype=undefined,this.toString=undefined,this.toLocaleString=undefined,this.valueOf=undefined,this.hasOwnProperty=undefined,this.propertyIsEnumerable=undefined,this.isPrototypeOf=undefined,this.constructor=undefined}return a}();a.BlockIntrinsics=b;var c=function(){function a(){this.itemCount=0,this.table=new b}return a.prototype.getAllKeys=function(){var a=[];for(var b in this.table)this.table[b]!=undefined&&(a[a.length]=b);return a},a.prototype.add=function(a,b){return this.table[a]!=undefined?!1:(this.table[a]=b,this.itemCount++,!0)},a.prototype.addOrUpdate=function(a,b){return this.table[a]!=undefined?(this.table[a]=b,!1):(this.table[a]=b,this.itemCount++,!0)},a.prototype.map=function(a,b){for(var c in this.table){var d=this.table[c];d!=undefined&&a(c,this.table[c],b)}},a.prototype.every=function(a,b){for(var c in this.table){var d=this.table[c];if(d!=undefined&&!a(c,this.table[c],b))return!1}return!0},a.prototype.some=function(a,b){for(var c in this.table){var d=this.table[c];if(d!=undefined&&a(c,this.table[c],b))return!0}return!1},a.prototype.count=function(){return this.itemCount},a.prototype.lookup=function(a){var b=this.table[a];return b!=undefined?b:null},a}();a.StringHashTable=c;var d=function(){function a(a,b){this.primaryTable=a,this.secondaryTable=b,this.insertPrimary=!0}return a.prototype.getAllKeys=function(){return this.primaryTable.getAllKeys().concat(this.secondaryTable.getAllKeys())},a.prototype.add=function(a,b){return this.insertPrimary?this.primaryTable.add(a,b):this.secondaryTable.add(a,b)},a.prototype.addOrUpdate=function(a,b){return this.insertPrimary?this.primaryTable.addOrUpdate(a,b):this.secondaryTable.addOrUpdate(a,b)},a.prototype.map=function(a,b){this.primaryTable.map(a,b),this.secondaryTable.map(a,b)},a.prototype.every=function(a,b){return this.primaryTable.every(a,b)&&this.secondaryTable.every(a,b)},a.prototype.some=function(a,b){return this.primaryTable.some(a,b)||this.secondaryTable.some(a,b)},a.prototype.count=function(){return this.primaryTable.count()+this.secondaryTable.count()},a.prototype.lookup=function(a){var b=this.primaryTable.lookup(a);return b!=undefined?b:this.secondaryTable.lookup(a)},a}();a.DualStringHashTable=d,a.numberHashFn=e,a.combineHashes=f;var g=function(){function a(a,b){this.key=a,this.data=b}return a}();a.HashEntry=g;var h=function(){function a(a,b,c){this.size=a,this.hashFn=b,this.equalsFn=c,this.itemCount=0,this.table=new Array;for(var d=0;d<this.size;d++)this.table[d]=null}return a.prototype.add=function(a,b){var c,d=new g(a,b),e=this.hashFn(a);e%=this.size;for(c=this.table[e];c!=null;c=c.next)if(this.equalsFn(a,c.key))return!1;return d.next=this.table[e],this.table[e]=d,this.itemCount++,!0},a.prototype.remove=function(a){var b,c=this.hashFn(a);c%=this.size;var d=null,e=null;for(b=this.table[c];b!=null;b=b.next){if(this.equalsFn(a,b.key)){d=b.data,this.itemCount--,e?e.next=b.next:this.table[c]=b.next;break}e=b}return d},a.prototype.count=function(){return this.itemCount},a.prototype.lookup=function(a){var b,c=this.hashFn(a);c%=this.size;for(b=this.table[c];b!=null;b=b.next)if(this.equalsFn(a,b.key))return b.data;return null},a}();a.HashTable=h})(TypeScript||(TypeScript={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c},TypeScript;(function(a){var b=function(){function b(b){this.nodeType=b,this.type=null,this.flags=a.ASTFlags.Writeable,this.minChar=-1,this.limChar=-1,this.passCreated=a.CompilerDiagnostics.analysisPass,this.preComments=null,this.postComments=null,this.isParenthesized=!1}return b.prototype.isStatementOrExpression=function(){return!1},b.prototype.isCompoundStatement=function(){return!1},b.prototype.isLeaf=function(){return this.isStatementOrExpression()&&!this.isCompoundStatement()},b.prototype.typeCheck=function(b){switch(this.nodeType){case a.NodeType.Error:case a.NodeType.EmptyExpr:this.type=b.anyType;break;case a.NodeType.This:return b.typeCheckThis(this);case a.NodeType.Null:this.type=b.nullType;break;case a.NodeType.False:case a.NodeType.True:this.type=b.booleanType;break;case a.NodeType.Super:return b.typeCheckSuper(this);case a.NodeType.EndCode:case a.NodeType.Empty:case a.NodeType.Void:this.type=b.voidType;break;default:throw new Error("please implement in derived class")}return this},b.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);switch(this.nodeType){case a.NodeType.This:b.thisFnc&&a.hasFlag(b.thisFnc.fncFlags,a.FncFlags.IsFatArrowFunction)?b.writeToOutput("_this"):b.writeToOutput("this");break;case a.NodeType.Null:b.writeToOutput("null");break;case a.NodeType.False:b.writeToOutput("false");break;case a.NodeType.True:b.writeToOutput("true");break;case a.NodeType.Super:b.emitSuperReference();case a.NodeType.EndCode:break;case a.NodeType.Error:case a.NodeType.EmptyExpr:break;case a.NodeType.Empty:b.writeToOutput("; ");break;case a.NodeType.Void:b.writeToOutput("void ");break;default:throw new Error("please implement in derived class")}b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},b.prototype.print=function(b){b.startLine();var c={line:-1,col:-1},d={line:-1,col:-1};b.parser!==null&&(b.parser.getSourceLineCol(c,this.minChar),b.parser.getSourceLineCol(d,this.limChar),b.write("("+c.line+","+c.col+")--"+"("+d.line+","+d.col+"): "));var e=this.printLabel();a.hasFlag(this.flags,a.ASTFlags.Error)&&(e+=" (Error)"),b.writeLine(e)},b.prototype.printLabel=function(){return a.nodeTypeTable[this.nodeType]!==undefined?a.nodeTypeTable[this.nodeType]:a.NodeType._map[this.nodeType]},b.prototype.addToControlFlow=function(a){a.walker.options.goChildren=!1,a.addContent(this)},b.prototype.netFreeUses=function(a,b){},b.prototype.treeViewLabel=function(){return a.NodeType._map[this.nodeType]},b}();a.AST=b;var c=function(b){function c(c,d){b.call(this,a.NodeType.Error),this.minChar=c,this.limChar=d}return __extends(c,b),c}(b);a.IncompleteAST=c;var d=function(b){function c(){b.call(this,a.NodeType.List),this.enclosingScope=null,this.members=new Array}return __extends(c,b),c.prototype.addToControlFlow=function(a){var b=this.members.length;for(var c=0;c<b;c++){if(a.noContinuation){a.addUnreachable(this.members[c]);break}this.members[c]=a.walk(this.members[c],this)}a.walker.options.goChildren=!1},c.prototype.append=function(a){return this.members[this.members.length]=a,this},c.prototype.appendAll=function(b){if(b.nodeType==a.NodeType.List){var c=b;for(var d=0,e=c.members.length;d<e;d++)this.append(c.members[d])}else this.append(b);return this},c.prototype.emit=function(b,c,d,e){b.emitJavascriptList(this,null,a.TokenID.SColon,d,!1,!1,e)},c.prototype.typeCheck=function(a){var b=this.members.length;a.nestingLevel++;for(var c=0;c<b;c++)this.members[c]&&(this.members[c]=this.members[c].typeCheck(a));return a.nestingLevel--,this},c}(b);a.ASTList=d;var e=function(b){function c(c){b.call(this,a.NodeType.Name),this.text=c,this.sym=null,this.cloId=-1}return __extends(c,b),c.prototype.isMissing=function(){return!1},c.prototype.isLeaf=function(){return!0},c.prototype.treeViewLabel=function(){return"id: "+this.text},c.prototype.printLabel=function(){return this.text?"id: "+this.text:"name node"},c.prototype.typeCheck=function(a){return a.typeCheckName(this)},c.prototype.emit=function(a,b,c,d){a.emitJavascriptName(this,!0)},c}(b);a.Identifier=e;var f=function(a){function b(){a.call(this,"__missing")}return __extends(b,a),b.prototype.isMissing=function(){return!0},b.prototype.emit=function(a,b,c,d){},b}(e);a.MissingIdentifier=f;var g=function(b){function c(c){b.call(this,a.NodeType.Label),this.id=c}return __extends(c,b),c.prototype.printLabel=function(){return this.id.text+":"},c.prototype.typeCheck=function(a){return this.type=a.voidType,this},c.prototype.emit=function(a,b,c,d){a.emitParensAndCommentsInPlace(this,!0),a.recordSourceMappingStart(this),a.writeLineToOutput(this.id.text+":"),a.recordSourceMappingEnd(this),a.emitParensAndCommentsInPlace(this,!1)},c}(b);a.Label=g;var h=function(b){function c(a,c){b.call(this,a),this.operand=c,this.targetType=null,this.castTerm=null,this.nty=a}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.addToControlFlow=function(c){b.prototype.addToControlFlow.call(this,c),this.nodeType==a.NodeType.Throw&&c.returnStmt()},c.prototype.typeCheck=function(b){switch(this.nty){case a.NodeType.Not:return b.typeCheckBitNot(this);case a.NodeType.LogNot:return b.typeCheckLogNot(this);case a.NodeType.Pos:case a.NodeType.Neg:return b.typeCheckUnaryNumberOperator(this);case a.NodeType.IncPost:case a.NodeType.IncPre:case a.NodeType.DecPost:case a.NodeType.DecPre:return b.typeCheckIncOrDec(this);case a.NodeType.ArrayLit:return b.typeCheckArrayLit(this),this;case a.NodeType.ObjectLit:return b.typeCheckObjectLit(this),this;case a.NodeType.Throw:return this.operand=b.typeCheck(this.operand),this.type=b.voidType,this;case a.NodeType.Typeof:return this.operand=b.typeCheck(this.operand),this.type=b.stringType,this;case a.NodeType.Delete:this.operand=b.typeCheck(this.operand),this.type=b.booleanType;break;case a.NodeType.TypeAssertion:this.castTerm=b.typeCheck(this.castTerm);var c=!this.operand.isParenthesized,d=c?this.castTerm.type:null;return b.checker.typeCheckWithContextualType(d,b.checker.inProvisionalTypecheckMode(),!0,this.operand),b.castWithCoercion(this.operand,this.castTerm.type,!1,!0),this.type=this.castTerm.type,this;case a.NodeType.Void:this.operand=b.typeCheck(this.operand),this.type=b.checker.undefinedType;break;default:throw new Error("please implement in derived class")}return this},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);switch(this.nty){case a.NodeType.IncPost:b.emitJavascript(this.operand,a.TokenID.Inc,!1),b.writeToOutput("++");break;case a.NodeType.LogNot:b.writeToOutput("!"),b.emitJavascript(this.operand,a.TokenID.Bang,!1);break;case a.NodeType.DecPost:b.emitJavascript(this.operand,a.TokenID.Dec,!1),b.writeToOutput("--");break;case a.NodeType.ObjectLit:b.emitObjectLiteral(this.operand);break;case a.NodeType.ArrayLit:b.emitArrayLiteral(this.operand);break;case a.NodeType.Not:b.writeToOutput("~"),b.emitJavascript(this.operand,a.TokenID.Tilde,!1);break;case a.NodeType.Neg:b.writeToOutput("-"),this.operand.nodeType==a.NodeType.Neg&&(this.operand.isParenthesized=!0),b.emitJavascript(this.operand,a.TokenID.Sub,!1);break;case a.NodeType.Pos:b.writeToOutput("+"),this.operand.nodeType==a.NodeType.Pos&&(this.operand.isParenthesized=!0),b.emitJavascript(this.operand,a.TokenID.Add,!1);break;case a.NodeType.IncPre:b.writeToOutput("++"),b.emitJavascript(this.operand,a.TokenID.Inc,!1);break;case a.NodeType.DecPre:b.writeToOutput("--"),b.emitJavascript(this.operand,a.TokenID.Dec,!1);break;case a.NodeType.Throw:b.writeToOutput("throw "),b.emitJavascript(this.operand,a.TokenID.Tilde,!1),b.writeToOutput(";");break;case a.NodeType.Typeof:b.writeToOutput("typeof "),b.emitJavascript(this.operand,a.TokenID.Tilde,!1);break;case a.NodeType.Delete:b.writeToOutput("delete "),b.emitJavascript(this.operand,a.TokenID.Tilde,!1);break;case a.NodeType.Void:b.writeToOutput("void "),b.emitJavascript(this.operand,a.TokenID.Tilde,!1);break;case a.NodeType.TypeAssertion:b.emitJavascript(this.operand,a.TokenID.Tilde,!1);break;default:throw new Error("please implement in derived class")}b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c}(b);a.UnaryExpression=h;var i=function(b){function c(a,c,d){b.call(this,a),this.target=c,this.args=d,this.signature=null,this.nty=a,this.minChar=this.target.minChar}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.typeCheck=function(b){return this.nty==a.NodeType.New?b.typeCheckNew(this):b.typeCheckCall(this)},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),this.nty==a.NodeType.New?b.emitNew(this.target,this.args):b.emitCall(this,this.target,this.args),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c}(b);a.CallExpression=i;var j=function(b){function c(a,c,d){b.call(this,a),this.operand1=c,this.operand2=d,this.nty=a}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.typeCheck=function(b){switch(this.nty){case a.NodeType.Dot:return b.typeCheckDotOperator(this);case a.NodeType.Asg:return b.typeCheckAsgOperator(this);case a.NodeType.Add:case a.NodeType.Sub:case a.NodeType.Mul:case a.NodeType.Div:case a.NodeType.Mod:case a.NodeType.Or:case a.NodeType.And:return b.typeCheckArithmeticOperator(this,!1);case a.NodeType.Xor:return b.typeCheckBitwiseOperator(this,!1);case a.NodeType.Ne:case a.NodeType.Eq:var c;b.checker.styleSettings.eqeqeq?(c=a.nodeTypeTable[this.nty],b.checker.errorReporter.styleError(this,"use of "+c)):b.checker.styleSettings.eqnull&&(c=a.nodeTypeTable[this.nty],this.operand2!==null&&this.operand2.nodeType==a.NodeType.Null&&b.checker.errorReporter.styleError(this,"use of "+c+" to compare with null"));case a.NodeType.Eqv:case a.NodeType.NEqv:case a.NodeType.Lt:case a.NodeType.Le:case a.NodeType.Ge:case a.NodeType.Gt:return b.typeCheckBooleanOperator(this);case a.NodeType.Index:return b.typeCheckIndex(this);case a.NodeType.Member:return this.type=b.voidType,this;case a.NodeType.LogOr:return b.typeCheckLogOr(this);case a.NodeType.LogAnd:return b.typeCheckLogAnd(this);case a.NodeType.AsgAdd:case a.NodeType.AsgSub:case a.NodeType.AsgMul:case a.NodeType.AsgDiv:case a.NodeType.AsgMod:case a.NodeType.AsgOr:case a.NodeType.AsgAnd:return b.typeCheckArithmeticOperator(this,!0);case a.NodeType.AsgXor:return b.typeCheckBitwiseOperator(this,!0);case a.NodeType.Lsh:case a.NodeType.Rsh:case a.NodeType.Rs2:return b.typeCheckShift(this,!1);case a.NodeType.AsgLsh:case a.NodeType.AsgRsh:case a.NodeType.AsgRs2:return b.typeCheckShift(this,!0);case a.NodeType.Comma:return b.typeCheckCommaOperator(this);case a.NodeType.InstOf:return b.typeCheckInstOf(this);case a.NodeType.In:return b.typeCheckInOperator(this);case a.NodeType.From:b.checker.errorReporter.simpleError(this,"Illegal use of 'from' keyword in binary expression");break;default:throw new Error("please implement in derived class")}return this},c.prototype.emit=function(b,c,d,e){var f=a.nodeTypeToTokTable[this.nodeType];b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);if(f!=undefined)b.emitJavascript(this.operand1,f,!1),a.tokenTable[f].text=="instanceof"?b.writeToOutput(" instanceof "):a.tokenTable[f].text=="in"?b.writeToOutput(" in "):b.writeToOutputTrimmable(" "+a.tokenTable[f].text+" "),b.emitJavascript(this.operand2,f,!1);else switch(this.nty){case a.NodeType.Dot:b.tryEmitConstant(this)||(b.emitJavascript(this.operand1,a.TokenID.Dot,!1),b.writeToOutput("."),b.emitJavascriptName(this.operand2,!1));break;case a.NodeType.Index:b.emitIndex(this.operand1,this.operand2);break;case a.NodeType.Member:if(this.operand2.nodeType==a.NodeType.FuncDecl&&this.operand2.isAccessor()){var g=this.operand2;a.hasFlag(g.fncFlags,a.FncFlags.GetAccessor)?b.writeToOutput("get "):b.writeToOutput("set "),b.emitJavascript(this.operand1,a.TokenID.Colon,!1)}else b.emitJavascript(this.operand1,a.TokenID.Colon,!1),b.writeToOutputTrimmable(": ");b.emitJavascript(this.operand2,a.TokenID.Comma,!1);break;case a.NodeType.Comma:b.emitJavascript(this.operand1,a.TokenID.Comma,!1),b.emitState.inObjectLiteral?b.writeLineToOutput(", "):b.writeToOutput(","),b.emitJavascript(this.operand2,a.TokenID.Comma,!1);break;case a.NodeType.Is:throw new Error("should be de-sugared during type check");default:throw new Error("please implement in derived class")}b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c}(b);a.BinaryExpression=j;var k=function(b){function c(a,c,d,e){b.call(this,a),this.operand1=c,this.operand2=d,this.operand3=e,this.nty=a}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.typeCheck=function(a){return a.typeCheckQMark(this)},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),b.emitJavascript(this.operand1,a.TokenID.QMark,!1),b.writeToOutput(" ? "),b.emitJavascript(this.operand2,a.TokenID.QMark,!1),b.writeToOutput(" : "),b.emitJavascript(this.operand3,a.TokenID.QMark,!1),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c}(b);a.TrinaryExpression=k;var l=function(b){function c(c){b.call(this,a.NodeType.NumberLit),this.value=c,this.isNegativeZero=!1}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.typeCheck=function(a){return this.type=a.doubleType,this},c.prototype.treeViewLabel=function(){return"num: "+this.value},c.prototype.emit=function(a,b,c,d){a.emitParensAndCommentsInPlace(this,!0),a.recordSourceMappingStart(this),this.isNegativeZero&&a.writeToOutput("-"),a.writeToOutput(this.value.toString()),a.recordSourceMappingEnd(this),a.emitParensAndCommentsInPlace(this,!1)},c.prototype.printLabel=function(){return Math.floor(this.value)!=this.value?this.value.toFixed(2).toString():this.value.toString()},c}(b);a.NumberLiteral=l;var m=function(b){function c(c){b.call(this,a.NodeType.Regex),this.regex=c}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.typeCheck=function(a){return this.type=a.regexType,this},c.prototype.emit=function(a,b,c,d){a.emitParensAndCommentsInPlace(this,!0),a.recordSourceMappingStart(this),a.writeToOutput(this.regex.toString()),a.recordSourceMappingEnd(this),a.emitParensAndCommentsInPlace(this,!1)},c}(b);a.RegexLiteral=m;var n=function(b){function c(c){b.call(this,a.NodeType.QString),this.text=c}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.emit=function(a,b,c,d){a.emitParensAndCommentsInPlace(this,!0),a.recordSourceMappingStart(this),a.emitStringLiteral(this.text),a.recordSourceMappingEnd(this),a.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return this.type=a.stringType,this},c.prototype.treeViewLabel=function(){return"st: "+this.text},c.prototype.printLabel=function(){return this.text},c}(b);a.StringLiteral=n;var o=function(b){function c(c,d){b.call(this,a.NodeType.Import),this.id=c,this.alias=d,this.varFlags=a.VarFlags.None,this.isDynamicImport=!1}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.emit=function(b,c,d,e){var f=this.alias.type;e&&b.emitImportDecl(this);if(!this.isDynamicImport||this.id.sym&&!this.id.sym.onlyReferencedAsTypeRef){var g=b.modAliasId,h=b.firstModAlias;b.recordSourceMappingStart(this),b.emitParensAndCommentsInPlace(this,!0),b.writeToOutput("var "+this.id.text+" = "),b.modAliasId=this.id.text,b.firstModAlias=this.firstAliasedModToString(),b.emitJavascript(this.alias,a.TokenID.Tilde,!1,e),this.isDynamicImport||b.writeToOutput(";"),b.emitParensAndCommentsInPlace(this,!1),b.recordSourceMappingEnd(this),b.modAliasId=g,b.firstModAlias=h}},c.prototype.typeCheck=function(a){return a.typeCheckImportDecl(this)},c.prototype.getAliasName=function(b){typeof b=="undefined"&&(b=this.alias);if(b.nodeType==a.NodeType.Name)return b.text;var c=b;return this.getAliasName(c.operand1)+"."+this.getAliasName(c.operand2)},c.prototype.firstAliasedModToString=function(){if(this.alias.nodeType==a.NodeType.Name)return this.alias.text;var b=this.alias,c=b.operand1;return c.text},c}(b);a.ImportDecl=o;var p=function(b){function c(c,d,e){b.call(this,d),this.id=c,this.nestingLevel=e,this.init=null,this.typeExpr=null,this.varFlags=a.VarFlags.None,this.sym=null}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isPrivate=function(){return a.hasFlag(this.varFlags,a.VarFlags.Private)},c.prototype.isPublic=function(){return a.hasFlag(this.varFlags,a.VarFlags.Public)},c.prototype.isProperty=function(){return a.hasFlag(this.varFlags,a.VarFlags.Property)},c.prototype.typeCheck=function(a){return a.typeCheckBoundDecl(this)},c.prototype.printLabel=function(){return this.treeViewLabel()},c}(b);a.BoundDecl=p;var q=function(b){function c(c,d){b.call(this,c,a.NodeType.VarDecl,d)}return __extends(c,b),c.prototype.isAmbient=function(){return a.hasFlag(this.varFlags,a.VarFlags.Ambient)},c.prototype.isExported=function(){return a.hasFlag(this.varFlags,a.VarFlags.Exported)},c.prototype.isStatic=function(){return a.hasFlag(this.varFlags,a.VarFlags.Static)},c.prototype.emit=function(a,b,c,d){a.emitJavascriptVarDecl(this,b,d)},c.prototype.treeViewLabel=function(){return"var "+this.id.text},c}(p);a.VarDecl=q;var r=function(b){function c(c){b.call(this,c,a.NodeType.ArgDecl,0),this.isOptional=!1,this.parameterPropertySym=null}return __extends(c,b),c.prototype.isOptionalArg=function(){return this.isOptional||this.init},c.prototype.treeViewLabel=function(){return"arg: "+this.id.text},c.prototype.emit=function(a,b,c,d){a.emitParensAndCommentsInPlace(this,!0),a.recordSourceMappingStart(this),a.writeToOutput(this.id.text),d&&a.emitArgDecl(this),a.recordSourceMappingEnd(this),a.emitParensAndCommentsInPlace(this,!1)},c}(p);a.ArgDecl=r;var s=0,t=function(b){function c(c,d,e,f,g,h,i,j){b.call(this,j),this.name=c,this.bod=d,this.isConstructor=e,this.args=f,this.vars=g,this.scopes=h,this.statics=i,this.hint=null,this.fncFlags=a.FncFlags.None,this.returnTypeAnnotation=null,this.variableArgList=!1,this.jumpRefs=null,this.internalNameCache=null,this.tmp1Declared=!1,this.enclosingFnc=null,this.freeVariables=[],this.unitIndex=-1,this.classDecl=null,this.boundToProperty=null,this.isOverload=!1,this.innerStaticFuncs=[],this.isTargetTypedAsMethod=!1,this.isInlineCallLiteral=!1,this.accessorSymbol=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.returnStatementsWithExpressions=[],this.scopeType=null}return __extends(c,b),c.prototype.internalName=function(){if(this.internalNameCache==null){var a=this.getNameText();a?this.internalNameCache="_internal_"+a:this.internalNameCache="_internal_"+s++}return this.internalNameCache},c.prototype.hasSelfReference=function(){return a.hasFlag(this.fncFlags,a.FncFlags.HasSelfReference)},c.prototype.setHasSelfReference=function(){this.fncFlags|=a.FncFlags.HasSelfReference},c.prototype.addCloRef=function(a,b){this.envids==null&&(this.envids=new Array),this.envids[this.envids.length]=a;var c=this.enclosingFnc;if(b)while(c&&c.type.symbol!=b.container)c.addJumpRef(b),c=c.enclosingFnc;return this.envids.length-1},c.prototype.addJumpRef=function(a){this.jumpRefs==null&&(this.jumpRefs=new Array);var b=new e(a.name);this.jumpRefs[this.jumpRefs.length]=b,b.sym=a,b.cloId=this.addCloRef(b,null)},c.prototype.buildControlFlow=function(){var b=new a.BasicBlock,c=new a.BasicBlock,d=new a.ControlFlowContext(b,c),e=function(a,b,c){return a.addToControlFlow(c.state),a},f=a.getAstWalkerFactory().getWalker(e,null,null,d);return d.walker=f,f.walk(this.bod,this),d},c.prototype.typeCheck=function(a){return a.typeCheckFunction(this)},c.prototype.emit=function(a,b,c,d){a.emitJavascriptFunction(this,d)},c.prototype.getNameText=function(){return this.name?this.name.text:this.hint},c.prototype.isMethod=function(){return(this.fncFlags&a.FncFlags.Method)!=a.FncFlags.None},
c.prototype.isCallMember=function(){return a.hasFlag(this.fncFlags,a.FncFlags.CallMember)},c.prototype.isConstructMember=function(){return a.hasFlag(this.fncFlags,a.FncFlags.ConstructMember)},c.prototype.isIndexerMember=function(){return a.hasFlag(this.fncFlags,a.FncFlags.IndexerMember)},c.prototype.isSpecialFn=function(){return this.isCallMember()||this.isIndexerMember()||this.isConstructMember()},c.prototype.isAnonymousFn=function(){return this.name===null},c.prototype.isAccessor=function(){return a.hasFlag(this.fncFlags,a.FncFlags.GetAccessor)||a.hasFlag(this.fncFlags,a.FncFlags.SetAccessor)},c.prototype.isGetAccessor=function(){return a.hasFlag(this.fncFlags,a.FncFlags.GetAccessor)},c.prototype.isSetAccessor=function(){return a.hasFlag(this.fncFlags,a.FncFlags.SetAccessor)},c.prototype.isAmbient=function(){return a.hasFlag(this.fncFlags,a.FncFlags.Ambient)},c.prototype.isExported=function(){return a.hasFlag(this.fncFlags,a.FncFlags.Exported)},c.prototype.isPrivate=function(){return a.hasFlag(this.fncFlags,a.FncFlags.Private)},c.prototype.isPublic=function(){return a.hasFlag(this.fncFlags,a.FncFlags.Public)},c.prototype.isStatic=function(){return a.hasFlag(this.fncFlags,a.FncFlags.Static)},c.prototype.treeViewLabel=function(){return this.name==null?"funcExpr":"func: "+this.name.text},c.prototype.ClearFlags=function(){this.fncFlags=a.FncFlags.None},c.prototype.isSignature=function(){return(this.fncFlags&a.FncFlags.Signature)!=a.FncFlags.None},c.prototype.hasStaticDeclarations=function(){return!this.isConstructor&&(this.statics.members.length>0||this.innerStaticFuncs.length>0)},c}(b);a.FuncDecl=t;var u=function(){function a(a,b,c){this.filename=a,this.lineMap=b,this.unitIndex=c}return a}();a.LocationInfo=u,a.unknownLocationInfo=new u("unknown",null,-1);var v=function(b){function c(c,d){b.call(this,new e("script"),null,!1,null,c,d,null,a.NodeType.Script),this.locationInfo=null,this.requiresGlobal=!1,this.requiresInherits=!1,this.isResident=!1,this.isDeclareFile=!1,this.hasBeenTypeChecked=!1,this.topLevelMod=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.vars=c,this.scopes=d}return __extends(c,b),c.prototype.typeCheck=function(a){return a.typeCheckScript(this)},c.prototype.treeViewLabel=function(){return"Script"},c.prototype.emitRequired=function(){if(!this.isDeclareFile&&!this.isResident&&this.bod)for(var b=0,c=this.bod.members.length;b<c;b++){var d=this.bod.members[b];if(d.nodeType==a.NodeType.Module){if(!a.hasFlag(d.modFlags,a.ModuleFlags.ShouldEmitModuleDecl|a.ModuleFlags.Ambient))return!0}else if(d.nodeType==a.NodeType.Class){if(!a.hasFlag(d.varFlags,a.VarFlags.Ambient))return!0}else if(d.nodeType==a.NodeType.VarDecl){if(!a.hasFlag(d.varFlags,a.VarFlags.Ambient))return!0}else if(d.nodeType==a.NodeType.FuncDecl){if(!d.isSignature())return!0}else if(d.nodeType!=a.NodeType.Interface&&d.nodeType!=a.NodeType.Empty)return!0}return!1},c.prototype.emit=function(b,c,d,e){if(this.emitRequired()){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),b.emitPrologue(this.requiresInherits);var f=e?b.setDeclContainingAST(this):null;b.emitJavascriptList(this.bod,null,a.TokenID.SColon,!0,!1,!1,e),e&&b.setDeclContainingAST(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)}},c}(t);a.Script=v;var w=function(a){function b(b,c,d){a.call(this,b),this.name=c,this.members=d,this.nty=b}return __extends(b,a),b}(b);a.Record=w;var x=function(b){function c(c,d,e,f){b.call(this,a.NodeType.Module,c,d),this.modFlags=a.ModuleFlags.ShouldEmitModuleDecl,this.alias=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.amdDependencies=[],this.members=d,this.vars=e,this.name=c,this.scopes=f,this.prettyName=this.name.text}return __extends(c,b),c.prototype.isExported=function(){return a.hasFlag(this.modFlags,a.ModuleFlags.Exported)},c.prototype.isAmbient=function(){return a.hasFlag(this.modFlags,a.ModuleFlags.Ambient)},c.prototype.isEnum=function(){return a.hasFlag(this.modFlags,a.ModuleFlags.IsEnum)},c.prototype.recordNonInterface=function(){this.modFlags&=~a.ModuleFlags.ShouldEmitModuleDecl},c.prototype.typeCheck=function(a){return a.typeCheckModule(this)},c.prototype.emit=function(b,c,d,e){a.hasFlag(this.modFlags,a.ModuleFlags.ShouldEmitModuleDecl)?e&&b.emitModuleSignature(this):(b.emitParensAndCommentsInPlace(this,!0),b.emitJavascriptModule(this,e),b.emitParensAndCommentsInPlace(this,!1))},c}(w);a.ModuleDecl=x;var y=function(a){function b(b,c,d,e,f){a.call(this,b,c,f),this.extendsList=d,this.implementsList=e,this.name=c,this.members=f}return __extends(b,a),b}(w);a.NamedType=y;var z=function(b){function c(c,e,f,g){b.call(this,a.NodeType.Class,c,f,g,e),this.varFlags=a.VarFlags.None,this.leftCurlyCount=0,this.rightCurlyCount=0,this.knownMemberNames={},this.constructorDecl=null,this.constructorNestingLevel=0,this.allMemberDefinitions=new d,this.name=c,this.baseClass=f,this.implementsList=g,this.definitionMembers=e}return __extends(c,b),c.prototype.isExported=function(){return a.hasFlag(this.varFlags,a.VarFlags.Exported)},c.prototype.isAmbient=function(){return a.hasFlag(this.varFlags,a.VarFlags.Ambient)},c.prototype.typeCheck=function(a){return a.typeCheckClass(this)},c.prototype.emit=function(a,b,c,d){a.emitJavascriptClass(this,d)},c}(y);a.ClassDecl=z;var A=function(b){function c(c,d,e,f,g,h){b.call(this,c,d,g,h,e),this.args=f,this.varFlags=a.VarFlags.None,this.isOverload=!1,this.leftCurlyCount=0,this.rightCurlyCount=0,this.nty=c,this.name=d,this.extendsList=g,this.implementsList=h,this.members=e}return __extends(c,b),c.prototype.isExported=function(){return a.hasFlag(this.varFlags,a.VarFlags.Exported)},c.prototype.isAmbient=function(){return a.hasFlag(this.varFlags,a.VarFlags.Ambient)},c.prototype.typeCheck=function(b){if(this.nty==a.NodeType.Interface)return b.typeCheckInterface(this);throw new Error("please implement type check for node type"+this.nty)},c.prototype.emit=function(b,c,d,e){if(this.nty!=a.NodeType.Interface)throw new Error("please implement emit for node type"+this.nty);e&&b.emitInterfaceDeclaration(this)},c}(y);a.TypeDecl=A;var B=function(b){function c(c){b.call(this,c),this.flags|=a.ASTFlags.IsStatement}return __extends(c,b),c.prototype.isLoop=function(){return!1},c.prototype.isCompoundStatement=function(){return this.isLoop()},c.prototype.typeCheck=function(a){return this.type=a.voidType,this},c}(b);a.Statement=B;var C=function(b){function c(c,d){b.call(this,a.NodeType.LabeledStatement),this.labels=c,this.stmt=d}return __extends(c,b),c.prototype.emit=function(a,b,c,d){a.emitParensAndCommentsInPlace(this,!0),a.recordSourceMappingStart(this);if(this.labels){var e=this.labels.members.length;for(var f=0;f<e;f++)this.labels.members[f].emit(a,b,c,d)}this.stmt.emit(a,b,!0,d),a.recordSourceMappingEnd(this),a.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return a.typeCheck(this.labels),this.stmt=this.stmt.typeCheck(a),this},c.prototype.addToControlFlow=function(b){var c=b.current,d=new a.BasicBlock;b.current=d,c.addSuccessor(d)},c}(B);a.LabeledStatement=C;var D=function(b){function c(c,d){b.call(this,a.NodeType.Block),this.stmts=c,this.visible=d}return __extends(c,b),c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),this.visible&&(b.writeLineToOutput(" {"),b.increaseIndent());var f=b.setInObjectLiteral(!1);this.stmts&&b.emitJavascriptList(this.stmts,null,a.TokenID.SColon,!0,!1,!1),this.visible&&(b.decreaseIndent(),b.emitIndent(),b.writeToOutput("}")),b.setInObjectLiteral(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.addToControlFlow=function(b){var c=new a.BasicBlock;b.pushStatement(this,b.current,c),this.stmts&&b.walk(this.stmts,this),b.walker.options.goChildren=!1,b.popStatement(),c.predecessors.length>0&&(b.current.addSuccessor(c),b.current=c)},c.prototype.typeCheck=function(a){return a.checker.styleSettings.emptyBlocks||(this.stmts===null||this.stmts.members.length==0)&&a.checker.errorReporter.styleError(this,"empty block"),a.typeCheck(this.stmts),this},c}(B);a.Block=D;var E=function(b){function c(a){b.call(this,a),this.target=null,this.resolvedTarget=null,this.nty=a}return __extends(c,b),c.prototype.hasExplicitTarget=function(){return this.target},c.prototype.setResolvedTarget=function(b,c){return c.isLoop()?(this.resolvedTarget=c,!0):this.nty===a.NodeType.Continue?(b.reportParseError("continue statement applies only to loops"),!1):c.nodeType==a.NodeType.Switch||this.hasExplicitTarget()?(this.resolvedTarget=c,!0):(b.reportParseError("break statement with no label can apply only to a loop or switch statement"),!1)},c.prototype.addToControlFlow=function(c){b.prototype.addToControlFlow.call(this,c),c.unconditionalBranch(this.resolvedTarget,this.nty==a.NodeType.Continue)},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),this.nty==a.NodeType.Break?b.writeToOutput("break"):b.writeToOutput("continue"),this.hasExplicitTarget()&&b.writeToOutput(" "+this.target),b.writeToOutput(";"),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c}(B);a.Jump=E;var F=function(b){function c(c){b.call(this,a.NodeType.While),this.cond=c,this.body=null}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isLoop=function(){return!0},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);var f=b.setInObjectLiteral(!1);b.writeToOutput("while("),b.emitJavascript(this.cond,a.TokenID.WHILE,!1),b.writeToOutput(")"),b.emitJavascriptStatements(this.body,!1,!1),b.setInObjectLiteral(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return a.typeCheckWhile(this)},c.prototype.addToControlFlow=function(b){var c=b.current,d=new a.BasicBlock,e=new a.BasicBlock;c.addSuccessor(d),b.current=d,b.addContent(this.cond);var f=b.current,g=null;this.body&&(b.current=new a.BasicBlock,f.addSuccessor(b.current),b.pushStatement(this,d,e),b.walk(this.body,this),g=b.popStatement());if(!b.noContinuation){var h=b.current;h.addSuccessor(d)}b.current=e,f.addSuccessor(e),b.noContinuation=!1,b.walker.options.goChildren=!1},c}(B);a.WhileStatement=F;var G=function(b){function c(){b.call(this,a.NodeType.DoWhile),this.body=null,this.whileAST=null,this.cond=null}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isLoop=function(){return!0},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);var f=b.setInObjectLiteral(!1);b.writeToOutput("do"),b.emitJavascriptStatements(this.body,!0,!1),b.recordSourceMappingStart(this.whileAST),b.writeToOutput("while"),b.recordSourceMappingEnd(this.whileAST),b.writeToOutput("("),b.emitJavascript(this.cond,a.TokenID.RParen,!1),b.writeToOutput(")"),b.setInObjectLiteral(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return a.typeCheckDoWhile(this)},c.prototype.addToControlFlow=function(b){var c=b.current,d=new a.BasicBlock,e=new a.BasicBlock;c.addSuccessor(d),b.current=d;var f=null;this.body&&(b.pushStatement(this,d,e),b.walk(this.body,this),f=b.popStatement());if(!b.noContinuation){var g=b.current;g.addSuccessor(d),b.addContent(this.cond),b.current=e,g.addSuccessor(e)}else b.addUnreachable(this.cond);b.walker.options.goChildren=!1},c}(B);a.DoWhileStatement=G;var H=function(b){function c(c){b.call(this,a.NodeType.If),this.cond=c,this.elseBod=null}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isCompoundStatement=function(){return!0},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);var f=b.setInObjectLiteral(!1);b.writeToOutput("if("),b.emitJavascript(this.cond,a.TokenID.IF,!1),b.writeToOutput(")"),b.emitJavascriptStatements(this.thenBod,!0,!1),this.elseBod&&(b.writeToOutput(" else"),b.emitJavascriptStatements(this.elseBod,!0,!0)),b.setInObjectLiteral(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return a.typeCheckIf(this)},c.prototype.addToControlFlow=function(b){this.cond.addToControlFlow(b);var c=new a.BasicBlock,d=b.current;b.pushStatement(this,d,c);var e=!1;b.current=new a.BasicBlock,d.addSuccessor(b.current),b.walk(this.thenBod,this),b.noContinuation||(e=!0,b.current.addSuccessor(c)),this.elseBod?(b.current=new a.BasicBlock,b.noContinuation=!1,d.addSuccessor(b.current),b.walk(this.elseBod,this),b.noContinuation?e&&(b.noContinuation=!1):(e=!0,b.current.addSuccessor(c))):(d.addSuccessor(c),b.noContinuation=!1,e=!0);var f=b.popStatement();c.predecessors.length>0&&(b.noContinuation=!1,e=!0),e&&(b.current=c),b.walker.options.goChildren=!1},c}(B);a.IfStatement=H;var I=function(b){function c(){b.call(this,a.NodeType.Return),this.returnExpression=null}return __extends(c,b),c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);var f=b.setInObjectLiteral(!1);this.returnExpression?(b.writeToOutput("return "),b.emitJavascript(this.returnExpression,a.TokenID.SColon,!1)):b.writeToOutput("return;"),b.setInObjectLiteral(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.addToControlFlow=function(a){b.prototype.addToControlFlow.call(this,a),a.returnStmt()},c.prototype.typeCheck=function(a){return a.typeCheckReturn(this)},c}(B);a.ReturnStatement=I;var J=function(b){function c(){b.call(this,a.NodeType.EndCode)}return __extends(c,b),c}(b);a.EndCode=J;var K=function(b){function c(c,d){b.call(this,a.NodeType.ForIn),this.lval=c,this.obj=d,this.lval&&this.lval.nodeType==a.NodeType.VarDecl&&(this.lval.varFlags|=a.VarFlags.AutoInit)}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isLoop=function(){return!0},c.prototype.isFiltered=function(){if(this.body){var b=null;if(this.body.nodeType==a.NodeType.List){var c=this.body;c.members.length==1&&(b=c.members[0])}else b=this.body;if(b!==null){if(b.nodeType==a.NodeType.Block){var d=b;d.stmts!==null&&d.stmts.members.length==1&&(b=d.stmts.members[0])}if(b.nodeType==a.NodeType.If){var e=b.cond;if(e.nodeType==a.NodeType.Call){var f=e.target;if(f.nodeType==a.NodeType.Dot){var g=f;if(g.operand1.nodeType==a.NodeType.Name&&this.obj.nodeType==a.NodeType.Name&&g.operand1.text==this.obj.text){var h=g.operand2;if(h.text=="hasOwnProperty"){var i=e.args;if(i!==null&&i.members.length==1){var j=i.members[0];if(j.nodeType==a.NodeType.Name&&this.lval.nodeType==a.NodeType.Name&&this.lval.text==j.text)return!0}}}}}}}}return!1},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);var f=b.setInObjectLiteral(!1);b.writeToOutput("for("),b.emitJavascript(this.lval,a.TokenID.FOR,!1),b.writeToOutput(" in "),b.emitJavascript(this.obj,a.TokenID.FOR,!1),b.writeToOutput(")"),b.emitJavascriptStatements(this.body,!0,!1),b.setInObjectLiteral(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return a.checker.styleSettings.forin&&(this.isFiltered()||a.checker.errorReporter.styleError(this,"no hasOwnProperty filter")),a.typeCheckForIn(this)},c.prototype.addToControlFlow=function(b){this.lval&&b.addContent(this.lval),this.obj&&b.addContent(this.obj);var c=b.current,d=new a.BasicBlock,e=new a.BasicBlock;c.addSuccessor(d),b.current=d,this.body&&(b.pushStatement(this,d,e),b.walk(this.body,this),b.popStatement());if(!b.noContinuation){var f=b.current;f.addSuccessor(d)}b.current=e,b.noContinuation=!1,c.addSuccessor(e),b.walker.options.goChildren=!1},c}(B);a.ForInStatement=K;var L=function(b){function c(c){b.call(this,a.NodeType.For),this.init=c}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isLoop=function(){return!0},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);var f=b.setInObjectLiteral(!1);b.writeToOutput("for("),this.init&&(this.init.nodeType!=a.NodeType.List?b.emitJavascript(this.init,a.TokenID.FOR,!1):b.emitForVarList(this.init)),b.writeToOutput("; "),b.emitJavascript(this.cond,a.TokenID.FOR,!1),b.writeToOutput("; "),b.emitJavascript(this.incr,a.TokenID.FOR,!1),b.writeToOutput(")"),b.emitJavascriptStatements(this.body,!0,!1),b.setInObjectLiteral(f),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return a.typeCheckFor(this)},c.prototype.addToControlFlow=function(b){this.init&&b.addContent(this.init);var c=b.current,d=new a.BasicBlock,e=new a.BasicBlock;c.addSuccessor(d),b.current=d;var f=null,g=d,h=null;this.incr&&(h=new a.BasicBlock,g=h),this.cond&&(f=b.current,b.addContent(this.cond),b.current=new a.BasicBlock,f.addSuccessor(b.current));var i=null;this.body&&(b.pushStatement(this,g,e),b.walk(this.body,this),i=b.popStatement()),this.incr&&(b.noContinuation?h.predecessors.length==0&&b.addUnreachable(this.incr):(b.current.addSuccessor(h),b.current=h,b.addContent(this.incr)));var j=b.current;b.noContinuation||j.addSuccessor(d),f&&(f.addSuccessor(e),b.noContinuation=!1),e.predecessors.length>0&&(b.noContinuation=!1,b.current=e),b.walker.options.goChildren=!1},c}(B);a.ForStatement=L;var M=function(b){function c(c){b.call(this,a.NodeType.With),this.expr=c,this.withSym=null}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isCompoundStatement=function(){return!0},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),b.writeToOutput("with ("),this.expr&&b.emitJavascript(this.expr,a.TokenID.WITH,!1),b.writeToOutput(")"),b.emitJavascriptStatements(this.body,!0,!1),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return a.typeCheckWith(this)},c}(B);a.WithStatement=M;var N=function(b){function c(c){b.call(this,a.NodeType.Switch),this.val=c,this.defaultCase=null}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isCompoundStatement=function(){return!0},c.prototype.emit=function(b,c,d){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this);var e=b.setInObjectLiteral(!1);b.writeToOutput("switch("),b.emitJavascript(this.val,a.TokenID.ID,!1),b.writeLineToOutput(") {"),b.increaseIndent();var f=this.caseList.members.length;for(var g=0;g<f;g++){var h=this.caseList.members[g];b.emitJavascript(h,a.TokenID.CASE,!0),b.writeLineToOutput("")}b.decreaseIndent(),b.emitIndent(),b.writeToOutput("}"),b.setInObjectLiteral(e),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){var b=this.caseList.members.length;this.val=a.typeCheck(this.val);for(var c=0;c<b;c++)this.caseList.members[c]=a.typeCheck(this.caseList.members[c]);return this.defaultCase=a.typeCheck(this.defaultCase),this.type=a.voidType,this},c.prototype.addToControlFlow=function(b){var c=b.current;b.addContent(this.val);var d=new a.BasicBlock,e=new a.BasicBlock;c.addSuccessor(d),b.pushSwitch(d),b.current=d,b.pushStatement(this,d,e),b.walk(this.caseList,this),b.popSwitch();var f=b.popStatement(),g=this.defaultCase==null;this.defaultCase==null&&c.addSuccessor(e),e.predecessors.length>0?(b.noContinuation=!1,b.current=e):b.noContinuation=!0,b.walker.options.goChildren=!1},c}(B);a.SwitchStatement=N;var O=function(b){function c(){b.call(this,a.NodeType.Case),this.expr=null}return __extends(c,b),c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),this.expr?(b.writeToOutput("case "),b.emitJavascript(this.expr,a.TokenID.ID,!1)):b.writeToOutput("default"),b.writeToOutput(":"),b.emitJavascriptStatements(this.body,!1,!1),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return this.expr=a.typeCheck(this.expr),a.typeCheck(this.body),this.type=a.voidType,this},c.prototype.addToControlFlow=function(b){var c=new a.BasicBlock,d=b.currentSwitch[b.currentSwitch.length-1];if(this.expr){var e=new a.BasicBlock;b.current=e,d.addSuccessor(e),b.addContent(this.expr),e.addSuccessor(c)}else d.addSuccessor(c);b.current=c,this.body&&b.walk(this.body,this),b.noContinuation=!1,b.walker.options.goChildren=!1},c}(B);a.CaseStatement=O;var P=function(b){function c(c,d){b.call(this,a.NodeType.TypeRef),this.term=c,this.arrayCount=d}return __extends(c,b),c.prototype.emit=function(a,b,c,d){throw new Error("should not emit a type ref")},c.prototype.typeCheck=function(b){var c=b.inTypeRefTypeCheck;b.inTypeRefTypeCheck=!0;var d=a.getTypeLink(this,b.checker,!0);return b.checker.resolveTypeLink(b.scope,d,!1),b.checkForVoidConstructor(d.type,this),this.type=d.type,this.term&&(this.term.type=this.type),b.inTypeRefTypeCheck=c,this},c}(b);a.TypeReference=P;var Q=function(b){function c(c,d){b.call(this,a.NodeType.TryFinally),this.tryNode=c,this.finallyNode=d}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isCompoundStatement=function(){return!0},c.prototype.emit=function(b,c,d){b.recordSourceMappingStart(this),b.emitJavascript(this.tryNode,a.TokenID.TRY,!1),b.emitJavascript(this.finallyNode,a.TokenID.FINALLY,!1),b.recordSourceMappingEnd(this)},c.prototype.typeCheck=function(a){return this.tryNode=a.typeCheck(this.tryNode),this.finallyNode=a.typeCheck(this.finallyNode),this.type=a.voidType,this},c.prototype.addToControlFlow=function(b){var c=new a.BasicBlock;b.walk(this.tryNode,this);var d=new a.BasicBlock;b.current&&b.current.addSuccessor(d),b.current=d,b.pushStatement(this,null,c),b.walk(this.finallyNode,this),!b.noContinuation&&b.current&&b.current.addSuccessor(c),c.predecessors.length>0?b.current=c:b.noContinuation=!0,b.popStatement(),b.walker.options.goChildren=!1},c}(B);a.TryFinally=Q;var R=function(b){function c(c,d){b.call(this,a.NodeType.TryCatch),this.tryNode=c,this.catchNode=d}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.isCompoundStatement=function(){return!0},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),b.emitJavascript(this.tryNode,a.TokenID.TRY,!1),b.emitJavascript(this.catchNode,a.TokenID.CATCH,!1),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.addToControlFlow=function(b){var c=b.current,d=new a.BasicBlock;c.addSuccessor(d),b.current=d;var e=new a.BasicBlock;b.pushStatement(this,null,e),b.walk(this.tryNode,this),b.noContinuation||b.current&&b.current.addSuccessor(e),b.current=new a.BasicBlock,c.addSuccessor(b.current),b.walk(this.catchNode,this),b.popStatement(),b.noContinuation||b.current&&b.current.addSuccessor(e),b.current=e,b.walker.options.goChildren=!1},c.prototype.typeCheck=function(a){return this.tryNode=a.typeCheck(this.tryNode),this.catchNode=a.typeCheck(this.catchNode),this.type=a.voidType,this},c}(B);a.TryCatch=R;var S=function(b){function c(c){b.call(this,a.NodeType.Try),this.body=c}return __extends(c,b),c.prototype.isStatementOrExpression=function(){return!0},c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),b.writeToOutput("try "),b.emitJavascript(this.body,a.TokenID.TRY,!1),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.typeCheck=function(a){return this.body=a.typeCheck(this.body),this},c.prototype.addToControlFlow=function(a){this.body&&a.walk(this.body,this),a.walker.options.goChildren=!1,a.noContinuation=!1},c}(B);a.Try=S;var T=function(b){function c(c,d){b.call(this,a.NodeType.Catch),this.param=c,this.body=d,this.containedScope=null,this.param&&(this.param.varFlags|=a.VarFlags.AutoInit)}return __extends(c,b),c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),b.writeToOutput(" catch ("),b.emitJavascript(this.param,a.TokenID.LParen,!1),b.writeToOutput(")"),b.emitJavascript(this.body,a.TokenID.CATCH,!1),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.addToControlFlow=function(b){if(this.param){b.addContent(this.param);var c=new a.BasicBlock;b.current.addSuccessor(c),b.current=c}this.body&&b.walk(this.body,this),b.noContinuation=!1,b.walker.options.goChildren=!1},c.prototype.typeCheck=function(b){var c=b.scope;b.scope=this.containedScope,this.param=b.typeCheck(this.param);var d=new a.ValueLocation,e=new a.VariableSymbol(this.param.id.text,this.param.minChar,b.checker.locationInfo.unitIndex,d);d.symbol=e,d.typeLink=new a.TypeLink,d.typeLink.type=b.anyType;var f=b.thisFnc;f&&f.type?d.symbol.container=f.type.symbol:d.symbol.container=null,this.param.sym=d.symbol,b.scope.enter(d.symbol.container,this.param,d.symbol,b.checker.errorReporter,!1,!1,!1),this.body=b.typeCheck(this.body);if(b.checker.inProvisionalTypecheckMode()){var g=b.scope.getTable();g.secondaryTable.table[d.symbol.name]=undefined}return this.type=b.voidType,b.scope=c,this},c}(B);a.Catch=T;var U=function(b){function c(c){b.call(this,a.NodeType.Finally),this.body=c}return __extends(c,b),c.prototype.emit=function(b,c,d,e){b.emitParensAndCommentsInPlace(this,!0),b.recordSourceMappingStart(this),b.writeToOutput("finally"),b.emitJavascript(this.body,a.TokenID.FINALLY,!1),b.recordSourceMappingEnd(this),b.emitParensAndCommentsInPlace(this,!1)},c.prototype.addToControlFlow=function(a){this.body&&a.walk(this.body,this),a.walker.options.goChildren=!1,a.noContinuation=!1},c.prototype.typeCheck=function(a){return this.body=a.typeCheck(this.body),this},c}(B);a.Finally=U;var V=function(b){function c(c,d,e){b.call(this,a.NodeType.Comment),this.content=c,this.isBlockComment=d,this.endsLine=e,this.text=null}return __extends(c,b),c.prototype.getText=function(){if(this.text==null)if(this.isBlockComment){this.text=this.content.split("\n");for(var a=0;a<this.text.length;a++)this.text[a]=this.text[a].replace(/^\s+|\s+$/g,"")}else this.text=[this.content.replace(/^\s+|\s+$/g,"")];return this.text},c}(b);a.Comment=V;var W=function(b){function c(){b.call(this,a.NodeType.Debugger)}return __extends(c,b),c.prototype.emit=function(a,b,c,d){a.emitParensAndCommentsInPlace(this,!0),a.recordSourceMappingStart(this),a.writeLineToOutput("debugger;"),a.recordSourceMappingEnd(this),a.emitParensAndCommentsInPlace(this,!1)},c}(B);a.DebuggerStatement=W})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function f(){return e||(e=new d),e}var b=function(){function a(){this.goChildren=!0,this.goNextSibling=!0,this.reverseSiblings=!1}return a.prototype.stopWalk=function(a){typeof a=="undefined"&&(a=!0),this.goChildren=!a,this.goNextSibling=!a},a}();a.AstWalkOptions=b;var c=function(){function a(a,b,c,d,e){this.childrenWalkers=a,this.pre=b,this.post=c,this.options=d,this.state=e}return a.prototype.walk=function(a,b){var c=this.pre(a,b,this);c===undefined&&(c=a);if(this.options.goChildren){var d=this.options.goNextSibling;this.options.goNextSibling=!0,this.childrenWalkers[a.nodeType](a,b,this),this.options.goNextSibling=d}else this.options.goChildren=!0;if(this.post){var e=this.post(c,b,this);return e===undefined&&(e=c),e}return c},a}(),d=function(){function d(){this.childrenWalkers=[],this.initChildrenWalkers()}return d.prototype.walk=function(a,b,c,d,e){return this.getWalker(b,c,d,e).walk(a,null)},d.prototype.getWalker=function(a,b,c,d){return this.getSlowWalker(a,b,c,d)},d.prototype.getSlowWalker=function(a,d,e,f){return e||(e=new b),new c(this.childrenWalkers,a,d,e,f)},d.prototype.initChildrenWalkers=function(){this.childrenWalkers[a.NodeType.None]=g.walkNone,this.childrenWalkers[a.NodeType.Empty]=g.walkNone,this.childrenWalkers[a.NodeType.EmptyExpr]=g.walkNone,this.childrenWalkers[a.NodeType.True]=g.walkNone,this.childrenWalkers[a.NodeType.False]=g.walkNone,this.childrenWalkers[a.NodeType.This]=g.walkNone,this.childrenWalkers[a.NodeType.Super]=g.walkNone,this.childrenWalkers[a.NodeType.QString]=g.walkNone,this.childrenWalkers[a.NodeType.Regex]=g.walkNone,this.childrenWalkers[a.NodeType.Null]=g.walkNone,this.childrenWalkers[a.NodeType.ArrayLit]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.ObjectLit]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.Void]=g.walkNone,this.childrenWalkers[a.NodeType.Comma]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Pos]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.Neg]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.Delete]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.Await]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.In]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Dot]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.From]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Is]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.InstOf]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Typeof]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.NumberLit]=g.walkNone,this.childrenWalkers[a.NodeType.Name]=g.walkNone,this.childrenWalkers[a.NodeType.TypeRef]=g.walkTypeReferenceChildren,this.childrenWalkers[a.NodeType.Index]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Call]=g.walkCallExpressionChildren,this.childrenWalkers[a.NodeType.New]=g.walkCallExpressionChildren,this.childrenWalkers[a.NodeType.Asg]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgAdd]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgSub]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgDiv]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgMul]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgMod]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgAnd]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgXor]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgOr]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgLsh]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgRsh]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.AsgRs2]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.QMark]=g.walkTrinaryExpressionChildren,this.childrenWalkers[a.NodeType.LogOr]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.LogAnd]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Or]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Xor]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.And]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Eq]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Ne]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Eqv]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.NEqv]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Lt]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Le]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Gt]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Ge]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Add]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Sub]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Mul]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Div]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Mod]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Lsh]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Rsh]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Rs2]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.Not]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.LogNot]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.IncPre]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.DecPre]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.IncPost]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.DecPost]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.TypeAssertion]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.FuncDecl]=g.walkFuncDeclChildren,this.childrenWalkers[a.NodeType.Member]=g.walkBinaryExpressionChildren,this.childrenWalkers[a.NodeType.VarDecl]=g.walkBoundDeclChildren,this.childrenWalkers[a.NodeType.ArgDecl]=g.walkBoundDeclChildren,this.childrenWalkers[a.NodeType.Return]=g.walkReturnStatementChildren,this.childrenWalkers[a.NodeType.Break]=g.walkNone,this.childrenWalkers[a.NodeType.Continue
]=g.walkNone,this.childrenWalkers[a.NodeType.Throw]=g.walkUnaryExpressionChildren,this.childrenWalkers[a.NodeType.For]=g.walkForStatementChildren,this.childrenWalkers[a.NodeType.ForIn]=g.walkForInStatementChildren,this.childrenWalkers[a.NodeType.If]=g.walkIfStatementChildren,this.childrenWalkers[a.NodeType.While]=g.walkWhileStatementChildren,this.childrenWalkers[a.NodeType.DoWhile]=g.walkDoWhileStatementChildren,this.childrenWalkers[a.NodeType.Block]=g.walkBlockChildren,this.childrenWalkers[a.NodeType.Case]=g.walkCaseStatementChildren,this.childrenWalkers[a.NodeType.Switch]=g.walkSwitchStatementChildren,this.childrenWalkers[a.NodeType.Try]=g.walkTryChildren,this.childrenWalkers[a.NodeType.TryCatch]=g.walkTryCatchChildren,this.childrenWalkers[a.NodeType.TryFinally]=g.walkTryFinallyChildren,this.childrenWalkers[a.NodeType.Finally]=g.walkFinallyChildren,this.childrenWalkers[a.NodeType.Catch]=g.walkCatchChildren,this.childrenWalkers[a.NodeType.List]=g.walkListChildren,this.childrenWalkers[a.NodeType.Script]=g.walkScriptChildren,this.childrenWalkers[a.NodeType.Class]=g.walkClassDeclChildren,this.childrenWalkers[a.NodeType.Interface]=g.walkTypeDeclChildren,this.childrenWalkers[a.NodeType.Module]=g.walkModuleDeclChildren,this.childrenWalkers[a.NodeType.Import]=g.walkImportDeclChildren,this.childrenWalkers[a.NodeType.With]=g.walkWithStatementChildren,this.childrenWalkers[a.NodeType.Label]=g.walkLabelChildren,this.childrenWalkers[a.NodeType.LabeledStatement]=g.walkLabeledStatementChildren,this.childrenWalkers[a.NodeType.EBStart]=g.walkNone,this.childrenWalkers[a.NodeType.GotoEB]=g.walkNone,this.childrenWalkers[a.NodeType.EndCode]=g.walkNone,this.childrenWalkers[a.NodeType.Error]=g.walkNone,this.childrenWalkers[a.NodeType.Comment]=g.walkNone,this.childrenWalkers[a.NodeType.Debugger]=g.walkNone;for(var b in a.NodeType._map)if(this.childrenWalkers[b]===undefined)throw new Error("initWalkers function is not up to date with enum content!")},d}();a.AstWalkerFactory=d;var e;a.getAstWalkerFactory=f;var g;(function(a){function b(a,b,c){}function c(a,b,c){var d=a.members.length;if(c.options.reverseSiblings)for(var e=d-1;e>=0;e--)c.options.goNextSibling&&(a.members[e]=c.walk(a.members[e],a));else for(var e=0;e<d;e++)c.options.goNextSibling&&(a.members[e]=c.walk(a.members[e],a))}function d(a,b,c){a.castTerm&&(a.castTerm=c.walk(a.castTerm,a)),a.operand&&(a.operand=c.walk(a.operand,a))}function e(a,b,c){c.options.reverseSiblings?(a.operand2&&(a.operand2=c.walk(a.operand2,a)),a.operand1&&c.options.goNextSibling&&(a.operand1=c.walk(a.operand1,a))):(a.operand1&&(a.operand1=c.walk(a.operand1,a)),a.operand2&&c.options.goNextSibling&&(a.operand2=c.walk(a.operand2,a)))}function f(a,b,c){a.term&&(a.term=c.walk(a.term,a))}function g(a,b,c){c.options.reverseSiblings||(a.target=c.walk(a.target,a)),a.args&&c.options.goNextSibling&&(a.args=c.walk(a.args,a)),c.options.reverseSiblings&&c.options.goNextSibling&&(a.target=c.walk(a.target,a))}function h(a,b,c){a.operand1&&(a.operand1=c.walk(a.operand1,a)),a.operand2&&c.options.goNextSibling&&(a.operand2=c.walk(a.operand2,a)),a.operand3&&c.options.goNextSibling&&(a.operand3=c.walk(a.operand3,a))}function i(a,b,c){a.name&&(a.name=c.walk(a.name,a)),a.args&&a.args.members.length>0&&c.options.goNextSibling&&(a.args=c.walk(a.args,a)),a.returnTypeAnnotation&&c.options.goNextSibling&&(a.returnTypeAnnotation=c.walk(a.returnTypeAnnotation,a)),a.bod&&a.bod.members.length>0&&c.options.goNextSibling&&(a.bod=c.walk(a.bod,a))}function j(a,b,c){a.id&&(a.id=c.walk(a.id,a)),a.init&&(a.init=c.walk(a.init,a)),a.typeExpr&&c.options.goNextSibling&&(a.typeExpr=c.walk(a.typeExpr,a))}function k(a,b,c){a.returnExpression&&(a.returnExpression=c.walk(a.returnExpression,a))}function l(a,b,c){a.init&&(a.init=c.walk(a.init,a)),a.cond&&c.options.goNextSibling&&(a.cond=c.walk(a.cond,a)),a.incr&&c.options.goNextSibling&&(a.incr=c.walk(a.incr,a)),a.body&&c.options.goNextSibling&&(a.body=c.walk(a.body,a))}function m(a,b,c){a.lval=c.walk(a.lval,a),c.options.goNextSibling&&(a.obj=c.walk(a.obj,a)),a.body&&c.options.goNextSibling&&(a.body=c.walk(a.body,a))}function n(a,b,c){a.cond=c.walk(a.cond,a),a.thenBod&&c.options.goNextSibling&&(a.thenBod=c.walk(a.thenBod,a)),a.elseBod&&c.options.goNextSibling&&(a.elseBod=c.walk(a.elseBod,a))}function o(a,b,c){a.cond=c.walk(a.cond,a),a.body&&c.options.goNextSibling&&(a.body=c.walk(a.body,a))}function p(a,b,c){a.cond=c.walk(a.cond,a),a.body&&c.options.goNextSibling&&(a.body=c.walk(a.body,a))}function q(a,b,c){a.stmts&&(a.stmts=c.walk(a.stmts,a))}function r(a,b,c){a.expr&&(a.expr=c.walk(a.expr,a)),a.body&&c.options.goNextSibling&&(a.body=c.walk(a.body,a))}function s(a,b,c){a.val&&(a.val=c.walk(a.val,a)),a.caseList&&c.options.goNextSibling&&(a.caseList=c.walk(a.caseList,a))}function t(a,b,c){a.body&&(a.body=c.walk(a.body,a))}function u(a,b,c){a.tryNode&&(a.tryNode=c.walk(a.tryNode,a)),a.catchNode&&c.options.goNextSibling&&(a.catchNode=c.walk(a.catchNode,a))}function v(a,b,c){a.tryNode&&(a.tryNode=c.walk(a.tryNode,a)),a.finallyNode&&c.options.goNextSibling&&(a.finallyNode=c.walk(a.finallyNode,a))}function w(a,b,c){a.body&&(a.body=c.walk(a.body,a))}function x(a,b,c){a.param&&(a.param=c.walk(a.param,a)),a.body&&c.options.goNextSibling&&(a.body=c.walk(a.body,a))}function y(a,b,c){a.name=c.walk(a.name,a),c.options.goNextSibling&&a.members&&(a.members=c.walk(a.members,a))}function z(a,b,c){y(a,b,c)}function A(a,b,c){z(a,b,c),c.options.goNextSibling&&a.baseClass&&(a.baseClass=c.walk(a.baseClass,a)),c.options.goNextSibling&&a.implementsList&&(a.implementsList=c.walk(a.implementsList,a))}function B(a,b,c){a.bod&&(a.bod=c.walk(a.bod,a))}function C(a,b,c){z(a,b,c),c.options.goNextSibling&&a.extendsList&&(a.extendsList=c.walk(a.extendsList,a)),c.options.goNextSibling&&a.implementsList&&(a.implementsList=c.walk(a.implementsList,a))}function D(a,b,c){y(a,b,c),c.options.goNextSibling&&a.alias&&(a.alias=c.walk(a.alias,a))}function E(a,b,c){a.id&&(a.id=c.walk(a.id,a)),a.alias&&(a.alias=c.walk(a.alias,a))}function F(a,b,c){a.expr&&(a.expr=c.walk(a.expr,a)),a.body&&c.options.goNextSibling&&(a.body=c.walk(a.body,a))}function G(a,b,c){}function H(a,b,c){a.labels=c.walk(a.labels,a),c.options.goNextSibling&&(a.stmt=c.walk(a.stmt,a))}a.walkNone=b,a.walkListChildren=c,a.walkUnaryExpressionChildren=d,a.walkBinaryExpressionChildren=e,a.walkTypeReferenceChildren=f,a.walkCallExpressionChildren=g,a.walkTrinaryExpressionChildren=h,a.walkFuncDeclChildren=i,a.walkBoundDeclChildren=j,a.walkReturnStatementChildren=k,a.walkForStatementChildren=l,a.walkForInStatementChildren=m,a.walkIfStatementChildren=n,a.walkWhileStatementChildren=o,a.walkDoWhileStatementChildren=p,a.walkBlockChildren=q,a.walkCaseStatementChildren=r,a.walkSwitchStatementChildren=s,a.walkTryChildren=t,a.walkTryCatchChildren=u,a.walkTryFinallyChildren=v,a.walkFinallyChildren=w,a.walkCatchChildren=x,a.walkRecordChildren=y,a.walkNamedTypeChildren=z,a.walkClassDeclChildren=A,a.walkScriptChildren=B,a.walkTypeDeclChildren=C,a.walkModuleDeclChildren=D,a.walkImportDeclChildren=E,a.walkWithStatementChildren=F,a.walkLabelChildren=G,a.walkLabeledStatementChildren=H})(g||(g={}))})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function b(a){return a===null||a.length===0?null:a[a.length-1]}function c(a,b){return a>=b?a:b}function d(a,b){return a<=b?a:b}function f(a){return a===null?!1:a.minChar===-1||a.limChar===-1?!1:!0}function i(b,c,d){typeof d=="undefined"&&(d=h.Default);var e=function(a){if(a&&a.length>0)for(var b=0;b<a.length;b++){var d=a[b].minChar,e=a[b].limChar;a[b].isBlockComment||e++,c>=d&&c<e&&j.path.push(a[b])}},i=function(g,i,k){if(f(g)){var l=a.hasFlag(d,h.EdgeInclusive)||g.nodeType===a.NodeType.Name||c===b.limChar,m=g.minChar,n=g.limChar+(l?1:0);if(c>=m&&c<n){var o=j.path.ast();(o==null||g.minChar>=o.minChar&&g.limChar<=o.limChar)&&j.path.push(g)}c<n&&e(g.preComments),c>=m&&e(g.postComments),a.hasFlag(d,h.DontPruneSearchBasedOnPosition)||(k.options.goChildren=m<=c&&c<=n)}return g},j=new g;return a.getAstWalkerFactory().walk(b,i,null,null,j),j.path}function j(b,d){var e=0,f=function(b,f,g){if(a.isValidAstNode(b)){b.minChar<=d&&(e=c(e,b.minChar));if(b.minChar>d||b.limChar<e)g.options.goChildren=!1}return b};return a.getAstWalkerFactory().walk(b,f),e}function k(b,c){var d=function(a,b,d){var e=d.state;return e.push(a),c(e,d),a},f=function(a,b,c){var d=c.state;return d.pop(),a},g=new e;a.getAstWalkerFactory().walk(b,d,f,null,g)}a.lastOf=b,a.max=c,a.min=d;var e=function(){function c(){this.asts=[],this.top=-1}return c.reverseIndexOf=function(b,c){return b===null||b.length<=c?null:b[b.length-c-1]},c.prototype.clone=function(){var a=new c;return a.asts=this.asts.map(function(a){return a}),a.top=this.top,a},c.prototype.pop=function(){var a=this.ast();this.up();while(this.asts.length>this.count())this.asts.pop();return a},c.prototype.push=function(a){while(this.asts.length>this.count())this.asts.pop();this.top=this.asts.length,this.asts.push(a)},c.prototype.up=function(){if(this.top<=-1)throw new Error("Invalid call to 'up'");this.top--},c.prototype.down=function(){if(this.top==this.ast.length-1)throw new Error("Invalid call to 'down'");this.top++},c.prototype.nodeType=function(){return this.ast()==null?a.NodeType.None:this.ast().nodeType},c.prototype.ast=function(){return c.reverseIndexOf(this.asts,this.asts.length-(this.top+1))},c.prototype.parent=function(){return c.reverseIndexOf(this.asts,this.asts.length-this.top)},c.prototype.count=function(){return this.top+1},c.prototype.get=function(a){return this.asts[a]},c.prototype.isNameOfClass=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===a.NodeType.Name&&this.parent().nodeType===a.NodeType.Class&&this.parent().name===this.ast()},c.prototype.isNameOfInterface=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===a.NodeType.Name&&this.parent().nodeType===a.NodeType.Interface&&this.parent().name===this.ast()},c.prototype.isNameOfArgument=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===a.NodeType.Name&&this.parent().nodeType===a.NodeType.ArgDecl&&this.parent().id===this.ast()},c.prototype.isNameOfVariable=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===a.NodeType.Name&&this.parent().nodeType===a.NodeType.VarDecl&&this.parent().id===this.ast()},c.prototype.isNameOfModule=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===a.NodeType.Name&&this.parent().nodeType===a.NodeType.Module&&this.parent().name===this.ast()},c.prototype.isNameOfFunction=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===a.NodeType.Name&&this.parent().nodeType===a.NodeType.FuncDecl&&this.parent().name===this.ast()},c.prototype.isChildOfScript=function(){var c=b(this.asts);return this.count()>=3&&this.asts[this.top]===c&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].nodeType===a.NodeType.Script},c.prototype.isChildOfModule=function(){var c=b(this.asts);return this.count()>=3&&this.asts[this.top]===c&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].nodeType===a.NodeType.Module},c.prototype.isChildOfClass=function(){var c=b(this.asts);return this.count()>=3&&this.asts[this.top]===c&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].nodeType===a.NodeType.Class},c.prototype.isArgumentOfClassConstructor=function(){var c=b(this.asts);return this.count()>=5&&this.asts[this.top]===c&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].nodeType===a.NodeType.FuncDecl&&this.asts[this.top-3].nodeType===a.NodeType.List&&this.asts[this.top-4].nodeType===a.NodeType.Class&&this.asts[this.top-2].isConstructor&&this.asts[this.top-2].args===this.asts[this.top-1]&&this.asts[this.top-4].constructorDecl===this.asts[this.top-2]},c.prototype.isChildOfInterface=function(){var c=b(this.asts);return this.count()>=3&&this.asts[this.top]===c&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].nodeType===a.NodeType.Interface},c.prototype.isTopLevelImplicitModule=function(){return this.count()>=1&&this.asts[this.top].nodeType===a.NodeType.Module&&a.hasFlag(this.asts[this.top].modFlags,a.ModuleFlags.IsWholeFile)},c.prototype.isBodyOfTopLevelImplicitModule=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===a.NodeType.List&&this.asts[this.top-1].nodeType===a.NodeType.Module&&this.asts[this.top-1].members==this.asts[this.top-0]&&a.hasFlag(this.asts[this.top-1].modFlags,a.ModuleFlags.IsWholeFile)},c.prototype.isBodyOfScript=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Script&&this.asts[this.top-1].bod==this.asts[this.top-0]},c.prototype.isBodyOfSwitch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Switch&&this.asts[this.top-1].caseList==this.asts[this.top-0]},c.prototype.isBodyOfModule=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Module&&this.asts[this.top-1].members==this.asts[this.top-0]},c.prototype.isBodyOfClass=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Class&&this.asts[this.top-1].members==this.asts[this.top-0]},c.prototype.isBodyOfFunction=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.FuncDecl&&this.asts[this.top-1].bod==this.asts[this.top-0]},c.prototype.isBodyOfInterface=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Interface&&this.asts[this.top-1].members==this.asts[this.top-0]},c.prototype.isBodyOfBlock=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Block&&this.asts[this.top-1].stmts==this.asts[this.top-0]},c.prototype.isBodyOfFor=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.For&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfCase=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Case&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfTry=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Try&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfCatch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Catch&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfDoWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.DoWhile&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.While&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfForIn=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.ForIn&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfWith=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.With&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isBodyOfFinally=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Finally&&this.asts[this.top-1].body==this.asts[this.top-0]},c.prototype.isCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===a.NodeType.Switch&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]},c.prototype.isDefaultCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===a.NodeType.Switch&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]&&this.asts[this.top-2].defaultCase==this.asts[this.top-0]},c.prototype.isListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===a.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},c.prototype.isBodyOfObjectLit=function(){return this.isListOfObjectLit()},c.prototype.isEmptyListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===a.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]&&this.asts[this.top-0].members.length==0},c.prototype.isMemberOfObjectLit=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===a.NodeType.ObjectLit&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-0].nodeType===a.NodeType.Member&&this.asts[this.top-2].operand==this.asts[this.top-1]},c.prototype.isNameOfMemberOfObjectLit=function(){return this.count()>=4&&this.asts[this.top-3].nodeType===a.NodeType.ObjectLit&&this.asts[this.top-2].nodeType===a.NodeType.List&&this.asts[this.top-1].nodeType===a.NodeType.Member&&this.asts[this.top-0].nodeType===a.NodeType.Name&&this.asts[this.top-3].operand==this.asts[this.top-2]},c.prototype.isListOfArrayLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.ArrayLit&&this.asts[this.top-0].nodeType===a.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},c.prototype.isTargetOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Member&&this.asts[this.top-1].operand1===this.asts[this.top-0]},c.prototype.isMemberOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.Member&&this.asts[this.top-1].operand2===this.asts[this.top-0]},c.prototype.isItemOfList=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.List},c.prototype.isThenOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.If&&this.asts[this.top-1].thenBod==this.asts[this.top-0]},c.prototype.isElseOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===a.NodeType.If&&this.asts[this.top-1].elseBod==this.asts[this.top-0]},c.prototype.isBodyOfDefaultCase=function(){return this.isBodyOfCase()},c.prototype.isSingleStatementList=function(){return this.count()>=1&&this.asts[this.top].nodeType===a.NodeType.List&&this.asts[this.top].members.length===1},c.prototype.isArgumentListOfFunction=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===a.NodeType.List&&this.asts[this.top-1].nodeType===a.NodeType.FuncDecl&&this.asts[this.top-1].args===this.asts[this.top-0]},c.prototype.isArgumentOfFunction=function(){return this.count()>=3&&this.asts[this.top-1].nodeType===a.NodeType.List&&this.asts[this.top-2].nodeType===a.NodeType.FuncDecl&&this.asts[this.top-2].args===this.asts[this.top-1]},c.prototype.isArgumentListOfCall=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===a.NodeType.List&&this.asts[this.top-1].nodeType===a.NodeType.Call&&this.asts[this.top-1].args===this.asts[this.top-0]},c.prototype.isArgumentListOfNew=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===a.NodeType.List&&this.asts[this.top-1].nodeType===a.NodeType.New&&this.asts[this.top-1].args===this.asts[this.top-0]},c.prototype.isSynthesizedBlock=function(){return this.count()>=1&&this.asts[this.top-0].nodeType===a.NodeType.Block&&this.asts[this.top-0].visible===!1},c}();a.AstPath=e,a.isValidAstNode=f;var g=function(){function b(){this.path=new a.AstPath}return b}();a.AstPathContext=g,function(a){a._map=[],a.Default=0,a.EdgeInclusive=1,a.DontPruneSearchBasedOnPosition=2}(a.GetAstPathOptions||(a.GetAstPathOptions={}));var h=a.GetAstPathOptions;a.getAstPathToPosition=i,a.getTokenizationOffset=j,a.walkAST=k})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function b(a){this.logger=a}return b.prototype.logScript=function(b){var c=this;this.logLinemap(b.locationInfo.lineMap);var d=[],e=function(a,e){d.push(a);var f=(d.length-1)*2;return c.logComments(b,a.preComments,f),c.logNode(b,a,f),c.logComments(b,a.postComments,f),a},f=function(a,b){return d.pop(),a};a.getAstWalkerFactory().walk(b,e,f)},b.prototype.logNode=function(a,b,c){var d=this.addPadding("",c,"| ",!0);d=d.concat("+ "+b.treeViewLabel()),d=this.addPadding(d,70," ",!1),d+=this.addLineColumn(a,b.minChar),d=this.addPadding(d,80," ",!1),d+="=> ",d+=this.addLineColumn(a,b.limChar),d=this.addPadding(d,102," ",!1),d=d.concat("["+this.addPadding(b.minChar.toString(),1," ",!0)+", "+this.addPadding(b.limChar.toString(),1," ",!0)+"]"),d=this.addPadding(d,115," ",!1),d=d.concat("sym="+b.sym),d=this.addPadding(d,135," ",!1),d=d.concat("type="+(b.type===null?"null":b.type.getTypeName())),this.logger.log(d)},b.prototype.logComments=function(a,b,c){if(b==null)return;for(var d=0;d<b.length;d++)this.logNode(a,b[d],c)},b.prototype.logLinemap=function(a){var b="[";for(var c=0;c<a.length;c++)c>0&&(b+=","),b+=a[c];b+="]",this.logger.log("linemap: "+b)},b.prototype.addPadding=function(a,b,c,d){var e=d?"":a;for(var f=a.length;f<b;f++)e+=c;return e+=d?a:"",e},b.prototype.addLineColumn=function(b,c){var d={line:-1,col:-1};return a.getSourceLineColFromMap(d,c,b.locationInfo.lineMap),d.col!==-1&&d.col++,"("+d.line+", "+d.col+")"},b}();a.AstLogger=b})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function b(a){this.checker=a}return b.prototype.resolveBaseTypeLinks=function(a,b){var c=null;if(a){c=new Array;for(var d=0,e=a.length;d<e;d++){var f=a[d];this.checker.resolvingBases=!0,this.checker.resolveTypeLink(b,f,!0),this.checker.resolvingBases=!1,f.type.isClass()?c[d]=f.type.instanceType:c[d]=f.type}}return c},b.prototype.resolveBases=function(a,b){b.extendsList=this.resolveBaseTypeLinks(b.extendsTypeLinks,a);var c=0,d=b.extendsList.length,e=b.isClassInstance();for(;c<d;c++){var f=b.extendsList[c].isClassInstance();b.extendsList[c]!=this.checker.anyType&&(e?f||this.checker.errorReporter.simpleErrorFromSym(b.symbol,"A export class may only extend other classes, "+b.extendsList[c].symbol.fullName()+" is an interface."):f&&this.checker.errorReporter.simpleErrorFromSym(b.symbol,"An interface may only extend other interfaces, "+b.extendsList[c].symbol.fullName()+" is a class."))}b.implementsList=this.resolveBaseTypeLinks(b.implementsTypeLinks,a);if(b.implementsList)for(c=0,d=b.implementsList.length;c<d;c++){var g=b.implementsList[c];g.isClassInstance()&&e&&this.checker.errorReporter.simpleErrorFromSym(b.symbol,"A class may only implement an interface; "+g.symbol.fullName()+" is a class.")}},b.prototype.resolveSignatureGroup=function(a,b,c){var d=!a.hasImplementation;for(var e=0,f=a.signatures.length;e<f;e++){var g=a.signatures[e];c?g.returnType.type=c:this.checker.resolveTypeLink(b,g.returnType,d);var h=g.parameters.length;for(var i=0;i<h;i++)this.bindSymbol(b,g.parameters[i]);if(g.hasVariableArgList){var j=g.parameters[h-1];j.argsOffset=h-1,j.getType().isArray()||(this.checker.errorReporter.simpleErrorFromSym(j,"... parameter must have array type"),j.parameter.typeLink.type=this.checker.makeArrayType(j.parameter.typeLink.type))}}},b.prototype.bindType=function(b,c,d){d&&this.bindType(b,d,null);if(c.hasMembers()){var e=c.members,f=c.ambientMembers,g=c.getAllEnclosedTypes(),h=c.getAllAmbientEnclosedTypes(),i=new a.SymbolTableScope(e,f,g,h,c.symbol),j=new a.SymbolAggregateScope(c.symbol),k=this.checker.currentModDecl,l=this.checker.inBind;j.addParentScope(i),j.addParentScope(b),c.isModuleType()&&(this.checker.currentModDecl=c.symbol.declAST,this.checker.inBind=!0),e&&this.bind(j,c.members.allMembers),g&&this.bind(j,g.allMembers),f&&this.bind(j,f.allMembers),h&&this.bind(j,h.allMembers),this.checker.currentModDecl=k,this.checker.inBind=l}c.extendsTypeLinks&&this.resolveBases(b,c),c.construct&&this.resolveSignatureGroup(c.construct,b,d),c.call&&this.resolveSignatureGroup(c.call,b,null),c.index&&this.resolveSignatureGroup(c.index,b,null),c.elementType&&this.bindType(b,c.elementType,null)},b.prototype.bindSymbol=function(b,c){if(!c.bound){var d=this.checker.locationInfo;this.checker.units&&c.unitIndex>=0&&c.unitIndex<this.checker.units.length&&(this.checker.locationInfo=this.checker.units[c.unitIndex]);switch(c.kind()){case a.SymbolKind.Type:if(c.flags&a.SymbolFlags.Bound)break;var e=c;e.flags|=a.SymbolFlags.Bound;if(e.aliasLink&&!e.type&&e.aliasLink.alias.nodeType==a.NodeType.Name){var f=e.aliasLink.alias.text,g=this.checker.findSymbolForDynamicModule(f,this.checker.locationInfo.filename,function(a){return b.find(a,!1,!0)});g&&(e.type=g.getType())}if(e.type&&e.type!=this.checker.gloModType){this.bindType(b,e.type,e.instanceType);if(e.type.isModuleType())for(var h=0;h<e.expansions.length;h++)this.bindType(b,e.expansions[h],e.instanceType)}break;case a.SymbolKind.Field:this.checker.resolveTypeLink(b,c.field.typeLink,!1);break;case a.SymbolKind.Parameter:this.checker.resolveTypeLink(b,c.parameter.typeLink,!0)}this.checker.locationInfo=d}c.bound=!0},b.prototype.bind=function(a,b){b.map(function(b,c,d){d.bindSymbol(a,c)},this)},b}();a.Binder=b})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function a(){}return a.encodedValues="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a.encode=function(c){if(c<64)return a.encodedValues.charAt(c);throw TypeError(c+": not a 64 based value")},a.decodeChar=function(c){if(c.length===1)return a.encodedValues.indexOf(c);throw TypeError('"'+c+'" must have length 1')},a}(),c=function(){function a(){}return a.encode=function(c){c<0?c=(-c<<1)+1:c<<=1;var d="";do{var e=c&31;c>>=5,c>0&&(e|=32),d+=b.encode(e)}while(c>0);return d},a.decode=function(c){var d=0,e=!1,f=0;for(var g=0;g<c.length;g++){var h=b.decodeChar(c[g]);g===0?((h&1)===1&&(e=!0),d=h>>1&15):d|=(h&31)<<f,f+=g==0?4:5;if((h&32)!==32)return{value:e?-d:d,rest:c.substr(g+1)}}throw new Error('Base64 value "'+c+'" finished with a continuation bit')},a}();a.Base64VLQFormat=c})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function a(a){this.parent=-1,this.firstChild=-1}return a}();a.SourceMapping=b;var c=function(){function b(b,c,d,e){this.jsFile=d,this.sourceMapOut=e,this.sourceMappings=new Array,this.currentMapping=-1,this.jsFileName=a.getPrettyName(c,!1,!0),this.tsFileName=a.getPrettyName(b,!1,!0)}return b.MapFileExtension=".map",b.CanEmitMapping=function(b,c){if(c.firstChild!==-1){var d=b[c.firstChild];if(d.emittedStartLine===c.emittedStartLine&&d.emittedStartColumn===c.emittedStartColumn)return!1}return!0},b.EmitSourceMapping=function(d){var e=d[0];e.jsFile.WriteLine("//@ sourceMappingURL="+e.jsFileName+b.MapFileExtension);var f=e.sourceMapOut,g="",h=[],i=0,j=0,k=0,l=0,m=0,n=!1;for(var o=0;o<d.length;o++){e=d[o];if(e.sourceMappings){var p=h.length;h.push(e.tsFileName);var q=e.sourceMappings;for(var r=0,s=q.length;r<s;r++){var t=q[r];if(!b.CanEmitMapping(q,t))continue;if(j!==t.emittedStartLine){while(j<t.emittedStartLine)i=0,g+=";",j++;n=!1}else n&&(g+=",");g+=a.Base64VLQFormat.encode(t.emittedStartColumn-i),i=t.emittedStartColumn,g+=a.Base64VLQFormat.encode(p-m),m=p,g+=a.Base64VLQFormat.encode(t.sourceStartLine-1-l),l=t.sourceStartLine-1,g+=a.Base64VLQFormat.encode(t.sourceStartColumn-k),k=t.sourceStartColumn,n=!0}}}g!=""&&(f.Write("{"),f.Write('"version":3,'),f.Write('"file":"'+e.jsFileName+'",'),f.Write('"sources":["'+h.join('","')+'"],'),f.Write('"names":[],'),f.Write('"mappings":"'+g),f.Write('"'),f.Write("}")),f.Close()},b}();a.SourceMapper=c})(TypeScript||(TypeScript={}));var TypeScript;(function(a){(function(a){a._map=[],a._map[0]="Prog",a.Prog=0,a._map[1]="Module",a.Module=1,a._map[2]="DynamicModule",a.DynamicModule=2,a._map[3]="Class",a.Class=3,a._map[4]="Constructor",a.Constructor=4,a._map[5]="Function",a.Function=5,a._map[6]="Args",a.Args=6,a._map[7]="Interface",a.Interface=7})(a.EmitContainer||(a.EmitContainer={}));var b=a.EmitContainer,c=function(){function a(){this.indentAmt=0,this.column=0,this.line=0,this.pretty=!1,this.inObjectLiteral=!1,this.container=b.Prog}return a}();a.EmitState=c;var d=function(){function d(a,b,d){this.checker=a,this.outfile=b,this.emitOptions=d,this.prologueEmitted=!1,this.indentStep=4,this.thisClassNode=null,this.thisFnc=null,this.moduleDeclList=[],this.moduleName="",this.emitState=new c,this.indentStrings=[],this.ambientModule=!1,this.modAliasId=null,this.firstModAlias=null,this.allSourceMappers=[],this.sourceMapper=null,this.declDottedModuleName=!1,this.declIndentDelta=0,this.declFile=null,this.declContainingAST=null}return d.prototype.canWriteDeclFile=function(){return this.declFile!=null},d.prototype.setSourceMappings=function(a){this.allSourceMappers.push(a),this.sourceMapper=a},d.prototype.setDeclarationFile=function(a){this.declFile=a},d.prototype.increaseIndent=function(){this.emitState.indentAmt+=this.indentStep,this.declDottedModuleName&&this.addDeclIndentDelta()},d.prototype.decreaseIndent=function(){this.emitState.indentAmt-=this.indentStep},d.prototype.addDeclIndentDelta=function(){this.declIndentDelta+=this.indentStep},d.prototype.reduceDeclIndentDelta=function(){this.declIndentDelta-=this.indentStep},d.prototype.writeToOutput=function(a){this.outfile.Write(a),this.emitState.column+=a.length},d.prototype.writeToOutputTrimmable=function(a){this.emitOptions.minWhitespace&&(a=a.replace(/[\s]*/g,"")),this.writeToOutput(a)},d.prototype.writeLineToOutput=function(b){if(this.emitOptions.minWhitespace){this.writeToOutput(b);var c=b.charCodeAt(b.length-1);c!=a.LexCodeSpace&&c!=a.LexCodeSMC&&c!=a.LexCodeLBR&&this.writeToOutput(" ")}else this.outfile.WriteLine(b),this.emitState.column=0,this.emitState.line++},d.prototype.setInObjectLiteral=function(a){var b=this.emitState.inObjectLiteral;return this.emitState.inObjectLiteral=a,b},d.prototype.setContainer=function(a){var b=this.emitState.container;return this.emitState.container=a,b},d.prototype.setDeclContainingAST=function(a){var b=this.declContainingAST;return this.declContainingAST=a,b},d.prototype.getIndentString=function(a){typeof a=="undefined"&&(a=!1);if(this.emitOptions.minWhitespace)return"";var b=this.emitState.indentAmt-(a?this.declIndentDelta:0),c=this.indentStrings[b];if(c===undefined){c="";for(var d=0;d<b;d++)c+=" ";this.indentStrings[b]=c}return c},d.prototype.emitIndent=function(){this.writeToOutput(this.getIndentString())},d.prototype.emitIndentToDeclFile=function(){this.declFile.Write(this.getIndentString(!0))},d.prototype.emitCommentInPlace=function(a){this.recordSourceMappingStart(a);var b=a.getText(),c=!1;if(a.isBlockComment){this.emitState.column==0&&this.emitIndent(),this.writeToOutput(b[0]);if(b.length>1||a.endsLine){this.writeLineToOutput("");for(var d=1;d<b.length;d++)this.emitIndent(),this.writeLineToOutput(b[d]);c=!0}}else this.emitState.column==0&&this.emitIndent(),this.writeLineToOutput(b[0]),c=!0;c?this.emitIndent():this.writeToOutput(" "),this.recordSourceMappingEnd(a)},d.prototype.emitParensAndCommentsInPlace=function(a,b){var c=b?a.preComments:a.postComments;a.isParenthesized&&!b&&this.writeToOutput(")");if(this.emitOptions.emitComments&&c&&c.length!=0)for(var d=0;d<c.length;d++)this.emitCommentInPlace(c[d]);a.isParenthesized&&b&&this.writeToOutput("(")},d.prototype.emitObjectLiteral=function(b){this.writeLineToOutput("{"),this.increaseIndent();var c=this.setInObjectLiteral(!0);this.emitJavascriptList(b,",",a.TokenID.Comma,!0,!1,!1),this.setInObjectLiteral(c),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")},d.prototype.emitArrayLiteral=function(b){this.writeToOutput("["),b&&(this.writeLineToOutput(""),this.increaseIndent(),this.emitJavascriptList(b,", ",a.TokenID.Comma,!0,!1,!1),this.decreaseIndent(),this.emitIndent()),this.writeToOutput("]")},d.prototype.emitNew=function(b,c){this.recordSourceMappingStart(b),this.writeToOutput("new "),b.nodeType==a.NodeType.TypeRef?this.writeToOutput("Array()"):(this.emitJavascript(b,a.TokenID.Tilde,!1),this.writeToOutput("("),this.emitJavascriptList(c,", ",a.TokenID.Comma,!1,!1,!1),this.writeToOutput(")")),this.recordSourceMappingEnd(b)},d.prototype.tryEmitConstant=function(b){if(!this.emitOptions.propagateConstants)return!1;var c=b.operand2;if(c&&c.sym&&c.sym.isVariable()&&a.hasFlag(c.sym.flags,a.SymbolFlags.Constant)&&c.sym.declAST){var d=c.sym.declAST;if(d.init&&d.init.nodeType==a.NodeType.NumberLit){var e=d.init;this.writeToOutput(e.value.toString());var f=" /* ";return f+=c.text,f+=" */ ",this.writeToOutput(f),!0}}return!1},d.prototype.emitCall=function(b,c,d){if(!this.emitSuperCall(b))if(!a.hasFlag(b.flags,a.ASTFlags.ClassBaseConstructorCall))c.nodeType==a.NodeType.FuncDecl&&!c.isParenthesized&&this.writeToOutput("("),this.emitJavascript(c,a.TokenID.LParen,!1),c.nodeType==a.NodeType.FuncDecl&&!c.isParenthesized&&this.writeToOutput(")"),this.writeToOutput("("),this.emitJavascriptList(d,", ",a.TokenID.Comma,!1,!1,!1),this.writeToOutput(")");else{this.decreaseIndent(),this.decreaseIndent();var e=new a.ASTList;e.members[0]=b,this.emitConstructorCalls(e,this.thisClassNode),this.increaseIndent(),this
.increaseIndent()}},d.prototype.defaultValue=function(a){return a==this.checker.anyType?"undefined":a==this.checker.numberType?"0":a==this.checker.stringType?'""':a==this.checker.booleanType?"false":"null"},d.prototype.emitConstructorCalls=function(b,c){if(b==null)return;var d=b.members.length;this.recordSourceMappingStart(c);for(var e=0;e<d;e++){var f=b.members[e],g=null;f.nodeType==a.NodeType.Call?g=f.target.type.symbol:g=f.type.symbol;var h=g.name;g.declModule!=c.type.symbol.declModule&&(h=g.fullName());if(f.nodeType==a.NodeType.Call){this.emitIndent(),this.writeToOutput("_super.call(this");var i=f.args;i&&i.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(i,", ",a.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")")}else f.type&&f.type.isClassInstance()&&(this.emitIndent(),this.writeToOutput(c.name.text+"._super.constructor"),this.writeToOutput(".call(this)"))}this.recordSourceMappingEnd(c)},d.prototype.emitInnerFunction=function(c,d,e,f,g,h,i,j){typeof i=="undefined"&&(i=!1),typeof j=="undefined"&&(j=this.emitState.container);var k=c.isConstructor&&a.hasFlag(c.fncFlags,a.FncFlags.ClassMethod),l=k&&a.hasFlag(this.thisClassNode.type.instanceType.typeFlags,a.TypeFlags.HasBaseType)&&!a.hasFlag(this.thisClassNode.type.instanceType.typeFlags,a.TypeFlags.HasBaseTypeOfObject),m=l&&a.hasFlag(this.thisClassNode.varFlags,a.VarFlags.ClassSuperMustBeFirstCallInConstructor);this.emitParensAndCommentsInPlace(c,!0),this.recordSourceMappingStart(c),(!c.isAccessor()||!c.accessorSymbol.isObjectLitField)&&this.writeToOutput("function ");if(d){var n=c.getNameText();n&&!c.isAccessor()&&this.writeToOutput(n)}this.writeToOutput("("),i&&(i=this.emitFuncSignatureIdentifier(c,!1,j));var o=0,p=0,q,r=[];if(c.args){var s=this.setContainer(b.Args);o=c.args.members.length;var t=o;c.variableArgList&&t--;for(p=0;p<t;p++)q=c.args.members[p],q.init&&r.push(q),this.emitJavascript(q,a.TokenID.LParen,!1,i),p<t-1&&(this.writeToOutput(", "),i&&this.declFile.Write(", "));this.setContainer(s)}this.writeLineToOutput(") {");var u=null;i&&(this.emitFuncSignatureVariableArg(c),c.hasStaticDeclarations()&&(u=this.setDeclContainingAST(c))),this.increaseIndent();for(p=0;p<r.length;p++){var q=r[p];this.emitIndent(),this.recordSourceMappingStart(q),this.writeToOutput("if (typeof "+q.id.text+' === "undefined") { '),this.recordSourceMappingStart(q.id),this.writeToOutput(q.id.text),this.recordSourceMappingEnd(q.id),this.writeToOutput(" = "),this.emitJavascript(q.init,a.TokenID.LParen,!1),this.writeLineToOutput("; }"),this.recordSourceMappingEnd(q)}if(c.isConstructor&&!m){if(c.args){o=c.args.members.length;for(p=0;p<o;p++)q=c.args.members[p],(q.varFlags&a.VarFlags.Property)!=a.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(q),this.recordSourceMappingStart(q.id),this.writeToOutput("this."+q.id.text),this.recordSourceMappingEnd(q.id),this.writeToOutput(" = "),this.recordSourceMappingStart(q.id),this.writeToOutput(q.id.text),this.recordSourceMappingEnd(q.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(q))}a.hasFlag(c.fncFlags,a.FncFlags.ClassMethod)||this.emitConstructorCalls(f,h)}g&&(this.emitIndent(),this.writeLineToOutput("var _this = this;"));if(c.variableArgList){o=c.args.members.length;var v=c.args.members[o-1];this.emitIndent(),this.recordSourceMappingStart(v),this.writeToOutput("var "),this.recordSourceMappingStart(v.id),this.writeToOutput(v.id.text),this.recordSourceMappingEnd(v.id),this.writeLineToOutput(" = [];"),this.recordSourceMappingEnd(v),this.emitIndent(),this.writeLineToOutput("for (var _i = 0; _i < (arguments.length - "+(o-1)+"); _i++) {"),this.increaseIndent(),this.emitIndent(),this.writeLineToOutput(v.id.text+"[_i] = arguments[_i + "+(o-1)+"];"),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")}if(c.isConstructor&&a.hasFlag(c.fncFlags,a.FncFlags.ClassMethod)&&!m){var w=this.thisClassNode.members.members.length;for(var p=0;p<w;p++)if(this.thisClassNode.members.members[p].nodeType==a.NodeType.VarDecl){var x=this.thisClassNode.members.members[p];!a.hasFlag(x.varFlags,a.VarFlags.Static)&&x.init&&(this.emitIndent(),this.emitJavascriptVarDecl(x,a.TokenID.Tilde),this.writeLineToOutput(""))}}this.emitBareJavascriptStatements(c.bod,m),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}"),!e&&!a.hasFlag(c.fncFlags,a.FncFlags.IsFunctionExpression)&&(a.hasFlag(c.fncFlags,a.FncFlags.Definition)||c.isConstructor)&&this.writeLineToOutput("");if(c.hasStaticDeclarations()){this.writeLineToOutput(""),this.emitIndent();var y=c.getNameText();this.writeLineToOutput("(function ("+y+") {"),this.increaseIndent();var z=0,p=0;z=c.innerStaticFuncs.length;for(p=0;p<z;p++){var A=c.innerStaticFuncs[p];if(A.isOverload){i&&this.emitFuncSignature(A);continue}this.emitIndent(),A.isAccessor()?this.emitPropertyAccessor(A,c.name.text,!1,i):(this.writeToOutput(y+"."+A.name.text+" = "),this.emitInnerFunction(A,A.name&&!A.name.isMissing(),!1,null,A.hasSelfReference(),null,i))}if(c.statics){this.recordSourceMappingStart(c.statics),z=c.statics.members.length;for(p=0;p<z;p++)this.emitIndent(),this.writeToOutput(y),this.emitJavascript(c.statics.members[p],a.TokenID.Tilde,!1,i),this.writeLineToOutput("");this.recordSourceMappingEnd(c.statics)}this.decreaseIndent(),this.emitIndent();var B=e&&this.thisClassNode,C=B?this.thisClassNode.name.text+".prototype.":"";this.writeLineToOutput("})("+C+y+");"),i&&(this.setDeclContainingAST(u),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"))}this.recordSourceMappingEnd(c),this.emitParensAndCommentsInPlace(c,!1)},d.prototype.emitArgDecl=function(a){this.declFile.Write(a.id.text),a.isOptionalArg()&&this.declFile.Write("?"),(a.typeExpr||a.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(a.type)&&this.declFile.Write(": "+this.getTypeSignature(a.type))},d.prototype.emitFuncSignatureIdentifier=function(b,c,d){typeof c=="undefined"&&(c=!1),typeof d=="undefined"&&(d=this.emitState.container);if(!c&&!b.isOverload)if(b.isConstructor){if(b.type.construct.signatures.length>1)return!1}else if(b.type.call.signatures.length>1)return!1;if(!this.canEmitSignature(a.ToDeclFlags(b.fncFlags),d))return!1;if(b.isConstructor)this.emitIndentToDeclFile(),this.declFile.Write("constructor ");else{var e=b.getNameText();c?(this.emitIndentToDeclFile(),b.isConstructMember()?this.declFile.Write("new"):!b.isCallMember()&&!b.isIndexerMember()&&(this.declFile.Write(e),a.hasFlag(b.name.flags,a.ASTFlags.OptionalName)&&this.declFile.Write("? "))):(this.emitDeclFlags(a.ToDeclFlags(b.fncFlags),"function"),this.declFile.Write(e))}return b.isIndexerMember()?this.declFile.Write("["):this.declFile.Write("("),!0},d.prototype.emitFuncSignatureVariableArg=function(a){if(a.variableArgList){var b=a.args.members[a.args.members.length-1];a.args.members.length>1?this.declFile.Write(", ..."):this.declFile.Write("..."),this.emitArgDecl(b)}a.isIndexerMember()?this.declFile.Write("]"):this.declFile.Write(")"),!a.isConstructor&&(a.returnTypeAnnotation||a.signature.returnType.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(a.signature.returnType.type)&&this.declFile.Write(": "+this.getTypeSignature(a.signature.returnType.type)),a.hasStaticDeclarations()?this.declFile.WriteLine(" {"):this.declFile.WriteLine(";")},d.prototype.emitFuncSignature=function(a,b){typeof b=="undefined"&&(b=!1);var c=this.emitFuncSignatureIdentifier(a,b);if(c){if(a.args){var d=a.args.members.length;a.variableArgList&&d--;for(var e=0;e<d;e++){var f=a.args.members[e];this.emitArgDecl(f),e<d-1&&this.declFile.Write(", ")}}this.emitFuncSignatureVariableArg(a)}},d.prototype.emitPropertyAccessorSignature=function(b){var c=b.accessorSymbol;this.emitDeclFlags(a.ToDeclFlags(c.flags),"var"),this.declFile.WriteLine(b.name.text+" : "+this.getTypeSignature(c.getType())+";")},d.prototype.emitDeclFlags=function(b,c){this.emitIndentToDeclFile();var d="";a.hasFlag(b,a.DeclFlags.GetAccessor)?d="get ":a.hasFlag(b,a.DeclFlags.SetAccessor)&&(d="set "),a.hasFlag(b,a.DeclFlags.Exported)&&this.declFile.Write("export "),a.hasFlag(b,a.DeclFlags.LocalStatic)||a.hasFlag(b,a.DeclFlags.Static)?this.declFile.Write("static "+d):a.hasFlag(b,a.DeclFlags.Private)?this.declFile.Write("private "+d):a.hasFlag(b,a.DeclFlags.Public)?this.declFile.Write("public "+d):d==""?this.declFile.Write(c+" "):this.declFile.Write(d)},d.prototype.canEmitTypeAnnotationSignature=function(b,c){typeof c=="undefined"&&(c=a.DeclFlags.None);if(b==null)return!1;if(b.primitiveTypeClass==a.Primitive.None&&b.symbol&&b.symbol.container!=undefined&&b.symbol.container!=this.checker.gloMod){if(a.hasFlag(c,a.DeclFlags.Private))return!1;if(a.hasFlag(b.symbol.container.flags,a.SymbolFlags.Exported))return!0;if(b.symbol.declAST)switch(b.symbol.declAST.nodeType){case a.NodeType.Module:if(!a.hasFlag(b.symbol.declAST.modFlags,a.ModuleFlags.Exported))return!1;break;case a.NodeType.Class:if(!a.hasFlag(b.symbol.declAST.varFlags,a.VarFlags.Exported))return!1;break;case a.NodeType.Interface:if(!a.hasFlag(b.symbol.declAST.varFlags,a.VarFlags.Exported))return!1;break;case a.NodeType.FuncDecl:if(!a.hasFlag(b.symbol.declAST.fncFlags,a.FncFlags.Exported))return!1;break;default:throw Error("Catch this unhandled type container")}}return!0},d.prototype.getTypeSignature=function(b){var c=null;if(this.declContainingAST)switch(this.declContainingAST.nodeType){case a.NodeType.Module:case a.NodeType.Interface:case a.NodeType.FuncDecl:this.declContainingAST.type&&(c=this.declContainingAST.type.containedScope);break;case a.NodeType.Script:var d=this.declContainingAST;d.bod&&(c=d.bod.enclosingScope);break;case a.NodeType.Class:this.declContainingAST.type&&(c=this.declContainingAST.type.instanceType.containedScope);break;default:throw Error("Unknown containing scope")}return b.getScopedTypeName(c)},d.prototype.canEmitSignature=function(c,d){return typeof d=="undefined"&&(d=this.emitState.container),d==b.Module&&!a.hasFlag(c,a.DeclFlags.Exported)?!1:!0},d.prototype.emitVarSignature=function(b,c){typeof c=="undefined"&&(c=!1);if(this.canEmitSignature(a.ToDeclFlags(b.varFlags))){c?(this.emitIndentToDeclFile(),this.declFile.Write(b.id.text),a.hasFlag(b.id.flags,a.ASTFlags.OptionalName)&&this.declFile.Write("?")):(this.emitDeclFlags(a.ToDeclFlags(b.varFlags),"var"),this.declFile.Write(b.id.text));var d=null;b.typeExpr&&b.typeExpr.type?d=b.typeExpr.type:b.sym&&(d=b.sym.getType(),d==this.checker.anyType&&(d=null));if(this.canEmitTypeAnnotationSignature(d,a.ToDeclFlags(b.varFlags))){var e=this.getTypeSignature(d);this.declFile.WriteLine(": "+e+";")}else this.declFile.WriteLine(";")}},d.prototype.emitBaseList=function(a,b){if(a&&a.members.length>0){this.declFile.Write(" "+b+" ");var c=a.members.length;for(var d=0;d<c;d++){var e=a.members[d],f=e.type.symbol,g=e.type,h=this.getTypeSignature(g);d>0&&this.declFile.Write(", "),this.declFile.Write(h)}}},d.prototype.emitClassSignatureIdentifierAndHeritage=function(b){if(!this.canEmitSignature(a.ToDeclFlags(b.varFlags)))return!1;var c=b.name.text;return this.emitDeclFlags(a.ToDeclFlags(b.varFlags),"class"),this.declFile.Write(c),this.emitBaseList(b.baseClass,"extends"),this.emitBaseList(b.implementsList,"implements"),this.declFile.WriteLine(" {"),!0},d.prototype.emitClassSignatureClassBodyOfAmbientClass=function(b){var c=b.definitionMembers.members.length;for(var d=0;d<c;d++){var e=b.definitionMembers.members[d];if(e.nodeType==a.NodeType.FuncDecl){var f=e;f.isAccessor()||this.emitFuncSignature(f)}else{if(e.nodeType!=a.NodeType.VarDecl)throw Error("We want to catch this");this.emitVarSignature(e)}}},d.prototype.emitMembersFromConstructorDefinition=function(b){if(b.args){var c=b.args.members.length;b.variableArgList&&c--;for(var d=0;d<c;d++){var e=b.args.members[d];a.hasFlag(e.varFlags,a.VarFlags.Property)&&(this.emitDeclFlags(a.ToDeclFlags(e.varFlags),"var"),this.declFile.Write(e.id.text),e.typeExpr&&this.declFile.Write(": "+this.getTypeSignature(e.type)),this.declFile.WriteLine(";"))}}},d.prototype.emitClassSignature=function(a){var b=this.emitClassSignatureIdentifierAndHeritage(a);if(b){var c=this.setDeclContainingAST(a);this.increaseIndent(),this.emitClassSignatureClassBodyOfAmbientClass(a),this.decreaseIndent(),this.setDeclContainingAST(c),this.emitIndentToDeclFile(),this.declFile.WriteLine("}")}},d.prototype.emitImportDecl=function(b){this.canEmitSignature(a.ToDeclFlags(b.varFlags))&&(this.emitDeclFlags(a.ToDeclFlags(b.varFlags),"import"),this.declFile.Write(b.id.text+" = "),b.isDynamicImport?this.declFile.WriteLine("module ("+b.getAliasName()+");"):this.declFile.WriteLine(b.getAliasName()+";"))},d.prototype.emitModuleIdentification=function(b){return this.canEmitSignature(a.ToDeclFlags(b.modFlags))?(this.declDottedModuleName?this.declFile.Write("."):this.emitDeclFlags(a.ToDeclFlags(b.modFlags),"module"),this.declFile.Write(b.name.text),b.members.members.length==1&&b.members.members[0].nodeType==a.NodeType.Module&&!b.members.members[0].isEnum()&&a.hasFlag(b.members.members[0].modFlags,a.ModuleFlags.Exported)?this.declDottedModuleName=!0:(this.declDottedModuleName=!1,this.declFile.WriteLine(" {")),!0):!1},d.prototype.emitModuleBodyOfAmbientModule=function(b){var c=b.members.members.length;for(var d=0;d<c;d++){var e=b.members.members[d];switch(e.nodeType){case a.NodeType.VarDecl:this.emitVarSignature(e);break;case a.NodeType.FuncDecl:this.emitFuncSignature(e);break;case a.NodeType.Class:this.emitClassSignature(e);break;case a.NodeType.Interface:this.emitInterfaceDeclaration(e);break;case a.NodeType.Module:this.emitModuleSignature(e);break;case a.NodeType.Import:this.emitImportDecl(e);break;case a.NodeType.Empty:break;default:throw Error("We want to catch this")}}},d.prototype.emitModuleSignature=function(a){if(a.isEnum())this.emitEnumSignature(a);else{var c=this.declIndentDelta,d=this.declDottedModuleName,e=this.emitModuleIdentification(a);if(e){var f=this.setDeclContainingAST(a);this.increaseIndent();var g=this.setContainer(b.Module);this.emitModuleBodyOfAmbientModule(a),this.setContainer(g),this.decreaseIndent(),this.setDeclContainingAST(f),d||(this.declIndentDelta=c,this.emitIndentToDeclFile(),this.declFile.WriteLine("}"))}}},d.prototype.emitEnumBodyOfAmbientEnum=function(b){var c=b.members.members.length;for(var d=1;d<c;d++){var e=b.members.members[d];if(e.nodeType==a.NodeType.VarDecl)this.emitIndentToDeclFile(),this.declFile.WriteLine(e.id.text+",");else if(e.nodeType!=a.NodeType.Asg)throw Error("We want to catch this")}},d.prototype.emitEnumSignature=function(b){return this.canEmitSignature(a.ToDeclFlags(b.modFlags))?(this.emitDeclFlags(a.ToDeclFlags(b.modFlags),"enum"),this.declFile.WriteLine(b.name.text+" {"),this.increaseIndent(),this.emitEnumBodyOfAmbientEnum(b),this.decreaseIndent(),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"),!0):!1},d.prototype.emitInterfaceBody=function(b){for(var c=0;c<b.members.length;c++){var d=b.members[c];switch(d.nodeType){case a.NodeType.FuncDecl:this.emitFuncSignature(d,!0);break;case a.NodeType.VarDecl:this.emitVarSignature(d,!0);break;default:throw Error("Not allowed")}}},d.prototype.emitInterfaceDeclaration=function(c){if(this.canEmitSignature(a.ToDeclFlags(c.varFlags))){var d=this.setContainer(b.Interface),e=c.name.text;this.emitDeclFlags(a.ToDeclFlags(c.varFlags),"interface"),this.declFile.Write(e),this.emitBaseList(c.extendsList,"extends"),this.declFile.WriteLine(" {"),this.increaseIndent();var f=this.setDeclContainingAST(c);this.emitInterfaceBody(c.members),this.setDeclContainingAST(f),this.decreaseIndent(),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"),this.setContainer(d)}},d.prototype.emitJavascriptModule=function(c,d){var e=c.name.text;a.isTSFile(e)?c.name.text=e.substring(0,e.length-3):a.isSTRFile(e)&&(c.name.text=e.substring(0,e.length-4));if(!a.hasFlag(c.modFlags,a.ModuleFlags.Ambient)){var f=a.hasFlag(c.modFlags,a.ModuleFlags.IsDynamic),g=this.declIndentDelta,h=this.declDottedModuleName,i=null,j=this.outfile;d&&(f||(c.isEnum()?d=this.emitEnumSignature(c):d=this.emitModuleIdentification(c)),d&&(i=this.setDeclContainingAST(c)));var k=this.setContainer(b.Module),l=this.moduleName,m=a.hasFlag(c.modFlags,a.ModuleFlags.Exported);this.moduleDeclList[this.moduleDeclList.length]=c,this.moduleName=c.name.text,this.recordSourceMappingStart(c);if(f){var n=a.stripQuotes(a.trimModName(c.name.text))+".js";this.emitOptions.createFile&&(n!=this.emitOptions.path?this.outfile=this.emitOptions.createFile(n):this.emitOptions.outputMany||this.checker.errorReporter.emitterError(c,"Module emit collides with emitted script: "+n)),this.setContainer(b.DynamicModule);if(a.moduleGenTarget==a.ModuleGenTarget.Asynchronous){var o='["require", "exports"',p="require, exports",q=null;for(var r=0;r<c.mod.importedModules.length;r++)q=c.mod.importedModules[r],q.id.sym&&!q.id.sym.onlyReferencedAsTypeRef&&(r<=c.mod.importedModules.length-1&&(o+=", ",p+=", "),p+="__"+q.id.text+"__",o+=q.firstAliasedModToString());for(var r=0;r<c.amdDependencies.length;r++)o+=', "'+c.amdDependencies[r]+'"';o+="]",this.writeLineToOutput("define("+o+","+" function("+p+") {")}}else m||(this.writeLineToOutput("var "+this.moduleName+";"),this.emitIndent()),this.writeLineToOutput("(function ("+this.moduleName+") {");if(!f||a.moduleGenTarget==a.ModuleGenTarget.Asynchronous)this.increaseIndent(),f&&this.addDeclIndentDelta();this.emitJavascriptList(c.members,null,a.TokenID.SColon,!0,!1,!1,d&&!c.isEnum());if(!f||a.moduleGenTarget==a.ModuleGenTarget.Asynchronous)this.decreaseIndent(),f&&this.reduceDeclIndentDelta();this.emitIndent();if(f)d&&this.setDeclContainingAST(i),a.moduleGenTarget==a.ModuleGenTarget.Asynchronous&&this.writeLineToOutput("})"),this.outfile!=j&&(this.outfile.Close(),this.outfile=j);else{d&&(this.setDeclContainingAST(i),!c.isEnum()&&!h&&(this.declIndentDelta=g,this.emitIndentToDeclFile(),this.declFile.WriteLine("}")));var s=null;c.type&&c.type.symbol.container&&c.type.symbol.container.declAST&&(s=c.type.symbol.container.declAST);var t=s&&a.hasFlag(s.modFlags,a.ModuleFlags.IsDynamic);if(k==b.Prog&&m)this.writeLineToOutput("})(this."+this.moduleName+" || (this."+this.moduleName+" = {}));");else if(m||k==b.Prog){var u=l!=""?(t?"exports":l)+".":l;this.writeLineToOutput("})("+u+this.moduleName+" || ("+u+this.moduleName+" = {}));")}else!m&&k!=b.Prog?this.writeLineToOutput("})("+this.moduleName+" || ("+this.moduleName+" = {}));"):this.writeLineToOutput("})();");k!=b.Prog&&!t&&m&&(this.emitIndent(),this.writeLineToOutput("var "+this.moduleName+" = "+l+"."+this.moduleName+";"))}this.recordSourceMappingEnd(c),this.setContainer(k),this.moduleName=l,this.moduleDeclList.length--}else d&&this.emitModuleSignature(c)},d.prototype.emitIndex=function(b,c){var d=this.setInObjectLiteral(!1);this.emitJavascript(b,a.TokenID.Tilde,!1),this.writeToOutput("["),this.emitJavascriptList(c,", ",a.TokenID.Comma,!1,!1,!1),this.writeToOutput("]"),this.setInObjectLiteral(d)},d.prototype.emitStringLiteral=function(a){this.writeToOutput(a)},d.prototype.emitJavascriptFunction=function(c,d){if(a.hasFlag(c.fncFlags,a.FncFlags.Signature)||c.isOverload){d&&this.emitFuncSignature(c);return}var e,f=this.thisFnc;this.thisFnc=c,c.isConstructor?e=this.setContainer(b.Constructor):e=this.setContainer(b.Function);var g=null,h=!1,i=c.getNameText();if((this.emitState.inObjectLiteral||!c.isAccessor())&&(e!=b.Constructor||(c.fncFlags&a.FncFlags.Method)==a.FncFlags.None)){var j=this.setInObjectLiteral(!1);this.thisClassNode&&(g=this.thisClassNode.extendsList),h=c.hasSelfReference(),this.recordSourceMappingStart(c),a.hasFlag(c.fncFlags,a.FncFlags.Exported|a.FncFlags.ClassPropertyMethodExported)&&c.type.symbol.container==this.checker.gloMod&&!c.isConstructor?(this.writeToOutput("this."+i+" = "),this.emitInnerFunction(c,!1,!1,g,h,this.thisClassNode,d,e)):this.emitInnerFunction(c,c.name&&!c.name.isMissing(),!1,g,h,this.thisClassNode,d,e),this.recordSourceMappingEnd(c),this.setInObjectLiteral(j)}this.setContainer(e),this.thisFnc=f;if(a.hasFlag(c.fncFlags,a.FncFlags.Definition))if(a.hasFlag(c.fncFlags,a.FncFlags.Static))this.thisClassNode&&(c.isAccessor()?this.emitPropertyAccessor(c,this.thisClassNode.name.text,!1,!1):(this.emitIndent(),this.recordSourceMappingStart(c),this.writeLineToOutput(this.thisClassNode.name.text+"."+i+" = "+i+";"),this.recordSourceMappingEnd(c)));else if((this.emitState.container==b.Module||this.emitState.container==b.DynamicModule)&&a.hasFlag(c.fncFlags,a.FncFlags.Exported|a.FncFlags.ClassPropertyMethodExported)){this.emitIndent();var k=this.emitState.container==b.Module?this.moduleName:"exports";this.recordSourceMappingStart(c),this.writeLineToOutput(k+"."+i+" = "+i+";"),this.recordSourceMappingEnd(c)}},d.prototype.emitAmbientVarDecl=function(b){b.init&&(this.emitParensAndCommentsInPlace(b,!0),this.recordSourceMappingStart(b),this.recordSourceMappingStart(b.id),this.writeToOutput(b.id.text),this.recordSourceMappingEnd(b.id),this.writeToOutput(" = "),this.emitJavascript(b.init,a.TokenID.Comma,!1),this.recordSourceMappingEnd(b),this.writeToOutput(";"),this.emitParensAndCommentsInPlace(b,!1))},d.prototype.emitForVarList=function(b){if(b){this.recordSourceMappingStart(b);var c=b.members.length;for(var d=0;d<c;d++){var e=b.members[d];this.emitJavascriptVarDecl(e,d==0?a.TokenID.FOR:a.TokenID.LParen),d<c-1&&this.writeToOutput(", ")}this.recordSourceMappingEnd(b)}},d.prototype.emitJavascriptVarDecl=function(c,d,e){typeof e=="undefined"&&(e=!1);if((c.varFlags&a.VarFlags.Ambient)==a.VarFlags.Ambient)this.emitAmbientVarDecl(c);else{var f=c.sym,g=c.init!=null;this.emitParensAndCommentsInPlace(c,!0),this.recordSourceMappingStart(c);if(f&&f.isMember()&&f.container&&f.container.kind()==a.SymbolKind.Type){var h=f.container.type;h.isClass()&&!a.hasFlag(f.flags,a.SymbolFlags.ModuleMember)?this.emitState.container!=b.Args&&(a.hasFlag(f.flags,a.SymbolFlags.Static)?this.writeToOutput(f.container.name+"."):this.writeToOutput("this.")):h.hasImplementation()?!a.hasFlag(f.flags,a.SymbolFlags.Exported)&&(f.container==this.checker.gloMod||!a.hasFlag(f.flags,a.SymbolFlags.Property))?this.writeToOutput("var "):a.hasFlag(c.varFlags,a.VarFlags.LocalStatic)?this.writeToOutput("."):this.emitState.container==b.DynamicModule?this.writeToOutput("exports."):this.writeToOutput(this.moduleName+"."):d!=a.TokenID.LParen&&(a.hasFlag(f.flags,a.SymbolFlags.Exported)&&f.container==this.checker.gloMod?this.writeToOutput("this."):this.writeToOutput("var "))}else d!=a.TokenID.LParen&&this.writeToOutput("var ");this.recordSourceMappingStart(c.id),this.writeToOutput(c.id.text),this.recordSourceMappingEnd(c.id),g?(this.writeToOutputTrimmable(" = "),this.emitJavascript(c.init,a.TokenID.Comma,!1)):f&&f.isMember()&&this.emitState.container==b.Constructor&&(this.writeToOutputTrimmable(" = "),this.writeToOutput(this.defaultValue(c.type))),d!=a.TokenID.FOR&&d!=a.TokenID.LParen&&this.writeToOutputTrimmable(";"),this.recordSourceMappingEnd(c),this.emitParensAndCommentsInPlace(c,!1)}e&&this.emitVarSignature(c)},d.prototype.declEnclosed=function(a){if(a==null)return!0;for(var b=0,c=this.moduleDeclList.length;b<c;b++)if(this.moduleDeclList[b]==a)return!0;return!1},d.prototype.emitJavascriptName=function(c,d){var e=c.sym;this.emitParensAndCommentsInPlace(c,!0),this.recordSourceMappingStart(c);if(!c.isMissing()){if(d&&this.emitState.container!=b.Args&&e)if(e.container&&e.container.name!=a.globalId){if(a.hasFlag(e.flags,a.SymbolFlags.Static)&&a.hasFlag(e.flags,a.SymbolFlags.Property))e.declModule&&a.hasFlag(e.declModule.modFlags,a.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(e.container.name+".");else if(e.kind()==a.SymbolKind.Field){var f=e;a.hasFlag(f.flags,a.SymbolFlags.ModuleMember)?e.container!=this.checker.gloMod&&(a.hasFlag(e.flags,a.SymbolFlags.Property)||a.hasFlag(e.flags,a.SymbolFlags.Exported))&&(a.hasFlag(e.declModule.modFlags,a.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(e.container.name+".")):e.isInstanceProperty()&&(this.thisFnc&&!this.thisFnc.isMethod()&&!this.thisFnc.isConstructor?this.writeToOutput("_this."):this.writeToOutput("this."))}else if(e.kind()==a.SymbolKind.Type)if(e.isInstanceProperty()){var g=e,h=g.type;h.call&&!a.hasFlag(e.flags,a.SymbolFlags.ModuleMember)&&(this.thisFnc&&!this.thisFnc.isMethod()&&!this.thisFnc.isConstructor?this.writeToOutput("_this."):this.writeToOutput("this."))}else(e.unitIndex!=this.checker.locationInfo.unitIndex||!this.declEnclosed(e.declModule))&&this.writeToOutput(e.container.name+".")}else e.container==this.checker.gloMod&&a.hasFlag(e.flags,a.SymbolFlags.Exported)&&!a.hasFlag(e.flags,a.SymbolFlags.Ambient)&&(!e.isType()&&!e.isMember()||!e.declModule||!a.hasFlag(e.declModule.modFlags,a.ModuleFlags.Ambient))&&this.emitState.container==b.Prog&&e.declAST.nodeType!=a.NodeType.FuncDecl&&this.writeToOutput("this.");if(e&&e.declAST&&e.declAST.nodeType==a.NodeType.Module&&a.hasFlag(e.declAST.modFlags,a.ModuleFlags.IsDynamic)){var i=e.declAST;if(a.moduleGenTarget==a.ModuleGenTarget.Asynchronous)this.writeLineToOutput("__"+this.modAliasId+"__;");else{var j=c.text,k=i.mod.symbol.declAST&&a.hasFlag(i.mod.symbol.declAST.modFlags,a.ModuleFlags.Ambient);j=k?j:this.firstModAlias?this.firstModAlias:a.quoteBaseName(j),j=k?j:a.isRelative(a.stripQuotes(j))?j:a.quoteStr("./"+a.stripQuotes(j)),this.writeToOutput("require("+j+")")}}else this.writeToOutput(c.text)}this.recordSourceMappingEnd(c),this.emitParensAndCommentsInPlace(c,!1)},d.prototype.emitJavascriptStatements=function(b,c,d){if(b)if(b.nodeType!=a.NodeType.Block){var e=b&&(b.nodeType!=a.NodeType.List||b.members.length>0);if(c||e){var f=b.nodeType==a.NodeType.Block||b.nodeType==a.NodeType.List&&b.members.length==1&&b.members[0].nodeType==a.NodeType.Block;this.recordSourceMappingStart(b),f||(this.writeLineToOutput(" {"),this.increaseIndent()),this.emitJavascriptList(b,null,a.TokenID.SColon,!0,!1,!1),f||(this.writeLineToOutput(""),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")),this.recordSourceMappingEnd(b)}}else this.emitJavascript(b,a.TokenID.SColon,!0);else c&&this.writeToOutput("{ }")},d.prototype.emitBareJavascriptStatements=function(b,c){if(b.nodeType!=a.NodeType.Block)if(b.nodeType==a.NodeType.List){var d=b;d.members.length==2&&d.members[0].nodeType==a.NodeType.Block&&d.members[1].nodeType==a.NodeType.EndCode?(this.emitJavascript(d.members[0],a.TokenID.SColon,!0),this.writeLineToOutput("")):this.emitJavascriptList(b,null,a.TokenID.SColon,!0,!1,c)}else this.emitJavascript(b,a.TokenID.SColon,!0);else this.emitJavascript(b,a.TokenID.SColon,!0)},d.prototype.recordSourceMappingStart=function(b){if(this.sourceMapper&&b){var c={line:-1,col:-1},d=new a.SourceMapping(b);d.emittedStartColumn=this.emitState.column,d.emittedStartLine=this.emitState.line,a.getSourceLineColFromMap(c,b.minChar,this.checker.locationInfo.lineMap),d.sourceStartColumn=c.col,d.sourceStartLine=c.line,a.getSourceLineColFromMap(c,b.limChar,this.checker.locationInfo.lineMap),d.sourceEndColumn=c.col,d.sourceEndLine=c.line,d.parent=this.sourceMapper.currentMapping,this.sourceMapper.currentMapping=this.sourceMapper.sourceMappings.length,this.sourceMapper.sourceMappings.push(d);if(d.parent>=0){var e=this.sourceMapper.sourceMappings[d.parent];e.firstChild==-1&&(e.firstChild=this.sourceMapper.currentMapping)}}},d.prototype.recordSourceMappingEnd=function(a){if(this.sourceMapper&&a){var b=this.sourceMapper.currentMapping,c=this.sourceMapper.sourceMappings[b];c.emittedEndColumn=this.emitState.column,c.emittedEndLine=this.emitState.line,this.sourceMapper.currentMapping=c.parent}},d.prototype.emitSourceMappings=function(){a.SourceMapper.EmitSourceMapping(this.allSourceMappers)},d.prototype.emitJavascriptList=function(b,c,d,e,f,g,h){if(b==null)return;if(b.nodeType!=a.NodeType.List)this.emitJavascript(b,d,e,h);else{var i=b;if(i.members.length==0)return;this.emitParensAndCommentsInPlace(b,!0);var j=i.members.length;for(var k=0;k<j;k++){if(k==1&&g){var l=this.thisClassNode.constructorDecl;if(l&&l.args){var m=l.args.members.length;for(var n=0;n<m;n++){var o=l.args.members[n];(o.varFlags&a.VarFlags.Property)!=a.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(o),this.recordSourceMappingStart(o.id),this.writeToOutput("this."+o.id.text),this.recordSourceMappingEnd(o.id),this.writeToOutput(" = "),this.recordSourceMappingStart(o.id),this.writeToOutput(o.id.text),this.recordSourceMappingEnd(o.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(o))}}var p=this.thisClassNode.members.members.length;for(var q=0;q<p;q++)if(this.thisClassNode.members.members[q].nodeType==a.NodeType.VarDecl){var r=this.thisClassNode.members.members[q];!a.hasFlag(r.varFlags,a.VarFlags.Static)&&r.init&&(this.emitIndent(),this.emitJavascriptVarDecl(r,a.TokenID.Tilde),this.writeLineToOutput(""))}}var s=i.members[k],t=s.nodeType==a.NodeType.FuncDecl&&a.hasFlag(s.fncFlags,a.FncFlags.Static)||s.nodeType==a.NodeType.VarDecl&&a.hasFlag(s.varFlags,a.VarFlags.Static);if(f?!t:t)continue;this.emitJavascript(s,d,e,h),c&&k<j-1?e?this.writeLineToOutput(c):this.writeToOutput(c):e&&s.nodeType!=a.NodeType.Interface&&(s.nodeType!=a.NodeType.VarDecl||(s.varFlags&a.VarFlags.Ambient)!=a.VarFlags.Ambient||s.init!=null)&&s.nodeType!=a.NodeType.EndCode&&s.nodeType!=a.NodeType.FuncDecl&&this.writeLineToOutput("")}this.emitParensAndCommentsInPlace(b,!1)}},d.prototype.emitJavascript=function(c,d,e,f){typeof f=="undefined"&&(f=!1);if(c==null)return;var g=!1;e&&this.emitState.indentAmt>0&&c.nodeType!=a.NodeType.List&&c.nodeType!=a.NodeType.Block&&c.nodeType!=a.NodeType.Interface&&(c.nodeType!=a.NodeType.VarDecl||(c.varFlags&a.VarFlags.Ambient)!=a.VarFlags.Ambient||c.init!=null)&&c.nodeType!=a.NodeType.EndCode&&(c.nodeType!=a.NodeType.FuncDecl||this.emitState.container!=b.Constructor)&&this.emitIndent(),g&&this.writeToOutput("("),c.emit(this,d,e,f),g&&this.writeToOutput(")"),d==a.TokenID.SColon&&c.nodeType<a.NodeType.GeneralNode&&this.writeToOutput(";")},d.prototype.emitPropertyAccessor=function(a,b,c,d){if(!a.accessorSymbol.hasBeenEmitted){var e=a.accessorSymbol;this.emitIndent(),this.recordSourceMappingStart(a),this.writeLineToOutput("Object.defineProperty("+b+(c?'.prototype, "':', "')+a.name.text+'"'+", {"),this.increaseIndent();if(e.getter){var f=e.getter.declAST;this.emitIndent(),this.writeToOutput("get: "),this.emitInnerFunction(f,!1,c,null,a.hasSelfReference(),null),this.writeLineToOutput(",")}if(e.setter){var g=e.setter.declAST;this.emitIndent(),this.writeToOutput("set: "),this.emitInnerFunction(g,!1,c,null,a.hasSelfReference(),null),this.writeLineToOutput(",")}this.emitIndent(),this.writeLineToOutput("enumerable: true,"),this.emitIndent(),this.writeLineToOutput("configurable: true"),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("});"),this.recordSourceMappingEnd(a),d&&this.emitPropertyAccessorSignature(a),e.hasBeenEmitted=!0}},d.prototype.emitPrototypeMember=function(b,c,d){if(b.nodeType==a.NodeType.FuncDecl){var e=b;e.isAccessor()?this.emitPropertyAccessor(e,c,!0,d):(this.emitIndent(),this.recordSourceMappingStart(e),this.writeToOutput(c+".prototype."+e.getNameText()+" = "),this.emitInnerFunction(e,!1,!0,null,e.hasSelfReference(),null,d),this.recordSourceMappingEnd(e),this.writeLineToOutput(";"))}else if(b.nodeType==a.NodeType.VarDecl){var f=b;f.init&&(this.emitIndent(),this.recordSourceMappingStart(f),this.recordSourceMappingStart(f.id),this.writeToOutput(c+".prototype."+f.id.text),this.recordSourceMappingEnd(f.id),this.writeToOutput(" = "),this.emitJavascript(f.init,a.TokenID.Asg,!1),this.recordSourceMappingEnd(f),this.writeLineToOutput(";")),d&&this.emitVarSignature(f)}},d.prototype.emitAddBaseMethods=function(b,c,d){if(c.members){var e=c.symbol,f=e.name;e.declModule!=d.type.symbol.declModule&&(f=e.fullName()),c.members.allMembers.map(function(c,d,e){var g=d;g.kind()==a.SymbolKind.Type&&g.type.call&&(this.recordSourceMappingStart(g.declAST),this.writeLineToOutput(b+".prototype."+g.name+" = "+f+".prototype."+g.name+";"),this.recordSourceMappingEnd(g.declAST))},null)}if(c.extendsList)for(var g=0,h=c.extendsList.length;g<h;g++)this.emitAddBaseMethods(b,c.extendsList[g],d)},d.prototype.emitJavascriptClass=function(c,d){if(!a.hasFlag(c.varFlags,a.VarFlags.Ambient)){var e=this.thisClassNode,f=0;this.thisClassNode=c;var g=c.name.text;this.emitParensAndCommentsInPlace(c,!0);var h=null;d&&(d=this.emitClassSignatureIdentifierAndHeritage(c),d&&(h=this.setDeclContainingAST(c)));var i=this.setContainer(b.Class);this.recordSourceMappingStart(c),a.hasFlag(c.varFlags,a.VarFlags.Exported)&&c.type.symbol.container==this.checker.gloMod?this.writeToOutput("this."+g):this.writeToOutput("var "+g);var j=c.type,k=j.instanceType,l=k?k.baseClass():null,m=null,n=null;l?this.writeLineToOutput(" = (function (_super) {"):this.writeLineToOutput(" = (function () {"),this.increaseIndent();if(l){m=c.extendsList
.members[0],n=m.nodeType==a.NodeType.Call?m.target:m,this.emitIndent(),this.writeLineToOutput("__extends("+g+", _super);");var o=k.extendsList.length;if(o>1)for(var f=1;f<o;f++){var p=k.extendsList[f];this.emitAddBaseMethods(g,p,c)}}this.emitIndent();var q=c.constructorDecl;if(q)this.emitJavascript(c.constructorDecl,a.TokenID.LParen,!1,!1),d&&this.emitMembersFromConstructorDefinition(c.constructorDecl);else{var r=0;this.recordSourceMappingStart(c),this.increaseIndent(),this.writeToOutput("function "+c.name.text+"() {"),l&&(this.writeLineToOutput(""),this.emitIndent(),this.writeLineToOutput("_super.apply(this, arguments);"),r++);var s=this.thisClassNode.members.members;for(var f=0;f<s.length;f++)if(s[f].nodeType==a.NodeType.VarDecl){var t=s[f];!a.hasFlag(t.varFlags,a.VarFlags.Static)&&t.init&&(this.writeLineToOutput(""),this.emitIndent(),this.emitJavascriptVarDecl(t,a.TokenID.Tilde),r++)}r?(this.writeLineToOutput(""),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")):(this.writeLineToOutput(" }"),this.decreaseIndent()),this.recordSourceMappingEnd(c)}var u=c.definitionMembers.members.length;for(var v=0;v<u;v++){var w=c.definitionMembers.members[v];if(w.nodeType==a.NodeType.FuncDecl){var x=w;a.hasFlag(x.fncFlags,a.FncFlags.Method)&&!x.isSignature()?a.hasFlag(x.fncFlags,a.FncFlags.Static)?x.isAccessor()?this.emitPropertyAccessor(x,this.thisClassNode.name.text,!1,d):(this.emitIndent(),this.recordSourceMappingStart(x),this.writeToOutput(c.name.text+"."+x.name.text+" = "),this.emitInnerFunction(x,x.name&&!x.name.isMissing(),!1,null,x.hasSelfReference(),null,d),this.recordSourceMappingEnd(x)):this.emitPrototypeMember(x,g,d):d&&this.emitFuncSignature(x)}else{if(w.nodeType!=a.NodeType.VarDecl)throw Error("We want to catch this");var t=w;a.hasFlag(t.varFlags,a.VarFlags.Static)?(this.emitIndent(),this.recordSourceMappingStart(t),this.writeToOutput(c.name.text+"."+t.id.text+" = "),t.init?(this.emitJavascript(t.init,a.TokenID.Asg,!1),this.writeLineToOutput(";")):this.writeLineToOutput(this.defaultValue(t.type)+";"),d&&this.emitVarSignature(t),this.recordSourceMappingEnd(t)):d&&this.emitVarSignature(t)}}this.emitIndent(),this.recordSourceMappingStart(c),this.writeLineToOutput("return "+g+";"),this.recordSourceMappingEnd(c),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("})("),l&&this.emitJavascript(n,a.TokenID.Tilde,!1),this.writeToOutput(");"),d&&(this.setDeclContainingAST(h),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"));if((i==b.Module||i==b.DynamicModule)&&a.hasFlag(c.varFlags,a.VarFlags.Exported)){this.writeLineToOutput(""),this.emitIndent();var y=i==b.Module?this.moduleName:"exports";this.recordSourceMappingStart(c),this.writeToOutput(y+"."+g+" = "+g+";"),this.recordSourceMappingEnd(c)}this.emitIndent(),this.recordSourceMappingEnd(c),this.emitParensAndCommentsInPlace(c,!1),this.setContainer(i),this.thisClassNode=e}else d&&this.emitClassSignature(c)},d.prototype.emitPrologue=function(a){this.prologueEmitted||a&&(this.prologueEmitted=!0,this.writeLineToOutput("var __extends = this.__extends || function (d, b) {"),this.writeLineToOutput("    function __() { this.constructor = d; }"),this.writeLineToOutput("    __.prototype = b.prototype;"),this.writeLineToOutput("    d.prototype = new __();"),this.writeLineToOutput("}"))},d.prototype.emitSuperReference=function(){this.writeToOutput("_super.prototype")},d.prototype.emitSuperCall=function(b){if(b.target.nodeType==a.NodeType.Dot){var c=b.target;if(c.operand1.nodeType==a.NodeType.Super)return this.emitJavascript(c,a.TokenID.LParen,!1),this.writeToOutput(".call(this"),b.args&&b.args.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(b.args,", ",a.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")"),!0}return!1},d}();a.Emitter=d})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function b(a){this.outfile=a,this.parser=null,this.checker=null,this.lineCol={line:0,col:0},this.emitAsComments=!0,this.hasErrors=!1,this.pushToErrorSink=!1,this.errorSink=[]}return b.prototype.getCapturedErrors=function(){return this.errorSink},b.prototype.freeCapturedErrors=function(){this.errorSink=[]},b.prototype.captureError=function(a){this.errorSink[this.errorSink.length]=a},b.prototype.setErrOut=function(a){this.outfile=a,this.emitAsComments=!1},b.prototype.emitPrefix=function(){this.emitAsComments&&this.outfile.Write("// "),this.outfile.Write(this.checker.locationInfo.filename+"("+this.lineCol.line+","+this.lineCol.col+"): ")},b.prototype.writePrefix=function(a){a?this.setError(a):(this.lineCol.line=-1,this.lineCol.col=-1),this.emitPrefix()},b.prototype.writePrefixFromSym=function(b){b&&this.checker.locationInfo.lineMap?a.getSourceLineColFromMap(this.lineCol,b.location,this.checker.locationInfo.lineMap):(this.lineCol.line=-1,this.lineCol.col=-1),this.emitPrefix()},b.prototype.setError=function(b){b&&(b.flags|=a.ASTFlags.Error,this.checker.locationInfo.lineMap&&a.getSourceLineColFromMap(this.lineCol,b.minChar,this.checker.locationInfo.lineMap))},b.prototype.reportError=function(a,b){if(this.pushToErrorSink){this.captureError(b);return}this.hasErrors=!0;var c=a.limChar-a.minChar;this.parser.errorRecovery&&this.parser.errorCallback?this.parser.errorCallback(a.minChar,c,b,this.checker.locationInfo.unitIndex):(this.writePrefix(a),this.outfile.WriteLine(b))},b.prototype.reportErrorFromSym=function(a,b){if(this.pushToErrorSink){this.captureError(b);return}this.hasErrors=!0,this.parser.errorRecovery&&this.parser.errorCallback?this.parser.errorCallback(a.location,1,b,this.checker.locationInfo.unitIndex):(this.writePrefixFromSym(a),this.outfile.WriteLine(b))},b.prototype.emitterError=function(a,b){throw this.reportError(a,b),Error("EmitError")},b.prototype.duplicateIdentifier=function(a,b){this.reportError(a,"Duplicate identifier '"+b+"'")},b.prototype.showRef=function(a,b,c){var d={line:-1,col:-1};this.parser.getSourceLineCol(d,c.location),this.reportError(a,"symbol "+b+" defined at ("+d.line+","+d.col+")")},b.prototype.unresolvedSymbol=function(a,b){this.reportError(a,"The name '"+b+"' does not exist in the current scope")},b.prototype.symbolDoesNotReferToAValue=function(a,b){this.reportError(a,"The name '"+b+"' does not refer to a value")},b.prototype.styleError=function(a,b){var c=this.pushToErrorSink;this.pushToErrorSink=!1,this.reportError(a,"STYLE: "+b),this.pushToErrorSink=c},b.prototype.simpleError=function(a,b){this.reportError(a,b)},b.prototype.simpleErrorFromSym=function(a,b){this.reportErrorFromSym(a,b)},b.prototype.invalidSuperReference=function(a){this.simpleError(a,"Keyword 'super' can only be used inside a class instance method")},b.prototype.valueCannotBeModified=function(a){this.simpleError(a,"The left-hand side of an assignment expression must be a variable, property or indexer")},b.prototype.invalidCall=function(b,c,d){var e=b.target.type,f=e.getScopedTypeName(d);if(e.construct&&c==a.NodeType.Call)this.reportError(b,"Value of type '"+f+"' is not callable.  Did you mean to include 'new'?");else{var g=c==a.NodeType.Call?"callable":"newable";this.reportError(b,"Value of type '"+f+"' is not "+g)}},b.prototype.indexLHS=function(a,b){var c=a.operand1.type.getScopedTypeName(b),d=a.operand2.type.getScopedTypeName(b);this.simpleError(a,"Value of type '"+c+"' is not indexable by type '"+d+"'")},b.prototype.incompatibleTypes=function(a,b,c,d,e,f){b||(b=this.checker.anyType),c||(c=this.checker.anyType);var g=f?f.message:"";d?this.reportError(a,"Operator '"+d+"' cannot be applied to types '"+b.getScopedTypeName(e)+"' and '"+c.getScopedTypeName(e)+"'"+(g?": "+g:"")):this.reportError(a,"Cannot convert '"+b.getScopedTypeName(e)+"' to '"+c.getScopedTypeName(e)+"'"+(g?": "+g:""))},b.prototype.expectedClassOrInterface=function(a){this.simpleError(a,"Expected var, class, interface, or module")},b.prototype.unaryOperatorTypeError=function(a,b,c){this.reportError(a,"Operator '"+b+"' cannot be applied to type '"+c.getTypeName()+"'")},b}();a.ErrorReporter=b})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function f(b,c,d,f,g,h){var i=d.getText(f,g);b.log("Quick parse range ("+f+","+g+'): "'+a.stringToLiteral(i,100)+'"');var j=new e;j.setErrorRecovery(null,-1,-1),j.errorCallback=h;var k=new a.TypeDecl(a.NodeType.Class,null,null,null,null,null);j.currentClassDecl=k;var l=j.quickParse(new a.StringSourceText(i),"",0);return l}(function(a){a._map=[],a.NoTypes=0,a.ArraySuffix=1,a.Primitive=2,a.Named=4,a.AllSimpleTypes=a.Primitive|a.Named,a.AllTypes=a.Primitive|a.Named|a.ArraySuffix})(a.TypeContext||(a.TypeContext={}));var b=a.TypeContext;(function(a){a._map=[],a._map[0]="None",a.None=0,a._map[1]="StartScript",a.StartScript=1,a._map[2]="StartStmtList",a.StartStmtList=2,a._map[3]="StartStatement",a.StartStatement=3,a._map[4]="StartFncDecl",a.StartFncDecl=4,a._map[5]="FncDeclName",a.FncDeclName=5,a._map[6]="FncDeclArgs",a.FncDeclArgs=6,a._map[7]="FncDeclReturnType",a.FncDeclReturnType=7,a._map[8]="ForInit",a.ForInit=8,a._map[9]="ForInitAfterVar",a.ForInitAfterVar=9,a._map[10]="ForCondStart",a.ForCondStart=10,a._map[11]="EndStmtList",a.EndStmtList=11,a._map[12]="EndScript",a.EndScript=12})(a.ParseState||(a.ParseState={}));var c=a.ParseState,d=function(){function a(a,b){this.Script=a,this.endLexState=b}return a}();a.QuickParseResult=d;var e=function(){function e(){this.varLists=[],this.scopeLists=[],this.staticsLists=[],this.scanner=new a.Scanner,this.tok=null,this.needTerminator=!1,this.inFnc=!1,this.inStaticFnc=!1,this.inInterfaceDecl=!1,this.currentClassDecl=null,this.inFncDecl=!1,this.anonId=new a.Identifier("_anonymous"),this.style_requireSemi=!1,this.style_funcInLoop=!0,this.incremental=!1,this.errorRecovery=!1,this.outfile=undefined,this.errorCallback=null,this.state=c.StartStmtList,this.cursorLine=-1,this.cursorColumn=-1,this.cursorState=c.None,this.errorMessage="",this.ambientModule=!1,this.ambientClass=!1,this.topLevel=!0,this.currentUnitIndex=-1,this.prevIDTok=null,this.stmtStack=new Array,this.hasTopLevelImportOrExport=!1,this.strictMode=!1,this.nestingLevel=0,this.prevExpr=null,this.currentClassDefinition=null,this.parsingClassConstructorDefinition=!1,this.parsingDeclareFile=!1,this.amdDependencies=[],this.inferPropertiesFromThisAssignment=!1,this.fname="",this.parseError=!1}return e.prototype.resetStmtStack=function(){this.stmtStack=new Array},e.prototype.inLoop=function(){for(var a=this.stmtStack.length-1;a>=0;a--)if(this.stmtStack[a].stmt.isLoop())return!0;return!1},e.prototype.pushStmt=function(a,b){var c={stmt:a,labels:b};this.stmtStack.push(c)},e.prototype.popStmt=function(){return this.stmtStack.pop()},e.prototype.resolveJumpTarget=function(b){var c=this.stmtStack.length;for(var d=c-1;d>=0;d--){var e=this.stmtStack[d];if(b.target){if(e.labels&&e.labels.members.length>0)for(var f=0,g=e.labels.members.length;f<g;f++){var h=e.labels.members[f];if(h.id.text==b.target){b.setResolvedTarget(this,e.stmt);return}}}else{if(e.stmt.isLoop()){b.setResolvedTarget(this,e.stmt);return}if(e.stmt.nodeType==a.NodeType.Switch&&b.nodeType==a.NodeType.Break){b.setResolvedTarget(this,e.stmt);return}}}b.target?this.reportParseError("could not find enclosing statement with label "+b.target):b.nodeType==a.NodeType.Break?this.reportParseError("break statement requires enclosing loop or switch"):this.reportParseError("continue statement requires enclosing loop")},e.prototype.setNonInteractive=function(){this.errorRecovery=!1},e.prototype.setErrorRecovery=function(a,b,d){this.outfile=a,this.cursorLine=b,this.cursorColumn=d,this.cursorState=c.None,this.errorRecovery=!0},e.prototype.posMatchesCursor=function(a){var b={line:-1,col:-1};return this.getSourceLineCol(b,a),b.line==this.cursorLine&&b.col==this.cursorColumn},e.prototype.getSourceLineCol=function(b,c){a.getSourceLineColFromMap(b,c,this.scanner.lineMap)},e.prototype.createRef=function(b,c){var d=new a.Identifier(b);return d.minChar=c,d},e.prototype.reportParseStyleError=function(a){this.reportParseError("STYLE: "+a)},e.prototype.reportParseError=function(a,b,c){typeof b=="undefined"&&(b=this.scanner.startPos),typeof c=="undefined"&&(c=this.scanner.pos);var d=Math.max(1,c-b);if(this.errorCallback)this.errorCallback(b,d,a,this.currentUnitIndex);else{if(!this.errorRecovery)throw new SyntaxError(this.fname+" ("+this.scanner.line+","+this.scanner.col+"): "+a);var e={line:-1,col:-1};this.getSourceLineCol(e,b),this.outfile&&this.outfile.WriteLine("// "+this.fname+" ("+e.line+","+e.col+"): "+a)}},e.prototype.chkNxtTok=function(a,b,c){this.tok=this.scanner.scan(),this.chkCurTok(a,b,c)},e.prototype.skip=function(b){b|=a.ErrorRecoverySet.EOF;var c=a.ErrorRecoverySet.None,d=a.lookupToken(this.tok.tokenId);d!=undefined&&(c=d.ers);var e=0;while((c&b)==a.ErrorRecoverySet.None||this.tok.tokenId==a.TokenID.RCurly&&e>0)this.tok.tokenId==a.TokenID.LCurly?e++:this.tok.tokenId==a.TokenID.RCurly&&e--,this.tok=this.scanner.scan(),c=a.ErrorRecoverySet.None,d=a.lookupToken(this.tok.tokenId),d!=undefined&&(c=d.ers)},e.prototype.chkCurTok=function(a,b,c){this.tok.tokenId!=a?(this.reportParseError(b),this.errorRecovery&&this.skip(c)):this.tok=this.scanner.scan()},e.prototype.pushDeclLists=function(){this.staticsLists.push(new a.ASTList),this.varLists.push(new a.ASTList),this.scopeLists.push(new a.ASTList)},e.prototype.popDeclLists=function(){this.staticsLists.pop(),this.varLists.pop(),this.scopeLists.pop()},e.prototype.topVarList=function(){return this.varLists[this.varLists.length-1]},e.prototype.topScopeList=function(){return this.scopeLists[this.scopeLists.length-1]},e.prototype.topStaticsList=function(){return this.staticsLists[this.staticsLists.length-1]},e.prototype.parseComment=function(b){if(b){var c=new a.Comment(b.value,b.isBlock,b.endsLine);c.minChar=b.startPos,c.limChar=b.startPos+b.value.length;if(!b.isBlock&&b.value.length>3&&b.value.substring(0,3)=="///"){var d=a.getAdditionalDependencyPath(b.value);d&&this.amdDependencies.push(d)}return c}return null},e.prototype.parseCommentsInner=function(a){if(a){var b=new Array;for(var c=0;c<a.length;c++)b.push(this.parseComment(a[c]));return b}return null},e.prototype.parseComments=function(){var a=this.scanner.getComments();return this.parseCommentsInner(a)},e.prototype.parseCommentsForLine=function(a){var b=this.scanner.getCommentsForLine(a);return this.parseCommentsInner(b)},e.prototype.combineComments=function(a,b){return a==null?b:b==null?a:a.concat(b)},e.prototype.parseEnumDecl=function(c,d){var e=this.scanner.leftCurlyCount,f=this.scanner.rightCurlyCount,g=null;this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)?(g=new a.Identifier(this.tok.getText()),g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("Enum declaration requires identifier"),this.errorRecovery&&(g=new a.MissingIdentifier,g.minChar=this.scanner.startPos,g.limChar=this.scanner.startPos,g.flags|=a.ASTFlags.Error));var h=this.scanner.startPos;this.chkCurTok(a.TokenID.LCurly,"Expected '{'",c|a.ErrorRecoverySet.ID),this.pushDeclLists();var i=new a.ASTList;i.minChar=h;var j=new a.VarDecl(new a.Identifier("_map"),0);j.varFlags|=a.VarFlags.Exported,j.varFlags|=a.VarFlags.Private,j.varFlags|=a.VarFlags.Property|a.VarFlags.Public,j.init=new a.UnaryExpression(a.NodeType.ArrayLit,null),i.append(j);var k=null;for(;;){var l=this.scanner.startPos,m,n=null,o=null,p=null,q=null;if(this.tok.tokenId==a.TokenID.ID||a.convertTokToIDName(this.tok))n=new a.Identifier(this.tok.getText()),n.minChar=this.scanner.startPos,n.limChar=this.scanner.pos;else{if(this.tok.tokenId==a.TokenID.RCurly)break;this.reportParseError("Expected identifer of enum member"),this.errorRecovery&&(n=new a.MissingIdentifier,n.minChar=this.scanner.startPos,n.limChar=this.scanner.startPos,n.flags|=a.ASTFlags.Error)}m=this.scanner.pos,p=this.parseComments(),this.tok=this.scanner.scan(),q=this.parseComments();if(this.tok.tokenId==a.TokenID.Asg)this.tok=this.scanner.scan(),o=this.parseExpr(c,a.OperatorPrecedence.Cma,!0,b.NoTypes),k=o,m=o.limChar;else{k==null?(o=new a.NumberLiteral(0),k=o):(o=new a.NumberLiteral(k.value+1),k=o);var r=new a.BinaryExpression(a.NodeType.Asg,new a.BinaryExpression(a.NodeType.Index,new a.Identifier("_map"),o),new a.StringLiteral('"'+n.text+'"'));i.append(r)}var s=new a.VarDecl(n,this.nestingLevel);s.minChar=l,s.limChar=m,s.init=o,s.typeExpr=new a.TypeReference(this.createRef(g.text,-1),0),s.varFlags|=a.VarFlags.Readonly|a.VarFlags.Property,o.nodeType==a.NodeType.NumberLit&&(s.varFlags|=a.VarFlags.Constant),s.preComments=p,i.append(s),s.postComments=q,s.varFlags|=a.VarFlags.Exported;if(this.tok.tokenId==a.TokenID.Comma){this.tok=this.scanner.scan(),s.postComments=this.combineComments(s.postComments,this.parseCommentsForLine(this.scanner.prevLine));if(this.tok.tokenId==a.TokenID.ID||a.convertTokToIDName(this.tok))continue}break}this.chkCurTok(a.TokenID.RCurly,"Expected '}'",c),i.limChar=this.scanner.lastTokenLimChar();var t=new a.ModuleDecl(g,i,this.topVarList(),this.topScopeList());return t.modFlags|=a.ModuleFlags.IsEnum,this.popDeclLists(),t.leftCurlyCount=this.scanner.leftCurlyCount-e,t.rightCurlyCount=this.scanner.rightCurlyCount-f,t},e.prototype.parseDottedName=function(b){this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)){var c=new a.Identifier(this.tok.getText());c.preComments=this.parseComments(),b[b.length]=c,c.minChar=this.scanner.startPos,c.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.Dot&&this.parseDottedName(b)}else this.reportParseError("need identifier after '.'")},e.prototype.isValidImportPath=function(b){return b=a.stripQuotes(b),!b||b.indexOf(":")!=-1||b.indexOf("\\")!=-1||b.charAt(0)=="/"?!1:!0},e.prototype.parseImportDecl=function(c,d){var e=null,f=null,g=null,h=this.scanner.startPos,i=!1;this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)?e=new a.Identifier(this.tok.getText()):(this.reportParseError("Expected identifer after 'import'"),e=new a.MissingIdentifier),e.minChar=this.scanner.startPos,e.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.chkCurTok(a.TokenID.Asg,"Expected =",c|a.ErrorRecoverySet.ID);var j=this.parseComments(),k;if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))if(this.tok.tokenId==a.TokenID.MODULE){k=this.scanner.pos,this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.LParen){this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.QString||this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))if(this.tok.tokenId==a.TokenID.QString){this.topLevel&&(this.hasTopLevelImportOrExport=!0);var l=this.tok.getText();this.isValidImportPath(l)||this.reportParseError("Invalid import path"),f=new a.Identifier(l),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos,i=!0,this.tok=this.scanner.scan(),f.preComments=j}else f=this.parseExpr(c|a.ErrorRecoverySet.SColon,a.OperatorPrecedence.Asg,!0,b.NoTypes),f.preComments=j;k=this.scanner.pos,this.chkCurTok(a.TokenID.RParen,"Expected ')'",c|a.ErrorRecoverySet.ID),f&&(f.postComments=this.parseComments()),this.tok.tokenId==a.TokenID.SColon&&(k=this.scanner.pos,this.tok=this.scanner.scan())}}else f=this.parseExpr(c|a.ErrorRecoverySet.SColon,a.OperatorPrecedence.Asg,!0,b.NoTypes),k=this.scanner.pos;else this.reportParseError("Expected module name"),f=new a.MissingIdentifier,f.minChar=this.scanner.startPos,f.limChar=this.scanner.startPos,f.flags|=a.ASTFlags.Error,k=f.limChar;return g=new a.ImportDecl(e,f),g.isDynamicImport=i,a.hasFlag(d,a.Modifiers.Exported)&&(g.varFlags|=a.VarFlags.Exported),g.minChar=h,g.limChar=k,g},e.prototype.parseModuleDecl=function(b,c){var d=this.scanner.leftCurlyCount,e=this.scanner.rightCurlyCount,f=this.ambientModule,g=this.topLevel;this.topLevel=!1;if(this.parsingDeclareFile||a.hasFlag(c,a.Modifiers.Ambient))this.ambientModule=!0;this.tok=this.scanner.scan();var h=null,i=null;this.pushDeclLists();var j=this.parseComments(),k=this.scanner.startPos,l=!1;if(this.tok.tokenId==a.TokenID.ID||this.tok.tokenId==a.TokenID.QString||a.convertTokToID(this.tok,this.strictMode)){var m=this.tok.getText();this.tok.tokenId==a.TokenID.QString&&(l=!0,this.ambientModule||this.reportParseError("Only ambient dynamic modules may have string literal names")),h=new a.Identifier(m),h.minChar=this.scanner.startPos,h.limChar=this.scanner.pos,this.tok=this.scanner.scan()}else this.tok.tokenId==a.TokenID.LCurly&&(this.reportParseError("Module name missing"),h=new a.Identifier(""),h.minChar=k,h.limChar=k);this.tok.tokenId==a.TokenID.Dot&&(i=new Array,this.parseDottedName(i)),h==null&&(h=new a.MissingIdentifier);var n=new a.ASTList,o=this.scanner.startPos;this.chkCurTok(a.TokenID.LCurly,"Expected '{'",b|a.ErrorRecoverySet.ID),this.parseStmtList(b|a.ErrorRecoverySet.RCurly,n,!0,!0,a.AllowedElements.ModuleMembers,c),n.minChar=o,n.limChar=this.scanner.pos,this.chkCurTok(a.TokenID.RCurly,"Expected '}'",b);var p=this.scanner.pos,q;if(i&&i.length>0){var r=i.length,s=i[r-1],t=new a.ModuleDecl(s,n,this.topVarList(),this.topScopeList());if(this.parsingDeclareFile||a.hasFlag(c,a.Modifiers.Ambient))t.modFlags|=a.ModuleFlags.Ambient;t.modFlags|=a.ModuleFlags.Exported,t.minChar=k,t.limChar=p,this.popDeclLists();var u;for(var v=r-2;v>=0;v--){u=new a.ASTList,u.append(t),s=i[v],t=new a.ModuleDecl(s,u,new a.ASTList,new a.ASTList),u.minChar=t.minChar=k,u.limChar=t.limChar=p;if(this.parsingDeclareFile||a.hasFlag(c,a.Modifiers.Ambient))t.modFlags|=a.ModuleFlags.Ambient;t.modFlags|=a.ModuleFlags.Exported}u=new a.ASTList,u.append(t),u.minChar=k,u.limChar=p,q=new a.ModuleDecl(h,u,new a.ASTList,new a.ASTList)}else q=new a.ModuleDecl(h,n,this.topVarList(),this.topScopeList()),this.popDeclLists();if(this.parsingDeclareFile||a.hasFlag(c,a.Modifiers.Ambient))q.modFlags|=a.ModuleFlags.Ambient;return a.hasFlag(c,a.Modifiers.Exported)&&(q.modFlags|=a.ModuleFlags.Exported),l&&(q.modFlags|=a.ModuleFlags.IsDynamic),q.preComments=j,q.postComments=this.parseComments(),this.ambientModule=f,this.topLevel=g,q.leftCurlyCount=this.scanner.leftCurlyCount-d,q.rightCurlyCount=this.scanner.rightCurlyCount-e,q},e.prototype.parseTypeReferenceTail=function(b,c,d){var e=new a.TypeReference(d,0);e.minChar=c;while(this.tok.tokenId==a.TokenID.LBrack)this.tok=this.scanner.scan(),e.arrayCount++,this.chkCurTok(a.TokenID.RBrack,"Expected ']'",b|a.ErrorRecoverySet.LBrack);return e.limChar=this.scanner.lastTokenLimChar(),e},e.prototype.parseNamedType=function(b,c,d,e){this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.Dot){var f=this.scanner.pos;this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)){var g=new a.Identifier(this.tok.getText());g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos;var h=new a.BinaryExpression(a.NodeType.Dot,d,g);return h.minChar=d.minChar,h.limChar=g.limChar,this.parseNamedType(b,c,h,e)}this.reportParseError("need identifier after '.'");if(this.errorRecovery)return d.flags|=a.ASTFlags.DotLHS,d.limChar=this.scanner.lastTokenLimChar(),d;var i=new a.MissingIdentifier;i.minChar=this.scanner.pos,i.limChar=this.scanner.pos;var j=new a.BinaryExpression(a.NodeType.Dot,d,i);return j.flags|=a.ASTFlags.Error,j.minChar=d.minChar,j.limChar=i.limChar,this.parseNamedType(b,c,j,e)}return e?this.parseTypeReferenceTail(b,c,d):d},e.prototype.parseTypeReference=function(b,c){var d=this.scanner.startPos,e=!1;switch(this.tok.tokenId){case a.TokenID.VOID:c||this.reportParseError("void not a valid type in this context");case a.TokenID.NUMBER:case a.TokenID.BOOL:case a.TokenID.ANY:case a.TokenID.STRING:var f=a.tokenTable[this.tok.tokenId].text,g=new a.Identifier(f);return g.minChar=d,g.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.parseTypeReferenceTail(b,d,g);case a.TokenID.ID:var h=this.createRef(this.tok.getText(),d);return h.limChar=this.scanner.pos,this.parseNamedType(b,d,h,!0);case a.TokenID.LCurly:this.tok=this.scanner.scan();var i=new a.ASTList;i.minChar=d;var j=this.inInterfaceDecl;this.inInterfaceDecl=!0,this.parseInterfaceMembers(b|a.ErrorRecoverySet.RCurly,i),this.inInterfaceDecl=j,this.chkCurTok(a.TokenID.RCurly,"Expected '}'",b);var k=new a.TypeDecl(a.NodeType.Interface,this.anonId,i,null,null,null);return k.minChar=d,k.limChar=i.limChar,this.parseTypeReferenceTail(b,d,k);case a.TokenID.NEW:this.tok=this.scanner.scan(),this.tok.tokenId!=a.TokenID.LParen?this.reportParseError("Expected '('"):e=!0;case a.TokenID.LParen:var l=new a.ASTList,m=this.parseFormalParameterList(b|a.ErrorRecoverySet.RParen,l,!1,!0,!1,!1,!1,null);this.chkCurTok(a.TokenID.Arrow,"Expected '=>'",b);var n=this.parseTypeReference(b,!0),o=new a.FuncDecl(null,null,!1,l,null,null,null,a.NodeType.FuncDecl);return o.returnTypeAnnotation=n,o.variableArgList=m,o.fncFlags|=a.FncFlags.Signature,e&&(o.fncFlags|=a.FncFlags.ConstructMember,o.hint="_construct",o.classDecl=null),o.minChar=d,this.parseTypeReferenceTail(b,d,o);default:this.reportParseError("Expected type name");var p=new a.TypeReference(null,0);return p.flags|=a.ASTFlags.Error,p.minChar=this.scanner.pos,p.limChar=this.scanner.pos,p}},e.prototype.parseFunctionStatements=function(d,e,f,g,h,i,j,k,l){this.pushDeclLists();var m=this.stmtStack;this.resetStmtStack();var n=null,o=!1,p=!1;if(!k){n=new a.ASTList;var q=this.scanner.startPos;this.tok.tokenId==a.TokenID.Arrow&&(g&&this.reportParseError("'=>' may not be used for class methods"),o=!0,this.tok=this.scanner.scan());if(o&&this.tok.tokenId!=a.TokenID.LCurly){var r=this.parseExpr(d|a.ErrorRecoverySet.SColon,a.OperatorPrecedence.Asg,!0,b.NoTypes),s=new a.ReturnStatement;s.returnExpression=r,n.minChar=q,n.append(s)}else{this.state=c.StartStmtList,this.chkCurTok(a.TokenID.LCurly,"Expected '{'",d|a.ErrorRecoverySet.StmtStart);var t=this.inFnc;p=o,this.inFnc=!0,this.parseStmtList(d|a.ErrorRecoverySet.RCurly|a.ErrorRecoverySet.StmtStart,n,!0,!1,i,l),n.minChar=q,n.limChar=this.scanner.pos,this.inFnc=t;var u=new a.EndCode;u.minChar=n.limChar,u.limChar=u.minChar,n.append(u)}}var v=new a.FuncDecl(e,n,f,h,this.topVarList(),this.topScopeList(),this.topStaticsList(),a.NodeType.FuncDecl);this.popDeclLists();var w=this.topScopeList();w.append(v);var x=!1,y=this.scanner.pos;return k?this.chkCurTok(a.TokenID.SColon,"Expected ';'",d):!o||p?(this.chkCurTok(a.TokenID.RCurly,"Expected '}'",d),p&&(v.fncFlags|=a.FncFlags.IsFatArrowFunction)):(v.fncFlags|=a.FncFlags.IsFatArrowFunction,this.tok.tokenId==a.TokenID.SColon&&(this.tok=this.scanner.scan())),v.minChar=j,v.limChar=y,k||(v.fncFlags|=a.FncFlags.Definition),this.stmtStack=m,v},e.prototype.transformAnonymousArgsIntoFormals=function(b,c){var d=this,e=function(c){if(c.nodeType==a.NodeType.Comma)d.transformAnonymousArgsIntoFormals(b,c);else if(c.nodeType==a.NodeType.Name||c.nodeType==a.NodeType.Asg){var e=c.nodeType==a.NodeType.Asg?c.operand1:c,f=new a.ArgDecl(e);f.preComments=e.preComments,f.postComments=e.postComments,f.minChar=e.minChar,f.limChar=e.limChar,a.hasFlag(e.flags,a.ASTFlags.PossibleOptionalParameter)&&(f.isOptional=!0),c.nodeType==a.NodeType.Asg&&(f.init=c.operand2),b.append(f)}else d.reportParseError("Invalid lambda argument")};if(c)if(c.nodeType==a.NodeType.Comma){var f=c;e(f.operand1),e(f.operand2)}else e(c)},e.prototype.parseFormalParameterList=function(c,d,e,f,g,h,i,j){d.minChar=this.scanner.startPos,g?this.tok=this.scanner.scan():j||this.chkCurTok(a.TokenID.LParen,"Expected '('",c|a.ErrorRecoverySet.RParen);var k=!1,l=!0,m=!1,n=!1,o=!1;j&&(this.transformAnonymousArgsIntoFormals(d,j),n=!0);for(;;){var p=!1,q=a.VarFlags.None,r=this.scanner.startPos;this.inferPropertiesFromThisAssignment&&this.tok.tokenId==a.TokenID.THIS&&(e||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.tok=this.scanner.scan(),q|=a.VarFlags.Public|a.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=a.VarFlags.ClassSuperMustBeFirstCallInConstructor)),this.tok.tokenId==a.TokenID.PUBLIC?(q|=a.VarFlags.Public|a.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=a.VarFlags.ClassSuperMustBeFirstCallInConstructor)):this.tok.tokenId==a.TokenID.PRIVATE&&(q|=a.VarFlags.Private|a.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=a.VarFlags.ClassSuperMustBeFirstCallInConstructor)),q!=a.VarFlags.None?(e||this.reportParseError("only constructor parameters can be properties"),this.tok=this.scanner.scan(),this.inferPropertiesFromThisAssignment&&this.tok.tokenId==a.TokenID.THIS&&(e||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.tok=this.scanner.scan(),this.tok=this.scanner.scan())):this.tok.tokenId==a.TokenID.Ellipsis&&(k=!0,this.tok=this.scanner.scan());var s=null;if(!n&&this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))s=new a.Identifier(this.tok.getText()),s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos;if(n||s){p=!0;var t=null,u=null;n&&d.members.length?(u=d.members[d.members.length-1],u.isOptional&&(m=!0,o=!0)):(u=new a.ArgDecl(s),h&&this.reportParseError("Property getters may not take any arguments"),i&&!l&&this.reportParseError("Property setters may only take one argument"),u.minChar=r,u.preComments=this.parseComments(),this.tok=this.scanner.scan()),this.tok.tokenId==a.TokenID.QMark&&(u.isOptional=!0,m=!0,this.tok=this.scanner.scan()),this.tok.tokenId==a.TokenID.Colon&&(this.tok=this.scanner.scan(),t=this.parseTypeReference(c,!1),j&&(o=!0)),this.tok.tokenId==a.TokenID.Asg&&(f&&this.reportParseError("Arguments in signatures may not have default values"),m=!0,this.tok=this.scanner.scan(),u.init=this.parseExpr(a.ErrorRecoverySet.Comma|c,a.OperatorPrecedence.Cma,!1,b.NoTypes)),m&&!u.isOptionalArg()&&!k&&this.reportParseError("Optional parameters may only be followed by other optional parameters"),k&&u.isOptionalArg()&&this.reportParseError("Varargs may not be optional or have default parameters"),u.postComments=this.parseComments(),u.typeExpr=t,u.limChar=this.scanner.lastTokenLimChar(),u.varFlags|=q,n?n=!1:d.append(u)}l=!1;if(this.tok.tokenId!=a.TokenID.Comma)break;if(p&&!k){this.tok=this.scanner.scan();continue}this.reportParseError("Unexpected ',' in argument list");if(this.errorRecovery){this.tok=this.scanner.scan();continue}}return g?this.chkCurTok(a.TokenID.RBrack,"Expected ']'",c|a.ErrorRecoverySet.LCurly|a.ErrorRecoverySet.SColon):(!j||o)&&this.chkCurTok(a.TokenID.RParen,"Expected ')'",c|a.ErrorRecoverySet.LCurly|a.ErrorRecoverySet.SColon),d.limChar=this.scanner.lastTokenLimChar(),k},e.prototype.parseFncDecl=function(b,d,e,f,g,h,i,j,k,l){var m=this.scanner.leftCurlyCount,n=this.scanner.rightCurlyCount,o=this.parsingClassConstructorDefinition;this.parsingClassConstructorDefinition=!1;var p=null,q=this.scanner.startPos,r=this.scanner.pos,s=this.nestingLevel;this.nestingLevel=0,!this.style_funcInLoop&&this.inLoop()&&this.reportParseStyleError("function declaration in loop");if(!f&&!i&&!h&&!l){this.tok=this.scanner.scan(),this.state=c.StartFncDecl;if(this.tok.tokenId!=a.TokenID.ID&&!a.convertTokToID(this.tok,this.strictMode)){if(d)return this.reportParseError("Function declaration must include identifier"),this.nestingLevel=s,new a.IncompleteAST(q,this.scanner.pos)}else p=new a.Identifier(this.tok.getText()),p.minChar=this.scanner.startPos,p.limChar=this.scanner.pos,this.tok=this.scanner.scan()}else g&&(p=g);this.state=c.FncDeclName;var t=new a.ASTList,u=!1,v=!1,w=a.hasFlag(k,a.Modifiers.Getter),x=a.hasFlag(k,a.Modifiers.Setter);if(this.tok.tokenId==a.TokenID.LParen||h&&this.tok.tokenId==a.TokenID.LBrack||l&&l.preProcessedLambdaArgs)u=this.parseFormalParameterList(b,t,!1,e,h,w,x,l?l.preProcessedLambdaArgs:null);this.state=c.FncDeclArgs;var y=null;this.tok.tokenId==a.TokenID.Colon&&(this.tok=this.scanner.scan(),a.hasFlag(k,a.Modifiers.Setter)&&this.reportParseError("Property setters may not declare a return type"),y=this.parseTypeReference(b,!0)),h&&t.members.length==0&&this.reportParseError("Index signatures require a parameter type to be specified"),this.state=c.FncDeclReturnType,d&&!this.parsingDeclareFile&&!j&&(!f||!(this.ambientModule||this.ambientClass||this.inInterfaceDecl))&&this.tok.tokenId==a.TokenID.SColon&&(v=!0,d=!1,e=!0);var z=this.inFncDecl;this.inFncDecl=!0;var A=this.parseFunctionStatements(b|a.ErrorRecoverySet.RCurly,p,!1,f,t,a.AllowedElements.FunctionBody,r,e,a.Modifiers.None);return this.inFncDecl=z,A.variableArgList=u,A.isOverload=v,e||(A.fncFlags|=a.FncFlags.Definition),i&&(A.fncFlags|=a.FncFlags.Static),e&&(A.fncFlags|=a.FncFlags.Signature),h&&(A.fncFlags|=a.FncFlags.IndexerMember),A.returnTypeAnnotation=y,f&&(A.fncFlags|=a.FncFlags.Method,A.fncFlags|=a.FncFlags.ClassPropertyMethodExported
),A.leftCurlyCount=this.scanner.leftCurlyCount-m,A.rightCurlyCount=this.scanner.rightCurlyCount-n,this.nestingLevel=s,this.parsingClassConstructorDefinition=o,A},e.prototype.convertToTypeReference=function(b){var c;switch(b.nodeType){case a.NodeType.TypeRef:return b;case a.NodeType.Name:return c=new a.TypeReference(b,0),c.minChar=b.minChar,c.limChar=b.limChar,c;case a.NodeType.Index:var d=b;c=this.convertToTypeReference(d.operand1);if(c)return c.arrayCount++,c.minChar=d.minChar,c.limChar=d.limChar,c;var e=new a.AST(a.NodeType.Error);return e}return null},e.prototype.parseArgList=function(c){var d=new a.ASTList;d.minChar=this.scanner.startPos,this.tok=this.scanner.scan();if(this.tok.tokenId!==a.TokenID.RParen)for(;;){if(d.members.length>65535){this.reportParseError("max number of args exceeded");break}var e=this.parseExpr(a.ErrorRecoverySet.Comma|c,a.OperatorPrecedence.Cma,!1,b.NoTypes);d.append(e);if(this.tok.tokenId!=a.TokenID.Comma)break;this.tok=this.scanner.scan()}return d.limChar=this.scanner.pos,d},e.prototype.parseBaseList=function(b,c,d,e,f){var g=!0,h=b;for(;;){g&&(this.tok.tokenId==a.TokenID.IMPLEMENTS&&(e&&this.reportParseError("interfaces can not implement other types"),h=c),this.tok=this.scanner.scan(),g=!1);var i=null;if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)){var j=this.scanner.startPos;i=new a.Identifier(this.tok.getText()),i.minChar=j,i.limChar=this.scanner.pos,i=this.parseNamedType(d|a.ErrorRecoverySet.LCurly,j,i,!1)}else this.reportParseError("Expected base name"),this.errorRecovery&&(i=new a.MissingIdentifier,i.minChar=this.scanner.pos,i.limChar=this.scanner.pos,i.flags|=a.ASTFlags.Error);if(this.tok.tokenId==a.TokenID.LParen){f&&this.reportParseError("Base classes may only be initialized via a 'super' call within the constructor body");var k=this.parseArgList(d|a.ErrorRecoverySet.RParen),l=new a.CallExpression(a.NodeType.Call,i,k);this.tok=this.scanner.scan(),l.limChar=this.scanner.pos,h.append(l)}else h.append(i);!e&&h==b&&b.members.length>1&&this.reportParseError("A class may only extend one other class");if(this.tok.tokenId==a.TokenID.Comma){this.tok=this.scanner.scan();continue}if(this.tok.tokenId==a.TokenID.EXTENDS||this.tok.tokenId==a.TokenID.IMPLEMENTS){h=b,g=!0;continue}break}},e.prototype.parseClassDecl=function(b,c,d){var e=this.scanner.leftCurlyCount,f=this.scanner.rightCurlyCount;(d&a.Modifiers.Readonly)!=a.Modifiers.None&&this.reportParseError("const modifier is implicit for class");if(this.parsingDeclareFile||this.ambientModule)d|=a.Modifiers.Ambient,d|=a.Modifiers.Exported;var g=this.parsingDeclareFile||(d&a.Modifiers.Ambient)!=a.Modifiers.None,h=this.ambientClass;this.ambientClass=g,this.tok=this.scanner.scan();var i=null;this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)?(i=new a.Identifier(this.tok.getText()),i.minChar=this.scanner.startPos,i.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("class missing name"),this.errorRecovery&&(i=new a.MissingIdentifier,i.minChar=this.scanner.pos,i.limChar=this.scanner.pos,i.flags|=a.ASTFlags.Error));var j=null,k=null,l=!1;if(this.tok.tokenId==a.TokenID.EXTENDS||this.tok.tokenId==a.TokenID.IMPLEMENTS)j=new a.ASTList,k=new a.ASTList,this.parseBaseList(j,k,b,!1,!0);var m=new a.ClassDecl(i,new a.ASTList,j,k);this.currentClassDefinition=m,this.parseClassElements(m,b,d);if(this.ambientModule||this.parsingDeclareFile||a.hasFlag(d,a.Modifiers.Exported))m.varFlags|=a.VarFlags.Exported;if(this.ambientModule||a.hasFlag(d,a.Modifiers.Ambient))m.varFlags|=a.VarFlags.Ambient;return m.varFlags|=a.VarFlags.Class,this.ambientClass=h,m.leftCurlyCount=this.scanner.leftCurlyCount-e,m.rightCurlyCount=this.scanner.rightCurlyCount-f,m},e.prototype.parseClassElements=function(b,c,d){var e=d,f=!1,g=this.scanner.startPos;this.chkCurTok(a.TokenID.LCurly,"Expected '{'",c),this.nestingLevel++;var h=this.scanner.startPos,i=!1;while(this.tok.tokenId!=a.TokenID.RCurly&&this.tok.tokenId!=a.TokenID.EOF){var j=!0,k=a.Modifiers.Public|a.Modifiers.Private;if(this.tok.tokenId==a.TokenID.GET)e&a.Modifiers.Getter&&this.reportParseError("Duplicate 'get' declaration in class body"),e&a.Modifiers.Setter&&this.reportParseError("Getter already marked as a setter"),e|=a.Modifiers.Getter;else if(this.tok.tokenId==a.TokenID.SET)e&a.Modifiers.Setter&&this.reportParseError("Duplicate 'set' declaration in class body"),e&a.Modifiers.Getter&&this.reportParseError("Setter already marked as a getter"),e|=a.Modifiers.Setter;else if(this.tok.tokenId==a.TokenID.PRIVATE)e&k&&this.reportParseError("Multiple modifiers may not be applied to class members"),e|=a.Modifiers.Private;else if(this.tok.tokenId==a.TokenID.PUBLIC)e&k&&this.reportParseError("Multiple modifiers may not be applied to class members"),e|=a.Modifiers.Public;else if(this.tok.tokenId==a.TokenID.STATIC)e&a.Modifiers.Static&&this.reportParseError("Multiple modifiers may not be applied to class members"),e|=a.Modifiers.Static;else if(this.tok.tokenId==a.TokenID.CONSTRUCTOR)e!=d&&this.reportParseError("Constructors may not have modifiers"),this.parseClassConstructorDeclaration(h,c,e),j=!1,f=!0;else if(i||this.tok.tokenId==a.TokenID.ID||a.convertTokToIDName(this.tok)){var l=i?e&a.Modifiers.Getter?"get":"set":this.tok.getText(),m=new a.Identifier(l);m.minChar=this.scanner.startPos,m.limChar=this.scanner.pos,i?(e^=e&a.Modifiers.Getter?a.Modifiers.Getter:a.Modifiers.Setter,i=!1):this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.LParen)this.parseClassMemberFunctionDeclaration(m,h,c,e),j=!1;else{(e&a.Modifiers.Getter||e&a.Modifiers.Setter)&&this.reportParseError("Property accessors must be functions");var n=this.parseClassMemberVariableDeclaration(m,h,!1,c,e);n.init&&n.init.nodeType==a.NodeType.FuncDecl?this.tok.tokenId==a.TokenID.RCurly&&(j=!1):n.init&&n.init.nodeType==a.NodeType.ObjectLit&&this.tok.tokenId!=a.TokenID.SColon?(j=!1,n.init.flags|=a.ASTFlags.AutomaticSemicolon):this.tok.tokenId!=a.TokenID.SColon&&(this.reportParseError("Expected ';'"),j=!1)}f=!0}else this.tok.tokenId==a.TokenID.SUPER?this.reportParseError("Base class initializers must be the first statement in a class definition"):!i&&(e&a.Modifiers.Getter||e&a.Modifiers.Setter)&&this.tok.tokenId==a.TokenID.LParen||this.tok.tokenId==a.TokenID.Asg?(i=!0,j=!1):this.tok.tokenId!=a.TokenID.SColon&&(this.reportParseError("Unexpected '"+this.tok.getText()+"' in class definition"),f=!0);j&&(this.tok=this.scanner.scan()),f&&(e=d,h=this.scanner.startPos,f=!1)}var o=this.scanner.pos;this.tok.tokenId==a.TokenID.RCurly&&(this.currentClassDefinition.definitionMembers.members.length||(this.currentClassDefinition.preComments=this.parseComments()),this.tok=this.scanner.scan()),this.nestingLevel--,this.currentClassDefinition.members.minChar=g,this.currentClassDefinition.members.limChar=o,this.currentClassDefinition.limChar=o,this.currentClassDefinition=null},e.prototype.parseClassConstructorDeclaration=function(b,c,d){this.parsingClassConstructorDefinition=!0;var e=this.parsingDeclareFile||a.hasFlag(d,a.Modifiers.Ambient),f=new a.ASTList,g=!1,h=this.parseComments();this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.LParen){g=this.parseFormalParameterList(c,f,!0,e,!1,!1,!1,null);if(f.members.length>0)var i=f.members[f.members.length-1]}var j=e||this.tok.tokenId==a.TokenID.SColon;if(j)for(var k=0;k<f.members.length;k++){var l=f.members[k];a.hasFlag(l.varFlags,a.VarFlags.Property)&&this.reportParseError("Overload or ambient signatures may not specify parameter properties")}j||(this.currentClassDefinition.constructorNestingLevel=this.nestingLevel+1);var m=this.parseFunctionStatements(c|a.ErrorRecoverySet.RCurly,this.currentClassDefinition.name,!0,!1,f,a.AllowedElements.ClassMembers,b,j,d);m.preComments=h,j&&!e&&(m.isOverload=!0),m.variableArgList=g,this.currentClassDecl=null,m.returnTypeAnnotation=this.convertToTypeReference(this.currentClassDefinition.name),m.classDecl=this.currentClassDefinition,e&&(m.fncFlags|=a.FncFlags.Ambient),j&&(m.fncFlags|=a.FncFlags.Signature);if(this.ambientModule||a.hasFlag(d,a.Modifiers.Exported))m.fncFlags|=a.FncFlags.Exported;this.currentClassDefinition.constructorDecl&&!e&&!this.currentClassDefinition.constructorDecl.isSignature()&&!m.isSignature()&&this.reportParseError("Duplicate constructor definition");if(e||!m.isSignature())this.currentClassDefinition.constructorDecl=m;return m.fncFlags|=a.FncFlags.ClassMethod,this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=m,this.parsingClassConstructorDefinition=!1,m.postComments=this.parseComments(),m},e.prototype.parseClassMemberVariableDeclaration=function(c,d,e,f,g){var h=new a.VarDecl(c,this.nestingLevel);h.minChar=d;var i=!1;h.preComments=this.parseComments(),this.tok.tokenId==a.TokenID.Colon&&(this.tok=this.scanner.scan(),h.typeExpr=this.parseTypeReference(f|a.ErrorRecoverySet.Asg|a.ErrorRecoverySet.Comma,!1));if(this.tok.tokenId==a.TokenID.Asg){if(this.parsingDeclareFile||a.hasFlag(g,a.Modifiers.Ambient)){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery)return this.skip(f),h.flags|=a.ASTFlags.Error,h.limChar=this.scanner.lastTokenLimChar(),h}this.tok=this.scanner.scan(),h.init=this.parseExpr(a.ErrorRecoverySet.Comma|f,a.OperatorPrecedence.Cma,!0,b.NoTypes),h.limChar=h.init.limChar,this.currentClassDefinition.varFlags|=a.VarFlags.ClassSuperMustBeFirstCallInConstructor}else h.limChar=this.scanner.pos;return g&a.Modifiers.Static&&(h.varFlags|=a.VarFlags.Static,i=!0),(g&a.Modifiers.Private)!=a.Modifiers.None?h.varFlags|=a.VarFlags.Private:h.varFlags|=a.VarFlags.Public,h.varFlags|=a.VarFlags.Property,e&&(h.varFlags|=a.VarFlags.ClassConstructorProperty),!e&&!i&&(h.varFlags|=a.VarFlags.ClassBodyProperty),this.currentClassDefinition.knownMemberNames[c.text]=!0,e||(this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=h),this.currentClassDefinition.allMemberDefinitions.members[this.currentClassDefinition.allMemberDefinitions.members.length]=h,h.postComments=this.parseComments(),h},e.prototype.parseClassMemberFunctionDeclaration=function(b,c,d,e){var f=this.prevIDTok!=null,g=a.hasFlag(e,a.Modifiers.Getter)||a.hasFlag(e,a.Modifiers.Setter),h=a.hasFlag(e,a.Modifiers.Static),i=this.ambientModule||a.hasFlag(e,a.Modifiers.Ambient);d|=a.ErrorRecoverySet.RParen;var j=this.parseComments();g&&e&a.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient classes");var k=this.parseFncDecl(d,!0,i,!0,b,!1,h,i,e,null);if(k.nodeType==a.NodeType.Error)return k;var l=k;return l.preComments=j,l.minChar=c,l.bod!==null&&(l.limChar=l.bod.limChar),e&a.Modifiers.Private?l.fncFlags|=a.FncFlags.Private:l.fncFlags|=a.FncFlags.Public,h&&(l.fncFlags|=a.FncFlags.Static),g&&(a.hasFlag(e,a.Modifiers.Getter)?(l.fncFlags|=a.FncFlags.GetAccessor,l.hint="get"+l.name.text):(l.fncFlags|=a.FncFlags.SetAccessor,l.hint="set"+l.name.text),l.fncFlags|=a.FncFlags.IsFunctionExpression,a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater")),l.fncFlags|=a.FncFlags.ClassMethod,this.currentClassDefinition.knownMemberNames[b.text]=!0,this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=l,l.postComments=this.parseComments(),l},e.prototype.parseInterfaceMember=function(b){var c=this.scanner.startPos,d=this.parsePropertyDecl(b,a.Modifiers.Public,!0,!1);return d.nodeType==a.NodeType.VarDecl&&this.chkCurTok(a.TokenID.SColon,"Expected ';'",b),d&&(d.minChar=c),d},e.prototype.parseInterfaceMembers=function(b,c){for(;;){switch(this.tok.tokenId){case a.TokenID.RCurly:case a.TokenID.EOF:c.limChar=this.scanner.pos;return}var d=this.parseInterfaceMember(b|a.ErrorRecoverySet.TypeScriptS);d&&c.append(d)}},e.prototype.parseInterfaceDecl=function(b,c){var d=this.scanner.leftCurlyCount,e=this.scanner.rightCurlyCount;this.tok=this.scanner.scan();var f=this.scanner.pos,g=null;this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)?(g=new a.Identifier(this.tok.getText()),g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("interface missing name"),this.errorRecovery&&(g=new a.MissingIdentifier,g.minChar=this.scanner.pos,g.limChar=this.scanner.pos,g.flags|=a.ASTFlags.Error));var h=null;this.tok.tokenId==a.TokenID.EXTENDS&&(h=new a.ASTList,h.minChar=this.scanner.startPos,this.parseBaseList(h,null,b,!0,!1));var i=this.scanner.startPos;this.chkCurTok(a.TokenID.LCurly,"Expected '{'",b|a.ErrorRecoverySet.TypeScriptS);var j=new a.ASTList;j.minChar=i;var k=this.inInterfaceDecl;this.inInterfaceDecl=!0,this.parseInterfaceMembers(b|a.ErrorRecoverySet.RCurly,j),this.inInterfaceDecl=k,this.chkCurTok(a.TokenID.RCurly,"Expected '}'",b);var l=new a.TypeDecl(a.NodeType.Interface,g,j,null,h,null);a.hasFlag(c,a.Modifiers.Private)&&(l.varFlags|=a.VarFlags.Private),a.hasFlag(c,a.Modifiers.Public)&&(l.varFlags|=a.VarFlags.Public);if(this.parsingDeclareFile||a.hasFlag(c,a.Modifiers.Exported))l.varFlags|=a.VarFlags.Exported;return l.leftCurlyCount=this.scanner.leftCurlyCount-d,l.rightCurlyCount=this.scanner.rightCurlyCount-e,l},e.prototype.makeVarDecl=function(b,c){var d=new a.VarDecl(b,c),e=this.topVarList();return e&&e.append(d),d},e.prototype.parsePropertyDecl=function(c,d,e,f){var g=null,h=this.scanner.startPos,i=h,j=!1,k=!1,l=this.prevIDTok!=null,m=a.hasFlag(d,a.Modifiers.Getter)||a.hasFlag(d,a.Modifiers.Setter);if(this.parsingDeclareFile||this.ambientModule||a.hasFlag(d,a.Modifiers.Ambient))e=!0;if(this.tok.tokenId==a.TokenID.LParen&&!l)!e&&!f&&(this.reportParseError("Expected identifier in property declaration"),this.errorRecovery&&(this.skip(c),g=new a.MissingIdentifier));else if(this.tok.tokenId==a.TokenID.NEW)e&&(this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.LParen&&(j=!0)),j||(e||(this.tok=this.scanner.scan()),g=new a.Identifier("new"),g.minChar=this.scanner.pos-3,g.limChar=this.scanner.pos,i=this.scanner.pos);else if(this.tok.tokenId==a.TokenID.LBrack&&e)k=!0,g=new a.Identifier("__item");else if(this.tok.tokenId!=a.TokenID.ID&&!a.convertTokToIDName(this.tok)&&!l){this.reportParseError("Expected identifier in property declaration");if(this.errorRecovery){var n=this.scanner.startPos,o=this.scanner.pos;this.skip(c&~a.ErrorRecoverySet.Comma),this.scanner.pos==o&&(this.tok=this.scanner.scan());var p=new a.VarDecl(new a.MissingIdentifier,this.nestingLevel);return p.flags|=a.ASTFlags.Error,p.minChar=n,p.limChar=this.scanner.lastTokenLimChar(),p}}else l?(g=new a.Identifier(this.prevIDTok.getText()),g.minChar=this.scanner.lastTokenLimChar()-3,g.limChar=this.scanner.lastTokenLimChar(),i=g.limChar,a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),this.tok.getText()==g.text&&this.tok!=this.prevIDTok&&(this.tok=this.scanner.scan()),this.prevIDTok=null):(g=new a.Identifier(this.tok.getText()),g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,i=this.scanner.pos,this.tok=this.scanner.scan());this.tok.tokenId==a.TokenID.QMark&&(this.inInterfaceDecl&&g?g.flags|=a.ASTFlags.OptionalName:this.reportParseError("Optional properties may only be declared on interface or object types"),this.tok=this.scanner.scan());if(this.tok.tokenId==a.TokenID.LParen||k&&this.tok.tokenId==a.TokenID.LBrack){var q=c|a.ErrorRecoverySet.RParen;k&&(q=c|a.ErrorRecoverySet.RBrack);var r=this.parseFncDecl(q,!0,e,!this.inFncDecl,g,k,f,this.parsingDeclareFile||a.hasFlag(d,a.Modifiers.Ambient),d,null),s;if(r.nodeType==a.NodeType.Error)return r;s=r,s.name&&(s.name.minChar=h,s.name.limChar=i),(d&a.Modifiers.Public)!=a.Modifiers.None&&(s.fncFlags|=a.FncFlags.Public),(d&a.Modifiers.Private)!=a.Modifiers.None&&(s.fncFlags|=a.FncFlags.Private),f&&(s.fncFlags|=a.FncFlags.Static);if(this.parsingDeclareFile||a.hasFlag(d,a.Modifiers.Ambient))s.fncFlags|=a.FncFlags.Ambient;return m&&(a.hasFlag(d,a.Modifiers.Getter)?(s.fncFlags|=a.FncFlags.GetAccessor,s.hint="get"+s.name.text):(s.fncFlags|=a.FncFlags.SetAccessor,s.hint="set"+s.name.text),s.fncFlags|=a.FncFlags.IsFunctionExpression,d&a.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient types")),g==null&&(j?(s.fncFlags|=a.FncFlags.ConstructMember,s.hint="_construct",s.classDecl=this.currentClassDecl):(s.hint="_call",s.fncFlags|=a.FncFlags.CallMember)),s}var t=new a.VarDecl(g,this.nestingLevel);t.minChar=h,this.tok.tokenId==a.TokenID.Colon&&(this.tok=this.scanner.scan(),t.typeExpr=this.parseTypeReference(c|a.ErrorRecoverySet.Asg|a.ErrorRecoverySet.Comma,!1));if(this.tok.tokenId==a.TokenID.Asg){if(e){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery)return this.skip(c),t.flags|=a.ASTFlags.Error,t.limChar=this.scanner.lastTokenLimChar(),t}this.tok=this.scanner.scan(),t.init=this.parseExpr(a.ErrorRecoverySet.Comma|c,a.OperatorPrecedence.Cma,!0,b.NoTypes),t.limChar=t.init.limChar;if(t.init.nodeType==a.NodeType.FuncDecl){var s=t.init;s.hint=t.id.text,s.boundToProperty=t}else m&&this.reportParseError("Accessors may only be functions")}else t.limChar=this.scanner.pos;return(d&a.Modifiers.Readonly)!=a.Modifiers.None&&(t.varFlags|=a.VarFlags.Readonly),f&&(t.varFlags|=a.VarFlags.Static),(d&a.Modifiers.Public)!=a.Modifiers.None&&(t.varFlags|=a.VarFlags.Public),(d&a.Modifiers.Private)!=a.Modifiers.None&&(t.varFlags|=a.VarFlags.Private),t.varFlags|=a.VarFlags.Property,t},e.prototype.parseVarDecl=function(c,d,e,f,g){var h=a.hasFlag(d,a.Modifiers.Readonly),i=this.scanner.startPos;this.tok=this.scanner.scan();var j=null,k=null,l=!1,m=this.parseComments();for(;;){if(this.tok.tokenId!=a.TokenID.ID&&!a.convertTokToID(this.tok,this.strictMode)){this.reportParseError("Expected identifier in variable declaration");if(this.errorRecovery)return j=new a.VarDecl(new a.MissingIdentifier,this.nestingLevel),j.minChar=i,this.skip(c),j.flags|=a.ASTFlags.Error,j.limChar=this.scanner.lastTokenLimChar(),j}var n=this.tok.getText();this.strictMode&&n=="eval"&&this.reportParseError("can not name a variable eval in strict mode"),j=this.makeVarDecl(new a.Identifier(n),this.nestingLevel),j.id.minChar=this.scanner.startPos,j.id.limChar=this.scanner.pos,j.preComments=m,g&&(j.varFlags|=a.VarFlags.Static),a.hasFlag(d,a.Modifiers.Readonly)&&(j.varFlags|=a.VarFlags.Readonly);if(this.parsingDeclareFile||a.hasFlag(d,a.Modifiers.Ambient))j.varFlags|=a.VarFlags.Ambient;if(this.parsingDeclareFile||a.hasFlag(d,a.Modifiers.Exported))j.varFlags|=a.VarFlags.Exported;j.minChar=i,k&&k.append(j),this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.Colon){this.tok=this.scanner.scan();var o=this.inFncDecl;this.inFncDecl=!1,j.typeExpr=this.parseTypeReference(c|a.ErrorRecoverySet.Asg|a.ErrorRecoverySet.Comma,!1),this.inFncDecl=o}if(this.tok.tokenId==a.TokenID.Asg){if(f){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery)return this.skip(c),j.flags|=a.ASTFlags.Error,j}this.tok=this.scanner.scan(),j.init=this.parseExpr(a.ErrorRecoverySet.Comma|c,a.OperatorPrecedence.Cma,e,b.NoTypes),j.limChar=j.init.limChar;if(j.init.nodeType==a.NodeType.FuncDecl){var p=j.init;p.hint=j.id.text}}else h&&this.reportParseError("const declaration requires initializer"),j.limChar=this.scanner.pos;j.postComments=this.parseCommentsForLine(this.scanner.line);if(this.tok.tokenId!=a.TokenID.Comma)return k?(k.limChar=j.limChar,k):j;l||(k=new a.ASTList,k.minChar=j.minChar,k.append(j),l=!0),this.tok=this.scanner.scan(),i=this.scanner.startPos}},e.prototype.parseMemberList=function(c){var d=new a.ASTList;if(this.tok.tokenId==a.TokenID.RCurly)return d;var e=null,f=null,g=null,h=null,i=this.scanner.startPos,j=!1,k=!1,l=null,m=0,n=0;for(;;){var o=!1;if(this.tok.tokenId==a.TokenID.GET||this.tok.tokenId==a.TokenID.SET)j=this.tok.tokenId==a.TokenID.SET,l=this.tok,m=this.scanner.startPos,n=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.ID||a.convertTokToIDName(this.tok)?(e=j?"set":"get",e+=this.tok.getText(),f=new a.Identifier(this.tok.getText()),f.minChar=this.scanner.startPos,o=!0,a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater")):this.tok.tokenId!=a.TokenID.Colon?this.reportParseError("Expected identifier, string or number as accessor name"):(k=!0,f=new a.Identifier(l.getText()),f.minChar=m,f.limChar=n);else if(this.tok.tokenId==a.TokenID.ID||a.convertTokToIDName(this.tok))e=this.tok.getText(),f=new a.Identifier(e),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos;else if(this.tok.tokenId==a.TokenID.QString)e=this.tok.getText(),f=new a.StringLiteral(e),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos;else if(this.tok.tokenId==a.TokenID.NumberLit){var p=this.tok;e=p.value.toString(),f=new a.StringLiteral(e),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos}else this.reportParseError("Expected identifier, string or number as member name"),this.errorRecovery&&(f=new a.MissingIdentifier,f.minChar=this.scanner.startPos,f.flags|=a.ASTFlags.Error,this.skip(c|a.ErrorRecoverySet.Comma),f.limChar=this.scanner.lastTokenLimChar());k?k=!1:this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.QMark&&(f.flags|=a.ASTFlags.OptionalName,this.tok=this.scanner.scan());if(o){var q=new a.ASTList;this.parseFormalParameterList(c|a.ErrorRecoverySet.RParen,q,!1,!0,!1,!j,j,null);var r=this.parseFunctionStatements(c|a.ErrorRecoverySet.RCurly,f,!1,!0,q,a.AllowedElements.FunctionDecls,this.scanner.startPos,!1,a.Modifiers.None);j&&r.returnTypeAnnotation&&this.reportParseError("Property setters may not declare a return type"),r.fncFlags|=j?a.FncFlags.SetAccessor:a.FncFlags.GetAccessor,r.fncFlags|=a.FncFlags.IsFunctionExpression,r.hint=e,g=r,h=new a.BinaryExpression(a.NodeType.Member,f,g),h.minChar=f.minChar;if(g.nodeType==a.NodeType.FuncDecl){var r=g;r.hint=e}}else if(this.tok.tokenId==a.TokenID.Colon){this.tok=this.scanner.scan(),g=this.parseExpr(a.ErrorRecoverySet.Comma|c,a.OperatorPrecedence.Cma,!0,b.NoTypes),g.nodeType==a.NodeType.TypeRef&&this.reportParseError("Expected 'new' on array declaration in member definition"),h=new a.BinaryExpression(a.NodeType.Member,f,g),h.minChar=f.minChar;if(g.nodeType==a.NodeType.FuncDecl){var r=g;r.hint=e}}else{this.reportParseError("Expected ':' in member definition");if(this.errorRecovery)return this.skip(c),d.flags|=a.ASTFlags.Error,d.minChar=i,d.limChar=this.scanner.lastTokenLimChar(),d}e=null,d.append(h),h.limChar=this.scanner.lastTokenLimChar();if(this.tok.tokenId!=a.TokenID.Comma)break;this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.RCurly)break}return h&&(d.limChar=h.limChar),d.minChar=i,d},e.prototype.parseArrayList=function(c){var d=null;if(this.tok.tokenId==a.TokenID.RBrack)return d;d=new a.ASTList,d.minChar=this.scanner.startPos;var e;for(;;){this.tok.tokenId==a.TokenID.Comma||this.tok.tokenId==a.TokenID.RBrack?e=new a.AST(a.NodeType.EmptyExpr):e=this.parseExpr(a.ErrorRecoverySet.Comma|c,a.OperatorPrecedence.Cma,!0,b.NoTypes),d.append(e);if(this.tok.tokenId!=a.TokenID.Comma)break;this.tok=this.scanner.scan()}return d.limChar=this.scanner.lastTokenLimChar(),d},e.prototype.parseArrayLiteral=function(b){var c=null;return c=new a.UnaryExpression(a.NodeType.ArrayLit,this.parseArrayList(b)),c},e.prototype.parseTerm=function(c,d,e,f){var g=null,h=!1,i=!1,j=this.scanner.startPos,k=this.scanner.pos,l=!1;switch(this.tok.tokenId){case a.TokenID.NUMBER:case a.TokenID.BOOL:case a.TokenID.ANY:case a.TokenID.STRING:var m=new a.Identifier(a.tokenTable[this.tok.tokenId].text);a.hasFlag(e,b.Primitive)?(g=new a.TypeReference(m,0),h=!0):(g=m,h=!0),g.minChar=j,this.tok=this.scanner.scan(),k=this.scanner.lastTokenLimChar();break;case a.TokenID.THIS:g=new a.AST(a.NodeType.This),g.minChar=j,this.tok=this.scanner.scan(),k=this.scanner.lastTokenLimChar();break;case a.TokenID.SUPER:g=new a.AST(a.NodeType.Super),g.minChar=j,this.tok=this.scanner.scan(),k=this.scanner.lastTokenLimChar();break;case a.TokenID.TRUE:g=new a.AST(a.NodeType.True),this.tok=this.scanner.scan(),g.minChar=j;break;case a.TokenID.FALSE:g=new a.AST(a.NodeType.False),this.tok=this.scanner.scan(),g.minChar=j;break;case a.TokenID.NULL:g=new a.AST(a.NodeType.Null),this.tok=this.scanner.scan(),g.minChar=j;break;case a.TokenID.NEW:j=this.scanner.pos,this.tok=this.scanner.scan(),g=new a.CallExpression(a.NodeType.New,this.parseTerm(c,!1,b.AllSimpleTypes,f),null),g.minChar=j,k=this.scanner.lastTokenLimChar(),i=!0;break;case a.TokenID.FUNCTION:j=this.scanner.pos,g=this.parseFncDecl(c,!1,!1,!1,null,!1,!1,!1,a.Modifiers.None,null),g.fncFlags|=a.FncFlags.IsFunctionExpression,g.minChar=j,k=this.scanner.lastTokenLimChar(),g.limChar=k}if(g==null)if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)){var n=this.tok.getText();g=this.createRef(n,j),h=!0,g.minChar=j,this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.QMark?g.flags|=a.ASTFlags.PossibleOptionalParameter:this.tok.tokenId==a.TokenID.Arrow&&(l=!0),k=this.scanner.lastTokenLimChar()}f&&this.chkCurTok(a.TokenID.GT,"Expected '>'",c);if(g==null)switch(this.tok.tokenId){case a.TokenID.LParen:j=this.scanner.pos;var o=this.scanner.previousToken().tokenId;this.tok=this.scanner.scan();var p=o==a.TokenID.LParen||o==a.TokenID.Comma||o==a.TokenID.EQ||o==a.TokenID.Colon;p&&this.tok.tokenId==a.TokenID.RParen?(l=!0,this.tok=this.scanner.scan()):(g=this.parseExpr(c|a.ErrorRecoverySet.RParen,a.OperatorPrecedence.No,!0,b.NoTypes),k=this.scanner.lastTokenLimChar(),l=p&&(g.nodeType==a.NodeType.Name||g.nodeType==a.NodeType.Comma)&&(this.tok.tokenId==a.TokenID.Colon||this.tok.tokenId==a.TokenID.QMark)),g&&!l&&(this.chkCurTok(a.TokenID.RParen,"Expected ')'",c),g.isParenthesized=!0);break;case a.TokenID.NumberLit:var q=this.tok;this.tok=this.scanner.scan(),g=new a.NumberLiteral(q.value),g.minChar=j,k=this.scanner.lastTokenLimChar();break;case a.TokenID.QString:g=new a.StringLiteral(this.tok.getText()),this.tok=this.scanner.scan(),g.minChar=j,k=this.scanner.lastTokenLimChar();break;case a.TokenID.Regex:var r=this.tok;g=new a.RegexLiteral(r.regex),this.tok=this.scanner.scan(),g.minChar=j,k=this.scanner.lastTokenLimChar();break;case a.TokenID.LBrack:j=this.scanner.startPos,this.tok=this.scanner.scan(),g=this.parseArrayLiteral(a.ErrorRecoverySet.RBrack|c),g.minChar=j,k=this.scanner.pos,this.chkCurTok(a.TokenID.RBrack,"Expected ']'",c);break;case a.TokenID.LCurly:j=this.scanner.startPos,this.tok=this.scanner.scan();var s=this.parseMemberList(a.ErrorRecoverySet.RCurly|c);this.chkCurTok(a.TokenID.RCurly,"Expected '}'",c),g=new a.UnaryExpression(a.NodeType.ObjectLit,s),g.minChar=j,k=this.scanner.lastTokenLimChar(),s.minChar=j,s.limChar=k;break;case a.TokenID.LT:j=this.scanner.startPos,this.tok=this.scanner.scan();var t=this.parseTypeReference(a.ErrorRecoverySet.BinOp,!1);this.chkCurTok(a.TokenID.GT,"Expected '>'",c),g=new a.UnaryExpression(a.NodeType.TypeAssertion,this.parseExpr(c,a.OperatorPrecedence.Uni,!1,b.NoTypes)),g.castTerm=t;break;default:if(this.prevExpr&&a.hasFlag(this.prevExpr.flags,a.ASTFlags.PossibleOptionalParameter))l=!0,g=this.prevExpr;else{this.reportParseError("Check format of expression term");if(this.errorRecovery){var u=new a.MissingIdentifier;u.minChar=j,u.flags|=a.ASTFlags.Error,this.skip(c|a.ErrorRecoverySet.Postfix),this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)?(u.text=this.tok.getText(),this.tok=this.scanner.scan(),k=this.scanner.lastTokenLimChar()):k=this.scanner.lastTokenLimChar(),g=u}}}l&&(this.tok.tokenId==a.TokenID.Arrow||this.tok.tokenId==a.TokenID.Colon||this.tok.tokenId==a.TokenID.Comma||this.tok.tokenId==a.TokenID.RParen?(g=this.parseFncDecl(c,!1,!1,!1,null,!1,!1,!1,a.Modifiers.None,{preProcessedLambdaArgs:g}),g.fncFlags|=a.FncFlags.IsFunctionExpression,g.fncFlags|=a.FncFlags.IsFatArrowFunction,g.minChar=j,k=this.scanner.lastTokenLimChar(),g.limChar=k):g&&(g.isParenthesized=!0)),h&&e!=b.NoTypes&&(e|=b.ArraySuffix);var v=this.parsePostfixOperators(c,g,d,i,e,j,k);if(v){if(h&&v.nodeType==a.NodeType.Index){var w=v;w.operand2==null&&(v=this.convertToTypeReference(v))}return v.minChar=j,v.limChar=a.max(v.limChar,this.scanner.lastTokenLimChar()),v}return new a.AST(a.NodeType.Error)},e.prototype.parseExpr=function(c,d,e,f){var g=null,h=a.lookupToken(this.tok.tokenId),i=!0,j=null,k=this.scanner.startPos,l=this.parseComments(),m=!1;if(h!=undefined&&h.unopNodeType!=a.NodeType.None){i=!1,this.tok=this.scanner.scan();var n=this.parseExpr(a.ErrorRecoverySet.BinOp|c,h.unopPrecedence,e,b.NoTypes);if(h.unopNodeType==a.NodeType.Pos&&n.nodeType==a.NodeType.NumberLit)g=n;else if(h.unopNodeType==a.NodeType.Neg&&n.nodeType==a.NodeType.NumberLit){var o=n;o.value=-o.value,o.value==0&&(o.isNegativeZero=!0),g=n}else g=new a.UnaryExpression(h.unopNodeType,n),g.limChar=n.limChar;g.minChar=k}else{g=this.parseTerm(a.ErrorRecoverySet.BinOp|a.ErrorRecoverySet.AddOp|c,!0,f,!1);var p,q;if(g.nodeType==a.NodeType.Name)p=g,j=p.text;else if(g.nodeType==a.NodeType.Dot){var r=!1;if(this.inferPropertiesFromThisAssignment&&(this.tok.tokenId==a.TokenID.Colon||this.tok.tokenId==a.TokenID.Asg)&&this.parsingClassConstructorDefinition&&this.nestingLevel==this.currentClassDefinition.constructorNestingLevel&&g.operand1.nodeType==a.NodeType.This&&g.operand2.nodeType==a.NodeType.Name){var s=g.operand2;this.currentClassDefinition.knownMemberNames[s.text]||(g=this.parseClassMemberVariableDeclaration(s,g.minChar,!0,c,a.Modifiers.Public),r=!0)}if(!r){q=g;while(q.nodeType==a.NodeType.Dot){var t=q;q=t.operand2}q.nodeType==a.NodeType.Name&&(p=q,j=p.text)}}if(!this.scanner.lastTokenHadNewline()&&(this.tok.tokenId==a.TokenID.Inc||this.tok.tokenId==a.TokenID.Dec)){i=!1;var u=g;g=new a.UnaryExpression(this.tok.tokenId==a.TokenID.Inc?a.NodeType.IncPost:a.NodeType.DecPost,u),g.limChar=this.scanner.pos,g.minChar=u.minChar,this.tok=this.scanner.scan()}}for(;;){h=a.lookupToken(this.tok.tokenId);if(h==undefined||h.binopNodeType==a.NodeType.None)break;if(!e&&h.binopNodeType==a.NodeType.In)break;if(h.binopPrecedence==a.OperatorPrecedence.Asg){if(h.binopPrecedence<d)break;i||this.reportParseError("illegal assignment")}else if(h.binopPrecedence<=d)break;this.tok=this.scanner.scan(),i=!1;if(h.binopNodeType==a.NodeType.QMark){this.prevExpr=g;var v=this.parseExpr(c|a.ErrorRecoverySet.Colon,a.OperatorPrecedence.Asg,e,b.NoTypes);this.prevExpr=null,v.nodeType!=a.NodeType.FuncDecl||!a.hasFlag(v.fncFlags,a.FncFlags.IsFatArrowFunction)?(this.chkCurTok(a.TokenID.Colon,"Expected :",c|a.ErrorRecoverySet.ExprStart),g=new a.TrinaryExpression(a.NodeType.QMark,g,v,this.parseExpr(c|a.ErrorRecoverySet.BinOp,a.OperatorPrecedence.Asg,e,b.NoTypes))):(g=v,m=!0)}else{var w=b.NoTypes,x;x=new a.BinaryExpression(h.binopNodeType,g,this.parseExpr(c|a.ErrorRecoverySet.BinOp,h.binopPrecedence,e,b.NoTypes));if(x.operand2.nodeType==a.NodeType.FuncDecl){var y=x.operand2;y.hint=j}x.minChar=g.minChar,x.limChar=this.scanner.lastTokenLimChar(),j=null,g=x}}return i&&(g.flags|=a.ASTFlags.Writeable),m||(g.minChar=k,g.limChar=a.max(g.limChar,this.scanner.lastTokenLimChar()),g.preComments=l,g.postComments=this.parseCommentsForLine(this.scanner.line)),g},e.prototype.parsePostfixOperators=function(c,d,e,f,g,h,i){var j=0;d||(d=new a.AST(a.NodeType.EmptyExpr),d.isParenthesized=!0),d.minChar=h,d.limChar=i;for(;;)switch(this.tok.tokenId){case a.TokenID.LParen:if(f){var k=d;k.args=this.parseArgList(c),f=!1}else{if(!e)return d;d=new a.CallExpression(a.NodeType.Call,d,this.parseArgList(c)),d.minChar=h}d.limChar=this.scanner.pos,this.chkCurTok(a.TokenID.RParen,"Expected ')'",c);break;case a.TokenID.LBrack:this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.RBrack&&a.hasFlag(g,b.ArraySuffix)){this.tok=this.scanner.scan();if(d.nodeType==a.NodeType.TypeRef){var l=d;l.arrayCount++}else d=new a.BinaryExpression(a.NodeType.Index,d,null);d.limChar=this.scanner.pos;break}d=new a.BinaryExpression(a.NodeType.Index,d,this.parseExpr(c|a.ErrorRecoverySet.RBrack,a.OperatorPrecedence.No,!0,b.NoTypes)),d.minChar=h,d.limChar=this.scanner.pos,this.chkCurTok(a.TokenID.RBrack,"Expected ']'",c);break;case a.TokenID.Dot:var m=null,n=this.scanner.pos;this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.ID||!this.scanner.lastTokenHadNewline()&&a.convertTokToIDName(this.tok))d.flags|=a.ASTFlags.DotLHS,m=this.createRef(this.tok.getText(),this.scanner.startPos),m.limChar=this.scanner.pos,this.tok=this.scanner.scan();else{this.reportParseError("Expected identifier following dot");if(this.errorRecovery)return this.skip(c),d.flags|=a.ASTFlags.Error|a.ASTFlags.DotLHS,d;m=new a.MissingIdentifier}d=new a.BinaryExpression
(a.NodeType.Dot,d,m),d.minChar=h,d.limChar=this.scanner.lastTokenLimChar();break;case a.TokenID.Arrow:d=this.parseFncDecl(c,!1,!1,!1,null,!1,!1,!1,a.Modifiers.None,{preProcessedLambdaArgs:d}),d.fncFlags|=a.FncFlags.IsFunctionExpression,d.minChar=h,d.limChar=this.scanner.lastTokenLimChar();break;default:return d}},e.prototype.parseTry=function(b,c,d,e){var f=this.scanner.startPos,g=this.parseComments();this.tok=this.scanner.scan();if(this.tok.tokenId!=a.TokenID.LCurly){this.reportParseError("Expected '{'");if(this.errorRecovery){var h=b;return h.minChar=f,h.limChar=this.scanner.lastTokenLimChar(),h.flags|=a.ASTFlags.Error,h}}return b.body=this.parseStatement(c,d,e),b.minChar=f,b.limChar=b.body.limChar,b.preComments=g,b.postComments=this.parseComments(),b},e.prototype.parseCatch=function(b,c,d){var e=this.scanner.startPos,f=this.parseComments();this.tok=this.scanner.scan(),this.chkCurTok(a.TokenID.LParen,"Expected '('",b|a.ErrorRecoverySet.ExprStart);if(this.tok.tokenId!=a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode)){this.reportParseError("Expected identifier in catch header");if(this.errorRecovery){this.skip(b);var g=new a.Catch(new a.VarDecl(new a.MissingIdentifier,this.nestingLevel),new a.Statement(a.NodeType.Empty));return g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,g.flags|=a.ASTFlags.Error,g}}var h=new a.VarDecl(new a.Identifier(this.tok.getText()),this.nestingLevel);h.id.minChar=this.scanner.startPos,h.id.limChar=this.scanner.pos,h.minChar=h.id.minChar,h.limChar=h.id.limChar,this.tok=this.scanner.scan(),this.chkCurTok(a.TokenID.RParen,"Expected ')'",b|a.ErrorRecoverySet.StmtStart);if(this.tok.tokenId!=a.TokenID.LCurly){this.reportParseError("Expected '{' to start catch body");if(this.errorRecovery){this.skip(b);var g=new a.Catch(new a.VarDecl(new a.MissingIdentifier,this.nestingLevel),new a.Statement(a.NodeType.Empty));return g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,g.flags|=a.ASTFlags.Error,g}}var i=this.parseStatement(b,c,d),j=new a.Catch(h,i);return j.minChar=e,j.limChar=i.limChar,j.preComments=f,j.postComments=this.parseComments(),j},e.prototype.parseFinally=function(b,c,d){var e=this.scanner.startPos,f=this.parseComments();this.tok=this.scanner.scan();if(this.tok.tokenId!=a.TokenID.LCurly){this.reportParseError("Expected '{' to start body of finally statement");if(this.errorRecovery){this.skip(b);var g=new a.Finally(new a.Statement(a.NodeType.Empty));return g.flags|=a.ASTFlags.Error,g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,g}}var h=this.parseStatement(b,c,d),i=new a.Finally(h);return i.minChar=e,i.limChar=i.body.limChar,i.preComments=f,i.postComments=this.parseComments(),i},e.prototype.parseTryCatchFinally=function(b,c,d,e){var f=new a.Try(null),g=this.scanner.startPos;this.pushStmt(f,e),this.parseTry(f,b|a.ErrorRecoverySet.Catch,c,d),this.popStmt();var h=null,i=null;if(this.tok.tokenId==a.TokenID.CATCH){var j=this.parseCatch(b|a.ErrorRecoverySet.Catch,c,d);h=new a.TryCatch(f,j),h.minChar=f.minChar,h.limChar=j.limChar}if(this.tok.tokenId!=a.TokenID.FINALLY){if(h==null){this.reportParseError("try with neither catch nor finally");if(this.errorRecovery){var k=new a.TryFinally(f,new a.Finally(new a.AST(a.NodeType.Empty)));return k.flags|=a.ASTFlags.Error,k.minChar=this.scanner.startPos,k.limChar=this.scanner.pos,k}return new a.TryFinally(f,new a.Finally(new a.AST(a.NodeType.Empty)))}return h}h&&(f=h);var l=this.parseFinally(b,c,d);return i=new a.TryFinally(f,l),i.minChar=g,i.limChar=l.limChar,i},e.prototype.parseStatement=function(d,e,f){function q(){return a.hasFlag(k,a.Modifiers.Ambient)||a.hasFlag(f,a.Modifiers.Ambient)}function r(){a.hasFlag(k,a.Modifiers.Exported)&&this.reportError("Statement may not be exported")}var g=null,h=null,i=null,j,k=a.Modifiers.None,l=this.scanner.startPos,m=!1,n=!1,o=null,p=this.parseComments();this.state=c.StartStatement;for(;;){switch(this.tok.tokenId){case a.TokenID.EOF:g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.pos;break;case a.TokenID.FUNCTION:this.inStaticFnc&&this.reportParseError("Ambient static function delarations may only contain other ambient static function declarations"),this.parsingDeclareFile||q()||this.ambientModule?(this.tok=this.scanner.scan(),o=this.parsePropertyDecl(d|a.ErrorRecoverySet.SColon,k,!0,!1),o.nodeType==a.NodeType.VarDecl?this.reportParseError("function keyword can only introduce function declaration"):o.nodeType==a.NodeType.FuncDecl&&(o.fncFlags,a.FncFlags.IsFatArrowFunction)&&(n=!0),g=o):(g=this.parseFncDecl(d,!0,!1,!1,null,!1,!1,q(),k,null),a.hasFlag(g.fncFlags,a.FncFlags.IsFatArrowFunction)&&(n=!0),this.ambientModule&&this.reportParseError("function declaration not permitted within ambient module"),a.hasFlag(k,a.Modifiers.Exported)&&(g.fncFlags|=a.FncFlags.Exported));break;case a.TokenID.MODULE:(e&a.AllowedElements.ModuleDecls)==a.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar()):g=this.parseModuleDecl(d,k);break;case a.TokenID.IMPORT:(e&a.AllowedElements.ModuleDecls)==a.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar()):g=this.parseImportDecl(d,k);break;case a.TokenID.EXPORT:(e&a.AllowedElements.ModuleDecls)==a.AllowedElements.None&&(this.reportParseError("'export' statements are only allowed at the global and module levels"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar()),this.topLevel&&(this.hasTopLevelImportOrExport=!0),k|=a.Modifiers.Exported,this.tok=this.scanner.scan();break;case a.TokenID.PRIVATE:k|=a.Modifiers.Private,this.tok=this.scanner.scan();if(this.parsingClassConstructorDefinition){this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),l=this.scanner.pos;if(!this.inferPropertiesFromThisAssignment||this.tok.tokenId==a.TokenID.THIS&&(this.tok=this.scanner.scan()).tokenId==a.TokenID.Dot){this.tok=this.scanner.scan();var s=new a.Identifier(this.tok.getText());s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos,this.tok=this.scanner.scan(),g=this.parseClassMemberVariableDeclaration(s,l,this.parsingClassConstructorDefinition,d,k)}else this.reportParseError("Expected 'this.' for property declaration"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar()}else if(this.tok.tokenId!=a.TokenID.INTERFACE){if(this.tok.tokenId==a.TokenID.GET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))k|=a.Modifiers.Getter,this.prevIDTok=null}else if(this.tok.tokenId==a.TokenID.SET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))k|=a.Modifiers.Setter,this.prevIDTok=null}o=this.parsePropertyDecl(d|a.ErrorRecoverySet.SColon,k,q(),!1);if(o.nodeType==a.NodeType.VarDecl||o.nodeType==a.NodeType.FuncDecl&&a.hasFlag(o.fncFlags,a.FncFlags.IsFatArrowFunction))n=!0;g=o}break;case a.TokenID.PUBLIC:if(this.parsingClassConstructorDefinition){this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),this.tok=this.scanner.scan(),l=this.scanner.pos,k|=a.Modifiers.Public;if(!this.inferPropertiesFromThisAssignment||this.tok.tokenId==a.TokenID.THIS&&(this.tok=this.scanner.scan()).tokenId==a.TokenID.Dot){this.tok=this.scanner.scan();var s=new a.Identifier(this.tok.getText());s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos,this.tok=this.scanner.scan(),g=this.parseClassMemberVariableDeclaration(s,l,this.parsingClassConstructorDefinition,d,k)}else this.reportParseError("Expected 'this.' for property declaration"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar()}else if((e&a.AllowedElements.Properties)==a.AllowedElements.None)this.reportParseError("'property' statements are only allowed within classes"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar();else{k|=a.Modifiers.Public,this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.GET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))k|=a.Modifiers.Getter,this.prevIDTok=null}else if(this.tok.tokenId==a.TokenID.SET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))k|=a.Modifiers.Setter,this.prevIDTok=null}o=this.parsePropertyDecl(d|a.ErrorRecoverySet.SColon,k,q(),!1);if(o.nodeType==a.NodeType.VarDecl||o.nodeType==a.NodeType.FuncDecl&&a.hasFlag(o.fncFlags,a.FncFlags.IsFatArrowFunction))n=!0;g=o}break;case a.TokenID.DECLARE:e&a.AllowedElements.AmbientDecls||this.reportParseError("Ambient declarations are only allowed at the top-level or module scopes"),!this.parsingDeclareFile&&a.hasFlag(f,a.Modifiers.Ambient)&&this.reportParseError("Duplicate ambient declaration in this context. (Is the enclosing module or class already ambient?)"),k|=a.Modifiers.Ambient,this.tok=this.scanner.scan();break;case a.TokenID.CLASS:(e&a.AllowedElements.ClassDecls)==a.AllowedElements.None?(this.reportParseError("class not allowed in this context"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar()):g=this.parseClassDecl(d,l,k);break;case a.TokenID.INTERFACE:(e&a.AllowedElements.InterfaceDecls)==a.AllowedElements.None?(this.reportParseError("interface not allowed in this context"),this.tok=this.scanner.scan(),g=new a.AST(a.NodeType.Error),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar()):g=this.parseInterfaceDecl(d,k);break;case a.TokenID.VAR:var t=this.parseVarDecl(d|a.ErrorRecoverySet.StmtStart,k,!0,!1,!1);t.nodeType==a.NodeType.VarDecl?g=t:g=new a.Block(t,!1),n=!0;if(this.parsingDeclareFile||this.ambientModule&&g.nodeType==a.NodeType.VarDecl)g.varFlags|=a.VarFlags.Exported;break;case a.TokenID.STATIC:this.currentClassDecl==null&&this.reportParseError("Statics may only be class members"),r(),k|=a.Modifiers.Public,this.tok=this.scanner.scan();if(this.tok.tokenId==a.TokenID.GET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))k|=a.Modifiers.Getter,this.prevIDTok=null}else if(this.tok.tokenId==a.TokenID.SET){this.tok=this.scanner.scan(),a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==a.TokenID.ID||a.convertTokToID(this.tok,this.strictMode))k|=a.Modifiers.Setter}q()&&(k|=a.Modifiers.Ambient),o=this.parsePropertyDecl(d|a.ErrorRecoverySet.SColon,k,this.parsingDeclareFile||(k&a.Modifiers.Ambient)!=a.Modifiers.None,!0);var u=this.topStaticsList();u&&o.nodeType==a.NodeType.VarDecl&&u.append(o);if(o.nodeType==a.NodeType.VarDecl||o.nodeType==a.NodeType.FuncDecl&&a.hasFlag(o.fncFlags,a.FncFlags.IsFatArrowFunction))n=!0;g=o;break;case a.TokenID.FOR:r(),k!=a.Modifiers.None&&this.reportParseError("syntax error: for statement does not take modifiers"),l=this.scanner.startPos,this.chkNxtTok(a.TokenID.LParen,"Expected '('",d|a.ErrorRecoverySet.ExprStart|a.ErrorRecoverySet.Var),this.state=c.ForInit,m=!0;switch(this.tok.tokenId){case a.TokenID.VAR:j=this.parseVarDecl(d|a.ErrorRecoverySet.SColon|a.ErrorRecoverySet.In,a.Modifiers.None,!1,!1,!1);break;case a.TokenID.SColon:j=null,this.state=c.ForCondStart;break;default:j=this.parseExpr(d|a.ErrorRecoverySet.SColon|a.ErrorRecoverySet.In,a.OperatorPrecedence.No,!1,b.NoTypes)}this.state=c.ForInitAfterVar;if(this.tok.tokenId==a.TokenID.IN)if(j==null||!m)this.reportParseError("malformed for statement"),this.errorRecovery&&(this.skip(d|a.ErrorRecoverySet.StmtStart),g=new a.AST(a.NodeType.Empty),g.flags|=a.ASTFlags.Error);else{this.tok=this.scanner.scan();var v=new a.ForInStatement(j,this.parseExpr(a.ErrorRecoverySet.RParen|d,a.OperatorPrecedence.Cma,!1,b.NoTypes));v.limChar=this.scanner.pos,this.chkCurTok(a.TokenID.RParen,"Expected ')'",a.ErrorRecoverySet.StmtStart|d),this.pushStmt(v,h),v.body=this.parseStatement(d,e,f),this.popStmt(),v.minChar=l,g=v}else{var w=new a.ForStatement(j);w.minChar=l,this.chkCurTok(a.TokenID.SColon,"Expected ';'",d),this.tok.tokenId==a.TokenID.SColon?w.cond=null:(w.cond=this.parseExpr(d|a.ErrorRecoverySet.SColon|a.ErrorRecoverySet.RParen,a.OperatorPrecedence.No,!0,b.NoTypes),this.tok.tokenId!=a.TokenID.SColon&&(this.skip(d|a.ErrorRecoverySet.StmtStart),g=w,g.flags|=a.ASTFlags.Error)),this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.RParen?w.incr=null:w.incr=this.parseExpr(d|a.ErrorRecoverySet.SColon|a.ErrorRecoverySet.RParen,a.OperatorPrecedence.No,!0,b.NoTypes),this.chkCurTok(a.TokenID.RParen,"Expected ')'",d|a.ErrorRecoverySet.LCurly),this.pushStmt(w,h),w.body=this.parseStatement(d,e,f),this.popStmt(),w.limChar=w.body.limChar,g=w}break;case a.TokenID.WITH:a.codeGenTarget<a.CodeGenTarget.ES5&&this.reportParseError("'with' statements are only available in ES5 codegen mode or better"),this.strictMode&&this.reportParseError("'with' statements are not available in strict mode"),r(),k!=a.Modifiers.None&&this.reportParseError("'with' statement does not take modifiers"),l=this.scanner.startPos,this.chkNxtTok(a.TokenID.LParen,"Expected '('",d|a.ErrorRecoverySet.ExprStart|a.ErrorRecoverySet.Var);var x=this.parseExpr(d|a.ErrorRecoverySet.Colon,a.OperatorPrecedence.No,!0,b.NoTypes);this.chkCurTok(a.TokenID.RParen,"Expected ')'",d|a.ErrorRecoverySet.LCurly);var y=new a.WithStatement(x);y.body=this.parseStatement(d,e,f),y.minChar=l,y.limChar=y.body.limChar,g=y;break;case a.TokenID.SWITCH:r(),k!=a.Modifiers.None&&this.reportParseError("'switch' statement does not take modifiers"),this.chkNxtTok(a.TokenID.LParen,"Expected '('",d|a.ErrorRecoverySet.ExprStart);var z=new a.SwitchStatement(this.parseExpr(d|a.ErrorRecoverySet.RParen,a.OperatorPrecedence.No,!0,b.NoTypes));this.chkCurTok(a.TokenID.RParen,"Expected ')'",d|a.ErrorRecoverySet.LCurly);var A=this.scanner.startPos;this.chkCurTok(a.TokenID.LCurly,"Expected '{'",d|a.ErrorRecoverySet.SCase),z.defaultCase=null,z.caseList=new a.ASTList;var B=null;this.pushStmt(z,h);for(;;){if(this.tok.tokenId!=a.TokenID.CASE&&this.tok.tokenId!=a.TokenID.DEFAULT)break;var C=this.tok.tokenId==a.TokenID.DEFAULT;B=new a.CaseStatement,B.minChar=this.scanner.startPos,this.tok=this.scanner.scan(),C?z.defaultCase=B:B.expr=this.parseExpr(d|a.ErrorRecoverySet.Colon,a.OperatorPrecedence.No,!0,b.NoTypes),this.chkCurTok(a.TokenID.Colon,"Expected ':'",d|a.ErrorRecoverySet.StmtStart),B.body=new a.ASTList,this.parseStmtList(d|a.ErrorRecoverySet.RCurly,B.body,!1,!0,e,k),B.limChar=B.body.limChar,z.caseList.append(B)}z.caseList.minChar=A,z.caseList.limChar=this.scanner.pos,z.limChar=z.caseList.limChar,this.chkCurTok(a.TokenID.RCurly,"Expected '}'",d),this.popStmt(),g=z;break;case a.TokenID.WHILE:r(),k!=a.Modifiers.None&&this.reportParseError("'while' statement does not take modifiers"),l=this.scanner.startPos,this.chkNxtTok(a.TokenID.LParen,"Expected '('",a.ErrorRecoverySet.ExprStart|d);var D=new a.WhileStatement(this.parseExpr(d|a.ErrorRecoverySet.RParen,a.OperatorPrecedence.No,!0,b.NoTypes));D.minChar=l,this.chkCurTok(a.TokenID.RParen,"Expected ')'",d|a.ErrorRecoverySet.StmtStart),this.pushStmt(D,h),D.body=this.parseStatement(d,e,f),D.limChar=D.body.limChar,this.popStmt(),g=D;break;case a.TokenID.DO:r(),k!=a.Modifiers.None&&this.reportParseError("'do' statement does not take modifiers"),l=this.scanner.startPos,this.tok=this.scanner.scan();var E=new a.DoWhileStatement;E.minChar=l,this.pushStmt(E,h),E.body=this.parseStatement(d|a.ErrorRecoverySet.While,e,f),this.popStmt(),E.whileAST=new a.Identifier("while"),E.whileAST.minChar=this.scanner.startPos,this.chkCurTok(a.TokenID.WHILE,"Expected 'while'",d|a.ErrorRecoverySet.LParen),E.whileAST.limChar=E.whileAST.minChar+5,this.chkCurTok(a.TokenID.LParen,"Expected '('",d|a.ErrorRecoverySet.ExprStart),E.cond=this.parseExpr(d|a.ErrorRecoverySet.RParen,a.OperatorPrecedence.No,!0,b.NoTypes),E.limChar=this.scanner.pos,this.chkCurTok(a.TokenID.RParen,"Expected ')'",d),g=E,this.tok.tokenId==a.TokenID.SColon&&(this.tok=this.scanner.scan());break;case a.TokenID.IF:r(),k!=a.Modifiers.None&&this.reportParseError("if statement does not take modifiers"),l=this.scanner.startPos,this.chkNxtTok(a.TokenID.LParen,"Expected '('",d|a.ErrorRecoverySet.ExprStart);var F=new a.IfStatement(this.parseExpr(d|a.ErrorRecoverySet.LParen,a.OperatorPrecedence.No,!0,b.NoTypes));F.minChar=l,this.chkCurTok(a.TokenID.RParen,"Expected ')'",d|a.ErrorRecoverySet.StmtStart),this.pushStmt(F,h),F.thenBod=this.parseStatement(a.ErrorRecoverySet.Else|d,e,f),F.limChar=F.thenBod.limChar,this.tok.tokenId==a.TokenID.ELSE&&(this.tok=this.scanner.scan(),F.elseBod=this.parseStatement(d,e,f),F.limChar=F.elseBod.limChar),this.popStmt(),g=F;break;case a.TokenID.TRY:r(),k!=a.Modifiers.None&&this.reportParseError("try statement does not take modifiers"),l=this.scanner.startPos,g=this.parseTryCatchFinally(d,a.AllowedElements.FunctionBody,f,h);break;case a.TokenID.LCurly:r(),k!=a.Modifiers.None&&this.reportParseError("block does not take modifiers"),l=this.scanner.startPos,this.tok=this.scanner.scan();var G=new a.Block(new a.ASTList,!0);this.pushStmt(G,h),this.parseStmtList(d|a.ErrorRecoverySet.RCurly,G.stmts,!1,!1,a.AllowedElements.Block,k),this.popStmt(),G.stmts.minChar=l,G.stmts.limChar=this.scanner.pos,G.minChar=G.stmts.minChar,G.limChar=G.stmts.limChar,this.chkCurTok(a.TokenID.RCurly,"Expected '}'",d),g=G;break;case a.TokenID.SColon:r(),k!=a.Modifiers.None&&this.reportParseError("modifier can not appear here"),g=new a.AST(a.NodeType.Empty),this.tok=this.scanner.scan();break;case a.TokenID.BREAK:case a.TokenID.CONTINUE:r(),k!=a.Modifiers.None&&this.reportParseError("modifiers can not appear before jump statement");var H=new a.Jump(this.tok.tokenId==a.TokenID.BREAK?a.NodeType.Break:a.NodeType.Continue);this.tok=this.scanner.scan(),this.tok.tokenId==a.TokenID.ID&&!this.scanner.lastTokenHadNewline()&&(H.target=this.tok.getText(),this.tok=this.scanner.scan()),this.resolveJumpTarget(H),g=H,n=!0;break;case a.TokenID.RETURN:r(),k!=a.Modifiers.None&&this.reportParseError("modifiers can not appear before return statement"),this.inFnc||this.reportParseError("return statement outside of function body"),l=this.scanner.startPos,this.tok=this.scanner.scan();var I=new a.ReturnStatement;I.minChar=l,this.tok.tokenId!=a.TokenID.SColon&&this.tok.tokenId!=a.TokenID.RCurly&&!this.scanner.lastTokenHadNewline()&&(I.returnExpression=this.parseExpr(d|a.ErrorRecoverySet.SColon,a.OperatorPrecedence.No,!0,b.NoTypes)),n=!0,I.limChar=this.scanner.lastTokenLimChar(),g=I;break;case a.TokenID.THROW:r(),k!=a.Modifiers.None&&this.reportParseError("modifiers can not appear before a throw statement"),l=this.scanner.startPos,this.tok=this.scanner.scan(),this.tok.tokenId!=a.TokenID.SColon&&this.tok.tokenId!=a.TokenID.RCurly&&!this.scanner.lastTokenHadNewline()?j=this.parseExpr(d|a.ErrorRecoverySet.SColon,a.OperatorPrecedence.No,!0,b.NoTypes):(this.reportParseError("throw with no target"),j=null),g=new a.UnaryExpression(a.NodeType.Throw,j),g.limChar=this.scanner.lastTokenLimChar(),n=!0;break;case a.TokenID.ENUM:this.tok=this.scanner.scan(),g=this.parseEnumDecl(d,k),g.minChar=l,g.limChar=this.scanner.lastTokenLimChar();if(this.parsingDeclareFile||a.hasFlag(k,a.Modifiers.Ambient))g.modFlags|=a.ModuleFlags.Ambient;a.hasFlag(k,a.Modifiers.Exported)&&(g.modFlags|=a.ModuleFlags.Exported);break;case a.TokenID.DEBUGGER:r(),k!=a.Modifiers.None&&this.reportParseError("modifiers can not appear before debugger statement"),l=this.scanner.startPos,this.tok=this.scanner.scan();var J=new a.DebuggerStatement;J.minChar=l,n=!0,J.limChar=this.scanner.lastTokenLimChar(),g=J;break;default:k!=a.Modifiers.None&&this.reportParseError("modifiers can not appear before an expression statement or label"),l=this.scanner.startPos;var K=this.scanner.pos;j=this.parseExpr(a.ErrorRecoverySet.Colon|a.ErrorRecoverySet.StmtStart|d,a.OperatorPrecedence.No,!0,b.NoTypes),this.scanner.pos==K?(this.tok=this.scanner.scan(),g=j):this.tok.tokenId==a.TokenID.Colon&&!this.scanner.lastTokenHadNewline()&&j&&j.nodeType==a.NodeType.Name?(h==null&&(h=new a.ASTList),h.append(new a.Label(j)),this.tok=this.scanner.scan()):(g=j,n=!0)}if(g)break}if(n)switch(this.tok.tokenId){case a.TokenID.SColon:this.tok=this.scanner.scan(),g.flags|=a.ASTFlags.ExplicitSemicolon;break;case a.TokenID.EOF:case a.TokenID.RCurly:g.flags|=a.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon");break;default:this.scanner.lastTokenHadNewline()?(g.flags|=a.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon")):this.reportParseError("Expected ';'")}return h&&(g=new a.LabeledStatement(h,g)),g.minChar=l,g.limChar=a.max(g.limChar,this.scanner.lastTokenLimChar()),g.preComments=p,this.ambientModule&&!this.okAmbientModuleMember(g)&&this.reportParseError("statement not permitted within ambient module"),g.flags|=a.ASTFlags.IsStatement,g},e.prototype.okAmbientModuleMember=function(b){var c=b.nodeType;return c==a.NodeType.Class||c==a.NodeType.Import||c==a.NodeType.Interface||c==a.NodeType.Module||c==a.NodeType.Empty||c==a.NodeType.VarDecl&&(a.hasFlag(b.varFlags,a.VarFlags.Property)||a.hasFlag(b.varFlags,a.VarFlags.Exported))||c==a.NodeType.FuncDecl&&b.isMethod()},e.prototype.parseStmtList=function(b,d,e,f,g,h){var i=e;d.minChar=this.scanner.startPos;var j=this.scanner.pos,k=(g&a.AllowedElements.ModuleDecls)==a.AllowedElements.None,l=(g&a.AllowedElements.ClassDecls)==a.AllowedElements.None;b|=a.ErrorRecoverySet.TypeScriptS|a.ErrorRecoverySet.RCurly,this.state=c.StartStmtList;var m=this.strictMode;this.nestingLevel++;for(;;){if(this.tok.tokenId==a.TokenID.RCurly||f&&(this.tok.tokenId==a.TokenID.CASE||this.tok.tokenId==a.TokenID.DEFAULT)||k&&this.tok.tokenId==a.TokenID.EXPORT||l&&this.tok.tokenId==a.TokenID.CLASS||this.tok.tokenId==a.TokenID.EOF){this.state=c.EndStmtList,d.limChar=j,d.members.length==0?d.preComments=this.parseComments():d.postComments=this.parseComments(),this.strictMode=m,this.nestingLevel--;return}var n=this.parseStatement(b&~(a.ErrorRecoverySet.Else|a.ErrorRecoverySet.RParen|a.ErrorRecoverySet.Catch|a.ErrorRecoverySet.Colon),g,h);if(n){n.postComments=this.combineComments(n.postComments,this.parseCommentsForLine(this.scanner.prevLine)),d.append(n),j=n.limChar;if(i)if(n.nodeType==a.NodeType.QString){var o=n;o.text=="use strict"?(d.flags|=a.ASTFlags.StrictMode,this.strictMode=!0):i=!1}else i=!1}}},e.prototype.quickParse=function(b,c,e){var f=a.moduleGenTarget;try{a.moduleGenTarget=a.ModuleGenTarget.Local;var g=this.parse(b,c,e,a.AllowedElements.QuickParse);return new d(g,this.scanner.lexState)}finally{a.moduleGenTarget=f}},e.prototype.parse=function(b,d,e,f){typeof f=="undefined"&&(f=a.AllowedElements.Global),this.ambientModule=!1,this.topLevel=!0,this.parseError=!1,this.hasTopLevelImportOrExport=!1,this.fname=d,this.currentUnitIndex=e,this.amdDependencies=[],this.scanner.resetComments(),this.scanner.setSourceText(b,a.LexMode.File);var g=this.scanner.leftCurlyCount,h=this.scanner.rightCurlyCount,i=this.scanner.pos;this.tok=this.scanner.scan(),this.pushDeclLists();var j=new a.ASTList;j.minChar=i,this.state=c.StartScript,this.parsingDeclareFile=a.isDSTRFile(d)||a.isDTSFile(d),this.parseStmtList(a.ErrorRecoverySet.EOF|a.ErrorRecoverySet.Func,j,!0,!1,f,a.Modifiers.None);if(this.tok.tokenId!=a.TokenID.EOF){var k=a.tokenTable[this.tok.tokenId];this.reportParseError("Unexpected statement block terminator '"+k.text+"'")}this.state=c.EndScript,j.limChar=this.scanner.pos;var l=null;if(a.moduleGenTarget!=a.ModuleGenTarget.Local&&this.hasTopLevelImportOrExport){var m=a.switchToForwardSlashes(d),n=new a.Identifier(m);l=new a.ModuleDecl(n,j,this.topVarList(),this.topScopeList()),l.modFlags|=a.ModuleFlags.IsDynamic,l.modFlags|=a.ModuleFlags.IsWholeFile,l.modFlags|=a.ModuleFlags.Exported,this.parsingDeclareFile&&(l.modFlags|=a.ModuleFlags.Ambient),l.minChar=i,l.limChar=this.scanner.pos,l.prettyName=a.getPrettyName(m),l.amdDependencies=this.amdDependencies,j=new a.ASTList,j.minChar=l.minChar,j.limChar=l.limChar,j.append(l)}var o=new a.Script(this.topVarList(),this.topScopeList());return o.bod=j,this.popDeclLists(),o.minChar=i,o.limChar=this.scanner.pos,o.locationInfo=new a.LocationInfo(d,this.scanner.lineMap,e),o.leftCurlyCount=this.scanner.leftCurlyCount-g,o.rightCurlyCount=this.scanner.rightCurlyCount-h,o.isDeclareFile=this.parsingDeclareFile,o.topLevelMod=l,o},e}();a.Parser=e,a.quickParse=f})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function c(a,b,c){var d=c.state;return a.print(d),d.increaseIndent(),a}function d(a,b,c){var d=c.state;return d.decreaseIndent(),a}var b=function(){function b(a,b){this.outfile=a,this.parser=b,this.builder="",this.indent1="  ",this.indentStrings=[],this.indentAmt=0}return b.prototype.increaseIndent=function(){this.indentAmt++},b.prototype.decreaseIndent=function(){this.indentAmt--},b.prototype.startLine=function(){this.builder.length>0&&a.CompilerDiagnostics.Alert(this.builder);var b=this.indentStrings[this.indentAmt];if(b===undefined){b="";for(var c=0;c<this.indentAmt;c++)b+=this.indent1;this.indentStrings[this.indentAmt]=b}this.builder+=b},b.prototype.write=function(a){this.builder+=a},b.prototype.writeLine=function(a){this.builder+=a,this.outfile.WriteLine(this.builder),this.builder=""},b}();a.PrintContext=b,a.prePrintAST=c,a.postPrintAST=d})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function d(){a.initializeStaticTokens(),b[a.LexCodeLPR]=a.staticTokens[a.TokenID.LParen],b[a.LexCodeRPR]=a.staticTokens[a.TokenID.RParen],b[a.LexCodeCMA]=a.staticTokens[a.TokenID.Comma],b[a.LexCodeSMC]=a.staticTokens[a.TokenID.SColon],b[a.LexCodeLBR]=a.staticTokens[a.TokenID.LBrack],b[a.LexCodeRBR]=a.staticTokens[a.TokenID.RBrack],b[a.LexCodeTIL]=a.staticTokens[a.TokenID.Tilde],b[a.LexCodeQUE]=a.staticTokens[a.TokenID.QMark],b[a.LexCodeLC]=a.staticTokens[a.TokenID.LCurly],b[a.LexCodeRC]=a.staticTokens[a.TokenID.RCurly],b[a.LexCodeCOL]=a.staticTokens[a.TokenID.Colon],a.LexKeywordTable=new a.StringHashTable;for(var d in a.TokenID._map)d<=a.TokenID.LimKeyword&&a.LexKeywordTable.add(a.TokenID._map[d].toLowerCase(),d);for(var e=0;e<128;e++)f(e)?c[e]=!0:c[e]=!1}function e(b,c){return b==a.LexCodeLBR||b==a.LexCodeLC||b==a.LexCodeLPR?c+1:b==a.LexCodeRBR||b==a.LexCodeRC||b==a.LexCodeRPR?c-1:c}function f(b){return b>=97&&b<=122||b>=65&&b<=90||b==a.LexCodeDollar||b==a.LexCodeUnderscore}function g(a){return a>=48&&a<=57}function h(a){return c[a]||g(a)}function i(b){return b==a.LexCodeRBR?a.LexCodeLBR:b==a.LexCodeRC?a.LexCodeLC:b==a.LexCodeRPR?a.LexCodeLPR:0}function t(a){return v(a,!0,!1)}function u(a,b){return v(a,!1,b)}function v(b,c,d){if(!(b.tokenId<=a.TokenID.LimKeyword))return!1;var e=a.lookupToken(b.tokenId);if(e==undefined)return!1;var f=a.Reservation.Javascript|a.Reservation.JavascriptFuture;d&&(f|=a.Reservation.JavascriptFutureStrict);if(c||!a.hasFlag(e.reservation,f))return!0}function w(a,b){if(b===-1)return 0;var c=0,d=a.length-1;while(c<d){var e=c+d>>1;b<a[e]?d=e-1:b<a[e+1]?c=d=e:c=e+1}return c}function x(a,b,c){var d=w(c,b);d>0&&(a.line=d,a.col=b-c[d])}function y(a,b){var c={line:-1,col:-1};return x(c,b,a.locationInfo.lineMap),c.col>=0&&c.col++,c}function z(a,b,c){return a.locationInfo.lineMap[b]+(c-1)}a.LexEOF=-1,a.LexCodeNWL=10,a.LexCodeRET=13,a.LexCodeTAB=9,a.LexCodeVTAB=11,a.LexCode_e="e".charCodeAt(0),a.LexCode_E="E".charCodeAt(0),a.LexCode_x="x".charCodeAt(0),a.LexCode_X="X".charCodeAt(0),a.LexCode_a="a".charCodeAt(0),a.LexCode_A="A".charCodeAt(0),a.LexCode_f="f".charCodeAt(0),a.LexCode_F="F".charCodeAt(0),a.LexCode_g="g".charCodeAt(0),a.LexCode_m="m".charCodeAt(0),a.LexCode_i="i".charCodeAt(0),a.LexCode_0="0".charCodeAt(0),a.LexCode_9="9".charCodeAt(0),a.LexCode_8="8".charCodeAt(0),a.LexCode_7="7".charCodeAt(0),a.LexCodeBSL="\\".charCodeAt(0),a.LexCodeSHP="#".charCodeAt(0),a.LexCodeBNG="!".charCodeAt(0),a.LexCodeQUO='"'.charCodeAt(0),a.LexCodeAPO="'".charCodeAt(0),a.LexCodePCT="%".charCodeAt(0),a.LexCodeAMP="&".charCodeAt(0),a.LexCodeLPR="(".charCodeAt(0),a.LexCodeRPR=")".charCodeAt(0),a.LexCodePLS="+".charCodeAt(0),a.LexCodeMIN="-".charCodeAt(0),a.LexCodeMUL="*".charCodeAt(0),a.LexCodeSLH="/".charCodeAt(0),a.LexCodeXOR="^".charCodeAt(0),a.LexCodeCMA=",".charCodeAt(0),a.LexCodeDOT=".".charCodeAt(0),a.LexCodeLT="<".charCodeAt(0),a.LexCodeEQ="=".charCodeAt(0),a.LexCodeGT=">".charCodeAt(0),a.LexCodeQUE="?".charCodeAt(0),a.LexCodeLBR="[".charCodeAt(0),a.LexCodeRBR="]".charCodeAt(0),a.LexCodeUSC="_".charCodeAt(0),a.LexCodeLC="{".charCodeAt(0),a.LexCodeRC="}".charCodeAt(0),a.LexCodeBAR="|".charCodeAt(0),a.LexCodeTIL="~".charCodeAt(0),a.LexCodeCOL=":".charCodeAt(0),a.LexCodeSMC=";".charCodeAt(0),a.LexCodeUnderscore="_".charCodeAt(0),a.LexCodeDollar="$".charCodeAt(0),a.LexCodeSpace=32,a.LexKeywordTable=undefined;var b=new Array(128),c=new Array(128);a.LexInitialize=d,a.LexAdjustIndent=e,a.LexIsIdentifierStartChar=f,a.LexIsDigit=g,a.LexIsIdentifierChar=h,a.LexMatchingOpen=i,function(a){a._map=[],a._map[0]="Start",a.Start=0,a._map[1]="InFraction",a.InFraction=1,a._map[2]="InExponent",a.InExponent=2}(a.NumberScanState||(a.NumberScanState={}));var j=a.NumberScanState;(function(a){a._map=[],a._map[0]="Start",a.Start=0,a._map[1]="InMultilineComment",a.InMultilineComment=1})(a.LexState||(a.LexState={}));var k=a.LexState;(function(a){a._map=[],a._map[0]="Line",a.Line=0,a._map[1]="File",a.File=1})(a.LexMode||(a.LexMode={}));var l=a.LexMode;(function(a){a._map=[],a._map[0]="Line",a.Line=0,a._map[1]="Block",a.Block=1})(a.CommentStyle||(a.CommentStyle={}));var m=a.CommentStyle,n=function(){function a(a){this.text=a}return a.prototype.getText=function(a,b){return this.text.substring(a,b)},a.prototype.getLength=function(){return this.text.length},a}();a.StringSourceText=n;var o=function(){function a(a,b,c){this.segmentStart=a,this.segmentEnd=b,this.segment=c}return a.prototype.charCodeAt=function(a){return this.segment.charCodeAt(a-this.segmentStart)},a.prototype.substring=function(a,b){return this.segment.substring(a-this.segmentStart,b-this.segmentStart)},a}();a.SourceTextSegment=o;var p=function(){function a(a,b){this.seg1=a,this.seg2=b}return a.prototype.charCodeAt=function(a){return this.seg1.segmentStart<=a&&a<this.seg1.segmentEnd?this.seg1.segment.charCodeAt(a-this.seg1.segmentStart):this.seg2.segment.charCodeAt(a-this.seg2.segmentStart)},a.prototype.substring=function(a,b){return this.seg1.segmentStart<=a&&b<=this.seg1.segmentEnd?this.seg1.segment.substring(a-this.seg1.segmentStart,b-this.seg1.segmentStart):this.seg2.segment.substring(a-this.seg2.segmentStart)+this.seg1.segment.substring(0,b-this.seg1.segmentStart)},a}();a.AggerateSourceTextSegment=p;var q=function(){function b(a){this.sourceText=a,this.agg=new p(b.emptySegment,b.emptySegment),this.len=this.sourceText.getLength()}return b.emptySegment=new o(0,0,""),b.prototype.max=function(a,b){return a>=b?a:b},b.prototype.min=function(a,b){return a<=b?a:b},b.prototype.fetchSegment=function(b,c){if(this.agg.seg1.segmentStart<=b&&c<=this.agg.seg1.segmentEnd)return this.agg.seg1;if(this.agg.seg2.segmentStart<=b&&c<=this.agg.seg1.segmentEnd)return this.agg;var d=this.agg.seg1,e=d.segmentEnd,f=a.max(e+512,c);f=a.min(f,this.len);var g=this.sourceText.getText(e,f),h=new o(e,f,g);return this.agg.seg2=d,this.agg.seg1=h,this.agg},b.prototype.charCodeAt=function(a){return this.fetchSegment(a,a+1).charCodeAt(a)},b.prototype.substring=function(a,b){return this.fetchSegment(a,b).substring(a,b)},b}();a.ScannerTextStream=q;var r=function(){function b(){this.prevToken=null,this.curSavedToken=
null,this.prevSavedToken=null,this.prevToken=null,this.currentToken=0,this.tokens=new Array,this.prevLine=1,this.line=1,this.col=0,this.lexState=k.Start,this.commentStack=new Array}return b.prototype.previousToken=function(){return this.prevToken},b.prototype.close=function(){this.currentToken=0},b.prototype.addToken=function(b,c){this.tokens[this.currentToken++]=new a.SavedToken(b,c.startPos,c.pos)},b.prototype.scan=function(){this.startLine=this.line,this.startPos=this.col;if(this.currentTokenIndex==this.currentTokens.length){if(!(this.line<this.lineMap.length))return a.staticTokens[a.TokenID.EOF];this.line++,this.col=0,this.currentTokenIndex=0,this.currentTokens=this.tokensByLine[this.line]}if(this.currentTokenIndex<this.currentTokens.length){this.prevToken=this.curSavedToken.tok,this.prevSavedToken=this.curSavedToken,this.curSavedToken=this.currentTokens[this.currentTokenIndex++];var b=this.curSavedToken.tok;return this.pos=this.curSavedToken.limChar,this.col+=this.curSavedToken.limChar-this.curSavedToken.minChar,this.startPos=this.curSavedToken.minChar,this.prevLine=this.line,b}return a.staticTokens[a.TokenID.EOF]},b.prototype.syncToTok=function(a){this.line=w(this.lineMap,a),this.currentTokenIndex=0;var b=a-this.lineMap[this.line];while(this.lexStateByLine[this.line]==k.InMultilineComment&&this.line>0)this.line--,b=0;var c=this.lineMap.length-1;this.currentTokens=this.tokensByLine[this.line];while(this.currentTokens.length==0&&this.line<c)this.line++,this.currentTokens=this.tokensByLine[this.line],b=0;if(this.line<=c){while(this.currentTokenIndex<this.currentTokens.length&&b>this.currentTokens[this.currentTokenIndex].limChar)this.currentTokenIndex++;if(this.currentTokenIndex<this.currentTokens.length)return this.col=this.currentTokens[this.currentTokenIndex].minChar,this.col+this.lineMap[this.line]}return-1},b.prototype.lastTokenLimChar=function(){return this.prevSavedToken!==null?this.prevSavedToken.limChar:0},b.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},b.prototype.pushComment=function(a){this.commentStack.push(a)},b.prototype.getComments=function(){var a=this.commentStack;return this.commentStack=[],a},b.prototype.getCommentsForLine=function(a){var b=null;while(this.commentStack.length>0&&this.commentStack[0].line==a)b==null?b=[this.commentStack.shift()]:b=b.concat([this.commentStack.shift()]);return b},b.prototype.resetComments=function(){this.commentStack=[]},b.prototype.setSourceText=function(a,b){},b}();a.SavedTokens=r;var s=function(){function e(){this.prevLine=1,this.line=1,this.col=0,this.pos=0,this.startPos=0,this.len=0,this.lineMap=[],this.ch=a.LexEOF,this.lexState=k.Start,this.mode=l.File,this.scanComments=!0,this.interveningWhitespace=!1,this.interveningWhitespacePos=0,this.leftCurlyCount=0,this.rightCurlyCount=0,this.commentStack=new Array,this.saveScan=null,this.prevTok=a.staticTokens[a.TokenID.EOF],this.startCol=this.col,this.startLine=this.line,this.lineMap[1]=0,a.LexKeywordTable||d()}return e.prototype.previousToken=function(){return this.prevTok},e.prototype.setSourceText=function(a,b){this.mode=b,this.scanComments=this.mode===l.Line,this.pos=0,this.interveningWhitespacePos=0,this.startPos=0,this.line=1,this.col=0,this.startCol=this.col,this.startLine=this.line,this.len=0,this.src=a.getText(0,a.getLength()),this.len=this.src.length,this.lineMap=[],this.lineMap[1]=0,this.commentStack=[],this.leftCurlyCount=0,this.rightCurlyCount=0},e.prototype.setSaveScan=function(a){this.saveScan=a},e.prototype.setText=function(a,b){this.setSourceText(new n(a),b)},e.prototype.setScanComments=function(a){this.scanComments=a},e.prototype.getLexState=function(){return this.lexState},e.prototype.scanLine=function(b,c){this.lexState=c;var d=new Array;this.setText(b,l.Line);var e=this.scan();while(e.tokenId!=a.TokenID.EOF)d[d.length]=e,e=this.scan();return d},e.prototype.tokenStart=function(){this.startPos=this.pos,this.startLine=this.line,this.startCol=this.col,this.interveningWhitespace=!1},e.prototype.peekChar=function(){return this.pos<this.len?this.src.charCodeAt(this.pos):a.LexEOF},e.prototype.peekCharAt=function(b){return b<this.len?this.src.charCodeAt(b):a.LexEOF},e.prototype.IsHexDigit=function(b){return b>=a.LexCode_0&&b<=a.LexCode_9||b>=a.LexCode_A&&b<=a.LexCode_F||b>=a.LexCode_a&&b<=a.LexCode_f},e.prototype.IsOctalDigit=function(b){return b>=a.LexCode_0&&b<=a.LexCode_7||b>=a.LexCode_a&&b<=a.LexCode_f},e.prototype.scanHexDigits=function(){var b=!1;for(;;){if(!this.IsHexDigit(this.ch))return b?new a.NumberToken(parseInt(this.src.substring(this.startPos,this.pos))):null;this.nextChar(),b=!0}},e.prototype.scanOctalDigits=function(){var b=!1;for(;;){if(!this.IsOctalDigit(this.ch))return b?new a.NumberToken(parseInt(this.src.substring(this.startPos,this.pos))):null;this.nextChar(),b=!0}},e.prototype.scanDecimalNumber=function(b){var c=!1,d=this.pos,e=this.col;for(;;)if(g(this.ch))c=!0,this.nextChar();else if(this.ch==a.LexCodeDOT){if(b!=j.Start)return c?new a.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=d,this.col=e,null);this.nextChar(),b=j.InFraction}else if(this.ch==a.LexCode_e||this.ch==a.LexCode_E)if(b==j.Start){if(!c)return this.pos=d,this.col=e,null;c=!1,this.nextChar(),b=j.InExponent}else{if(b!=j.InFraction)return c?new a.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=d,this.col=e,null);this.nextChar(),b=j.InExponent,c=!1}else{if(this.ch!=a.LexCodePLS&&this.ch!=a.LexCodeMIN)return c?new a.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=d,this.col=e,null);if(b!=j.InExponent)return b==j.InFraction?new a.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):c?new a.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=d,this.col=e,null);if(!!c)return this.pos=d,this.col=e,null;this.nextChar()}},e.prototype.scanNumber=function(){if(this.peekChar()!=a.LexCode_0)return this.scanDecimalNumber(j.Start);switch(this.peekCharAt(this.pos+1)){case a.LexCode_x:case a.LexCode_X:return this.advanceChar(2),this.scanHexDigits();case a.LexCode_8:case a.LexCode_9:case a.LexCodeDOT:return this.scanDecimalNumber(j.Start);default:return this.scanOctalDigits()}},e.prototype.scanFraction=function(){return this.scanDecimalNumber(j.InFraction)},e.prototype.newLine=function(){this.col=0,this.mode==l.File&&(this.line++,this.lineMap[this.line]=this.pos+1)},e.prototype.finishMultilineComment=function(){var b;this.lexState=k.InMultilineComment;while(this.pos<this.len){if(this.ch==a.LexCodeMUL){b=this.peekCharAt(this.pos+1);if(b==a.LexCodeSLH)return this.advanceChar(2),this.mode==l.File&&this.tokenStart(),this.lexState=k.Start,!0}else if(this.ch==a.LexCodeNWL){this.newLine();if(this.mode==l.Line)return this.nextChar(),!1}this.nextChar()}return!1},e.prototype.pushComment=function(a){this.commentStack.push(a)},e.prototype.getComments=function(){var a=this.commentStack;return this.commentStack=[],a},e.prototype.getCommentsForLine=function(a){var b=null;while(this.commentStack.length>0&&this.commentStack[0].line==a)b==null?b=[this.commentStack.shift()]:b=b.concat([this.commentStack.shift()]);return b},e.prototype.resetComments=function(){this.commentStack=[]},e.prototype.endsLine=function(b){return b==a.LexCodeNWL||b==a.LexCodeRET||b==8232||b==8233},e.prototype.finishSinglelineComment=function(){while(this.pos<this.len){if(this.endsLine(this.ch))break;this.nextChar()}this.mode==l.File&&this.tokenStart()},e.prototype.tokenText=function(){return this.src.substring(this.startPos,this.pos)},e.prototype.findClosingSLH=function(){var b=this.pos,c=this.src.charCodeAt(b),d=0,e=!1;while(!this.endsLine(c)&&b<this.len){if(c==a.LexCodeSLH&&!e)return b;d=c,b++,e?e=!1:e=d==a.LexCodeBSL,c=this.src.charCodeAt(b)}return-1},e.prototype.speculateRegex=function(){if(a.noRegexTable[this.prevTok.tokenId]!=undefined)return null;var b=this.pos,c=this.col,d=this.findClosingSLH();if(d>0){var e=this.src.substring(b,d),f="";this.pos=d+1,this.ch=this.peekChar();var g=this.pos;while(this.ch==a.LexCode_i||this.ch==a.LexCode_g||this.ch==a.LexCode_m)this.nextChar();if(this.pos-g>3)return null;f=this.src.substring(g,this.pos);var h=undefined;try{h=new RegExp(e,f)}catch(i){}if(h)return this.col=c+(this.pos-this.startPos),new a.RegexToken(h)}return this.pos=b,this.col=c,null},e.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},e.prototype.lastTokenLimChar=function(){return this.interveningWhitespace?this.interveningWhitespacePos:this.startPos},e.prototype.advanceChar=function(a){this.pos+=a,this.col+=a,this.ch=this.peekChar()},e.prototype.nextChar=function(){this.pos++,this.col++,this.ch=this.peekChar()},e.prototype.scan=function(){if(this.lexState==k.InMultilineComment&&this.scanComments){this.ch=this.peekChar();var b=this.line;this.finishMultilineComment();if(this.startPos<this.pos){var c=this.src.substring(this.startPos,this.pos);return this.tokenStart(),new a.CommentToken(a.TokenID.Comment,c,!0,this.startPos,b,!0)}return a.staticTokens[a.TokenID.EOF]}return this.prevLine=this.line,this.prevTok=this.innerScan(),this.saveScan&&this.saveScan.addToken(this.prevTok,this),this.prevTok},e.prototype.innerScan=function(){var d;this.tokenStart(),this.ch=this.peekChar();while(this.pos<this.len){if(c[this.ch]){do this.nextChar();while(c[this.ch]||g(this.ch));var e=this.src.substring(this.startPos,this.pos),f;return(f=a.LexKeywordTable.lookup(e))!=null?a.staticTokens[f]:new a.StringToken(a.TokenID.ID,e)}if(this.ch==a.LexCodeSpace){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos);do this.nextChar();while(this.ch==a.LexCodeSpace);if(this.mode==l.Line){var h=this.src.substring(this.startPos,this.pos);return new a.WhitespaceToken(a.TokenID.Whitespace,h)}this.tokenStart(),this.interveningWhitespace=!0}else if(this.ch==a.LexCodeSLH){this.nextChar();var i;if(this.ch==a.LexCodeSLH){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1);var j=this.pos-1,k=this.line;this.finishSinglelineComment();var i=this.src.substring(j,this.pos),m=new a.CommentToken(a.TokenID.Comment,i,!1,j,k,!1);if(this.scanComments)return this.startPos=j,m;this.pushComment(m),this.interveningWhitespace=!0}else{if(this.ch!=a.LexCodeMUL){var o=this.speculateRegex();return o?o:this.peekCharAt(this.pos)==a.LexCodeEQ?(this.nextChar(),a.staticTokens[a.TokenID.AsgDiv]):a.staticTokens[a.TokenID.Div]}this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1);var j=this.pos-1,k=this.line;this.nextChar(),this.finishMultilineComment();var i=this.src.substring(j,this.pos),n=this.peekChar()==a.LexCodeNWL||this.peekChar()==a.LexCodeRET,m=new a.CommentToken(a.TokenID.Comment,i,!0,j,k,n);if(this.scanComments)return this.startPos=j,m;this.pushComment(m),this.interveningWhitespace=!0}}else{if(this.ch==a.LexCodeSMC)return this.nextChar(),a.staticTokens[a.TokenID.SColon];if(this.ch==a.LexCodeAPO||this.ch==a.LexCodeQUO){var p=this.ch,q=0,r=!1;do q=this.ch,r?r=!1:r=q==a.LexCodeBSL,this.nextChar();while(this.ch!=a.LexEOF&&(r||this.ch!=p));return this.ch!=a.LexEOF&&this.nextChar(),new a.StringToken(a.TokenID.QString,this.src.substring(this.startPos,this.pos))}if(b[this.ch]){var s=b[this.ch];return s.tokenId==a.TokenID.LCurly?this.leftCurlyCount++:s.tokenId==a.TokenID.RCurly&&this.rightCurlyCount++,this.nextChar(),s}if(this.ch>=a.LexCode_0&&this.ch<=a.LexCode_9)return d=this.scanNumber(),d?d:(this.nextChar(),a.staticTokens[a.TokenID.Error]);switch(this.ch){case a.LexCodeTAB:case a.LexCodeVTAB:this.interveningWhitespace||(this.interveningWhitespacePos=this.pos);if(this.mode==l.Line){do this.nextChar();while(this.ch==a.LexCodeSpace||this.ch==9);var t=this.src.substring(this.startPos,this.pos);return new a.WhitespaceToken(a.TokenID.Whitespace,t)}this.interveningWhitespace=!0;case 255:case 254:case 239:case 187:case 191:case 8232:case 8233:case a.LexCodeNWL:case a.LexCodeRET:if(this.ch==a.LexCodeNWL){this.newLine();if(this.mode==l.Line)return a.staticTokens[a.TokenID.EOF]}this.interveningWhitespace||(this.interveningWhitespacePos=this.pos),this.nextChar(),this.tokenStart(),this.interveningWhitespace=!0;break;case a.LexCodeDOT:return this.peekCharAt(this.pos+1)==a.LexCodeDOT?this.peekCharAt(this.pos+2)==a.LexCodeDOT?(this.advanceChar(3),a.staticTokens[a.TokenID.Ellipsis]):(this.nextChar(),a.staticTokens[a.TokenID.Dot]):(this.nextChar(),d=this.scanFraction(),d?d:a.staticTokens[a.TokenID.Dot]);case a.LexCodeEQ:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?this.peekCharAt(this.pos+2)==a.LexCodeEQ?(this.advanceChar(3),a.staticTokens[a.TokenID.Eqv]):(this.advanceChar(2),a.staticTokens[a.TokenID.EQ]):this.peekCharAt(this.pos+1)==a.LexCodeGT?(this.advanceChar(2),a.staticTokens[a.TokenID.Arrow]):(this.nextChar(),a.staticTokens[a.TokenID.Asg]);case a.LexCodeBNG:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?this.peekCharAt(this.pos+2)==a.LexCodeEQ?(this.advanceChar(3),a.staticTokens[a.TokenID.NEqv]):(this.advanceChar(2),a.staticTokens[a.TokenID.NE]):(this.nextChar(),a.staticTokens[a.TokenID.Bang]);case a.LexCodePLS:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.AsgAdd]):this.peekCharAt(this.pos+1)==a.LexCodePLS?(this.advanceChar(2),a.staticTokens[a.TokenID.Inc]):(this.nextChar(),a.staticTokens[a.TokenID.Add]);case a.LexCodeMIN:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.AsgSub]):this.peekCharAt(this.pos+1)==a.LexCodeMIN?(this.advanceChar(2),a.staticTokens[a.TokenID.Dec]):(this.nextChar(),a.staticTokens[a.TokenID.Sub]);case a.LexCodeMUL:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.AsgMul]):(this.nextChar(),a.staticTokens[a.TokenID.Mult]);case a.LexCodePCT:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.AsgMod]):(this.nextChar(),a.staticTokens[a.TokenID.Pct]);case a.LexCodeLT:return this.peekCharAt(this.pos+1)==a.LexCodeLT?this.peekCharAt(this.pos+2)==a.LexCodeEQ?(this.advanceChar(3),a.staticTokens[a.TokenID.AsgLsh]):(this.advanceChar(2),a.staticTokens[a.TokenID.Lsh]):this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.LE]):(this.nextChar(),a.staticTokens[a.TokenID.LT]);case a.LexCodeGT:return this.peekCharAt(this.pos+1)==a.LexCodeGT?this.peekCharAt(this.pos+2)==a.LexCodeEQ?(this.advanceChar(3),a.staticTokens[a.TokenID.AsgRsh]):this.peekCharAt(this.pos+2)==a.LexCodeGT?this.peekCharAt(this.pos+3)==a.LexCodeEQ?(this.advanceChar(4),a.staticTokens[a.TokenID.AsgRs2]):(this.advanceChar(3),a.staticTokens[a.TokenID.Rs2]):(this.advanceChar(2),a.staticTokens[a.TokenID.Rsh]):this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.GE]):(this.nextChar(),a.staticTokens[a.TokenID.GT]);case a.LexCodeXOR:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.AsgXor]):(this.nextChar(),a.staticTokens[a.TokenID.Xor]);case a.LexCodeBAR:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.AsgOr]):this.peekCharAt(this.pos+1)==a.LexCodeBAR?(this.advanceChar(2),a.staticTokens[a.TokenID.LogOr]):(this.nextChar(),a.staticTokens[a.TokenID.Or]);case a.LexCodeAMP:return this.peekCharAt(this.pos+1)==a.LexCodeEQ?(this.advanceChar(2),a.staticTokens[a.TokenID.AsgAnd]):this.peekCharAt(this.pos+1)==a.LexCodeAMP?(this.advanceChar(2),a.staticTokens[a.TokenID.LogAnd]):(this.nextChar(),a.staticTokens[a.TokenID.And]);default:return a.staticTokens[a.TokenID.EOF]}}}return a.staticTokens[a.TokenID.EOF]},e}();a.Scanner=s,a.convertTokToIDName=t,a.convertTokToID=u,a.getLineNumberFromPosition=w,a.getSourceLineColFromMap=x,a.getLineColumnFromPosition=y,a.getPositionFromLineColumn=z})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function c(b,c,d,e,f){var g=new a.ScopeChain(null,c.scopeChain,b);g.thisType=d,g.classType=e,g.fnc=f,c.scopeChain=g}function d(a){a.scopeChain=a.scopeChain.previous}function e(a,b){return a==null||!a.isInstanceProperty()?b:a}function f(a){return a.isInstanceProperty()}function h(b,d){var e=b,f=null,g=null;e.name&&e.mod&&(e.name.sym=e.mod.symbol);var h=e.mod;if(!h)return;f=new a.SymbolTableScope(h.members,h.ambientMembers,h.enclosedTypes,h.ambientEnclosedTypes,h.symbol),h.memberScope=f,d.modDeclChain.push(e),d.typeFlow.checker.currentModDecl=e,g=new a.SymbolAggregateScope(h.symbol),g.addParentScope(f),g.addParentScope(d.scopeChain.scope),c(g,d,null,null,null),h.containedScope=g,h.symbol&&d.typeFlow.addLocalsFromScope(h.containedScope,h.symbol,e.vars,h.members.privateMembers,!0)}function i(b,d){var e=b,f=null,g=null;e.name&&e.type&&(e.name.sym=e.type.symbol);var h=b.type;if(h){var i=h.symbol;f=d.typeFlow.checker.scopeOf(h),g=new a.SymbolAggregateScope(h.symbol),g.addParentScope(f),g.addParentScope(d.scopeChain.scope),h.containedScope=g,h.memberScope=f;var j=h.instanceType;f=d.typeFlow.checker.scopeOf(j),j.memberScope=f,g=new a.SymbolAggregateScope(j.symbol),g.addParentScope(d.scopeChain.scope),c(g,d,j,h,null),j.containedScope=g}else b.type=d.typeFlow.anyType}function j(b,d){var e=b,f=null,g=null;e.name&&e.type&&(e.name.sym=e.type.symbol);var h=b.type;f=d.typeFlow.checker.scopeOf(h),h.memberScope=f,g=new a.SymbolAggregateScope(h.symbol),g.addParentScope(f),g.addParentScope(d.scopeChain.scope),c(g,d,null,null,null),h.containedScope=g}function k(b,d){var e=b,f=e.type,g=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),h=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),f=new a.Type,i=new a.WithSymbol(e.minChar,d.typeFlow.checker.locationInfo.unitIndex,f);f.members=g,f.ambientMembers=h,f.symbol=i,f.setHasImplementation(),e.type=f;var j=new a.SymbolScopeBuilder(f.members,f.ambientMembers,null,null,d.scopeChain.scope,f.symbol);c(j,d,null,null,null),f.containedScope=j}function l(b,d){var e=b,f=null,g=null;e.type&&(g=b.type.symbol);var h=a.hasFlag(e.fncFlags,a.FncFlags.Static),i=h&&d.scopeChain.fnc!=null,j=i?d.scopeChain.fnc.type.memberScope:d.scopeChain.scope;if(d.scopeChain.thisType&&(!e.isConstructor||a.hasFlag(e.fncFlags,a.FncFlags.ClassMethod))){var k=d.scopeChain.thisType;!(k.typeFlags&a.TypeFlags.IsClass)&&!a.hasFlag(e.fncFlags,a.FncFlags.ClassMethod)?!e.isMethod()||h?j=k.constructorScope:j=k.containedScope:d.scopeChain.previous.scope.container&&d.scopeChain.previous.scope.container.declAST&&d.scopeChain.previous.scope.container.declAST.nodeType==a.NodeType.FuncDecl&&d.scopeChain.previous.scope.container.declAST.isConstructor?j=k.constructorScope:h&&d.scopeChain.classType?j=d.scopeChain.classType.containedScope:j=k.containedScope,f=k.symbol}else e.isConstructor&&d.scopeChain.thisType&&(f=d.scopeChain.thisType.symbol);if(e.type==null||a.hasFlag(e.type.symbol.flags,a.SymbolFlags.TypeSetDuringScopeAssignment)){d.scopeChain.fnc&&d.scopeChain.fnc.type&&(f=d.scopeChain.fnc.type.symbol);var l=null,m=d.scopeChain.fnc,n=e.name?e.name.text:null,o=null;h?(m.type.members==null&&f.getType().memberScope&&(m.type.members=f.type.memberScope.valueMembers),l=d.scopeChain.fnc.type.memberScope,m.innerStaticFuncs[m.innerStaticFuncs.length]=e):!e.isConstructor&&f&&f.declAST&&f.declAST.nodeType==a.NodeType.FuncDecl&&f.declAST.isConstructor&&!e.isMethod()?l=d.scopeChain.thisType.constructorScope:l=d.scopeChain.scope,n&&n!="__missing"&&!e.isAccessor()&&(h?o=l.findLocal(n,!1,!1):o=l.findLocal(n,!1,!1)),d.typeFlow.checker.createFunctionSignature(e,f,l,o,o==null);if(!e.accessorSymbol&&e.fncFlags&a.FncFlags.ClassMethod&&f&&(!o||o.declAST.nodeType!=a.NodeType.FuncDecl)&&e.isAccessor()||o&&o.isAccessor())e.accessorSymbol=d.typeFlow.checker.createAccessorSymbol(e,o,f.getType(),e.isMethod()&&h,!0,l,f);e.type.symbol.flags|=a.SymbolFlags.TypeSetDuringScopeAssignment}e.name&&e.type&&(e.name.sym=e.type.symbol),e.scopeType=e.type;if(e.isOverload)return;var p=new a.StringHashTable,q=new a.ScopedMembers(new a.DualStringHashTable(p,new a.StringHashTable)),r=new a.StringHashTable,s=new a.ScopedMembers(new a.DualStringHashTable(r,new a.StringHashTable)),t=new a.StringHashTable,u=new a.ScopedMembers(new a.DualStringHashTable(t,new a.StringHashTable)),v=new a.StringHashTable,w=new a.ScopedMembers(new a.DualStringHashTable(v,new a.StringHashTable));e.unitIndex=d.typeFlow.checker.locationInfo.unitIndex;var x=new a.SymbolScopeBuilder(q,s,null,null,j,g),y=new a.SymbolScopeBuilder(u,w,null,null,j,null);e.isConstructor&&d.scopeChain.thisType&&(d.scopeChain.thisType.constructorScope=x),e.symbols=p;if(!e.isSpecialFn()){var z=e.type,A=e.signature;e.isConstructor||(z.containedScope=x,x.container=z.symbol,z.memberScope=y,y.container=z.symbol),e.enclosingFnc=d.scopeChain.fnc,z.enclosingType=h?d.scopeChain.classType:d.scopeChain.thisType;var o=b.type.symbol;(e.fncFlags&a.FncFlags.Signature)==a.FncFlags.None&&e.vars&&(d.typeFlow.addLocalsFromScope(x,o,e.vars,p,!1),d.typeFlow.addLocalsFromScope(y,o,e.statics,t,!1));if(A.parameters){var B=A.parameters.length;for(var C=0;C<B;C++){var D=A.parameters[C];d.typeFlow.checker.resolveTypeLink(x,D.parameter.typeLink,!0)}}d.typeFlow.checker.resolveTypeLink(x,A.returnType,e.isSignature())}if(!e.isConstructor||a.hasFlag(e.fncFlags,a.FncFlags.ClassMethod)){var E=e.isConstructor&&a.hasFlag(e.fncFlags,a.FncFlags.ClassMethod)?d.scopeChain.thisType:null;c(x,d,E,null,e)}}function m(b,d){var e=b;if(e.param){var f=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),g=new a.SymbolScopeBuilder(f,null,null,null,d.scopeChain.scope,d.scopeChain.scope.container);e.containedScope=g,c(g,d,d.scopeChain.thisType,d.scopeChain.classType,d.scopeChain.fnc)}}function n(b,c,d){var e=d.state,f=!0;if(b)if(b.nodeType==a.NodeType.List){var g=b;g.enclosingScope=e.scopeChain.scope}else b.nodeType==a.NodeType.Module?h(b,e):b.nodeType==a.NodeType.Class?i(b,e):b.nodeType==a.NodeType.Interface?j(b,e):b.nodeType==a.NodeType.With?k(b,e):b.nodeType==a.NodeType.FuncDecl?l(b,e):b.nodeType==a.NodeType.Catch?m(b,e):b.nodeType==a.NodeType.TypeRef&&(f=!1);return d.options.goChildren=f,b}function o(b,c,e){var f=e.state,g=!0;if(b)if(b.nodeType==a.NodeType.Module){var h=b;d(f),f.modDeclChain.pop(),f.modDeclChain.length>=1&&(f.typeFlow.checker.currentModDecl=f.modDeclChain[f.modDeclChain.length-1])}else if(b.nodeType==a.NodeType.Class)d(f);else if(b.nodeType==a.NodeType.Interface)d(f);else if(b.nodeType==a.NodeType.With)d(f);else if(b.nodeType==a.NodeType.FuncDecl){var i=b;(!i.isConstructor||a.hasFlag(i.fncFlags,a.FncFlags.ClassMethod))&&!i.isOverload&&d(f)}else if(b.nodeType==a.NodeType.Catch){var j=b;j.param&&d(f)}else g=!1;return e.options.goChildren=g,b}var b=function(){function a(a,b,c){this.scopeChain=a,this.typeFlow=b,this.modDeclChain=c}return a}();a.AssignScopeContext=b,a.pushAssignScope=c,a.popAssignScope=d,a.instanceCompare=e,a.instanceFilterStop=f;var g=function(){function a(a,b){this.select=a,this.stop=b,this.result=null}return a.prototype.reset=function(){this.result=null},a.prototype.update=function(a){return this.result=this.select(this.result,a),this.result?this.stop(this.result):!1},a}();a.ScopeSearchFilter=g,a.instanceFilter=new g(e,f),a.preAssignModuleScopes=h,a.preAssignClassScopes=i,a.preAssignInterfaceScopes=j,a.preAssignWithScopes=k,a.preAssignFuncDeclScopes=l,a.preAssignCatchScopes=m,a.preAssignScopes=n,a.postAssignScopes=o})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function e(b,c,d){var e=d.state;return a.hasFlag(b.flags,e.matchFlag)&&(e.pos<0||e.pos==b.limChar)&&(e.ast=b,b.type==null&&e.pos>=0&&e.flow.inScopeTypeCheck(b,e.scope),e.type=b.type,e.options.stopWalk()),b}function f(b,c,d,e,f,g,h,i,j){var k=new a.SymbolScopeBuilder(c,d,e,f,null,b),l=new a.ScopeChain(b,g.scopeChain,k);l.thisType=h,l.classType=i,l.moduleDecl=j,g.scopeChain=l}function g(a){a.scopeChain=a.scopeChain.previous}function h(b,c,d){var e=d.state,f=b.minChar,g=b.limChar;b.nodeType==a.NodeType.Script&&e.pos>g&&(g=e.pos);if(f<=e.pos&&g>=e.pos){switch(b.nodeType){case a.NodeType.Script:var h=b;e.scopeGetter=function(){return h.bod===null?null:h.bod.enclosingScope},e.scopeStartAST=h;break;case a.NodeType.Class:e.scopeGetter=function(){return b.type===null||b.type.instanceType.containedScope===null?null:b.type.instanceType.containedScope},e.scopeStartAST=b,e.enclosingClassDecl=b;break;case a.NodeType.ObjectLit:var i=b;i.targetType&&(e.scopeGetter=function(){return i.targetType.containedScope},e.objectLiteralScopeGetter=function(){return i.targetType.memberScope},e.enclosingObjectLit=i);break;case a.NodeType.Module:e.deepestModuleDecl=b,e.scopeGetter=function(){return b.type===null?null:b.type.containedScope},e.scopeStartAST=b;break;case a.NodeType.Interface:e.scopeGetter=function(){return b.type===null?null:b.type.containedScope},e.scopeStartAST=b;break;case a.NodeType.FuncDecl:var j=b;e.skipNextFuncDeclForClass?e.skipNextFuncDeclForClass=!1:(e.scopeGetter=function(){return j.isConstructor&&a.hasFlag(j.fncFlags,a.FncFlags.ClassMethod)&&b.type&&b.type.enclosingType?b.type.enclosingType.constructorScope:j.scopeType?j.scopeType.containedScope:j.type?j.type.containedScope:null},e.scopeStartAST=b)}d.options.goChildren=!0}else d.options.goChildren=!1;return b}function i(b,c,e,f,g){var i=new d(b,c,e,f,g);return a.getAstWalkerFactory().walk(c,h,null,null,i),i.scopeStartAST===null?null:i}var b=function(){function a(a,b){this.scopeChain=a,this.checker=b,this.script=null}return a}();a.TypeCollectionContext=b;var c=function(){function b(b,c,d){this.flow=b,this.pos=c,this.matchFlag=d,this.type=null,this.ast=null,this.options=new a.AstWalkOptions}return b}();a.MemberScopeContext=c;var d=function(){function b(a,b,c,d,e){this.logger=a,this.script=b,this.text=c,this.pos=d,this.isMemberCompletion=e,this.scopeGetter=null,this.objectLiteralScopeGetter=null,this.scopeStartAST=null,this.skipNextFuncDeclForClass=!1,this.deepestModuleDecl=null,this.enclosingClassDecl=null,this.enclosingObjectLit=null,this.publicsOnly=!0,this.useFullAst=!1}return b.prototype.getScope=function(){return this.scopeGetter()},b.prototype.getObjectLiteralScope=function(){return this.objectLiteralScopeGetter()},b.prototype.getScopeAST=function(){return this.scopeStartAST},b.prototype.getScopePosition=function(){return this.scopeStartAST.minChar},b.prototype.getScriptFragmentStartAST=function(){return this.scopeStartAST},b.prototype.getScriptFragmentPosition=function(){return this.getScriptFragmentStartAST().minChar},b.prototype.getScriptFragment=function(){if(this.scriptFragment==null){var b=this.getScriptFragmentStartAST(),c=b.minChar,d=this.isMemberCompletion?this.pos:this.pos+1;this.scriptFragment=a.quickParse(this.logger,b,this.text,c,d,null).Script}return this.scriptFragment},b}();a.EnclosingScopeContext=d,a.preFindMemberScope=e,a.pushTypeCollectionScope=f,a.popTypeCollectionScope=g,a.preFindEnclosingScope=h,a.findEnclosingScopeAt=i})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function b(){this.hasVariableArgList=!1,this.parameters=null,this.declAST=null,this.typeCheckStatus=a.TypeCheckStatus.NotStarted,this.nonOptionalParameterCount=0}return b.prototype.specializeType=function(c,d,e){var f=new b;this.hasVariableArgList&&(f.hasVariableArgList=!0),f.returnType=new a.TypeLink,this.returnType.type?f.returnType.type=this.returnType.type.specializeType(c,d,e,!1):f.returnType.type=e.anyType;if(this.parameters){f.parameters=[];for(var g=0,h=this.parameters.length;g<h;g++){var i=this.parameters[g],j=new a.ValueLocation,k=new a.ParameterSymbol(i.name,i.location,e.locationInfo.unitIndex,j);k.declAST=this.declAST,j.symbol=k,j.typeLink=new a.TypeLink,f.parameters[g]=k;var l=i.getType();l?(j.typeLink.type=l.specializeType(c,d,e,!1),k.declAST.type=j.typeLink.type):j.typeLink.type=e.anyType}}return f.nonOptionalParameterCount=this.nonOptionalParameterCount,f.declAST=this.declAST,f},b.prototype.toString=function(){return this.toStringHelper(!1,!1,null)},b.prototype.toStringHelper=function(a,b,c){var d;b?d="[":d="(";var e=this.parameters.length;for(var f=0;f<e;f++)d+=this.parameters[f].name+(this.parameters[f].isOptional()?"?":"")+": ",d+=this.parameters[f].getType().getScopedTypeName(c),f<e-1&&(d+=",");return a?b?d+="] => ":d+=") => ":b?d+="]: ":d+="): ",this.returnType.type?d+=this.returnType.type.getScopedTypeName(c):d+="any",d},b}();a.Signature=b;var c=function(){function b(){this.signatures=[],this.hasImplementation=!0,this.definitionSignature=null,this.hasBeenTypechecked=!1,this.flags=a.SignatureFlags.None}return b.prototype.addSignature=function(b){this.signatures==null&&(this.signatures=new Array),this.signatures[this.signatures.length]=b,b.declAST&&!b.declAST.isOverload&&!b.declAST.isSignature()&&!a.hasFlag(b.declAST.fncFlags,a.FncFlags.Ambient)&&a.hasFlag(b.declAST.fncFlags,a.FncFlags.Definition)&&(this.definitionSignature=b)},b.prototype.toString=function(){return this.signatures.toString()},b.prototype.toStrings=function(b,c,d){var e=[],f=this.signatures.length;f>1&&(c=!1);for(var g=0;g<f;g++){if(f>1&&this.signatures[g]==this.definitionSignature)continue;this.flags&a.SignatureFlags.IsIndexer?e[g]=this.signatures[g].toStringHelper(c,!0,d):e[g]=b+this.signatures[g].toStringHelper(c,!1,d)}return e},b.prototype.specializeType=function(a,c,d){var e=new b;if(this.signatures)for(var f=0,g=this.signatures.length;f<g;f++)e.addSignature(this.signatures[f].specializeType(a,c,d));return e},b.prototype.verifySignatures=function(b){var c=0;if(this.signatures&&(c=this.signatures.length)>0)for(var d=0;d<c;d++){for(var e=d+1;e<c;e++)this.signatures[d].declAST&&this.signatures[e].declAST&&!a.hasFlag(this.signatures[d].declAST.fncFlags,a.FncFlags.Definition)&&!a.hasFlag(this.signatures[e].declAST.fncFlags,a.FncFlags.Definition)&&b.signaturesAreIdentical(this.signatures[d],this.signatures[e])&&b.errorReporter.simpleError(this.signatures[d].declAST,this.signatures[d].declAST&&this.signatures[d].declAST.name?"Signature for '"+this.signatures[d].declAST.name.text+"' is duplicated":"Signature is duplicated");this.definitionSignature&&(b.signatureIsAssignableToTarget(this.definitionSignature,this.signatures[d])||b.errorReporter.simpleError(this.signatures[d].declAST,"Overload signature is not compatible with function definition"))}},b.prototype.typeCheck=function(b,c,d){if(this.hasBeenTypechecked)return;this.hasBeenTypechecked=!0;var e=0;if(this.signatures&&(e=this.signatures.length)>0){for(var f=0;f<e;f++)!d&&!this.definitionSignature&&this.signatures[f].declAST&&this.signatures[f].declAST.isOverload&&!a.hasFlag(this.signatures[f].declAST.fncFlags,a.FncFlags.Ambient)&&b.errorReporter.simpleError(this.signatures[f].declAST,"Overload declaration lacks definition"),this.signatures[f].declAST&&this.signatures[f].declAST.isConstructor&&this.signatures[f].declAST.classDecl&&this.signatures[f].declAST.classDecl.type.symbol.typeCheckStatus==a.TypeCheckStatus.NotStarted&&b.typeFlow.typeCheck(this.signatures[f].declAST.classDecl),b.typeFlow.typeCheck(this.signatures[f].declAST);this.verifySignatures(b)}},b}();a.SignatureGroup=c})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function c(b,c){return b.declAST&&c&&c.declAST&&b.declAST.nodeType==a.NodeType.FuncDecl?b.declAST.minChar<=c.declAST.minChar&&b.declAST.limChar>=c.declAST.limChar:!1}function d(a,b){while(a.container){if(a==b||c(a.container,b))return!0;a=a.container}return!1}(function(a){a._map=[],a._map[0]="NotStarted",a.NotStarted=0,a._map[1]="Started",a.Started=1,a._map[2]="Finished",a.Finished=2})(a.TypeCheckStatus||(a.TypeCheckStatus={}));var b=a.TypeCheckStatus;a.aLexicallyEnclosesB=c,a.aEnclosesB=d;var e=function(){function b(b,c,d){this.name=b,this.location=c,this.unitIndex=d,this.bound=!1,this.flags=a.SymbolFlags.None,this.isObjectLitField=!1,this.declAST=null,this.declModule=null,this.passSymbolCreated=a.CompilerDiagnostics.analysisPass}return b.prototype.instanceScope=function(){return null},b.prototype.isVariable=function(){return!1},b.prototype.isMember=function(){return!1},b.prototype.isInferenceSymbol=function(){return!1},b.prototype.isWith=function(){return!1},b.prototype.writeable=function(){return!1},b.prototype.isType=function(){return!1},b.prototype.getType=function(){return null},b.prototype.isAccessor=function(){return!1},b.prototype.isInstanceProperty=function(){return a.hasFlag(this.flags,a.SymbolFlags.Property)&&!a.hasFlag(this.flags,a.SymbolFlags.ModuleMember)},b.prototype.getTypeName=function(a){return this.toString()},b.prototype.getOptionalNameString=function(){return a.hasFlag(this.flags,a.SymbolFlags.Optional)?"?":""},b.prototype.pathToRoot=function(){var b=new Array,c=this;while(c&&c.name!=a.globalId)b[b.length]=c,c=c.container;return b},b.prototype.findCommonAncestorPath=function(a){if(this.container==null)return new 
Array;var b=this.container.pathToRoot(),c;a?c=a.pathToRoot():c=new Array;var d=-1;for(var e=0,f=b.length;e<f;e++){var g=b[e];for(var h=0,i=c.length;h<i;h++){var j=c[h];if(g==j){d=e;break}}if(d>=0)break}return d>=0?b.slice(0,d):b},b.prototype.scopeRelativeName=function(a){if(a==null)return this.name;var b=this.findCommonAncestorPath(a.container),c="";for(var d=0,e=b.length;d<e;d++)c=b[d].name+"."+c;return c+=this.name,c},b.prototype.fullName=function(){var b=this.name,c=this.container;while(c&&c.name!=a.globalId)b=c.name+"."+b,c=c.container;return b},b.prototype.visible=function(b,c){if(c==null||this.container==c.gloMod)return!0;if(a.hasFlag(this.flags,a.SymbolFlags.ModuleMember))return a.hasFlag(this.flags,a.SymbolFlags.Exported)?a.hasFlag(this.flags,a.SymbolFlags.Private)?d(this,b.container):!0:c&&c.currentModDecl==this.declModule||c.currentModDecl&&c.currentModDecl.mod&&c.currentModDecl.mod.symbol&&this.declModule&&this.declModule.mod&&this.declModule.mod.symbol&&d(c.currentModDecl.mod.symbol,this.declModule.mod.symbol);var e=this.declAST&&this.declAST.nodeType==a.NodeType.FuncDecl,f=e&&this.declAST.isMethod(),g=e&&a.hasFlag(this.declAST.fncFlags,a.FncFlags.Static),h=f&&a.hasFlag(this.declAST.fncFlags,a.FncFlags.Private),i=this.isType()&&this.aliasLink;return this.isMember()||f||g||i?a.hasFlag(this.flags,a.SymbolFlags.Private)||h?b.container==null&&this.container!=b.container?!1:this.container==null?!0:d(b.container,this.container):!0:this.container?d(this,b.container):!0},b.prototype.addRef=function(a){this.refs||(this.refs=[]),this.refs[this.refs.length]=a},b.prototype.toString=function(){return this.name?this.name:"_anonymous"},b.prototype.print=function(a){a.Write(this.toString())},b.prototype.specializeType=function(a,b,c){throw new Error("please implement in derived class")},b.prototype.setType=function(a){throw new Error("please implement in derived class")},b.prototype.kind=function(){throw new Error("please implement in derived class")},b}();a.Symbol=e;var f=function(){function a(){}return a}();a.ValueLocation=f;var g=function(c){function d(a,d,e){c.call(this,a,d,e),this.typeCheckStatus=b.NotStarted}return __extends(d,c),d.prototype.isInferenceSymbol=function(){return!0},d.prototype.transferVarFlags=function(b){a.hasFlag(b,a.VarFlags.Ambient)&&(this.flags|=a.SymbolFlags.Ambient),a.hasFlag(b,a.VarFlags.Constant)&&(this.flags|=a.SymbolFlags.Constant),a.hasFlag(b,a.VarFlags.Static)&&(this.flags|=a.SymbolFlags.Static),a.hasFlag(b,a.VarFlags.Property)&&(this.flags|=a.SymbolFlags.Property),a.hasFlag(b,a.VarFlags.Private)&&(this.flags|=a.SymbolFlags.Private),a.hasFlag(b,a.VarFlags.Public)&&(this.flags|=a.SymbolFlags.Public),a.hasFlag(b,a.VarFlags.Readonly)&&(this.flags|=a.SymbolFlags.Readonly),a.hasFlag(b,a.VarFlags.Exported)&&(this.flags|=a.SymbolFlags.Exported)},d}(e);a.InferenceSymbol=g;var h=function(b){function c(c,d,e,f){b.call(this,c,d,e),this.type=f,this.expansions=[],this.isMethod=!1,this.aliasLink=null,this.onlyReferencedAsTypeRef=a.optimizeModuleCodeGen,this.prettyName=this.name}return __extends(c,b),c.prototype.addLocation=function(a){this.additionalLocations==null&&(this.additionalLocations=[]),this.additionalLocations[this.additionalLocations.length]=a},c.prototype.kind=function(){return a.SymbolKind.Type},c.prototype.isType=function(){return!0},c.prototype.getType=function(){return this.type},c.prototype.getTypeName=function(a){return this.type.getMemberTypeName(this.name?this.name+this.getOptionalNameString():"",!1,!1,a)},c.prototype.instanceScope=function(){return!(this.type.typeFlags&a.TypeFlags.IsClass)&&this.type.isClass()?this.type.instanceType.constructorScope:this.type.containedScope},c.prototype.toString=function(){var a=this.type.getTypeName();return this.name&&(a=this.name+":"+a),a},c.prototype.isClass=function(){return this.instanceType!=null},c.prototype.isFunction=function(){return this.declAST!=null&&this.declAST.nodeType==a.NodeType.FuncDecl},c.prototype.specializeType=function(a,b,d){if(this.type==a)return b.symbol;var e=this.type.specializeType(a,b,d,!1);if(e!=this.type){var f=new c(this.name,0,-1,e);return f}return this},c.prototype.scopeRelativeName=function(b){if(b==null)return this.prettyName+this.getOptionalNameString();var c=this.findCommonAncestorPath(b.container),d="";for(var e=0,f=c.length;e<f;e++){var g=c[e].kind()==a.SymbolKind.Type?c[e].prettyName:c[e].name;d=g+"."+d}return d+=this.prettyName+this.getOptionalNameString(),d},c}(g);a.TypeSymbol=h;var i=function(a){function b(b,c,d){a.call(this,"with",b,c,d)}return __extends(b,a),b.prototype.isWith=function(){return!0},b}(h);a.WithSymbol=i;var j=function(c){function d(a,b,d,e,f){c.call(this,a,b,d),this.canWrite=e,this.field=f,this.getter=null,this.setter=null,this.hasBeenEmitted=!1,this.name=a,this.location=b}return __extends(d,c),d.prototype.kind=function(){return a.SymbolKind.Field},d.prototype.writeable=function(){return this.isAccessor()?this.setter!=null:this.canWrite},d.prototype.getType=function(){return this.field.typeLink.type},d.prototype.getTypeName=function(a){return this.name+this.getOptionalNameString()+": "+this.field.typeLink.type.getMemberTypeName("",!0,!1,a)},d.prototype.isMember=function(){return!0},d.prototype.setType=function(a){this.field.typeLink.type=a},d.prototype.isAccessor=function(){return this.getter!=null||this.setter!=null},d.prototype.isVariable=function(){return!0},d.prototype.toString=function(){return this.name+this.getOptionalNameString()+":"+this.field.typeLink.type.getTypeName()},d.prototype.specializeType=function(c,e,g){var h=this.field.typeLink.type.specializeType(c,e,g,!1);if(h!=this.field.typeLink.type){var i=new f,j=new d(this.name,0,g.locationInfo.unitIndex,this.canWrite,i);return j.flags=this.flags,i.symbol=j,i.typeLink=new a.TypeLink,j.setType(h),j.typeCheckStatus=b.Finished,j}return this},d}(g);a.FieldSymbol=j;var k=function(b){function c(a,c,d,e){b.call(this,a,c,d),this.parameter=e,this.argsOffset=-1,this.name=a,this.location=c}return __extends(c,b),c.prototype.kind=function(){return a.SymbolKind.Parameter},c.prototype.writeable=function(){return!0},c.prototype.getType=function(){return this.parameter.typeLink.type},c.prototype.setType=function(a){this.parameter.typeLink.type=a},c.prototype.isVariable=function(){return!0},c.prototype.isOptional=function(){return this.parameter&&this.parameter.symbol&&this.parameter.symbol.declAST?this.parameter.symbol.declAST.isOptional:!1},c.prototype.getTypeName=function(a){return this.name+(this.isOptional()?"?":"")+":"+this.getType().getMemberTypeName("",!1,!1,a)},c.prototype.toString=function(){return this.name+(this.isOptional()?"?":"")+":"+this.getType().getTypeName()},c.prototype.specializeType=function(a,b,d){var e=this.parameter.typeLink.type.specializeType(a,b,d,!1);if(this.parameter.typeLink.type!=e){var g=new f,h=new c(this.name,0,d.locationInfo.unitIndex,g);return g.symbol=h,h.setType(e),h}return this},c}(g);a.ParameterSymbol=k;var l=function(b){function c(a,c,d,e){b.call(this,a,c,d),this.variable=e}return __extends(c,b),c.prototype.kind=function(){return a.SymbolKind.Variable},c.prototype.writeable=function(){return!0},c.prototype.getType=function(){return this.variable.typeLink.type},c.prototype.getTypeName=function(a){return this.name+":"+this.getType().getMemberTypeName("",!1,!1,a)},c.prototype.setType=function(a){this.variable.typeLink.type=a},c.prototype.isVariable=function(){return!0},c}(g);a.VariableSymbol=l})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function e(b,c){return c?!(a.hasFlag(b.flags,a.SymbolFlags.Private)||b.declAST&&b.declAST.nodeType==a.NodeType.FuncDecl&&a.hasFlag(b.declAST.fncFlags,a.FncFlags.Private)):!0}var b=function(){function a(a){this.dualMembers=a,this.allMembers=this.dualMembers,this.publicMembers=this.dualMembers.primaryTable,this.privateMembers=this.dualMembers.secondaryTable}return a.prototype.addPublicMember=function(a,b){return this.dualMembers.primaryTable.add(a,b)},a.prototype.addPrivateMember=function(a,b){return this.dualMembers.secondaryTable.add(a,b)},a}();a.ScopedMembers=b,function(a){a._map=[],a._map[0]="None",a.None=0,a._map[1]="Type",a.Type=1,a._map[2]="Field",a.Field=2,a._map[3]="Parameter",a.Parameter=3,a._map[4]="Variable",a.Variable=4}(a.SymbolKind||(a.SymbolKind={}));var c=a.SymbolKind,d=function(){function a(a){this.container=a}return a.prototype.printLabel=function(){return"base"},a.prototype.getAllSymbolNames=function(a){return["please","implement","in","derived","classes"]},a.prototype.getAllTypeSymbolNames=function(a){return["please","implement","in","derived","classes"]},a.prototype.getAllValueSymbolNames=function(a){return["please","implement","in","derived","classes"]},a.prototype.search=function(a,b,c,d){return null},a.prototype.findLocal=function(a,b,c){return null},a.prototype.find=function(a,b,c){return null},a.prototype.findImplementation=function(a,b,c){return null},a.prototype.findAmbient=function(a,b,c){return null},a.prototype.print=function(a){this.container?a.WriteLine(this.printLabel()+" scope with container: "+this.container.name+"..."):a.WriteLine(this.printLabel()+" scope...")},a.prototype.enter=function(a,b,c,d,e,f,g){throw new Error("please implement in derived class")},a.prototype.getTable=function(){throw new Error("please implement in derived class")},a}();a.SymbolScope=d;var f=function(b){function c(a){b.call(this,a),this.valueCache=null,this.valueImplCache=null,this.valueAmbientCache=null,this.typeCache=null,this.typeImplCache=null,this.typeAmbientCache=null,this.parents=null,this.container=a}return __extends(c,b),c.prototype.printLabel=function(){return"agg"},c.prototype.search=function(a,b,c,d){if(this.parents)for(var e=0;e<this.parents.length;e++){var f=this.parents[e].search(a,b,c,d);if(f&&a.update(f))return f}return a.result},c.prototype.getAllSymbolNames=function(a){var b=[];if(this.parents)for(var c=0;c<this.parents.length;c++){var d=this.parents[c].getAllSymbolNames(a);d&&(b=b.concat(d))}return b},c.prototype.getAllTypeSymbolNames=function(a){var b=[];if(this.parents)for(var c=0;c<this.parents.length;c++){var d=this.parents[c].getAllTypeSymbolNames(a);d&&(b=b.concat(d))}return b},c.prototype.getAllValueSymbolNames=function(a){var b=[];if(this.parents)for(var c=0;c<this.parents.length;c++){var d=this.parents[c].getAllValueSymbolNames(a);d&&(b=b.concat(d))}return b},c.prototype.print=function(a){b.prototype.print.call(this,a);if(this.parents)for(var c=0;c<this.parents.length;c++)this.parents[c].print(a)},c.prototype.findImplementation=function(b,c,d){var e=null,f=0,g=this.valueImplCache;d&&(g=this.typeImplCache);if(g&&(e=g.lookup(b))!=null&&(c?!(a.hasFlag(e.flags,a.SymbolFlags.Private)||e.declAST&&e.declAST.nodeType==a.NodeType.FuncDecl&&a.hasFlag(e.declAST.fncFlags,a.FncFlags.Private)):!0))return e;if(this.parents)for(f=0;f<this.parents.length;f++){e=this.parents[f].findImplementation(b,c,d);if(e)break}return g&&(d?(this.typeImplCache=new a.StringHashTable,g=this.typeImplCache):(this.valueImplCache=new a.StringHashTable,g=this.valueImplCache)),g.add(b,e),e},c.prototype.find=function(b,c,d){var e=null,f=0,g=this.valueCache;d&&(g=this.typeCache);if(g&&(e=g.lookup(b))!=null&&(c?!(a.hasFlag(e.flags,a.SymbolFlags.Private)||e.declAST&&e.declAST.nodeType==a.NodeType.FuncDecl&&a.hasFlag(e.declAST.fncFlags,a.FncFlags.Private)):!0))return e;if(this.parents)for(f=0;f<this.parents.length;f++){e=this.parents[f].find(b,c,d);if(e)break}return g==null&&(d?(this.typeCache=new a.StringHashTable,g=this.typeCache):(this.valueCache=new a.StringHashTable,g=this.valueCache)),g.add(b,e),e},c.prototype.findAmbient=function(b,c,d){var e=null,f=0,g=this.valueAmbientCache;d&&(g=this.typeAmbientCache);if(g&&(e=g.lookup(b))!=null)return e;if(this.parents)for(f=0;f<this.parents.length;f++){e=this.parents[f].findAmbient(b,c,d);if(e)break}return g==null&&(d?(this.typeAmbientCache=new a.StringHashTable,g=this.typeAmbientCache):(this.valueAmbientCache=new a.StringHashTable,g=this.valueAmbientCache)),g.add(b,e),e},c.prototype.addParentScope=function(a){this.parents==null&&(this.parents=new Array),this.parents[this.parents.length]=a},c}(d);a.SymbolAggregateScope=f;var g=function(a){function b(b,c,d,e,f){a.call(this,f),this.valueMembers=b,this.ambientValueMembers=c,this.enclosedTypes=d,this.ambientEnclosedTypes=e,this.container=f}return __extends(b,a),b.prototype.printLabel=function(){return"table"},b.prototype.getAllSymbolNames=function(a){var b=this.getAllTypeSymbolNames(a);return b.concat(this.getAllValueSymbolNames(a))},b.prototype.getAllTypeSymbolNames=function(a){var b=[];return this.ambientEnclosedTypes&&(b=b.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(b=b.concat(this.enclosedTypes.allMembers.getAllKeys())),b},b.prototype.getAllValueSymbolNames=function(a){var b=[];return this.ambientValueMembers&&(b=b.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(b=b.concat(this.valueMembers.allMembers.getAllKeys())),b},b.prototype.search=function(a,b,c,d){var e=this.find(b,c,d);return a.update(e),a.result},b.prototype.find=function(a,b,c){var d=null,e=null;c?(d=this.enclosedTypes==null?null:b?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,e=this.ambientEnclosedTypes==null?null:b?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers):(d=this.valueMembers==null?null:b?this.valueMembers.publicMembers:this.valueMembers.allMembers,e=this.ambientValueMembers==null?null:b?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers);if(e){var f=e.lookup(a);if(f)return f}if(d){var f=d.lookup(a);if(f)return f}return null},b.prototype.findAmbient=function(a,b,c){var d=this.ambientValueMembers==null?null:b?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;c&&(d=this.ambientEnclosedTypes==null?null:b?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers);if(d){var e=d.lookup(a);if(e)return e}return null},b.prototype.print=function(b){a.prototype.print.call(this,b),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(a,c,d){b.WriteLine("  "+a)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(a,c,d){b.WriteLine("  "+a)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(a,c,d){b.WriteLine("  "+a)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(a,c,d){b.WriteLine("  "+a)},null)},b.prototype.findImplementation=function(a,b,d){var e=this.find(a,b,d);if(e)if(e.kind()==c.Type){var f=e;f.type.hasImplementation()||(e=null)}else if(e.container&&e.container.kind()==c.Type){var g=e.container;g.type.hasImplementation()||(e=null)}return e},b.prototype.getTable=function(){return this.valueMembers.publicMembers},b}(d);a.SymbolTableScope=g;var h=function(b){function c(a,c,d,e,f,g){b.call(this,g),this.valueMembers=a,this.ambientValueMembers=c,this.enclosedTypes=d,this.ambientEnclosedTypes=e,this.parent=f,this.container=g}return __extends(c,b),c.prototype.printLabel=function(){return"builder"},c.prototype.getAllSymbolNames=function(a){var b=this.getAllTypeSymbolNames(a);return b.concat(this.getAllValueSymbolNames(a))},c.prototype.getAllTypeSymbolNames=function(a){var b=[];this.ambientEnclosedTypes&&(b=b.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(b=b.concat(this.enclosedTypes.allMembers.getAllKeys()));if(!a&&this.parent){var c=this.parent.getAllTypeSymbolNames(a);c&&(b=b.concat(c))}return b},c.prototype.getAllValueSymbolNames=function(a){var b=[];this.ambientValueMembers&&(b=b.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(b=b.concat(this.valueMembers.allMembers.getAllKeys()));if(!a&&this.parent){var c=this.parent.getAllValueSymbolNames(a);c&&(b=b.concat(c))}return b},c.prototype.search=function(a,b,c,d){var e=null,f=this.valueMembers==null?null:c?this.valueMembers.publicMembers:this.valueMembers.allMembers,g=this.ambientValueMembers==null?null:c?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;d&&(f=this.enclosedTypes==null?null:c?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,g=this.ambientEnclosedTypes==null?null:c?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers);if(g&&(e=g.lookup(b))!=null&&a.update(e))return e;if(f&&(e=f.lookup(b))!=null&&a.update(e))return e;if(this.parent){e=this.parent.search(a,b,c,d);if(e&&a.update(e))return e}return a.result},c.prototype.print=function(a){b.prototype.print.call(this,a),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(b,c,d){var e=c;a.WriteLine("  "+b)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(b,c,d){var e=c;a.WriteLine("  "+b)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(b,c,d){var e=c;a.WriteLine("  "+b)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(b,c,d){var e=c;a.WriteLine("  "+b)},null),this.parent&&this.parent.print(a)},c.prototype.find=function(a,b,c){var d=null,e=this.valueMembers==null?null:b?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:b?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return c&&(e=this.enclosedTypes==null?null:b?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:b?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),f&&(d=f.lookup(a))!=null?d:e&&(d=e.lookup(a))!=null?d:this.parent?this.parent.find(a,b,c):null},c.prototype.findAmbient=function(a,b,c){var d=null,e=this.ambientValueMembers==null?null:b?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return c&&(e=this.ambientEnclosedTypes==null?null:b?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),e&&(d=e.lookup(a))!=null?d:this.parent?this.parent.findAmbient(a,b,c):null},c.prototype.findLocal=function(a,b,c){var d=null,e=this.valueMembers==null?null:b?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:b?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return c&&(e=this.enclosedTypes==null?null:b?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:b?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),e&&(d=e.lookup(a))!=null&&d?d:f&&(d=f.lookup(a))!=null&&d?d:null},c.prototype.enter=function(b,c,d,e,f,g,h){var i=null;h?g?i=this.ambientEnclosedTypes==null?null:f?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.privateMembers:i=this.ambientValueMembers==null?null:f?this.ambientValueMembers.publicMembers:this.ambientValueMembers.privateMembers:g?i=this.enclosedTypes==null?null:f?this.enclosedTypes.publicMembers:this.enclosedTypes.privateMembers:i=this.valueMembers==null?null:f?this.valueMembers.publicMembers:this.valueMembers.privateMembers,i?i.add(d.name,d)||e.duplicateIdentifier(c,d.name):a.CompilerDiagnostics.Alert("YYYYY"),d.container=b},c.prototype.getTable=function(){return this.valueMembers.allMembers},c}(d);a.SymbolScopeBuilder=h;var i=function(a){function b(b,c,d){a.call(this,c),this.scope=b,this.filter=d}return __extends(b,a),b.prototype.print=function(a){this.scope.print(a)},b.prototype.find=function(a,b,c){return this.filter.reset(),this.scope.search(this.filter,a,b,c)},b.prototype.findLocal=function(a,b,c){return this.scope.findLocal(a,b,c)},b}(d);a.FilteredSymbolScope=i;var j=function(a){function b(b,c,d,e){a.call(this,b,null,null,null,c,d),this.filter=e}return __extends(b,a),b.prototype.findLocal=function(b,c,d){var e=a.prototype.findLocal.call(this,b,c,d);return e&&!this.filter(e)?null:e},b.prototype.search=function(a,b,c,d){throw new Error("please implement")},b.prototype.find=function(b,c,d){var e=a.prototype.findLocal.call(this,b,c,d);return e&&!this.filter(e)?null:a.prototype.find.call(this,b,c,d)},b}(h);a.FilteredSymbolScopeBuilder=j})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function f(b,c,d,f,g,h,i,j){b!==undefined&&(a.tokenTable[b]=new e(b,c,d,f,g,h,i,j),f!=a.NodeType.None&&(a.nodeTypeTable[f]=i,a.nodeTypeToTokTable[f]=b),h!=a.NodeType.None&&(a.nodeTypeTable[h]=i))}function g(b){return a.tokenTable[b]}function p(){for(var c=0;c<=b.LimFixed;c++)a.staticTokens[c]=new j(c)}(function(a){a._map=[],a._map[0]="ANY",a.ANY=0,a._map[1]="BOOL",a.BOOL=1,a._map[2]="BREAK",a.BREAK=2,a._map[3]="CASE",a.CASE=3,a._map[4]="CATCH",a.CATCH=4,a._map[5]="CLASS",a.CLASS=5,a._map[6]="CONST",a.CONST=6,a._map[7]="CONTINUE",a.CONTINUE=7,a._map[8]="DEBUGGER",a.DEBUGGER=8,a._map[9]="DEFAULT",a.DEFAULT=9,a._map[10]="DELETE",a.DELETE=10,a._map[11]="DO",a.DO=11,a._map[12]="ELSE",a.ELSE=12,a._map[13]="ENUM",a.ENUM=13,a._map[14]="EXPORT",a.EXPORT=14,a._map[15]="EXTENDS",a.EXTENDS=15,a._map[16]="DECLARE",a.DECLARE=16,a._map[17]="FALSE",a.FALSE=17,a._map[18]="FINALLY",a.FINALLY=18,a._map[19]="FOR",a.FOR=19,a._map[20]="FUNCTION",a.FUNCTION=20,a._map[21]="CONSTRUCTOR",a.CONSTRUCTOR=21,a._map[22]="GET",a.GET=22,a._map[23]="IF",a.IF=23,a._map[24]="IMPLEMENTS",a.IMPLEMENTS=24,a._map[25]="IMPORT",a.IMPORT=25,a._map[26]="IN",a.IN=26,a._map[27]="INSTANCEOF",a.INSTANCEOF=27,a._map[28]="INTERFACE",a.INTERFACE=28,a._map[29]="LET",a.LET=29,a._map[30]="MODULE",a.MODULE=30,a._map[31]="NEW",a.NEW=31,a._map[32]="NUMBER",a.NUMBER=32,a._map[33]="NULL",a.NULL=33,a._map[34]="PACKAGE",a.PACKAGE=34,a._map[35]="PRIVATE",a.PRIVATE=35,a._map[36]="PROTECTED",a.PROTECTED=36,a._map[37]="PUBLIC",a.PUBLIC=37,a._map[38]="RETURN",a.RETURN=38,a._map[39]="SET",a.SET=39,a._map[40]="STATIC",a.STATIC=40,a._map[41]="STRING",a.STRING=41,a._map[42]="SUPER",a.SUPER=42,a._map[43]="SWITCH",a.SWITCH=43,a._map[44]="THIS",a.THIS=44,a._map[45]="THROW",a.THROW=45,a._map[46]="TRUE",a.TRUE=46,a._map[47]="TRY",a.TRY=47,a._map[48]="TYPEOF",a.TYPEOF=48,a._map[49]="VAR",a.VAR=49,a._map[50]="VOID",a.VOID=50,a._map[51]="WITH",a.WITH=51,a._map[52]="WHILE",a.WHILE=52,a._map[53]="YIELD",a.YIELD=53,a._map[54]="SColon",a.SColon=54,a._map[55]="LParen",a.LParen=55,a._map[56]="RParen",a.RParen=56,a._map[57]="LBrack",a.LBrack=57,a._map[58]="RBrack",a.RBrack=58,a._map[59]="LCurly",a.LCurly=59,a._map[60]="RCurly",a.RCurly=60,a._map[61]="Comma",a.Comma=61,a._map[62]="Asg",a.Asg=62,a._map[63]="AsgAdd",a.AsgAdd=63,a._map[64]="AsgSub",a.AsgSub=64,a._map[65]="AsgMul",a.AsgMul=65,a._map[66]="AsgDiv",a.AsgDiv=66,a._map[67]="AsgMod",a.AsgMod=67,a._map[68]="AsgAnd",a.AsgAnd=68,a._map[69]="AsgXor",a.AsgXor=69,a._map[70]="AsgOr",a.AsgOr=70,a._map[71]="AsgLsh",a.AsgLsh=71,a._map[72]="AsgRsh",a.AsgRsh=72,a._map[73]="AsgRs2",a.AsgRs2=73,a._map[74]="QMark",a.QMark=74,a._map[75]="Colon",a.Colon=75,a._map[76]="LogOr",a.LogOr=76,a._map[77]="LogAnd",a.LogAnd=77,a._map[78]="Or",a.Or=78,a._map[79]="Xor",a.Xor=79,a._map[80]="And",a.And=80,a._map[81]="EQ",a.EQ=81,a._map[82]="NE",a.NE=82,a._map[83]="Eqv",a.Eqv=83,a._map[84]="NEqv",a.NEqv=84,a._map[85]="LT",a.LT=85,a._map[86]="LE",a.LE=86,a._map[87]="GT",a.GT=87,a._map[88]="GE",a.GE=88,a._map[89]="Lsh",a.Lsh=89,a._map[90]="Rsh",a.Rsh=90,a._map[91]="Rs2",a.Rs2=91,a._map[92]="Add",a.Add=92,a._map[93]="Sub",a.Sub=93,a._map[94]="Mult",a.Mult=94,a._map[95]="Div",a.Div=95,a._map[96]="Pct",a.Pct=96,a._map[97]="Tilde",a.Tilde=97,a._map[98]="Bang",a.Bang=98,a._map[99]="Inc",a.Inc=99,a._map[100]="Dec",a.Dec=100,a._map[101]="Dot",a.Dot=101,a._map[102]="Ellipsis",a.Ellipsis=102,a._map[103]="Error",a.Error=103,a._map[104]="EOF",a.EOF=104,a._map[105]="Arrow",a.Arrow=105,a._map[106]="ID",a.ID=106,a._map[107]="QString",a.QString=107,a._map[108]="Regex",a.Regex=108,a._map[109]="NumberLit",a.NumberLit=109,a._map[110]="Whitespace",a.Whitespace=110,a._map[111]="Comment",a.Comment=111,a._map[112]="Lim",a.Lim=112,a.LimFixed=a.Arrow,a.LimKeyword=a.YIELD})(a.TokenID||(a.TokenID={}));var b=a.TokenID;a.tokenTable=new Array,a.nodeTypeTable=new Array,a.nodeTypeToTokTable=new Array,a.noRegexTable=new Array,a.noRegexTable[b.ID]=!0,a.noRegexTable[b.QString]=!0,a.noRegexTable[b.NumberLit]=!0,a.noRegexTable[b.Regex]=!0,a.noRegexTable[b.THIS]=!0,a.noRegexTable[b.Inc]=!0,a.noRegexTable[b.Dec]=!0,a.noRegexTable[b.RParen]=!0,a.noRegexTable[b.RBrack]=!0,a.noRegexTable[b.RCurly]=!0,a.noRegexTable[b.TRUE]=!0,a.noRegexTable[b.FALSE]=!0,function(a){a._map=[],a._map[0]="No",a.No=0,a._map[1]="Cma",a.Cma=1,a._map[2]="Asg",a.Asg=2,a._map[3]="Que",a.Que=3,a._map[4]="Lor",a.Lor=4,a._map[5]="Lan",a.Lan=5,a._map[6]="Bor",a.Bor=6,a._map[7]="Xor",a.Xor=7,a._map[8]="Ban",a.Ban=8,a._map[9]="Equ",a.Equ=9,a._map[10]="Cmp",a.Cmp=10,a._map[11]="Shf",a.Shf=11,a._map[12]="Add",a.Add=12,a._map[13]="Mul",a.Mul=13,a._map[14]="Uni",a.Uni=14,a._map[15]="Lim",a.Lim=15}(a.OperatorPrecedence||(a.OperatorPrecedence={}));var c=a.OperatorPrecedence;(function(a){a._map=[],a.None=0,a.Javascript=1,a.JavascriptFuture=2,a.TypeScript=4,a.JavascriptFutureStrict=8,a.TypeScriptAndJS=a.Javascript|a.TypeScript,a.TypeScriptAndJSFuture=a.JavascriptFuture|a.TypeScript,a.TypeScriptAndJSFutureStrict=a.JavascriptFutureStrict|a.TypeScript})(a.Reservation||(a.Reservation={}));var d=a.Reservation,e=function(){function a(a,b,c,d,e,f,g,h){this.tokenId=a,this.reservation=b,this.binopPrecedence=c,this.binopNodeType=d,this.unopPrecedence=e,this.unopNodeType=f,this.text=g,this.ers=h}return a}();a.TokenInfo=e,f(b.ANY,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"any",a.ErrorRecoverySet.PrimType),f(b.BOOL,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"bool",a.ErrorRecoverySet.PrimType),f(b.BREAK,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"break",a.ErrorRecoverySet.Stmt),f(b.CASE,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"case",a.ErrorRecoverySet.SCase),f(b.CATCH,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"catch",a.ErrorRecoverySet.Catch),f(b.CLASS,d.TypeScriptAndJSFuture,c.No,a.NodeType.None,c.No,a.NodeType.None,"class",a.ErrorRecoverySet.TypeScriptS),f(b.CONST,d.TypeScriptAndJSFuture,c.No,a.NodeType.None,c.No,a.NodeType.None,"const",a.ErrorRecoverySet.Var),f(b.CONTINUE,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"continue",a.ErrorRecoverySet.Stmt),f(b.DEBUGGER,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.Debugger,"debugger",a.ErrorRecoverySet.Stmt),f(b.DEFAULT,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"default",a.ErrorRecoverySet.SCase),f(b.DELETE,d.TypeScriptAndJS,c.No,a.NodeType.None,c.Uni,a.NodeType.Delete,"delete",a.ErrorRecoverySet.Prefix),f(b.DO,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"do",a.ErrorRecoverySet.Stmt),f(b.ELSE,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"else",a.ErrorRecoverySet.Else),f(b.ENUM,d.TypeScriptAndJSFuture,c.No,a.NodeType.None,c.No,a.NodeType.None,"enum",a.ErrorRecoverySet.TypeScriptS),f(b.EXPORT,d.TypeScriptAndJSFuture,c.No,a.NodeType.None,c.No,a.NodeType.None,"export",a.ErrorRecoverySet.TypeScriptS),f(b.EXTENDS,d.TypeScriptAndJSFuture,c.No,a.NodeType.None,c.No,a.NodeType.None,"extends",a.ErrorRecoverySet.None),f(b.DECLARE,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"declare",a.ErrorRecoverySet.Stmt),f(b.FALSE,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"false",a.ErrorRecoverySet.RLit),f(b.FINALLY,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"finally",a.ErrorRecoverySet.Catch),f(b.FOR,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"for",a.ErrorRecoverySet.Stmt),f(b.FUNCTION,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"function",a.ErrorRecoverySet.Func),f(b.CONSTRUCTOR,d.TypeScriptAndJSFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"constructor",a.ErrorRecoverySet.Func),f(b.GET,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"get",a.ErrorRecoverySet.Func),f(b.SET,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"set",a.ErrorRecoverySet.Func),f(b.IF,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"if",a.ErrorRecoverySet.Stmt),f(b.IMPLEMENTS,d.TypeScriptAndJSFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"implements",a.ErrorRecoverySet.None),f(b.IMPORT,d.TypeScriptAndJSFuture,c.No,a.NodeType.None,c.No,a.NodeType.None,"import",a.ErrorRecoverySet.TypeScriptS),f(b.IN,d.TypeScriptAndJS,c.Cmp,a.NodeType.In,c.No,a.NodeType.None,"in",a.ErrorRecoverySet.None),f(b.INSTANCEOF,d.TypeScriptAndJS,c.Cmp,a.NodeType.InstOf,c.No,a.NodeType.None,"instanceof",a.ErrorRecoverySet.BinOp),f(b.INTERFACE,d.TypeScriptAndJSFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"interface",a.ErrorRecoverySet.TypeScriptS),f(b.LET,d.JavascriptFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"let",a.ErrorRecoverySet.None),f(b.MODULE,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"module",a.ErrorRecoverySet.TypeScriptS),f(b.NEW,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"new",a.ErrorRecoverySet.PreOp),f(b.NUMBER,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"number",a.ErrorRecoverySet.PrimType),f(b.NULL,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"null",a.ErrorRecoverySet.RLit),f(b.PACKAGE,d.JavascriptFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"package",a.ErrorRecoverySet.None),f(b.PRIVATE,d.TypeScriptAndJSFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"private",a.ErrorRecoverySet.TypeScriptS),f(b.PROTECTED,d.JavascriptFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"protected",a.ErrorRecoverySet.None),f(b.PUBLIC,d.TypeScriptAndJSFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"public",a.ErrorRecoverySet.TypeScriptS),f(b.RETURN,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"return",a.ErrorRecoverySet.Stmt),f(b.STATIC,d.TypeScriptAndJSFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"static",a.ErrorRecoverySet.None),f(b.STRING,d.TypeScript,c.No,a.NodeType.None,c.No,a.NodeType.None,"string",a.ErrorRecoverySet.PrimType),f(b.SUPER,d.TypeScriptAndJSFuture,c.No,a.NodeType.None,c.No,a.NodeType.None,"super",a.ErrorRecoverySet.RLit),f(b.SWITCH,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"switch",a.ErrorRecoverySet.Stmt),f(b.THIS,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"this",a.ErrorRecoverySet.RLit),f(b.THROW,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"throw",a.ErrorRecoverySet.Stmt),f(b.TRUE,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"true",a.ErrorRecoverySet.RLit),f(b.TRY,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"try",a.ErrorRecoverySet.Stmt),f(b.TYPEOF,d.TypeScriptAndJS,c.No,a.NodeType.None,c.Uni,a.NodeType.Typeof,"typeof",a.ErrorRecoverySet.Prefix),f(b.VAR,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"var",a.ErrorRecoverySet.Var),f(b.VOID,d.TypeScriptAndJS,c.No,a.NodeType.None,c.Uni,a.NodeType.Void,"void",a.ErrorRecoverySet.Prefix),f(b.WITH,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.With,"with",a.ErrorRecoverySet.Stmt),f(b.WHILE,d.TypeScriptAndJS,c.No,a.NodeType.None,c.No,a.NodeType.None,"while",a.ErrorRecoverySet.While),f(b.YIELD,d.JavascriptFutureStrict,c.No,a.NodeType.None,c.No,a.NodeType.None,"yield",a.ErrorRecoverySet.None),f(b.ID,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"identifier",a.ErrorRecoverySet.ID),f(b.NumberLit,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"numberLiteral",a.ErrorRecoverySet.Literal),f(b.Regex,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"regex",a.ErrorRecoverySet.RegExp),f(b.QString,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"qstring",a.ErrorRecoverySet.Literal),f(b.SColon,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,";",a.ErrorRecoverySet.SColon),f(b.RParen,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,")",a.ErrorRecoverySet.RParen),f(b.RBrack,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"]",a.ErrorRecoverySet.RBrack),f(b.LCurly,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"{",a.ErrorRecoverySet.LCurly),f(b.RCurly,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"}",a.ErrorRecoverySet.RCurly),f(b.Ellipsis,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"...",a.ErrorRecoverySet.None),f(b.Comma,d.None,c.Cma,a.NodeType.Comma,c.No,a.NodeType.None,",",a.ErrorRecoverySet.Comma),f(b.Asg,d.None,c.Asg,a.NodeType.Asg,c.No,a.NodeType.None,"=",a.ErrorRecoverySet.Asg),f(b.AsgAdd,d.None,c.Asg,a.NodeType.AsgAdd,c.No,a.NodeType.None,"+=",a.ErrorRecoverySet.BinOp),f(b.AsgSub,d.None,c.Asg,a.NodeType.AsgSub,c.No,a.NodeType.None,"-=",a.ErrorRecoverySet.BinOp),f(b.AsgMul,d.None,c.Asg,a.NodeType.AsgMul,c.No,a.NodeType.None,"*=",a.ErrorRecoverySet.BinOp),f(b.AsgDiv,d.None,c.Asg,a.NodeType.AsgDiv,c.No,a.NodeType.None,"/=",a.ErrorRecoverySet.BinOp),f(b.AsgMod,d.None,c.Asg,a.NodeType.AsgMod,c.No,a.NodeType.None,"%=",a.ErrorRecoverySet.BinOp
),f(b.AsgAnd,d.None,c.Asg,a.NodeType.AsgAnd,c.No,a.NodeType.None,"&=",a.ErrorRecoverySet.BinOp),f(b.AsgXor,d.None,c.Asg,a.NodeType.AsgXor,c.No,a.NodeType.None,"^=",a.ErrorRecoverySet.BinOp),f(b.AsgOr,d.None,c.Asg,a.NodeType.AsgOr,c.No,a.NodeType.None,"|=",a.ErrorRecoverySet.BinOp),f(b.AsgLsh,d.None,c.Asg,a.NodeType.AsgLsh,c.No,a.NodeType.None,"<<=",a.ErrorRecoverySet.BinOp),f(b.AsgRsh,d.None,c.Asg,a.NodeType.AsgRsh,c.No,a.NodeType.None,">>=",a.ErrorRecoverySet.BinOp),f(b.AsgRs2,d.None,c.Asg,a.NodeType.AsgRs2,c.No,a.NodeType.None,">>>=",a.ErrorRecoverySet.BinOp),f(b.QMark,d.None,c.Que,a.NodeType.QMark,c.No,a.NodeType.None,"?",a.ErrorRecoverySet.BinOp),f(b.Colon,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,":",a.ErrorRecoverySet.Colon),f(b.LogOr,d.None,c.Lor,a.NodeType.LogOr,c.No,a.NodeType.None,"||",a.ErrorRecoverySet.BinOp),f(b.LogAnd,d.None,c.Lan,a.NodeType.LogAnd,c.No,a.NodeType.None,"&&",a.ErrorRecoverySet.BinOp),f(b.Or,d.None,c.Bor,a.NodeType.Or,c.No,a.NodeType.None,"|",a.ErrorRecoverySet.BinOp),f(b.Xor,d.None,c.Xor,a.NodeType.Xor,c.No,a.NodeType.None,"^",a.ErrorRecoverySet.BinOp),f(b.And,d.None,c.Ban,a.NodeType.And,c.No,a.NodeType.None,"&",a.ErrorRecoverySet.BinOp),f(b.EQ,d.None,c.Equ,a.NodeType.Eq,c.No,a.NodeType.None,"==",a.ErrorRecoverySet.BinOp),f(b.NE,d.None,c.Equ,a.NodeType.Ne,c.No,a.NodeType.None,"!=",a.ErrorRecoverySet.BinOp),f(b.Eqv,d.None,c.Equ,a.NodeType.Eqv,c.No,a.NodeType.None,"===",a.ErrorRecoverySet.BinOp),f(b.NEqv,d.None,c.Equ,a.NodeType.NEqv,c.No,a.NodeType.None,"!==",a.ErrorRecoverySet.BinOp),f(b.LT,d.None,c.Cmp,a.NodeType.Lt,c.No,a.NodeType.None,"<",a.ErrorRecoverySet.BinOp),f(b.LE,d.None,c.Cmp,a.NodeType.Le,c.No,a.NodeType.None,"<=",a.ErrorRecoverySet.BinOp),f(b.GT,d.None,c.Cmp,a.NodeType.Gt,c.No,a.NodeType.None,">",a.ErrorRecoverySet.BinOp),f(b.GE,d.None,c.Cmp,a.NodeType.Ge,c.No,a.NodeType.None,">=",a.ErrorRecoverySet.BinOp),f(b.Lsh,d.None,c.Shf,a.NodeType.Lsh,c.No,a.NodeType.None,"<<",a.ErrorRecoverySet.BinOp),f(b.Rsh,d.None,c.Shf,a.NodeType.Rsh,c.No,a.NodeType.None,">>",a.ErrorRecoverySet.BinOp),f(b.Rs2,d.None,c.Shf,a.NodeType.Rs2,c.No,a.NodeType.None,">>>",a.ErrorRecoverySet.BinOp),f(b.Add,d.None,c.Add,a.NodeType.Add,c.Uni,a.NodeType.Pos,"+",a.ErrorRecoverySet.AddOp),f(b.Sub,d.None,c.Add,a.NodeType.Sub,c.Uni,a.NodeType.Neg,"-",a.ErrorRecoverySet.AddOp),f(b.Mult,d.None,c.Mul,a.NodeType.Mul,c.No,a.NodeType.None,"*",a.ErrorRecoverySet.BinOp),f(b.Div,d.None,c.Mul,a.NodeType.Div,c.No,a.NodeType.None,"/",a.ErrorRecoverySet.BinOp),f(b.Pct,d.None,c.Mul,a.NodeType.Mod,c.No,a.NodeType.None,"%",a.ErrorRecoverySet.BinOp),f(b.Tilde,d.None,c.No,a.NodeType.None,c.Uni,a.NodeType.Not,"~",a.ErrorRecoverySet.PreOp),f(b.Bang,d.None,c.No,a.NodeType.None,c.Uni,a.NodeType.LogNot,"!",a.ErrorRecoverySet.PreOp),f(b.Inc,d.None,c.No,a.NodeType.None,c.Uni,a.NodeType.IncPre,"++",a.ErrorRecoverySet.PreOp),f(b.Dec,d.None,c.No,a.NodeType.None,c.Uni,a.NodeType.DecPre,"--",a.ErrorRecoverySet.PreOp),f(b.LParen,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"(",a.ErrorRecoverySet.LParen),f(b.LBrack,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"[",a.ErrorRecoverySet.LBrack),f(b.Dot,d.None,c.Uni,a.NodeType.None,c.No,a.NodeType.None,".",a.ErrorRecoverySet.Dot),f(b.EOF,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"<EOF>",a.ErrorRecoverySet.EOF),f(b.Arrow,d.None,c.No,a.NodeType.None,c.No,a.NodeType.None,"=>",a.ErrorRecoverySet.None),a.lookupToken=g,function(a){a._map=[],a._map[0]="Punctuation",a.Punctuation=0,a._map[1]="Keyword",a.Keyword=1,a._map[2]="Operator",a.Operator=2,a._map[3]="Comment",a.Comment=3,a._map[4]="Whitespace",a.Whitespace=4,a._map[5]="Identifier",a.Identifier=5,a._map[6]="Literal",a.Literal=6}(a.TokenClass||(a.TokenClass={}));var h=a.TokenClass,i=function(){function a(a,b,c){this.tok=a,this.minChar=b,this.limChar=c}return a}();a.SavedToken=i;var j=function(){function c(a){this.tokenId=a}return c.prototype.toString=function(){return"token: "+this.tokenId+" "+this.getText()+" ("+b._map[this.tokenId]+")"},c.prototype.print=function(a,b){b.WriteLine(this.toString()+",on line"+a)},c.prototype.getText=function(){return a.tokenTable[this.tokenId].text},c.prototype.classification=function(){if(this.tokenId<=b.LimKeyword)return h.Keyword;var c=g(this.tokenId);if(c!=undefined)if(c.unopNodeType!=a.NodeType.None||c.binopNodeType!=a.NodeType.None)return h.Operator;return h.Punctuation},c}();a.Token=j;var k=function(a){function c(c){a.call(this,b.NumberLit),this.value=c}return __extends(c,a),c.prototype.getText=function(){return this.value.toString()},c.prototype.classification=function(){return h.Literal},c}(j);a.NumberToken=k;var l=function(a){function c(b,c){a.call(this,b),this.value=c,this.tokenId=b}return __extends(c,a),c.prototype.getText=function(){return this.value},c.prototype.classification=function(){return this.tokenId==b.ID?h.Identifier:h.Literal},c}(j);a.StringToken=l;var m=function(a){function b(b,c){a.call(this,b),this.value=c,this.tokenId=b}return __extends(b,a),b.prototype.getText=function(){return this.value},b.prototype.classification=function(){return h.Whitespace},b}(j);a.WhitespaceToken=m;var n=function(a){function b(b,c,d,e,f,g){a.call(this,b),this.value=c,this.isBlock=d,this.startPos=e,this.line=f,this.endsLine=g,this.tokenID=b}return __extends(b,a),b.prototype.getText=function(){return this.value},b.prototype.classification=function(){return h.Comment},b}(j);a.CommentToken=n;var o=function(a){function c(c){a.call(this,b.Regex),this.regex=c}return __extends(c,a),c.prototype.getText=function(){return this.regex.toString()},c.prototype.classification=function(){return h.Literal},c}(j);a.RegexToken=o,a.staticTokens=new Array,a.initializeStaticTokens=p})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function a(){this.arrayBase=null}return a.prototype.specialize=function(a,b){return this.arrayBase==null&&(this.arrayBase=a.specializeType(b.wildElm.type,this.arrayType.elementType,b,!0)),this.arrayBase},a}();a.ArrayCache=b;var c=function(){function b(){this.onlyCaptureFirstError=!1,this.flags=a.TypeRelationshipFlags.SuccessfulComparison,this.message=""}return b.prototype.addMessageToFront=function(a){this.onlyCaptureFirstError?this.setMessage(a):this.message=this.message?a+":\n\t"+this.message:a},b.prototype.setMessage=function(a){this.message=a},b}();a.TypeComparisonInfo=c,function(a){a._map=[],a._map[0]="Resident",a.Resident=0,a._map[1]="Transient",a.Transient=1}(a.TypeCheckCollectionMode||(a.TypeCheckCollectionMode={}));var d=a.TypeCheckCollectionMode,e=function(){function b(b){this.errorReporter=b,this.importedGlobalsTable=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),this.importedGlobalsTypeTable=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),this.globals=null,this.globalTypes=null,this.ambientGlobals=null,this.ambientGlobalTypes=null,this.residentGlobalValues=new a.StringHashTable,this.residentGlobalTypes=new a.StringHashTable,this.residentGlobalAmbientValues=new a.StringHashTable,this.residentGlobalAmbientTypes=new a.StringHashTable,this.residentTypeCheck=!0,this.mod=null,this.gloMod=null,this.wildElm=null,this.importedGlobals=new a.SymbolScopeBuilder(null,this.importedGlobalsTable,null,this.importedGlobalsTypeTable,null,null),this.dualGlobalValues=new a.DualStringHashTable(this.residentGlobalValues,new a.StringHashTable),this.dualGlobalTypes=new a.DualStringHashTable(this.residentGlobalTypes,new a.StringHashTable),this.dualAmbientGlobalValues=new a.DualStringHashTable(this.residentGlobalAmbientValues,new a.StringHashTable),this.dualAmbientGlobalTypes=new a.DualStringHashTable(this.residentGlobalAmbientTypes,new a.StringHashTable);var c=new a.ScopedMembers(new a.DualStringHashTable(this.dualGlobalValues,new a.StringHashTable)),e=new a.ScopedMembers(new a.DualStringHashTable(this.dualAmbientGlobalValues,new a.StringHashTable)),f=new a.ScopedMembers(new a.DualStringHashTable(this.dualGlobalTypes,new a.StringHashTable)),g=new a.ScopedMembers(new a.DualStringHashTable(this.dualAmbientGlobalTypes,new a.StringHashTable));this.globalScope=new a.SymbolScopeBuilder(c,e,f,g,this.importedGlobals,null),this.voidType=this.enterPrimitive(a.Primitive.Void,"void"),this.booleanType=this.enterPrimitive(a.Primitive.Boolean,"bool"),this.doubleType=this.enterPrimitive(a.Primitive.Double,"number"),this.importedGlobals.ambientEnclosedTypes.addPublicMember("number",this.doubleType.symbol),this.stringType=this.enterPrimitive(a.Primitive.String,"string"),this.anyType=this.enterPrimitive(a.Primitive.Any,"any"),this.nullType=this.enterPrimitive(a.Primitive.Null,"null"),this.undefinedType=this.enterPrimitive(a.Primitive.Undefined,"undefined"),this.setCollectionMode(d.Resident),this.wildElm=new a.TypeSymbol("_element",0,-1,new a.Type),this.importedGlobalsTypeTable.addPublicMember(this.wildElm.name,this.wildElm),this.mod=new a.ModuleType(f,g),this.mod.members=c,this.mod.ambientMembers=e,this.mod.containedScope=this.globalScope,this.gloMod=new a.TypeSymbol(a.globalId,0,-1,this.mod),this.mod.members.addPublicMember(this.gloMod.name,this.gloMod),this.defineGlobalValue("undefined",this.undefinedType)}return b.prototype.enterPrimitive=function(b,c){var d=new a.Type;d.primitiveTypeClass=b;var e=new a.TypeSymbol(c,0,-1,d);return e.typeCheckStatus=a.TypeCheckStatus.Finished,d.symbol=e,this.importedGlobals.enter(null,null,e,this.errorReporter,!0,!0,!0),d},b.prototype.setCollectionMode=function(a){this.residentTypeCheck=this.dualGlobalValues.insertPrimary=this.dualGlobalTypes.insertPrimary=this.dualAmbientGlobalValues.insertPrimary=this.dualAmbientGlobalTypes.insertPrimary=a==d.Resident},b.prototype.refreshPersistentState=function(){this.globals=new a.StringHashTable,this.globalTypes=new a.StringHashTable,this.ambientGlobals=new a.StringHashTable,this.ambientGlobalTypes=new a.StringHashTable,this.dualGlobalValues.secondaryTable=this.globals,this.dualGlobalTypes.secondaryTable=this.globalTypes,this.dualAmbientGlobalValues.secondaryTable=this.ambientGlobals,this.dualAmbientGlobalTypes.secondaryTable=this.ambientGlobalTypes},b.prototype.defineGlobalValue=function(b,c){var d=new a.ValueLocation;d.typeLink=new a.TypeLink;var e=new a.VariableSymbol(b,0,-1,d);e.setType(c),e.typeCheckStatus=a.TypeCheckStatus.Finished,e.container=this.gloMod,this.importedGlobalsTable.addPublicMember(b,e)},b}();a.PersistentGlobalTypeState=e;var f=function(){function a(a,b,c){this.contextualType=a,this.provisional=b,this.contextID=c,this.targetSig=null,this.targetThis=null,this.targetAccessorType=null}return a}();a.ContextualTypeContext=f;var g=function(){function b(a){this.checker=a,this.contextStack=[],this.hadProvisionalErrors=!1}return b.contextID=a.TypeCheckStatus.Finished+1,b.prototype.pushContextualType=function(a,c){this.contextStack.push(new f(a,c,b.contextID++)),this.checker.errorReporter.pushToErrorSink=c},b.prototype.popContextualType=function(){var a=this.contextStack.pop();return this.checker.errorReporter.pushToErrorSink=this.isProvisional(),this.hadProvisionalErrors=this.hadProvisionalErrors||a.provisional&&this.checker.errorReporter.getCapturedErrors().length,this.checker.errorReporter.freeCapturedErrors(),a},b.prototype.getContextualType=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1]:null},b.prototype.getContextID=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].contextID:a.TypeCheckStatus.Finished},b.prototype.isProvisional=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].provisional:!1},b}();a.ContextualTypingContextStack=g;var h=function(){function c(a){this.persistentState=a,this.errorReporter=null,this.checkControlFlow=!1,this.printControlFlowGraph=!1,this.checkControlFlowUseDef=!1,this.styleSettings=null,this.units=null,this.anon="_anonymous",this.locationInfo=null,this.typeFlow=null,this.currentCompareA=null,this.currentCompareB=null,this.currentModDecl=null,this.inBind=!1,this.inWith=!1,this.errorsOnWith=!0,this.currentContextualTypeContext=null,this.resolvingBases=!1,this.canCallDefinitionSignature=!1,this.assignableCache={},this.subtypeCache={},this.identicalCache={},this.provisionalStartedTypecheckObjects=[],this.voidType=this.persistentState.voidType,this.booleanType=this.persistentState.booleanType,this.numberType=this.persistentState.doubleType,this.stringType=this.persistentState.stringType,this.anyType=this.persistentState.anyType,this.nullType=this.persistentState.nullType,this.undefinedType=this.persistentState.undefinedType,this.globals=this.persistentState.dualGlobalValues,this.globalTypes=this.persistentState.dualGlobalTypes,this.ambientGlobals=this.persistentState.dualAmbientGlobalValues,this.ambientGlobalTypes=this.persistentState.dualAmbientGlobalTypes,this.gloModType=this.persistentState.mod,this.gloMod=this.persistentState.gloMod,this.wildElm=this.persistentState.wildElm,this.globalScope=this.persistentState.globalScope,this.typingContextStack=new g(this)}return c.prototype.setStyleOptions=function(a){this.styleSettings=a},c.prototype.setContextualType=function(a,b){this.typingContextStack.pushContextualType(a,b),this.currentContextualTypeContext=this.typingContextStack.getContextualType()},c.prototype.unsetContextualType=function(){var a=this.typingContextStack.popContextualType();return this.currentContextualTypeContext=this.typingContextStack.getContextualType(),a},c.prototype.hadProvisionalErrors=function(){return this.typingContextStack.hadProvisionalErrors},c.prototype.resetProvisionalErrors=function(){this.typingContextStack.getContextualType()||(this.typingContextStack.hadProvisionalErrors=!1)},c.prototype.typeCheckWithContextualType=function(a,b,c,d){c&&this.setContextualType(a,this.typingContextStack.isProvisional()||b),this.typeFlow.typeCheck(d),c&&this.unsetContextualType()},c.prototype.resetTargetType=function(){this.currentContextualTypeContext=this.typingContextStack.getContextualType()},c.prototype.killTargetType=function(){this.currentContextualTypeContext=null,this.errorReporter.pushToErrorSink=!1},c.prototype.hasTargetType=function(){return this.currentContextualTypeContext&&this.currentContextualTypeContext.contextualType},c.prototype.getTargetTypeContext=function(){return this.currentContextualTypeContext},c.prototype.inProvisionalTypecheckMode=function(){return this.typingContextStack.isProvisional()},c.prototype.getTypeCheckFinishedStatus=function(){return this.inProvisionalTypecheckMode()?this.typingContextStack.getContextID():a.TypeCheckStatus.Finished},c.prototype.typeStatusIsFinished=function(b){return b==a.TypeCheckStatus.Finished||this.inProvisionalTypecheckMode()&&b==this.typingContextStack.getContextID()},c.prototype.addStartedPTO=function(a){this.inProvisionalTypecheckMode()&&(this.provisionalStartedTypecheckObjects[this.provisionalStartedTypecheckObjects.length]=a)},c.prototype.cleanStartedPTO=function(){for(var b=0;b<this.provisionalStartedTypecheckObjects.length;b++)this.provisionalStartedTypecheckObjects[b].typeCheckStatus=a.TypeCheckStatus.NotStarted;this.provisionalStartedTypecheckObjects=[]},c.prototype.collectTypes=function(b){if(b.nodeType==a.NodeType.Script){var c=b;this.locationInfo=c.locationInfo}var d=new a.ScopeChain(this.gloMod,null,this.globalScope),e=new a.TypeCollectionContext(d,this);a.getAstWalkerFactory().walk(b,a.preCollectTypes,a.postCollectTypes,null,e)},c.prototype.makeArrayType=function(c){return c.arrayCache==null&&(c.arrayCache=new b,c.arrayCache.arrayType=new a.Type,c.arrayCache.arrayType.elementType=c,c.arrayCache.arrayType.symbol=c.symbol),c.arrayCache.arrayType},c.prototype.getParameterList=function(b,c){var d=null,e=null,f=b.members.length,g=0,h=[];if(f>0){d=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),e=new a.SymbolScopeBuilder(d,null,null,null,null,c);for(var i=0;i<f;i++){var j=b.members[i],k=new a.ValueLocation,l=new a.ParameterSymbol(j.id.text,j.minChar,this.locationInfo.unitIndex,k);l.declAST=j,j.id.sym=l,j.sym=l,k.symbol=l,k.typeLink=a.getTypeLink(j.typeExpr,this,!1),e.enter(null,j,l,this.errorReporter,!0,!1,!1),h[h.length]=l,j.isOptionalArg()||g++}}return{parameters:h,nonOptionalParameterCount:g}},c.prototype.createFunctionSignature=function(b,c,d,e,f){var g=a.hasFlag(b.fncFlags,a.FncFlags.Exported|a.FncFlags.ClassPropertyMethodExported)||c==this.gloMod,h=a.hasFlag(b.fncFlags,a.FncFlags.Static),i=a.hasFlag(b.fncFlags,a.FncFlags.Private),j=a.hasFlag(b.fncFlags,a.FncFlags.Definition),k=a.hasFlag(b.fncFlags,a.FncFlags.Ambient),l=b.isConstructMember()||b.isConstructor,m=c==this.gloMod,n=new a.Signature,o=b.fncFlags&a.FncFlags.IsFunctionExpression;b.returnTypeAnnotation||j?n.returnType=a.getTypeLink(b.returnTypeAnnotation,this,!1):(n.returnType=new a.TypeLink,n.returnType.type=this.anyType),n.hasVariableArgList=b.variableArgList;var p=this.getParameterList(b.args,c);n.parameters=p.parameters,n.nonOptionalParameterCount=p.nonOptionalParameterCount,b.signature=n,n.declAST=b;var q=e&&e.getType()&&!e.isAccessor()&&(b.isSignature()||k==a.hasFlag(e.flags,a.SymbolFlags.Ambient));q&&i!=a.hasFlag(e.flags,a.SymbolFlags.Private)&&this.errorReporter.simpleError(b,"Public/Private visibility of overloads does not agree");var r=q?e.getType():new a.Type;l?(r.construct==null&&(r.construct=new a.SignatureGroup),r.construct.addSignature(n),r.construct.hasImplementation=!b.isSignature(),r.construct.hasImplementation&&r.setHasImplementation()):b.isIndexerMember()?(r.index==null&&(r.index=new a.SignatureGroup,r.index.flags|=a.SignatureFlags.IsIndexer),r.index.addSignature(n),r.index.hasImplementation=!b.isSignature(),r.index.hasImplementation&&r.setHasImplementation()):(r.call==null&&(r.call=new a.SignatureGroup),r.call.addSignature(n),r.call.hasImplementation=!b.isSignature(),r.call.hasImplementation&&r.setHasImplementation());var s=r.instanceType;s&&!h&&(s.call==null?s.call=r.call:r.call&&s.call.signatures.concat(r.call.signatures));var t=null,u=!1;b.name&&!b.name.isMissing()?t=b.name.text:b.hint&&(t=b.hint,u=!0),r.symbol==null&&(r.symbol=new a.TypeSymbol(t?t:this.anon,b.minChar,this.locationInfo.unitIndex,r),q||(r.symbol.declAST=b)),h&&(r.symbol.flags|=a.SymbolFlags.Static),k&&(r.symbol.flags|=a.SymbolFlags.Ambient),i&&(r.symbol.flags|=a.SymbolFlags.Private),r.symbol.isMethod=b.isMethod(),r.symbol.isMethod&&(r.symbol.flags|=a.SymbolFlags.Property),b.type=r,l||(t&&!o&&!b.isAccessor()&&!u?f?b.isMethod()&&h?(c.type.members.publicMembers.add(t,r.symbol)||this.errorReporter.duplicateIdentifier(b,t),r.symbol.container=c):(e==null||e.declAST&&!e.declAST.isOverload&&c.isType())&&d.enter(c,b,r.symbol,this.errorReporter,!i&&(g||h||m),!1,k):b.isSpecialFn()||(r.symbol.container=c):b.isSpecialFn()||(r.symbol.container=c));if(q){var v=e?e.getType():null,w=r;if(w!=v){w.construct==null?v&&v.construct?w.construct=v.construct:w.construct=new a.SignatureGroup:v&&v.construct&&w.construct.signatures.concat(v.construct.signatures);if(v){w.call==null?w.call=v.call:v.call&&w.call.signatures.concat(v.call.signatures);if(!h){w.instanceType==null&&(w.instanceType=v.instanceType);var s=w.instanceType;s&&(s.call==null?s.call=v.call:v.call&&s.call.signatures.concat(v.call.signatures))}w.index==null?w.index=v.index:v.index&&w.index.signatures.concat(v.index.signatures)}}}return n},c.prototype.createAccessorSymbol=function(b,c,d,e,f,g,h){var i=null,j=b.signature,k=b.name.text,l=a.hasFlag(b.fncFlags,a.FncFlags.Static),m=a.hasFlag(b.fncFlags,a.FncFlags.Private);if(c==null){var n=new a.ValueLocation;i=new a.FieldSymbol(k,b.minChar,this.locationInfo.unitIndex,!1,n),n.symbol=i,i.declAST=b,a.hasFlag(b.fncFlags,a.FncFlags.GetAccessor)?(i.getter&&this.errorReporter.simpleError(b,"Redeclaration of property getter"),i.getter=j.declAST.type.symbol):(i.setter&&this.errorReporter.simpleError(b,"Redeclaration of property setter"),i.setter=j.declAST.type.symbol),n.typeLink=a.getTypeLink(null,this,!1),e?d?(d.members.publicMembers.add(k,i)||this.errorReporter.duplicateIdentifier(b,i.name),i.container=d.symbol):this.errorReporter.simpleError(b,"Accessor property may not be added in this context"):g.enter(h,b,i,this.errorReporter,!m||l,!1,!1),f&&(i.flags|=a.SymbolFlags.Property),l&&(i.flags|=a.SymbolFlags.Static),m?i.flags|=a.SymbolFlags.Private:i.flags|=a.SymbolFlags.Public}else i=c,m!=a.hasFlag(i.flags,a.SymbolFlags.Private)&&this.errorReporter.simpleError(b,"Getter and setter accessors do not agree in visibility"),a.hasFlag(b.fncFlags,a.FncFlags.GetAccessor)?(i.getter&&this.errorReporter.simpleError(b,"Redeclaration of property getter"),i.getter=b.type.symbol):(i.setter&&this.errorReporter.simpleError(b,"Redeclaration of property setter"),i.setter=b.type.symbol);return i},c.prototype.addBases=function(b,c,d){b.addParentScope(new a.SymbolTableScope(c.members,c.ambientMembers,c.getAllEnclosedTypes(),c.getAllAmbientEnclosedTypes(),c.symbol));var e=0,f;if(c.extendsList)for(var g=c.extendsList.length;e<g;e++){f=c.extendsList[e];if(d.baseId==f.typeID){this.errorReporter.reportErrorFromSym(f.symbol,"Type '"+d.base+"' is recursively referenced as a base class of itself"),f.symbol.flags|=a.SymbolFlags.RecursivelyReferenced;break}this.addBases(b,f,d)}},c.prototype.scopeOf=function(b){var c=new a.SymbolAggregateScope(b.symbol),d={base:b.symbol&&b.symbol.name?b.symbol.name:"{}",baseId:b.typeID};return this.addBases(c,b,d),c},c.prototype.lookupMemberType=function(a,b){var c=null;a.containedScope?c=a.containedScope.find(b,!1,!0):a.members&&(c=a.members.allMembers.lookup(b),c==null&&a.ambientMembers&&(c=a.ambientMembers.allMembers.lookup(b)));if(c==null){var d=a.getAllEnclosedTypes(),e=a.getAllAmbientEnclosedTypes();d&&(c=d.allMembers.lookup(b),c==null&&e&&(c=e.allMembers.lookup(b)))}return c&&c.isType()?c.getType():null},c.prototype.findSymbolForDynamicModule=function(b,c,d){var e=b,f=d(b);if(f==null){f||(b=a.swapQuotes(e),f=d(b)),f||(b=a.stripQuotes(e)+".ts",f=d(b)),f||(b=a.stripQuotes(e)+".str",f=d(b)),f||(b=a.stripQuotes(e)+".d.ts",f=d(b)),f||(b=a.stripQuotes(e)+".d.str",f=d(b));if(!f&&!a.isRelative(e)){b=e;var g=a.stripQuotes(b),h=a.getRootFilePath(a.switchToForwardSlashes(c));while(f==null&&h!=""&&h!="/")b=a.normalizePath(h+g+".ts"),f=d(b),f==null&&(b=a.changePathToSTR(b),f=d(b)),f==null&&(b=a.changePathToDTS(b),f=d(b)),f==null&&(b=a.changePathToDSTR(b),f=d(b)),f==null&&(h=a.normalizePath(h+".."),h=h&&h!="/"?h+"/":h)}}return f},c.prototype.resolveTypeMember=function(b,c){var d=c.operand1,e=c.operand2,f=this.anyType,g=this.anyType;if(d&&e&&e.nodeType==a.NodeType.Name){if(d.nodeType==a.NodeType.Dot)g=this.resolveTypeMember(b,d);else if(d.nodeType==a.NodeType.Name){var h=d,i=b.find(h.text,!1,!0);if(i==null)this.errorReporter.unresolvedSymbol(h,h.text);else if(i.isType()){var j=i;if(j.aliasLink&&!j.type&&j.aliasLink.alias.nodeType==a.NodeType.Name){var k=j.aliasLink.alias.text,l=this.findSymbolForDynamicModule(k,this.locationInfo.filename,function(a){return b.find(a,!1,!0)});l&&(j.type=l.getType())}if(a.optimizeModuleCodeGen&&i){var m=i.getType();if(m&&j.aliasLink&&j.onlyReferencedAsTypeRef){var n=m.symbol.declAST;n&&a.hasFlag(n.modFlags,a.ModuleFlags.IsDynamic)&&(j.onlyReferencedAsTypeRef=!this.resolvingBases)}}i.visible(b,this)||this.errorReporter.simpleError(d,"The symbol '"+h.text+"' is not visible at this point"),g=i.getType(),h.sym=i}else this.errorReporter.simpleError(d,"Expected type")}g||(g=this.anyType);if(g!=this.anyType){var o=e;f=this.lookupMemberType(g,o.text),f==null?(f=this.anyType,this.errorReporter.simpleError(c,"Expected type")):f.symbol.visible(b,this)||this.errorReporter.simpleError(d,"The symbol '"+e.text+"' is not visible at this point"),o.sym=f.symbol}}return f.isClass()&&(f=f.instanceType),f},c.prototype.resolveFuncDecl=function(a,b,c){var d=this.createFunctionSignature(a,b.container,b,c,!1).declAST.type.symbol,e;a.isConstructMember()?e=d.type.construct.signatures:a.isIndexerMember()?e=d.type.getInstanceType().index.signatures:e=d.type.call.signatures;var f=e[e.length-1],g=f.parameters.length;for(var h=0;h<g;h++){var i=f.parameters[h];this.resolveTypeLink(b,i.parameter.typeLink,!0)}return g&&a.variableArgList&&(f.parameters[g-1].parameter.typeLink.type.elementType||(this.errorReporter.simpleErrorFromSym(f.parameters[g-1].parameter.symbol,"... parameter must have array type"),f.parameters[g-1].parameter.typeLink.type.elementType=this.makeArrayType(f.parameters[g-1].parameter.typeLink.type))),this.resolveTypeLink(b,f.returnType,a.isSignature()),d},c.prototype.resolveVarDecl=function(b,c){var d=new a.ValueLocation,e=new a.FieldSymbol(b.id.text,b.minChar,this.locationInfo.unitIndex,(b.varFlags&a.VarFlags.Readonly)==a.VarFlags.None,d);return e.transferVarFlags(b.varFlags),d.symbol=e,e.declAST=b,d.typeLink=a.getTypeLink(b.typeExpr,this,b.init==null),this.resolveTypeLink(c,d.typeLink,!0),b.sym=e,b.type=d.typeLink.type,e},c.prototype.resolveTypeLink=function(b,c,d){var e=0;if(c.type==null){var f=c.ast;if(f)while(c.type==null)switch(f.nodeType){case a.NodeType.Name:var g=f,h=b.find(g.text,!1,!0);h==null?(c.type=this.anyType,this.errorReporter.unresolvedSymbol(g,g.text)):h.isType()?(h.visible(b,this)||this.errorReporter.simpleError(f,"The symbol '"+g.text+"' is not visible at this point"),g.sym=h,c.type=h.getType(),c.type?c.type.isClass()&&(c.type=c.type.instanceType):c.type=this.anyType):(c.type=this.anyType,this.errorReporter.simpleError(f,"Expected type"));break;case a.NodeType.Dot:c.type=this.resolveTypeMember(b,f);break;case a.NodeType.TypeRef:var i=f;e=i.arrayCount,f=i.term,f==null&&(c.type=this.anyType);break;case a.NodeType.Interface:var j=f,k=new a.Type,l=new a.TypeSymbol(j.name.text,f.minChar,this.locationInfo.unitIndex,k);k.symbol=l,k.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),k.containedScope=new a.SymbolTableScope(k.members,null,null,null,l),k.containedScope.container=l,k.memberScope=k.containedScope;var m=j.members,n=m.members,o=n.length;for(var p=0;p<o;p++){var q=n[p],r=null,s=!0,t=null;if(q.nodeType==a.NodeType.FuncDecl){var u=q;t=u.name,r=k.members.allMembers.lookup(u.getNameText()),s=r==null,u.isSpecialFn()?(s=!1,r=this.resolveFuncDecl(u,b,l)):r=this.resolveFuncDecl(u,b,r),u.type=r.type}else t=q.id,r=this.resolveVarDecl(q,b);s&&(t&&a.hasFlag(t.flags,a.ASTFlags.OptionalName)&&(r.flags|=a.SymbolFlags.Optional),k.members.allMembers.add(r.name,r)||this.errorReporter.duplicateIdentifier(f,r.name))}f.type=k,c.type=k;break;case a.NodeType.FuncDecl:var v=this.resolveFuncDecl(f,b,null);c.type=v.type;break;default:c.type=this.anyType,this.errorReporter.simpleError(f,"Expected type")}for(var w=e;w>0;w--)c.type=this.makeArrayType(c.type);d&&c.type==null&&(c.type=this.anyType),c.ast&&(c.ast.type=c.type)}},c.prototype.findMostApplicableSignature=function(a,b){if(a.length==1)return{sig:a[0].signature,ambiguous:!1};var c=a[0],d=null,e=null,f=null,g=null,h=!1;for(var i=1;i<a.length;i++){d=a[i];var j=0;for(j=0;b&&j<b.members.length;j++){e=b.members[j].type,f=j<c.signature.parameters.length?c.signature.parameters[j].getType():c.signature.parameters[c.signature.parameters.length-1].getType().elementType,g=j<d.signature.parameters.length?d.signature.parameters[j].getType():d.signature.parameters[d.signature.parameters.length-1].getType().elementType;if(this.typesAreIdentical(f,g))continue;if(this.typesAreIdentical(e,f))break;if(this.typesAreIdentical(e,g)){c=d;break}if(this.sourceIsSubtypeOfTarget(f,g))break;if(this.sourceIsSubtypeOfTarget(g,f)){c=d;break}if(d.hadProvisionalErrors)break;if(c.hadProvisionalErrors){c=d;break}}if(!b||j==b.members.length){var k={getLength:function(){return 2},setTypeAtIndex:function(a,b){},getTypeAtIndex:function(a){return a?d.signature.returnType.type:c.signature.returnType.type}},l=this.findBestCommonType(c.signature.returnType.type,null,k);h=!l}else h=!1}return{sig:c.signature,ambiguous:h}},c.prototype.getApplicableSignatures=function(b,c,d){var e=[],f=null,g=!1,h=null,i=!1;for(var j=0;j<b.length;j++){g=!1;for(var k=0;k<c.members.length;k++){if(k>=b[j].parameters.length)continue;f=b[j].parameters[k].getType(),b[j].declAST.variableArgList&&k>=b[j].nonOptionalParameterCount-1&&f.isArray()&&(f=f.elementType);if(f==this.anyType)continue;if(c.members[k].nodeType==a.NodeType.FuncDecl){if(this.typeFlow.functionInterfaceType&&f==this.typeFlow.functionInterfaceType)continue;if(!this.canContextuallyTypeFunction(f,c.members[k],!0)){if(!this.canContextuallyTypeFunction(f,c.members[k],!1))break;this.typeFlow.typeCheck(c.members[k]);if(!this.sourceIsAssignableToTarget(c.members[k].type,f,d))break}else{this.typeCheckWithContextualType(f,!0,!0,c.members[k]),this.cleanStartedPTO(),i=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(c.members[k].type,f,d)||(d&&d.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(k+1)+", which is of type '"+c.members[k].type.getTypeName()+"'"),g=!0),i&&(h=this.currentContextualTypeContext,this.typeCheckWithContextualType(null,!0,!0,c.members[k]),this.sourceIsAssignableToTarget(c.members[k].type,f)||(g=!0),this.cleanStartedPTO()),this.resetProvisionalErrors();if(g)break}}else if(c.members[k].nodeType==a.NodeType.ObjectLit){if(this.typeFlow.objectInterfaceType&&f==this.typeFlow.objectInterfaceType)continue;this.typeCheckWithContextualType(f,!0,!0,c.members[k]),this.cleanStartedPTO(),i=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(c.members[k].type,f,d)||(d&&d.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(k+1)+", which is of type '"+c.members[k].type.getTypeName()+"'"),g=!0),i&&(this.typeCheckWithContextualType(null,!0,!0,c.members[k]),this.sourceIsAssignableToTarget(c.members[k].type,f)||(g=!0),this.cleanStartedPTO()),this.resetProvisionalErrors();if(g)break}else if(c.members[k].nodeType==a.NodeType.ArrayLit){if(this.typeFlow.arrayInterfaceType&&f==this.typeFlow.arrayInterfaceType)continue;this.typeCheckWithContextualType(f,!0,!0,c.members[k]),this.cleanStartedPTO(),i=this.hadProvisionalErrors();if(!this.sourceIsAssignableToTarget(c.members[k].type,f,d)){d&&d.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(k+1)+", which is of type '"+c.members[k].type.getTypeName()+"'");break}i&&(this.typeCheckWithContextualType(null,!0,!0,c.members[k]),this.sourceIsAssignableToTarget(c.members[k].type,f)||(g=!0),this.cleanStartedPTO()),this.resetProvisionalErrors();if(g)break}}k==c.members.length&&(e[e.length]={signature:b[j],hadProvisionalErrors:i}),i=!1}return e},c.prototype.canContextuallyTypeFunction=function(a,b,c){if(b.isParenthesized||b.isMethod()||c&&b.returnTypeAnnotation||b.isInlineCallLiteral)return!1;c=c||this.typeFlow.functionInterfaceType==a;if(!c)return!0;b.signature||(this.createFunctionSignature(b,this.typeFlow.scope.container,this.typeFlow.scope,null,null),this.typeFlow.typeCheck(b));var d=b.signature,e=d.parameters.length;for(var f=0;f<e;f++){var g=d.parameters[f],h=g,i=h.declAST;if(c&&i.typeExpr)return!1}if(a.construct&&a.call)return!1;var j=a.construct?a.construct:a.call;return!j||j.signatures.length>1?!1:!0},c.prototype.canContextuallyTypeObjectLiteral=function(b,c){if(b==this.typeFlow.objectInterfaceType)return!0;var d=c.operand;if(!d||!b.memberScope)return!1;var e=null,f=null,g="",h={};for(var i=0;i<d.members.length;i++){e=d.members[i].operand1;if(e.nodeType==a.NodeType.Name)g=e.text;else{if(e.nodeType!=a.NodeType.QString)return!1;var j=e.text;g=j.substring(1,j.length-1)}f=b.memberScope.find(g,!0,!1);if(!f)return!1;h[g]=!0}var k=b.memberScope.getAllValueSymbolNames(!0);for(var i=0;i<k.length;i++){var l=k[i],m=b.memberScope.find(l,!0,!1);if(!h[k[i]]&&!a.hasFlag(m.flags,a.SymbolFlags.Optional))return!1}return!0},c.prototype.widenType=function(a){return a==this.undefinedType||a==this.nullType?this.anyType:a},c.prototype.isNullOrUndefinedType=function(a){return a==this.undefinedType||a==this.nullType},c.prototype.findBestCommonType=function(a,b,c,d){var e=0,f=c.getLength(),g=0,h=a;b&&(h=h?h.mergeOrdered(b,this):b);var i=h;while(g<f){for(e=0;e<f;e++){if(e==g)continue;i&&(h=i.mergeOrdered(c.getTypeAtIndex(e),this,d))&&(i=h);if(h==this.anyType||h==null)break;b&&c.setTypeAtIndex(e,b)}if(i&&h)break;g++,g<f&&(i=c.getTypeAtIndex(g))}return h},c.prototype.typesAreIdentical=function(b,c){if(b==c)return!0;if(!b||!c)return!1;var d=c.typeID<<16|b.typeID;if(this.identicalCache[d])return!0;if(b.typeFlags&a.TypeFlags.IsEnum||c.typeFlags&a.TypeFlags.IsEnum)return!1;if(b.isArray()||c.isArray()){if(!b.isArray()||!c.isArray())return!1;this.identicalCache[d]=!1;var e=this.typesAreIdentical(b.elementType,c.elementType);return e?this.subtypeCache[d]=!0:this.subtypeCache[d]=undefined,e}if(b.primitiveTypeClass!=c.primitiveTypeClass)return!1;this.identicalCache[d]=!1;if(b.memberScope&&
c.memberScope){var f=b.memberScope.getAllValueSymbolNames(!0).sort(),g=c.memberScope.getAllValueSymbolNames(!0).sort();if(f.length!=g.length)return this.identicalCache[d]=undefined,!1;var h=null,i=null,j=null,k=null;for(var l=0;l<f.length;l++){if(f[l]!=g[l])return this.identicalCache[d]=undefined,!1;h=b.memberScope.find(f[l],!1,!1),i=c.memberScope.find(g[l],!1,!1);if((h.flags&a.SymbolFlags.Optional)!=(i.flags&a.SymbolFlags.Optional))return this.identicalCache[d]=undefined,!1;j=h.getType(),k=i.getType();if(j&&k&&this.identicalCache[k.typeID<<16|j.typeID]!=undefined)continue;if(!this.typesAreIdentical(j,k))return this.identicalCache[d]=undefined,!1}}else if(b.memberScope||c.memberScope)return this.identicalCache[d]=undefined,!1;return this.signatureGroupsAreIdentical(b.call,c.call)?this.signatureGroupsAreIdentical(b.construct,c.construct)?this.signatureGroupsAreIdentical(b.index,c.index)?(this.identicalCache[d]=!0,!0):(this.identicalCache[d]=undefined,!1):(this.identicalCache[d]=undefined,!1):(this.identicalCache[d]=undefined,!1)},c.prototype.signatureGroupsAreIdentical=function(a,b){if(a==b)return!0;if(!a||!b)return!1;if(a.signatures.length!=b.signatures.length)return!1;var c=null,d=null,e=!1;for(var f=0;f<a.signatures.length;f++){c=a.signatures[f];for(var g=0;g<b.signatures.length;g++){d=b.signatures[g];if(this.signaturesAreIdentical(c,d)){e=!0;break}}if(e){e=!1;continue}return!1}return!0},c.prototype.signaturesAreIdentical=function(a,b){if(a.hasVariableArgList!=b.hasVariableArgList)return!1;if(a.nonOptionalParameterCount!=b.nonOptionalParameterCount)return!1;if(a.parameters.length!=b.parameters.length)return!1;if(!this.typesAreIdentical(a.returnType.type,b.returnType.type))return!1;for(var c=0;c<a.parameters.length;c++)if(!this.typesAreIdentical(a.parameters[c].parameter.typeLink.type,b.parameters[c].parameter.typeLink.type))return!1;return!0},c.prototype.sourceIsSubtypeOfTarget=function(a,b,c){return this.sourceIsRelatableToTarget(a,b,!1,this.subtypeCache,c)},c.prototype.signatureGroupIsSubtypeOfTarget=function(a,b,c){return this.signatureGroupIsRelatableToTarget(a,b,!1,this.subtypeCache,c)},c.prototype.signatureIsSubtypeOfTarget=function(a,b,c){return this.signatureIsRelatableToTarget(a,b,!1,this.subtypeCache,c)},c.prototype.sourceIsAssignableToTarget=function(a,b,c){return this.sourceIsRelatableToTarget(a,b,!0,this.assignableCache,c)},c.prototype.signatureGroupIsAssignableToTarget=function(a,b,c){return this.signatureGroupIsRelatableToTarget(a,b,!0,this.assignableCache,c)},c.prototype.signatureIsAssignableToTarget=function(a,b,c){return this.signatureIsRelatableToTarget(a,b,!0,this.assignableCache,c)},c.prototype.sourceIsRelatableToTarget=function(b,c,d,e,f){if(b==c)return!0;if(!b||!c)return!0;var g=b.typeID<<16|c.typeID;if(e[g])return!0;if(d){if(b==this.anyType||c==this.anyType)return!0}else if(c==this.anyType)return!0;if(b==this.undefinedType)return!0;if(b==this.nullType&&c!=this.undefinedType&&c!=this.voidType)return!0;if(c==this.numberType&&b.typeFlags&a.TypeFlags.IsEnum)return!0;if(b==this.numberType&&c.typeFlags&a.TypeFlags.IsEnum)return!0;if(b.typeFlags&a.TypeFlags.IsEnum||c.typeFlags&a.TypeFlags.IsEnum)return!1;if(b.isArray()||c.isArray()){if(!b.isArray()||!c.isArray())return!1;e[g]=!1;var h=this.sourceIsRelatableToTarget(b.elementType,c.elementType,d,e,f);return h?e[g]=!0:e[g]=undefined,h}if(b.primitiveTypeClass!=c.primitiveTypeClass){if(c.primitiveTypeClass!=a.Primitive.None)return!1;if(b==this.numberType&&this.typeFlow.numberInterfaceType)b=this.typeFlow.numberInterfaceType;else if(b==this.stringType&&this.typeFlow.stringInterfaceType)b=this.typeFlow.stringInterfaceType;else{if(b!=this.booleanType||!this.typeFlow.booleanInterfaceType)return!1;b=this.typeFlow.booleanInterfaceType}}e[g]=!1;if(b.hasBase(c))return e[g]=!0,!0;if(this.typeFlow.objectInterfaceType&&c==this.typeFlow.objectInterfaceType)return!0;if(this.typeFlow.functionInterfaceType&&(b.call||b.construct)&&c==this.typeFlow.functionInterfaceType)return!0;if(c.isClass()||c.isClassInstance())return e[g]=undefined,!1;if(c.memberScope&&b.memberScope){var i=c.memberScope.getAllValueSymbolNames(!0),j=null,k=null,l=null,m=null,n=null;for(var o=0;o<i.length;o++){j=c.memberScope.find(i[o],!1,!1),k=b.memberScope.find(i[o],!1,!1);if(j.kind()==a.SymbolKind.Variable&&j.variable.typeLink.ast&&j.variable.typeLink.ast.nodeType==a.NodeType.Name&&j.variable.typeLink.ast.text=="IArguments")continue;j.isInferenceSymbol()&&(n=j,n.typeCheckStatus==a.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(j.declAST)),l=j.getType();if(!k){this.typeFlow.objectInterfaceType&&(k=this.typeFlow.objectInterfaceType.memberScope.find(i[o],!1,!1));if(!k){this.typeFlow.functionInterfaceType&&(l.call||l.construct)&&(k=this.typeFlow.functionInterfaceType.memberScope.find(i[o],!1,!1));if(!k){if(!(j.flags&a.SymbolFlags.Optional))return e[g]=undefined,f&&(f.flags|=a.TypeRelationshipFlags.RequiredPropertyIsMissing,f.addMessageToFront("Type '"+b.getTypeName()+"' is missing property '"+i[o]+"' from type '"+c.getTypeName()+"'")),!1;continue}}}k.isInferenceSymbol()&&(n=k,n.typeCheckStatus==a.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(k.declAST)),m=k.getType();if(l&&m&&e[m.typeID<<16|l.typeID]!=undefined)continue;if(!this.sourceIsRelatableToTarget(m,l,d,e,f))return e[g]=undefined,f&&(f.flags|=a.TypeRelationshipFlags.IncompatiblePropertyTypes,f.addMessageToFront("Types of property '"+j.name+"' of types '"+b.getTypeName()+"' and '"+c.getTypeName()+"' are incompatible")),!1}}if(b.call||c.call)if(!this.signatureGroupIsRelatableToTarget(b.call,c.call,d,e,f)){if(f){if(b.call&&c.call)f.addMessageToFront("Call signatures of types '"+b.getTypeName()+"' and '"+c.getTypeName()+"' are incompatible");else{var p=c.call?c.getTypeName():b.getTypeName(),q=c.call?b.getTypeName():c.getTypeName();f.setMessage("Type '"+p+"' requires a call signature, but Type '"+q+"' lacks one")}f.flags|=a.TypeRelationshipFlags.IncompatibleSignatures}return e[g]=undefined,!1}if(b.construct||c.construct)if(!this.signatureGroupIsRelatableToTarget(b.construct,c.construct,d,e,f)){if(f){if(b.construct&&c.construct)f.addMessageToFront("Construct signatures of types '"+b.getTypeName()+"' and '"+c.getTypeName()+"' are incompatible");else{var p=c.construct?c.getTypeName():b.getTypeName(),q=c.construct?b.getTypeName():c.getTypeName();f.setMessage("Type '"+p+"' requires a construct signature, but Type '"+q+"' lacks one")}f.flags|=a.TypeRelationshipFlags.IncompatibleSignatures}return e[g]=undefined,!1}if(c.index){var r=!c.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:c.index,s=!b.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:b.index;if(!this.signatureGroupIsRelatableToTarget(s,r,d,e,f))return f&&(f.addMessageToFront("Index signatures of types '"+b.getTypeName()+"' and '"+c.getTypeName()+"' are incompatible"),f.flags|=a.TypeRelationshipFlags.IncompatibleSignatures),e[g]=undefined,!1}return e[g]=!0,!0},c.prototype.signatureGroupIsRelatableToTarget=function(a,b,c,d,e){if(a==b)return!0;if(!a||!b)return!1;var f=null,g=null,h=!1;for(var i=0;i<b.signatures.length;i++){f=b.signatures[i];for(var j=0;j<a.signatures.length;j++){g=a.signatures[j];if(this.signatureIsRelatableToTarget(g,f,c,d,e)){h=!0;break}}if(h){h=!1;continue}return!1}return!0},c.prototype.signatureIsRelatableToTarget=function(b,c,d,e,f){if(!b.parameters||!c.parameters)return!1;var g=c.hasVariableArgList?c.nonOptionalParameterCount-1:c.nonOptionalParameterCount,h=b.hasVariableArgList?b.nonOptionalParameterCount-1:b.nonOptionalParameterCount;if(h>g&&!c.hasVariableArgList)return f&&(f.flags|=a.TypeRelationshipFlags.SourceSignatureHasTooManyParameters,f.addMessageToFront("Call signature expects "+g+" or fewer parameters")),!1;var i=b.returnType.type,j=c.returnType.type;if(j!=this.voidType&&!this.sourceIsRelatableToTarget(i,j,d,e,f))return f&&(f.flags|=a.TypeRelationshipFlags.IncompatibleReturnTypes),!1;var k=h<g&&b.hasVariableArgList?g:h,l=null,m=null,n="",o="";for(var p=0,q=0;p<k;p++,q++){!b.hasVariableArgList||p<h?(l=b.parameters[p].parameter.typeLink.type,n=b.parameters[p].parameter.symbol.name):p==h&&(l=b.parameters[p].parameter.typeLink.type,l.elementType&&(l=l.elementType),n=b.parameters[p].parameter.symbol.name),q<c.parameters.length&&q<g?(m=c.parameters[q].parameter.typeLink.type,o=c.parameters[q].parameter.symbol.name):c.hasVariableArgList&&q==g&&(m=c.parameters[q].parameter.typeLink.type,m.elementType&&(m=m.elementType),o=c.parameters[q].parameter.symbol.name);if(!this.sourceIsRelatableToTarget(l,m,d,e,f)&&!this.sourceIsRelatableToTarget(m,l,d,e,f))return f&&(f.flags|=a.TypeRelationshipFlags.IncompatibleParameterTypes),!1}return!0},c}();a.TypeChecker=h})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function c(b,c){if(b){var d=b.members.length;c==null&&(c=new Array);for(var e=0;e<d;e++){var f=b.members[e],g=f;g.nodeType==a.NodeType.Call&&(g=g.target);var h=new a.TypeLink;h.ast=g,c[c.length]=h}}return c}function d(a,b){a.extendsTypeLinks=c(b.extendsList,a.extendsTypeLinks),a.implementsTypeLinks=c(b.implementsList,a.implementsTypeLinks)}function e(b,c,d){var e=new a.ValueLocation;e.typeLink=new a.TypeLink,e.typeLink.ast=c,e.typeLink.type=b.instanceType;var f=new a.FieldSymbol("prototype",c.minChar,d.checker.locationInfo.unitIndex,!0,e);f.flags|=a.SymbolFlags.Property|a.SymbolFlags.BuiltIn,e.symbol=f,f.declAST=c,b.members.addPublicMember("prototype",f)}function f(b){var c=new a.Signature;c.returnType=new a.TypeLink,c.returnType.type=b.instanceType,c.parameters=[],b.construct=new a.SignatureGroup,b.construct.addSignature(c)}function g(b,c){b.construct=new a.SignatureGroup;var d=null;c.construct||f(c);for(var e=0;e<c.construct.signatures.length;e++)d=new a.Signature,d.parameters=c.construct.signatures[e].parameters,d.nonOptionalParameterCount=c.construct.signatures[e].nonOptionalParameterCount,d.typeCheckStatus=c.construct.signatures[e].typeCheckStatus,d.declAST=c.construct.signatures[e].declAST,d.returnType=new a.TypeLink,d.returnType.type=b.instanceType,b.construct.addSignature(d)}function h(a,b){var c=b.scope.find(a,!1,!0);return c==null&&b.previous&&(c=h(a,b.previous)),c}function i(b,c){var d=null;switch(b.nodeType){case a.NodeType.Name:var e=b.text,f=a.isQuoted(e),g=function(a){return c.members?c.members.lookup(e):h(e,c.topLevelScope)};f?d=c.tcContext.checker.findSymbolForDynamicModule(e,c.tcContext.script.locationInfo.filename,g):d=g(e);break;case a.NodeType.Dot:var j=b,k=i(j.operand1,c);k&&k.getType()&&(d=i(j.operand2,c));break;default:}if(d){var l=d.getType();if(l){var m=l.members;m&&(c.members=m.publicMembers)}else c.tcContext.checker.errorReporter.simpleError(b,"Potentially circular alias reference - could not obtain type of alias")}return d}function j(b,c,d){var e=d.scopeChain,f=null,g=null,h=b,j=a.hasFlag(h.varFlags,a.VarFlags.Exported),k=i(h.alias,{topLevelScope:e,members:null,tcContext:d}),l=d.scopeChain.container==d.checker.gloMod;if(k){var m=k.getType();m&&(g=m)}return f=new a.TypeSymbol(h.id.text,h.minChar,d.checker.locationInfo.unitIndex,g),f.aliasLink=h,d.scopeChain.moduleDecl&&(f.declModule=d.scopeChain.moduleDecl),f.declAST=h,h.id.sym=f,e.scope.enter(e.container,b,f,d.checker.errorReporter,j||l,!0,!1),e.scope.enter(e.container,b,f,d.checker.errorReporter,j||l,!1,!1),!0}function k(b,c,d){var e=d.scopeChain,f=b,g=a.hasFlag(f.modFlags,a.ModuleFlags.Ambient),h=a.hasFlag(f.modFlags,a.ModuleFlags.IsEnum),i=d.scopeChain.container==d.checker.gloMod,j=a.hasFlag(f.modFlags,a.ModuleFlags.Exported),k=f.name.text,l=a.isQuoted(k),m=e.scope.findLocal(k,!1,!1),n=null,o=null;if(m==null||m.kind()!=a.SymbolKind.Type){if(o==null){var p=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),q=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable));o=new a.ModuleType(p,q),h&&(o.typeFlags|=a.TypeFlags.IsEnum),o.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),o.ambientMembers=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),o.setHasImplementation()}n=new a.TypeSymbol(k,f.minChar,d.checker.locationInfo.unitIndex,o),d.scopeChain.moduleDecl&&(n.declModule=d.scopeChain.moduleDecl),n.declAST=f,n.prettyName=f.prettyName,e.scope.enter(e.container,b,n,d.checker.errorReporter,j||i,!0,g),e.scope.enter(e.container,b,n,d.checker.errorReporter,j||i,!1,g),o.symbol=n}else{m&&m.declAST&&m.declAST.nodeType!=a.NodeType.Module&&d.checker.errorReporter.simpleError(f,"Conflicting symbol name for module '"+k+"'"),n=m;var r=n.type.getAllEnclosedTypes().publicMembers,s=r==null?new a.StringHashTable:r,p=new a.ScopedMembers(new a.DualStringHashTable(s,new a.StringHashTable)),t=n.type.getAllAmbientEnclosedTypes().publicMembers,u=t==null?new a.StringHashTable:t,q=new a.ScopedMembers(new a.DualStringHashTable(u,new a.StringHashTable)),v=n.type.members.publicMembers,w=v==null?new a.StringHashTable:v,x=new a.ScopedMembers(new a.DualStringHashTable(w,new a.StringHashTable)),y=n.type.ambientMembers.publicMembers,z=y==null?new a.StringHashTable:y,A=new a.ScopedMembers(new a.DualStringHashTable(z,new a.StringHashTable));o=new a.ModuleType(p,q),h&&(o.typeFlags|=a.TypeFlags.IsEnum),o.members=x,o.ambientMembers=A,o.setHasImplementation(),o.symbol=n,n.addLocation(f.minChar),n.expansions.push(o)}d.scopeChain.moduleDecl&&d.scopeChain.moduleDecl.recordNonInterface(),j&&(n.flags|=a.SymbolFlags.Exported);if(d.scopeChain.moduleDecl||d.scopeChain.container==d.checker.gloMod)n.flags|=a.SymbolFlags.ModuleMember;return f.mod=o,a.pushTypeCollectionScope(n,o.members,o.ambientMembers,o.enclosedTypes,o.ambientEnclosedTypes,d,null,null,f),!0}function l(b,c,g){var h=g.scopeChain,i=b,j,k,l=null,m=i.name.text,n=!1,o=a.hasFlag(i.varFlags,a.VarFlags.Ambient),p=a.hasFlag(i.varFlags,a.VarFlags.Exported),q=g.scopeChain.container==g.checker.gloMod,r=h.container,s=!1;l=h.scope.findLocal(m,!1,!0);if(!l){var t=h.scope.findLocal(m,!1,!1);t&&t.isType()&&t.declAST&&t.declAST.nodeType==a.NodeType.FuncDecl&&t.declAST.isSignature()&&(l=t,s=!0,p&&(l.flags|=a.SymbolFlags.Exported),o&&(l.flags|=a.SymbolFlags.Ambient),g.scopeChain.scope.enter(g.scopeChain.container,b,l,g.checker.errorReporter,p||q,!0,o))}l&&!s&&l.declAST!=i&&!l.declAST.isOverload&&(l=null);if(l==null){var u=h.scope.findLocal(m,!1,!1);j=new a.Type,j.setHasImplementation(),k=new a.Type,k.setHasImplementation(),j.instanceType=k,j.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),j.ambientMembers=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),e(j,i,g),k.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),k.ambientMembers=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),l=new a.TypeSymbol(m,i.minChar,g.checker.locationInfo.unitIndex,j),l.declAST=i,l.instanceType=k,j.symbol=l,k.symbol=l,g.scopeChain.moduleDecl&&(g.scopeChain.moduleDecl.recordNonInterface(),l.declModule=g.scopeChain.moduleDecl,l.flags|=a.SymbolFlags.ModuleMember),p&&(l.flags|=a.SymbolFlags.Exported),o&&(l.flags|=a.SymbolFlags.Ambient),b.type=j,g.scopeChain.scope.enter(g.scopeChain.container,b,l,g.checker.errorReporter,p||q,!0,o),u==null&&g.scopeChain.scope.enter(g.scopeChain.container,b,l,g.checker.errorReporter,p||q,!1,o)}else j=l.type,j.instanceType==null&&(j.instanceType=new a.Type,j.instanceType.setHasImplementation(),j.instanceType.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),j.instanceType.symbol=j.symbol,j.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),j.ambientMembers=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable))),k=j.instanceType,b.type=j;return i.constructorDecl||(l&&l.declAST&&l.declAST.type&&l.declAST.type.call&&!l.declAST.isOverload&&g.checker.errorReporter.duplicateIdentifier(l.declAST,l.name),f(i.type)),j.typeFlags|=a.TypeFlags.IsClass,k.typeFlags|=a.TypeFlags.IsClass,d(k,i),a.pushTypeCollectionScope(l,k.members,k.ambientMembers,null,null,g,k,j,null),!0}function m(b,c,e){var f=e.scopeChain,g=b,h=null,i=null,j=a.hasFlag(g.varFlags,a.VarFlags.Exported),k=e.scopeChain.container==e.checker.gloMod,l=!0;l=!1;var m=g.name.text;return h=f.scope.findLocal(m,!1,!0),h==null?(i=new a.Type,h=new a.TypeSymbol(m,b.minChar,e.checker.locationInfo.unitIndex,i),i.symbol=h,i.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),i.ambientMembers=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),h.declAST=g,h.declModule=e.scopeChain.moduleDecl):(l=!0,i=h.type),i||(i=e.checker.anyType),b.type=i,d(i,g),j&&(h.flags|=a.SymbolFlags.Exported),e.scopeChain.moduleDecl&&(h.flags|=a.SymbolFlags.ModuleMember),l||e.scopeChain.scope.enter(e.scopeChain.container,b,h,e.checker.errorReporter,k||j,!0,!1),a.pushTypeCollectionScope(h,i.members,i.ambientMembers,null,null,e,i,null,null),!0}function n(b,c,d){var e=d.scopeChain,f=b;if(a.hasFlag(f.varFlags,a.VarFlags.Public|a.VarFlags.Private)){var g=new a.ValueLocation,h=a.hasFlag(f.varFlags,a.VarFlags.Private),i=new a.FieldSymbol(f.id.text,f.minChar,d.checker.locationInfo.unitIndex,!a.hasFlag(f.varFlags,a.VarFlags.Readonly),g);i.transferVarFlags(f.varFlags),g.symbol=i,i.declAST=b,f.parameterPropertySym=i,d.scopeChain.scope.enter(d.scopeChain.container,b,i,d.checker.errorReporter,!h,!1,!1),g.typeLink=a.getTypeLink(f.typeExpr,d.checker,f.init==null),f.sym=i}return!1}function o(b,c,d){var e=d.scopeChain,f=b,g=a.hasFlag(f.varFlags,a.VarFlags.Ambient),h=a.hasFlag(f.varFlags,a.VarFlags.Exported),i=d.scopeChain.container==d.checker.gloMod,j=a.hasFlag(f.varFlags,a.VarFlags.Property),k=a.hasFlag(f.varFlags,a.VarFlags.Static),l=a.hasFlag(f.varFlags,a.VarFlags.Private),m=a.hasFlag(f.id.flags,a.ASTFlags.OptionalName);d.scopeChain.moduleDecl&&d.scopeChain.moduleDecl.recordNonInterface();if(j||h||d.scopeChain.container==d.checker.gloMod||d.scopeChain.moduleDecl){if(g){var n=e.scope.findLocal(f.id.text,!1,!1);if(n)return f.sym=n,!1}if(f.id==null)return d.checker.errorReporter.simpleError(f,"Expected variable identifier at this location"),!1;var o=new a.ValueLocation,p=new a.FieldSymbol(f.id.text,f.minChar,d.checker.locationInfo.unitIndex,(f.varFlags&a.VarFlags.Readonly)==a.VarFlags.None,o);p.transferVarFlags(f.varFlags),m&&(p.flags|=a.SymbolFlags.Optional),o.symbol=p,p.declAST=b;if(d.scopeChain.moduleDecl||d.scopeChain.container==d.checker.gloMod)p.flags|=a.SymbolFlags.ModuleMember,p.declModule=d.scopeChain.moduleDecl;a.hasFlag(f.varFlags,a.VarFlags.Property)&&k&&d.scopeChain.classType?(d.scopeChain.classType.members.publicMembers.add(f.id.text,p)||d.checker.errorReporter.duplicateIdentifier(b,p.name),p.container=d.scopeChain.classType.symbol):d.scopeChain.scope.enter(d.scopeChain.container,b,p,d.checker.errorReporter,!l&&(j||h||i||k),!1,g),a.hasFlag(f.varFlags,a.VarFlags.Exported)&&(p.flags|=a.SymbolFlags.Exported),o.typeLink=a.getTypeLink(f.typeExpr,d.checker,f.init==null),f.sym=p}return!1}function p(b,c,d){var e=d.scopeChain;d.scopeChain.moduleDecl&&d.scopeChain.moduleDecl.recordNonInterface();var f=b,g=null,h=f.getNameText(),i=a.hasFlag(f.fncFlags,a.FncFlags.Exported|a.FncFlags.ClassPropertyMethodExported),j=a.hasFlag(f.fncFlags,a.FncFlags.Static),k=a.hasFlag(f.fncFlags,a.FncFlags.Private),l=f.isConstructMember()||f.isConstructor,m=(f.isMethod()&&j||f.isAccessor())&&d.scopeChain.classType?d.scopeChain.classType.symbol:d.scopeChain.container,n=d.scopeChain.scope,o=m==d.checker.gloMod,p=f.name&&a.hasFlag(f.name.flags,a.ASTFlags.OptionalName),q=!1,r=!1;l&&a.hasFlag(f.fncFlags,a.FncFlags.ClassMethod)&&(m=m.container,n=e.previous.scope),f.unitIndex=d.checker.locationInfo.unitIndex;if(!f.isConstructor&&m&&m.declAST&&m.declAST.nodeType==a.NodeType.FuncDecl&&m.declAST.isConstructor&&!f.isMethod())return q;if(a.hasFlag(f.fncFlags,a.FncFlags.Signature)){var s=d.scopeChain.thisType;h&&h!="__missing"&&(j?g=m.type.members.allMembers.lookup(h):(g=n.findLocal(h,!1,!1),g==null&&(g=n.findLocal(h,!1,!0))),g&&(r=!0,!f.isSignature()&&a.hasFlag(f.fncFlags,a.FncFlags.Ambient)!=a.hasFlag(g.flags,a.SymbolFlags.Ambient)&&(g=null)));if(g==null){f.isSpecialFn()?g=d.checker.createFunctionSignature(f,m,n,m,!1).declAST.type.symbol:g=d.checker.createFunctionSignature(f,m,n,null,!r).declAST.type.symbol;if(g.declAST==null||!f.isSpecialFn())g.declAST=b}else g.kind()==a.SymbolKind.Type?g=d.checker.createFunctionSignature(f,m,n,g,!1).declAST.type.symbol:d.checker.errorReporter.simpleError(f,"Function or method '"+f.name.text+"' already declared as a property");f.isSpecialFn()&&!j?f.type=s?s:g.type:f.type=g.type}else{h&&(j?g=m.type.members.allMembers.lookup(h):(f.isConstructor&&d.scopeChain.previous&&(g=d.scopeChain.previous.scope.findLocal(h,!1,!1)),g==null&&(g=n.findLocal(h,!1,!1))),g&&(r=!0,!l&&g.declAST.nodeType==a.NodeType.FuncDecl&&!g.declAST.isAccessor()&&!g.declAST.isSignature()&&(g=null,r=!1))),g&&!g.isAccessor()&&g.type&&g.type.construct&&g.type.construct.signatures!=[]&&(g.type.construct.signatures[0].declAST==null||!a.hasFlag(g.type.construct.signatures[0].declAST.fncFlags,a.FncFlags.Ambient))&&!f.isConstructor&&d.checker.errorReporter.simpleError(f,"Functions may not have class overloads"),g&&g.kind()!=a.SymbolKind.Type&&f.isMethod()&&!f.isAccessor()&&!f.isConstructor&&(d.checker.errorReporter.simpleError(f,"Function or method '"+f.name.text+"' already declared as a property"),g.type=d.checker.anyType);var t=d.checker.createFunctionSignature(f,m,n,g,!r);if((!g||g.declAST.nodeType!=a.NodeType.FuncDecl)&&f.isAccessor()||g&&g.isAccessor())f.accessorSymbol=d.checker.createAccessorSymbol(f,g,m.type,f.isMethod()&&j,!0,n,m);f.type.symbol.declAST=b,f.isConstructor&&(q=!0)}return i&&(f.type.call&&(f.type.symbol.flags|=a.SymbolFlags.Exported),g&&!g.isAccessor()&&g.type.call&&(g.flags|=a.SymbolFlags.Exported)),d.scopeChain.moduleDecl&&!f.isSpecialFn()&&(f.type.symbol.flags|=a.SymbolFlags.ModuleMember,f.type.symbol.declModule=d.scopeChain.moduleDecl),g&&p&&(g.flags|=a.SymbolFlags.Optional),q}function q(b,c,d){var e=d.state,f=!1,g=e.scopeChain;if(b.nodeType==a.NodeType.Script){var h=b;e.script=h,f=!0}else b.nodeType==a.NodeType.List?f=!0:b.nodeType==a.NodeType.Import?f=j(b,c,e):b.nodeType==a.NodeType.With?f=!1:b.nodeType==a.NodeType.Module?f=k(b,c,e):b.nodeType==a.NodeType.Class?f=l(b,c,e):b.nodeType==a.NodeType.Block?f=!0:b.nodeType==a.NodeType.Interface?f=m(b,c,e):b.nodeType==a.NodeType.ArgDecl?f=n(b,c,e):b.nodeType==a.NodeType.VarDecl?f=o(b,c,e):b.nodeType==a.NodeType.FuncDecl?f=p(b,c,e):b.isStatementOrExpression()&&e.scopeChain.moduleDecl&&e.scopeChain.moduleDecl.recordNonInterface();return d.options.goChildren=f,b}function r(b,c,d){var e=d.state;return b.nodeType==a.NodeType.Module?a.popTypeCollectionScope(e):b.nodeType==a.NodeType.Class?a.popTypeCollectionScope(e):b.nodeType==a.NodeType.Interface&&a.popTypeCollectionScope(e),b}var b=function(){function a(a){this.normalBlock=a,this.exceptionBlock=-1}return a}();a.Continuation=b,a.createNewConstructGroupForType=f,a.cloneParentConstructGroupForChildType=g,a.globalId="__GLO",a.preCollectImportTypes=j,a.preCollectModuleTypes=k,a.preCollectClassTypes=l,a.preCollectInterfaceTypes=m,a.preCollectArgDeclTypes=n,a.preCollectVarDeclTypes=o,a.preCollectFuncDeclTypes=p,a.preCollectTypes=q,a.postCollectTypes=r})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function a(a,b,c){this.container=a,this.previous=b,this.scope=c}return a}();a.ScopeChain=b;var c=function(){function b(a){this.bb=a,this.defsBySymbol=new Array,this.useIndexBySymbol=new Array}return b.prototype.updateTop=function(){var a=new e(this.top.bitCount);for(var b=0,c=this.bb.successors.length;b<c;b++){var d=this.bb.successors[b];d.useDef&&a.union(d.useDef.top)}a.difference(this.kill),a.union(this.gen);var f=a.notEq(this.top);return this.top=a,f},b.prototype.initialize=function(b){function f(b,c,f){var g=f.state;b==null&&(b=null);if(b.nodeType==a.NodeType.VarDecl){var h=b;(h.init||a.hasFlag(h.varFlags,a.VarFlags.AutoInit))&&d(h.sym,g)}else if(b.nodeType==a.NodeType.Name){if(c)if(c.nodeType==a.NodeType.Asg){var i=c;if(i.operand1==b)return b}else if(c.nodeType==a.NodeType.VarDecl){var j=c;if(j.id==b)return b}var k=b;e(k.sym,g,b)}else if(b.nodeType>=a.NodeType.Asg&&b.nodeType<=a.NodeType.LastAsg){var i=b;if(i.operand1&&i.operand1.nodeType==a.NodeType.Name){var k=i.operand1;d(k.sym,g)}}else b.nodeType==a.NodeType.FuncDecl&&(f.options.goChildren=!1);return b}var c=this,d=function(a,b){if(b.isLocalSym(a)){var d=b.getSymbolIndex(a);c.useIndexBySymbol[d]=new Array,c.defsBySymbol[d]=!0}},e=function(a,b,d){if(b.isLocalSym(a)){var e=b.getSymbolIndex(a);c.useIndexBySymbol[e]==undefined&&(c.useIndexBySymbol[e]=new Array);var f=c.useIndexBySymbol[e],g=b.getUseIndex(d);b.addUse(e,g),f.push(g)}},g=new a.AstWalkOptions;g.reverseSiblings=!0,a.getAstWalkerFactory().walk(this.bb.content,f,null,g,b)},b.prototype.initializeGen=function(a){var b=this.useIndexBySymbol.length,c=a.uses.length;this.gen=new e(c);for(var d=0;d<b;d++){var f=this.useIndexBySymbol[d];if(f!=undefined&&f.length>0)for(var g=0,h=f.length;g<h;g++)this.gen.set(f[g],!0)}this.top=this.gen},b.prototype.initializeKill=function(a){this.kill=new e(this.gen.bitCount);for(var b=0,c=this.defsBySymbol.length;b<c;b++)if(this.defsBySymbol[b]){var d=a.useIndexBySymbol[b];if(d)for(var f=0,g=d.length;f<g;f++)this.kill.set(d[f],!0)}},b}();a.BBUseDefInfo=c;var d=function(){function b(){this.useIndexBySymbol=new Array,this.uses=new Array,this.symbols=new Array,this.symbolMap=new a.StringHashTable,this.symbolCount=0}return b.prototype.getSymbolIndex=function(a){var b=a.name,c=this.symbolMap.lookup(b);return c==null&&(c=this.symbolCount++,this.symbols[c]=a,this.symbolMap.add(b,c)),c},b.prototype.addUse=function(a,b){var c=this.useIndexBySymbol[a];c==undefined&&(c=new Array,this.useIndexBySymbol[a]=c),c[c.length]=b},b.prototype.getUseIndex=function(a){return this.uses[this.uses.length]=a,this.uses.length-1},b.prototype.isLocalSym=function(b){return b&&b.container==this.func&&b.kind()==a.SymbolKind.Variable},b.prototype.killSymbol=function(a,b){var c=this.symbolMap.lookup(a.name),d=this.useIndexBySymbol[c];for(var e=0,f=d.length;e<f;e++)b.set(d[e],!0)},b}();a.UseDefContext=d;var e=function(){function a(b){this.bitCount=b,this.firstBits=0,this.restOfBits=null;if(this.bitCount>a.packBits){this.restOfBits=new Array;var c=Math.floor(this.bitCount/a.packBits);for(var d=0;d<c;d++)this.restOfBits[d]=0}}return a.packBits=30,a.prototype.set=function(b,c){if(b<a.packBits)c?this.firstBits|=1<<b:this.firstBits&=~(1<<b);else{var d=Math.floor(b/a.packBits)-1,e=b%a.packBits;c?this.restOfBits[d]|=1<<e:this.restOfBits[d]&=~(1<<e)}},a.prototype.map=function(b){var c;for(c=0;c<a.packBits;c++){if(c==this.bitCount)return;(1<<c&this.firstBits)!=0&&b(c)}if(this.restOfBits){var d,e=a.packBits;for(c=0,d=this.restOfBits.length;c<d;c++){var f=this.restOfBits[c];for(var g=0;g<a.packBits;g++){(1<<g&f)!=0&&b(e),e++;if(e==this.bitCount)return}}}},a.prototype.union=function(a){this.firstBits|=a.firstBits;if(this.restOfBits)for(var b=0,c=this.restOfBits.length;b<c;b++){var d=this.restOfBits[b],e=a.restOfBits[b];this.restOfBits[b]=d|e}},a.prototype.intersection=function(a){this.firstBits&=a.firstBits;if(this.restOfBits)for(var b=0,c=this.restOfBits.length;b<c;b++){var d=this.restOfBits[b],e=a.restOfBits[b];this.restOfBits[b]=d&e}},a.prototype.notEq=function(a){if(this.firstBits!=a.firstBits)return!0;if(this.restOfBits)for(var b=0,c=this.restOfBits.length;b<c;b++){var d=this.restOfBits[b],e=a.restOfBits[b];if(d!=e)return!0}return!1},a.prototype.difference=function(a){var b=this.firstBits;this.firstBits&=~a.firstBits;if(this.restOfBits)for(var c=0,d=this.restOfBits.length;c<d;c++){var e=this.restOfBits[c],f=a.restOfBits[c];this.restOfBits[c]&=~f}},a}();a.BitVector=e;var f=function(){function b(){this.predecessors=new Array,this.index=-1,this.markValue=0,this.successors=new Array,this.useDef=null,this.content=new a.ASTList}return b.prototype.marked=function(a){return this.markValue>a},b.prototype.mark=function(){this.markValue++},b.prototype.addSuccessor=function(a){this.successors[this.successors.length]=a,a.predecessors[a.predecessors.length]=this},b}();a.BasicBlock=f;var g=function(){function b(a,b){this.current=a,this.exit=b,this.entry=null,this.unreachable=null,this.noContinuation=!1,this.statementStack=new Array,this.currentSwitch=new Array,this.markBase=0,this.linearBBs=new Array,this.entry=this.current}return b.prototype.walk=function(a,b){return this.walker.walk(a,b)},b.prototype.pushSwitch=function(a){this.currentSwitch.push(a)},b.prototype.popSwitch=function(){return this.currentSwitch.pop()},b.prototype.reportUnreachable=function(b){if(this.unreachable&&this.unreachable.length>0){var c=this.unreachable.length;for(var d=0;d<c;d++){var e=this.unreachable[d];e.nodeType!=a.NodeType.EndCode&&b.simpleError(e,"unreachable code")}}},b.prototype.printAST=function(b,c){var d=new a.PrintContext(c,null);d.increaseIndent(),a.getAstWalkerFactory().walk(b,a.prePrintAST,a.postPrintAST,null,d),d.decreaseIndent()},b.prototype.printBlockContent=function(a,b){var c=a.content;for(var d=0,e=c.members.length;d<e;d++){var f=c.members[d];this.printAST(f,b)}},b.prototype.bfs=function(a,b,c,d){var e=this.markBase++,f=new Array;f[f.length]=this.entry;while(f.length>0){var g=f.pop();if(!g.marked(e)){g.mark(),a&&a(g);var h=g.successors.length;if(h>0){c&&c();for(var i=h-1;i>=0;i--){var j=g.successors[i];j.marked(this.markBase)||(b&&b(g,j),f[f.length]=j)}d&&d()}}}},b.prototype.useDef=function(a,b){var e=this,f=new d;f.func=b;var g=function(a){a.useDef=new c(a),a.useDef.initialize(f),e.linearBBs[e.linearBBs.length]=a};this.bfs(g,null,null,null);var h,i;for(h=0,i=this.linearBBs.length;h<i;h++)this.linearBBs[h].useDef.initializeGen(f),this.linearBBs[h].useDef.initializeKill(f);var j=!0;while(j){j=!1;for(h=0;h<i;h++)j=this.linearBBs[h].useDef.updateTop()||j}var k=this.entry.useDef.top;k.map(function(b){var c=f.uses[b];a.simpleError(c,"use of variable '"+c.text+"' that is not definitely assigned")})},b.prototype.print=function(a){function e(){a.Write("  Branches to ")}function f(){a.WriteLine("")}function g(b,d){d.index<0&&(d.index=c++),a.Write(d.index+" ")}var b=this,c=0,d=function(d){d.index<0&&(d.index=c++),d==b.exit?a.WriteLine("Exit block with index "+d.index):(a.WriteLine("Basic block with index "+d.index),b.printBlockContent(d,a))};this.bfs(d,g,e,f);if(this.unreachable!=null)for(var h=0,i=this.unreachable.length;h<i;h++)a.WriteLine("Unreachable basic block ..."),this.printAST(this.unreachable[h],a)},b.prototype.pushStatement=function(a,b,c){this.statementStack.push({stmt:a,continueBB:b,breakBB:c})},b.prototype.popStatement=function(){return this.statementStack.pop()},b.prototype.returnStmt=function(){this.current.addSuccessor(this.exit),this.setUnreachable()},b.prototype.setUnreachable=function(){this.current=null,this.noContinuation=!0},b.prototype.addUnreachable=function(a){this.unreachable===null&&(this.unreachable=new Array),this.unreachable[this.unreachable.length]=a},b.prototype.unconditionalBranch=function(a,b){var c=null;for(var d=0,e=this.statementStack.length;d<e;d++){var f=this.statementStack[d];if(f.stmt==a){b?c=f.continueBB:c=f.breakBB;break}}c&&this.current.addSuccessor(c),this.setUnreachable()},b.prototype.addContent=function(a){this.current&&this.current.content.append(a)},b}();a.ControlFlowContext=g;var h=function(){function a(){this.cacheSize=16,this.rdCache=[],this.nextUp=0;for(var a=0;a<this.cacheSize;a++)this.rdCache[a]={actuals:new Array,exactCandidates:new Array,conversionCandidates:new Array,id:a}}return a.prototype.getResolutionData=function(){var a=null;return this.nextUp<this.cacheSize&&(a=this.rdCache[this.nextUp]),a==null&&(this.cacheSize++,a={actuals:new Array,exactCandidates:new Array,conversionCandidates:new Array,id:this.cacheSize},this.rdCache[this.cacheSize]=a),this.nextUp++,a},a.prototype.returnResolutionData=function(a){a.actuals.length=0,a.exactCandidates.length=0,a.conversionCandidates.length=0,this.nextUp=a.id},a}();a.ResolutionDataCache=h;var i=function(){function c(a,b,c,d){this.logger=a,this.initScope=b,this.parser=c,this.checker=d,this.thisFnc=null,this.thisClassNode=null,this.enclosingFncIsMethod=!1,this.arrayInterfaceType=null,this.stringInterfaceType=null,this.objectInterfaceType=null,this.functionInterfaceType=null,this.numberInterfaceType=null,this.booleanInterfaceType=null,this.currentScript=null,this.inNewTargetTypeCheck=!1,this.inImportTypeCheck=!1,this
.inTypeRefTypeCheck=!1,this.inArrayElementTypeCheck=!1,this.resolutionDataCache=new h,this.nestingLevel=0,this.inBoundPropTypeCheck=!1,this.inSuperCall=!1,this.checker.typeFlow=this,this.scope=this.initScope,this.globalScope=this.initScope,this.doubleType=this.checker.numberType,this.booleanType=this.checker.booleanType,this.stringType=this.checker.stringType,this.anyType=this.checker.anyType,this.regexType=this.anyType,this.nullType=this.checker.nullType,this.voidType=this.checker.voidType,this.arrayAnyType=this.checker.makeArrayType(this.anyType)}return c.prototype.initLibs=function(){var b=this.globalScope.find("Array",!1,!0);b&&b.kind()==a.SymbolKind.Type&&(this.arrayInterfaceType=b.type);var c=this.globalScope.find("String",!1,!0);c&&c.kind()==a.SymbolKind.Type&&(this.stringInterfaceType=c.type);var d=this.globalScope.find("Object",!1,!0);d&&d.kind()==a.SymbolKind.Type&&(this.objectInterfaceType=d.type);var e=this.globalScope.find("Function",!1,!0);e&&e.kind()==a.SymbolKind.Type&&(this.functionInterfaceType=e.type);var f=this.globalScope.find("Number",!1,!0);f&&f.kind()==a.SymbolKind.Type&&(this.numberInterfaceType=f.type);var g=this.globalScope.find("Boolean",!1,!0);g&&g.kind()==a.SymbolKind.Type&&(this.booleanInterfaceType=g.type);var h=this.globalScope.find("RegExp",!1,!0);h&&h.kind()==a.SymbolKind.Type&&(this.regexType=h.type)},c.prototype.cast=function(a,b){return this.castWithCoercion(a,b,!0,!1)},c.prototype.castWithCoercion=function(b,c,d,e){var f=new a.TypeComparisonInfo;return this.checker.sourceIsAssignableToTarget(b.type,c,f)||e&&this.checker.sourceIsAssignableToTarget(c,b.type,f)?(d&&(c==null?b.type=this.anyType:c.isClass()?b.type=c.instanceType:b.type=c),b):(this.checker.errorReporter.incompatibleTypes(b,b.type,c,null,this.scope,f),b)},c.prototype.inScopeTypeCheck=function(b,c){var d=this.scope;this.scope=c;var e=this.thisFnc,f=this.thisType,g=this.thisClassNode,h=this.checker.currentModDecl,i=this.enclosingFncIsMethod,j=this.scope.container,k=null;while(j){if(j.kind()==a.SymbolKind.Type){var l=j,m=l.type;m.call&&k==null&&(this.enclosingFncIsMethod=l.isMethod,k=j.declAST);if(m.isClass()){this.thisType=m.instanceType,l.declAST&&l.declAST.nodeType==a.NodeType.Class&&(this.thisClassNode=l.declAST);break}if(m.isModuleType()){this.checker.currentModDecl=l.declAST;break}}j=j.container}this.thisFnc=k;var n=this.typeCheck(b);return this.thisFnc=e,this.thisType=f,this.thisClassNode=g,this.checker.currentModDecl=h,this.enclosingFncIsMethod=i,this.scope=d,n},c.prototype.typeCheck=function(a){return a?a.typeCheck(this):null},c.prototype.inScopeTypeCheckDecl=function(b){if(b.nodeType==a.NodeType.VarDecl||b.nodeType==a.NodeType.ArgDecl)this.inScopeTypeCheckBoundDecl(b);else if(b.nodeType==a.NodeType.FuncDecl){var c=b;c.isAccessor()&&this.typeCheckFunction(c)}},c.prototype.inScopeTypeCheckBoundDecl=function(b){var c=b.sym,d=this.thisFnc,e=this.thisType,f=this.enclosingFncIsMethod,g=this.checker.locationInfo;if(c&&c.container){var h=a.hasFlag(b.varFlags,a.VarFlags.ClassConstructorProperty)?c.container.getType().constructorScope:c.container.instanceScope();a.hasFlag(b.varFlags,a.VarFlags.Property)&&c.container.declAST.nodeType==a.NodeType.FuncDecl&&(this.thisFnc=c.container.declAST);if(h){var i=this.scope;this.scope=h;var j=c.container;this.checker.units&&c.unitIndex>=0&&c.unitIndex<this.checker.units.length?this.checker.locationInfo=this.checker.units[c.unitIndex]:this.checker.locationInfo=a.unknownLocationInfo;while(j){if(j.kind()==a.SymbolKind.Type){var k=j,l=k.type;l.call&&(this.enclosingFncIsMethod=k.isMethod);if(l.isClass()){this.thisType=l.instanceType;break}}j=j.container}this.typeCheckBoundDecl(b),this.scope=i}}this.thisFnc=d,this.thisType=e,this.checker.locationInfo=g,this.enclosingFncIsMethod=f},c.prototype.resolveBoundDecl=function(a){if(a.typeExpr)(a.typeExpr.type==null||a.typeExpr.type&&a.typeExpr.type==this.anyType&&this.scope||a.typeExpr.type.symbol==null||!this.checker.typeStatusIsFinished(a.typeExpr.type.symbol.typeCheckStatus))&&this.typeCheck(a.typeExpr),a.type=a.typeExpr.type,a.sym&&a.sym.setType(a.type);else if(a.init==null){this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(a,"type implicitly set to 'any'"),a.type=this.anyType;if(a.sym){if(a.sym.isType()){var b=a.sym;if(b.isMethod){this.checker.errorReporter.simpleError(a,"Cannot bind method group to variable.  (Did you mean to use 'declare function' instead of 'declare var'?)");return}this.checker.errorReporter.simpleError(a,"Cannot bind type to variable");return}a.sym.setType(a.type)}}},c.prototype.typeCheckBoundDecl=function(b){var c=b.sym;if(c==null)b.init?(b.init=this.typeCheck(b.init),b.type=this.checker.widenType(b.init.type)):(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(b,"type implicitly set to 'any'"),b.type=this.anyType);else if(c.typeCheckStatus==a.TypeCheckStatus.Started)this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(b,"type implicitly set to 'any'"),b.type=this.anyType,c.setType(this.anyType);else if(c.typeCheckStatus==a.TypeCheckStatus.NotStarted){c.typeCheckStatus=a.TypeCheckStatus.Started,this.checker.addStartedPTO(c);var d=!1;b.type==null&&b.typeExpr&&(this.resolveBoundDecl(b),d=!0,b.type=b.typeExpr.type,c.typeCheckStatus=this.checker.getTypeCheckFinishedStatus());if(b.init){a.hasFlag(b.varFlags,a.VarFlags.Ambient)&&this.checker.errorReporter.simpleError(b,"Ambient variable can not have an initializer");var e=a.hasFlag(b.varFlags,a.VarFlags.LocalStatic),f=this.scope,g=!b.init.isParenthesized;e&&(this.scope=b.sym.container.getType().memberScope),b.varFlags&a.VarFlags.Property&&(this.inBoundPropTypeCheck=!0),this.checker.typeCheckWithContextualType(b.type,this.checker.inProvisionalTypecheckMode(),g,b.init),this.inBoundPropTypeCheck&&(this.inBoundPropTypeCheck=!1),this.scope=f;if(b.type){var h=!1,i=null;b.init.type&&(i=b.init.type.containedScope,h=!0,b.init.type==this.voidType&&this.checker.errorReporter.simpleError(b,"Cannot assign type 'void' to variable '"+b.id.text+"'")),b.init=this.castWithCoercion(b.init,b.type,g,!1),h&&b.init.type.containedScope==null&&(b.init.type.containedScope=i)}else b.type=this.checker.widenType(b.init.type),b.type==this.voidType&&(this.checker.errorReporter.simpleError(b,"Cannot assign type 'void' to variable '"+b.id.text+"'"),b.type=this.anyType);c.setType(b.type)}else d||this.resolveBoundDecl(b);c.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else this.checker.typeStatusIsFinished(c.typeCheckStatus)&&c.declAST!=b&&b.init&&(b.init=this.typeCheck(b.init),b.type=c.getType(),b.init=this.cast(b.init,b.type));return b.id&&b.sym&&(b.id.sym=b.sym),b},c.prototype.typeCheckSuper=function(a){return this.thisType&&this.enclosingFncIsMethod&&!this.thisFnc.isStatic()&&this.thisType.baseClass()?a.type=this.thisType.baseClass():(a.type=this.anyType,this.checker.errorReporter.invalidSuperReference(a)),a},c.prototype.typeCheckThis=function(b){var c=!1;this.thisFnc==null?this.thisType?this.thisClassNode&&this.thisClassNode.nty==a.NodeType.Class?(c=!0,b.type=this.anyType):b.type=this.thisType:(this.checker.currentModDecl&&this.checker.errorReporter.simpleError(b,"'this' may not be referenced within module bodies"),b.type=this.anyType):((this.inBoundPropTypeCheck||this.inSuperCall)&&this.thisClassNode&&this.thisClassNode.nty==a.NodeType.Class&&(c=!0),this.thisFnc.isMethod()||this.thisFnc.isConstructor||this.thisFnc.isTargetTypedAsMethod?this.thisType&&!(this.thisFnc.fncFlags&a.FncFlags.Static)?b.type=this.thisType:b.type=this.anyType:b.type=this.anyType);if(!this.enclosingFncIsMethod&&this.thisFnc&&a.hasFlag(this.thisFnc.fncFlags,a.FncFlags.IsFatArrowFunction))if(this.thisFnc.boundToProperty){var d=this.thisFnc.boundToProperty.sym.container;d.declAST.nodeType==a.NodeType.FuncDecl&&d.declAST.setHasSelfReference()}else{var e=this.thisFnc.enclosingFnc,f=e,g=!1;while(e){if(e.isMethod()||e.isConstructor||e.hasSelfReference()){e.setHasSelfReference(),g=!0;break}e=e.enclosingFnc}!g&&f&&f.setHasSelfReference(),g&&this.thisType&&(b.type=this.thisType)}return c&&this.checker.errorReporter.simpleError(b,"Keyword 'this' cannot be referenced in initializers in a class body, or in super constructor calls"),b},c.prototype.setTypeFromSymbol=function(b,c){if(c.isVariable()){if(c.isInferenceSymbol()){var d=c;d.declAST&&!this.checker.typeStatusIsFinished(d.typeCheckStatus)&&this.inScopeTypeCheckDecl(d.declAST),this.checker.styleSettings.innerScopeDeclEscape||d.declAST&&d.declAST.nodeType==a.NodeType.VarDecl&&this.nestingLevel<d.declAST.nestingLevel&&this.checker.errorReporter.styleError(b,"Illegal reference to a variable defined in more nested scope")}b.type=c.getType(),c.writeable()||(b.flags=b.flags&~a.ASTFlags.Writeable)}else c.isType()?(b.type=c.getType(),b.flags=b.flags&~a.ASTFlags.Writeable):(b.type=this.anyType,this.checker.errorReporter.symbolDoesNotReferToAValue(b,c.name))},c.prototype.typeCheckName=function(b){var c=this,d=b;if(this.checker.inWith)d.type=this.anyType;else{var e=!1,f=d.text,g=f,h=a.isQuoted(d.text),i=this.scope.find(f,!1,e);i==null&&h&&(i=this.checker.findSymbolForDynamicModule(f,this.currentScript.locationInfo.filename,function(a){return c.scope.find(a,!1,e)}));if(!i)d.isMissing()||this.checker.errorReporter.unresolvedSymbol(d,d.text),d.type=this.anyType;else{this.inNewTargetTypeCheck&&i.isInferenceSymbol()&&!this.checker.typeStatusIsFinished(i.typeCheckStatus)&&this.checker.errorReporter.simpleError(b,"Symbol '"+d.text+"' is referenced before its declaration");if(a.optimizeModuleCodeGen&&i&&i.isType()){var j=i.getType();if(j&&i.aliasLink&&i.onlyReferencedAsTypeRef){var k=j.symbol.declAST;k&&a.hasFlag(k.modFlags,a.ModuleFlags.IsDynamic)&&(i.onlyReferencedAsTypeRef=this.inTypeRefTypeCheck)}}i.declAST&&i.declAST.nodeType==a.NodeType.FuncDecl&&!i.declAST.returnTypeAnnotation&&i.declAST.signature.typeCheckStatus==a.TypeCheckStatus.Started&&(i.declAST.type.symbol.flags|=a.SymbolFlags.RecursivelyReferenced,i.declAST.signature.returnType.type=this.anyType),this.setTypeFromSymbol(b,i),d.sym=i,this.thisFnc&&this.thisFnc.type&&i.container!=this.thisFnc.type.symbol&&(this.thisFnc.freeVariables[this.thisFnc.freeVariables.length]=i)}}return b},c.prototype.typeCheckScript=function(a){return this.checker.locationInfo=a.locationInfo,this.scope=this.checker.globalScope,a.topLevelMod||this.addLocalsFromScope(this.scope,this.checker.gloMod,a.vars,this.checker.globals,!0),this.currentScript=a,a.bod=this.typeCheck(a.bod),this.currentScript=null,a},c.prototype.typeCheckBitNot=function(a){var b=a;return b.operand=this.typeCheck(b.operand),b.type=this.doubleType,b},c.prototype.typeCheckUnaryNumberOperator=function(a){var b=a;return b.operand=this.typeCheck(b.operand),b.type=this.doubleType,a},c.prototype.typeCheckLogNot=function(a){var b=a;return b.operand=this.typeCheck(b.operand),b.type=this.booleanType,b},c.prototype.astIsWriteable=function(b){return a.hasFlag(b.flags,a.ASTFlags.Writeable)},c.prototype.typeCheckIncOrDec=function(b){var c=b,d=c.operand;return this.astIsWriteable(c)?(c=this.typeCheckUnaryNumberOperator(b),c.operand.type!=this.checker.numberType&&c.operand.type!=this.checker.anyType&&!(c.operand.type.typeFlags&a.TypeFlags.IsEnum)&&this.checker.errorReporter.simpleError(b,"'++' and '--' may only be applied to operands of type 'number' or 'any'")):(this.checker.errorReporter.valueCannotBeModified(c),c.type=this.doubleType),c},c.prototype.typeCheckBitwiseOperator=function(b,c){var d=b,e=null;d.operand1=this.typeCheck(d.operand1),d.operand2=this.typeCheck(d.operand2);var f=d.operand1.type,g=d.operand2.type;c&&!this.astIsWriteable(d)&&this.checker.errorReporter.valueCannotBeModified(d),this.checker.styleSettings.bitwise&&this.checker.errorReporter.styleError(b,"use of "+a.nodeTypeTable[d.nodeType]);if(this.checker.sourceIsSubtypeOfTarget(f,this.doubleType)&&this.checker.sourceIsSubtypeOfTarget(g,this.doubleType))e=this.doubleType;else if(f==this.booleanType&&g==this.booleanType)e=this.booleanType;else if(f==this.anyType){if(g==this.anyType||g==this.doubleType||g==this.booleanType)e=this.anyType}else g==this.anyType&&(f==this.anyType||f==this.doubleType||f==this.booleanType)&&(e=this.anyType);return e==null&&(e=this.anyType,this.checker.errorReporter.incompatibleTypes(d,f,g,d.printLabel(),this.scope)),d.type=e,d},c.prototype.typeCheckArithmeticOperator=function(b,c){var d=b;d.operand1=this.typeCheck(d.operand1),d.operand2=this.typeCheck(d.operand2);var e=d.operand1.type,f=d.operand2.type;c&&!this.astIsWriteable(d)&&this.checker.errorReporter.valueCannotBeModified(d),this.checker.styleSettings.bitwise&&(d.nodeType==a.NodeType.And||d.nodeType==a.NodeType.Or||d.nodeType==a.NodeType.AsgAnd||d.nodeType==a.NodeType.AsgOr)&&this.checker.errorReporter.styleError(b,"use of "+a.nodeTypeTable[d.nodeType]);if(e==null||f==null)return this.checker.errorReporter.simpleError(d,"Could not typecheck arithmetic operation.  Possible recursive typecheck error?"),d.type=this.anyType,d;var g=d.nodeType;return this.checker.isNullOrUndefinedType(e)&&(e=f),this.checker.isNullOrUndefinedType(f)&&(f=e),e=this.checker.widenType(e),f=this.checker.widenType(f),g==a.NodeType.Add||g==a.NodeType.AsgAdd?e==this.checker.stringType||f==this.checker.stringType?d.type=this.checker.stringType:e==this.checker.numberType&&f==this.checker.numberType?d.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(e,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(f,this.checker.numberType)?d.type=this.checker.numberType:e==this.checker.anyType||f==this.checker.anyType?d.type=this.checker.anyType:(d.type=this.anyType,this.checker.errorReporter.incompatibleTypes(d,e,f,d.printLabel(),this.scope)):e==this.checker.numberType&&f==this.checker.numberType?d.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(e,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(f,this.checker.numberType)?d.type=this.checker.numberType:e==this.checker.anyType||f==this.checker.anyType?d.type=this.checker.numberType:(d.type=this.anyType,this.checker.errorReporter.incompatibleTypes(d,e,f,d.printLabel(),this.scope)),d},c.prototype.typeCheckDotOperator=function(a){var b=a,c=!1;b.operand1=this.typeCheck(b.operand1);var d=b.operand1.type,e=null;if(d){if(d==this.anyType)return b.type=this.anyType,b;if(d==this.stringType){if(!this.stringInterfaceType)return b.type=this.anyType,b;e=this.stringInterfaceType.memberScope}else if(d==this.doubleType){if(!this.numberInterfaceType)return b.type=this.anyType,b;e=this.numberInterfaceType.memberScope}else if(d==this.booleanType){if(!this.booleanInterfaceType)return b.type=this.anyType,b;e=this.booleanInterfaceType.memberScope}else if((d.call||d.construct)&&d.members==null){if(!this.functionInterfaceType)return b.type=this.anyType,b;e=this.functionInterfaceType.memberScope}else if(d.elementType){if(!this.arrayInterfaceType)return b.type=this.anyType,b;var f=d.elementType.getArrayBase(this.arrayInterfaceType,this.checker);e=f.memberScope}else e=d.memberScope}if(e==null)this.checker.errorReporter.expectedClassOrInterface(b),b.type=this.anyType;else{var g=b.operand2,h=this.thisClassNode&&b.operand1.type==this.thisClassNode.type.instanceType,i=e.find(g.text,!h,!1);i||this.objectInterfaceType&&d&&(d.isReferenceType()&&(i=this.objectInterfaceType.memberScope.find(g.text,!1,!1)),i||this.functionInterfaceType&&(d.call||d.construct)&&(i=this.functionInterfaceType.memberScope.find(g.text,!1,!1)));if(!i||!i.visible(e,this.checker))b.type=this.anyType,i==null?this.checker.errorReporter.simpleError(g,"The property '"+g.text+"' does not exist on value of type '"+d.getScopedTypeName(this.scope)+"'"):this.checker.errorReporter.simpleError(b,"The property '"+g.text+" on type '"+d.getScopedTypeName(this.scope)+"' is not visible");else{if(i.isVariable()&&i.isInferenceSymbol()){var j=i;j.declAST&&!this.checker.typeStatusIsFinished(j.typeCheckStatus)&&this.inScopeTypeCheckDecl(j.declAST)}g.sym=i,b.type=i.getType()}}return b.type==null&&(b.type=this.anyType),b},c.prototype.typeCheckBooleanOperator=function(a){var b=a;b.operand1=this.typeCheck(b.operand1),b.operand2=this.typeCheck(b.operand2);var c=b.operand1.type,d=b.operand2.type;return!this.checker.sourceIsAssignableToTarget(c,d)&&!this.checker.sourceIsAssignableToTarget(d,c)&&this.checker.errorReporter.incompatibleTypes(b,c,d,b.printLabel(),this.scope),b.type=this.booleanType,b},c.prototype.typeCheckAsgOperator=function(b){var c=b,d=!c.operand2.isParenthesized;c.operand1=this.typeCheck(c.operand1),this.checker.typeCheckWithContextualType(c.operand1.type,this.checker.inProvisionalTypecheckMode(),d,c.operand2);var e=c.operand1.type,f=c.operand2.type;this.astIsWriteable(c.operand1)||this.checker.errorReporter.valueCannotBeModified(c);if(c.operand1.nodeType==a.NodeType.Call)var g=c.operand1;var h=!1,i=null;return c.operand2.type&&(i=c.operand2.type.containedScope,h=!0),c.operand2=this.castWithCoercion(c.operand2,e,d,!1),h&&c.operand2.type.containedScope==null&&(c.operand2.type.containedScope=i),c.type=f,c},c.prototype.typeCheckIndex=function(b){var c=b;c.operand1=this.typeCheck(c.operand1),c.operand2=this.typeCheck(c.operand2),this.checker.styleSettings.literalSubscript||c.operand2.nodeType==a.NodeType.QString&&this.checker.errorReporter.styleError(b,"use literal subscript ('.') notation instead)");var d=c.operand1.type,e=c.operand2.type;if(d.elementType)e==this.checker.anyType||e==this.checker.numberType||a.hasFlag(e.typeFlags,a.TypeFlags.IsEnum)?c.type=d.elementType:e==this.checker.stringType?c.type=this.checker.anyType:(this.checker.errorReporter.simpleError(c,"Illegal property access"),c.type=this.checker.anyType);else if(d.index)if(e==this.checker.anyType||!(d.index.flags&a.SignatureFlags.IsStringIndexer||d.index.flags&a.SignatureFlags.IsNumberIndexer)||d.index.flags&a.SignatureFlags.IsStringIndexer&&e==this.checker.stringType||d.index.flags&a.SignatureFlags.IsNumberIndexer&&(e==this.checker.numberType||a.hasFlag(e.typeFlags,a.TypeFlags.IsEnum))){var f=this.resolveOverload(b,d.index);f?c.type=f.returnType.type:c.type=this.checker.anyType}else e==this.checker.stringType?c.type=this.checker.anyType:(this.checker.errorReporter.simpleError(c,"Illegal property access"),c.type=this.checker.anyType);else d!=this.checker.anyType&&d!=this.checker.stringType&&d!=this.checker.numberType&&d!=this.checker.booleanType&&!d.isReferenceType()||e!=this.checker.anyType&&e!=this.checker.stringType&&e!=this.checker.numberType&&!a.hasFlag(e.typeFlags,a.TypeFlags.IsEnum)?(this.checker.errorReporter.simpleError(c,"Illegal property access"),c.type=this.checker.anyType):c.type=this.checker.anyType;return c},c.prototype.typeCheckInOperator=function(a){return a.operand1=this.cast(this.typeCheck(a.operand1),this.stringType),a.operand2=this.typeCheck(a.operand2),(a.operand1.type!=this.checker.anyType&&a.operand1.type!=this.checker.stringType||a.operand2.type!=this.anyType&&!this.checker.sourceIsSubtypeOfTarget(a.operand2.type,this.objectInterfaceType))&&this.checker.errorReporter.simpleError(a,"The in operator requires the left operand to be of type Any or the String primitive type, and the right operand to be of type Any or an object type"),a.type=this.booleanType,a},c.prototype.typeCheckShift=function(a,b){return a.operand1=this.cast(this.typeCheck(a.operand1),this.doubleType),a.operand2=this.cast(this.typeCheck(a.operand2),this.doubleType),b&&!this.astIsWriteable(a.operand1)&&this.checker.errorReporter.valueCannotBeModified(a),a.type=this.doubleType,a},c.prototype.typeCheckQMark=function(a){a.operand1=this.typeCheck(a.operand1),a.operand2=this.typeCheck(a.operand2),a.operand3=this.typeCheck(a.operand3);var b=a.operand2.type,c=a.operand3.type;return b==c?a.type=b:this.checker.sourceIsSubtypeOfTarget(b,c)?a.type=c:this.checker.sourceIsSubtypeOfTarget(c,b)?a.type=b:(a.type=this.anyType,this.checker.errorReporter.incompatibleTypes(a,b,c,a.printLabel(),this.scope)),a},c.prototype.addFormals=function(a,b,c){var d=b.parameters.length;for(var e=0;e<d;e++){var f=b.parameters[e];f.container=a,c.add(f.name,f)}},c.prototype.addLocalsFromScope=function(b,c,d,e,f){var g=d.members.length,h=!1;for(var i=0;i<g;i++){var j=d.members[i];if(j.sym==null||j.sym.kind()!=a.SymbolKind.Field){var k=null;if((k=e.lookup(j.id.text))==null){var l=new a.ValueLocation;l.typeLink=new a.TypeLink;var m=null;a.hasFlag(j.varFlags,a.VarFlags.Static)?(j.varFlags|=a.VarFlags.LocalStatic,m=new a.FieldSymbol(j.id.text,j.minChar,this.checker.locationInfo.unitIndex,!0,l)):m=new a.VariableSymbol(j.id.text,j.minChar,this.checker.locationInfo.unitIndex,l),m.transferVarFlags(j.varFlags),l.symbol=m,m.declAST=j,l.typeLink.ast=j.typeExpr,this.checker.resolveTypeLink(b,l.typeLink,!1),j.type==null&&j.init==null&&(j.type=this.anyType),l.typeLink.type=j.type,l.symbol.container=c,j.sym=l.symbol,e.add(j.id.text,m),j.id.text=="arguments"&&(h=!0)}else j.type=k.getType(),j.sym=k}}if(!f&&!h){var n=new a.ValueLocation;n.typeLink=new a.TypeLink;var o=new a.VariableSymbol("arguments",d.minChar,this.checker.locationInfo.unitIndex,n);n.typeLink.ast=new a.Identifier("IArguments"),this.checker.resolveTypeLink(b,n.typeLink,!1),e.add("arguments",o)}},c.prototype.addConstructorLocalArgs=function(b,c,d,e){if(c){var f=c.members.length;for(var g=0;g<f;g++){var h=c.members[g];if(h.sym==null||e||h.sym.kind()!=a.SymbolKind.Field){var i=null;if((i=d.lookup(h.id.text))==null){this.resolveBoundDecl(h);var j=new a.ValueLocation;j.typeLink=new a.TypeLink;var k=new a.ParameterSymbol(h.id.text,h.minChar,this.checker.locationInfo.unitIndex,j);k.declAST=h,j.symbol=k,j.typeLink.type=h.type,j.symbol.container=b,h.sym=j.symbol,d.add(h.id.text,k)}else h.type=i.getType(),h.sym=i}}}},c.prototype.checkInitSelf=function(a){if(!a.isMethod()){var b=a.freeVariables;for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e.isInstanceProperty())return!0}}var f=a.scopes,g=f.members.length;for(var h=0;h<g;h++){var i=f.members[h];if(this.checkInitSelf(i))return!0}return!1},c.prototype.checkPromoteFreeVars=function(b,c){var d=b.freeVariables;for(var e=0,f=d.length;e<f;e++){var g=d[e];!g.isInstanceProperty()&&g.container==c&&(a.instanceFilter.reset(),this.scope.search(a.instanceFilter,g.name,!1,!1)&&this.checker.errorReporter.simpleError(b,"Constructor-local variable shadows class property '"+g.name+"'. To access the class property, use 'self."+g.name+"'"),this.checker.errorReporter.simpleError(b,"Constructor-local variables may not be accessed from instance method bodies. Consider changing local variable '"+g.name+"' to a class property"))}},c.prototype.allReturnsAreVoid=function(b){var c=!0;if(b.signature.returnType.type==null){var d=function(b,d,e){var f=!0;switch(b.nodeType){case a.NodeType.FuncDecl:f=!1;break;case a.NodeType.Return:var g=b;g.returnExpression&&(c=!1,f=!1);default:}return e.options.goChildren=f,e.options.goNextSibling=f,b};a.getAstWalkerFactory().walk(b.bod,d)}return c},c.prototype.classConstructorHasSuperCall=function(b){var c=!1,d=function(b,d,e){var f=!0;switch(b.nodeType){case a.NodeType.FuncDecl:f=!1;break;case a.NodeType.Call:var g=b;if(g.target.nodeType==a.NodeType.Super){f=!1,c=!0;break}break;default:}return e.options.goChildren=f,b};return a.getAstWalkerFactory().walk(b.bod,d),c},c.prototype.typeCheckFunction=function(b){this.nestingLevel=0;var c=b.type,d=c.symbol,e=b.signature;if(this.checker.typeStatusIsFinished(e.typeCheckStatus))return b;if(e.typeCheckStatus==a.TypeCheckStatus.Started)return!b.returnTypeAnnotation&&b.bod&&!b.isSignature()&&!b.isConstructor&&this.allReturnsAreVoid(b)?(e.returnType.type=this.voidType,b):(b.returnTypeAnnotation==null&&(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(b,"type implicitly set to 'any'"),e.returnType.type=this.anyType,d.flags|=a.SymbolFlags.RecursivelyReferenced),b);e.typeCheckStatus=a.TypeCheckStatus.Started,this.checker.addStartedPTO(e);var f=this.scope,g=this.thisFnc,h=this.enclosingFncIsMethod,i=this.thisClassNode;this.enclosingFncIsMethod=b.isMethod()||b.isConstructor,this.thisFnc=b;var j=b.type.symbol,k=this.thisType,l=this.checker.locationInfo,m=null,n=!1,o=null,p=null,q=b.isAccessor()&&a.hasFlag(b.fncFlags,a.FncFlags.GetAccessor),r=b.isAccessor()&&a.hasFlag(b.fncFlags,a.FncFlags.SetAccessor),s=(q||r)&&b.accessorSymbol?b.accessorSymbol.getType():null,t=this.checker.currentModDecl;if(b.isConstructor&&!b.isOverload){if(c.instanceType==null)return this.checker.errorReporter.simpleError(b,"Malformed function body (is this a class named the same as an existing interface?)"),b;this.scope=c.instanceType.constructorScope;var u=this.scope;m=u.valueMembers.allMembers}else if(b.isOverload)m=b.symbols,!a.hasFlag(b.fncFlags,a.FncFlags.Static)&&c.containedScope&&(this.scope=c.containedScope);else{b.bod&&(this.scope=c.containedScope);var u=this.scope;u&&u.valueMembers&&(m=u.valueMembers.allMembers)}if(b.isConstructor&&b.bod&&a.hasFlag(b.fncFlags,a.FncFlags.ClassMethod)){var v=a.hasFlag(b.classDecl.type.instanceType.typeFlags,a.TypeFlags.HasBaseType),w=!v||a.hasFlag(b.classDecl.type.instanceType.typeFlags,a.TypeFlags.HasBaseTypeOfObject),x=a.hasFlag(b.classDecl.varFlags,a.VarFlags.ClassSuperMustBeFirstCallInConstructor);w&&this.classConstructorHasSuperCall(b)?this.checker.errorReporter.simpleError(b,"Calls to 'super' constructor are not allowed in classes that either inherit directly from 'Object' or have no base class"):v&&(x?(!b.bod||!b.bod.members.length||b.bod.members[0].nodeType!=a.NodeType.Call||b.bod.members[0].target.nodeType!=a.NodeType.Super)&&this.checker.errorReporter.simpleError(b,"If a derived class contains initialized properties or constructor parameter properties, the first statement in the constructor body must be a call to the super constructor"):this.classConstructorHasSuperCall(b)||this.checker.errorReporter.simpleError(b,"Constructors for derived classes must contain a call to the class's 'super' constructor"))}if(b.isMethod()&&b.type.enclosingType){var y=null;b.type.enclosingType.symbol.declAST.nodeType==a.NodeType.FuncDecl?y=b.type.enclosingType.symbol.declAST.classDecl:b.type.enclosingType.symbol.declAST.nodeType==a.NodeType.Class&&(y=b.type.enclosingType.symbol.declAST),y&&(this.thisClassNode=y)}if(c.enclosingType){var z=c.symbol.container;z&&z.isType()&&z.getType().isClass()&&(z=z.container),z&&z.declAST&&z.declAST.nodeType==a.NodeType.Module&&(this.checker.currentModDecl=z.declAST)}this.checker.units&&b.unitIndex>=0&&b.unitIndex<this.checker.units.length?this.checker.locationInfo=this.checker.units[b.unitIndex]:this.checker.locationInfo=a.unknownLocationInfo,c.enclosingType?this.thisType=c.enclosingType:this.thisType=k;var A=e.parameters.length;if(!b.isConstructor&&b.bod&&!b.isSignature()){var B=this.scope,u=this.scope;if(!b.isMethod()&&b.returnTypeAnnotation==null){if(f&&b.name&&!b.name.isMissing()){var C=f.findAmbient(b.name.text,!1,!1);C&&C.declAST&&C.declAST.type&&(this.checker.setContextualType(C.declAST.type,!1),n=!0)}if(this.checker.hasTargetType()){var D=this.checker.getTargetTypeContext(),E=D.contextualType;if(this.checker.canContextuallyTypeFunction(E,b,!0)){var F=E.construct?E.construct:E.call;D.targetSig=F.signatures[0];var G=D.targetSig.parameters;o=G,p=D.targetSig.returnType.type,D.targetSig.declAST&&(D.targetSig.declAST.isConstructor?b.isTargetTypedAsMethod=!0:D.targetSig.declAST.isMethod()&&(b.isTargetTypedAsMethod=!0)),d.type=D.contextualType}else E&&b.isAccessor()?(s=E,D.targetAccessorType=s):this.checker.killTargetType()}}var H=u.valueMembers;this.scope=new a.SymbolScopeBuilder(H,null,null,null,f,j);for(var I=0;I<A;I++){var J=e.parameters[I],K=J,L=K.declAST;if(this.checker.hasTargetType()&&o&&(this.checker.getTargetTypeContext().targetSig.hasVariableArgList||I<o.length)){var D=this.checker.getTargetTypeContext(),M=D.targetSig.hasVariableArgList;L.type=M&&I>=o.length-1?o[o.length-1].getType().elementType:o[I].getType(),L.sym.setType(L.type),L.sym.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else this.typeCheck(L);r&&s&&(L=this.cast(L,s)),K.container=j,H.publicMembers.add(K.name,K)}this.scope=B}else{this.typeCheck(b.args);for(var I=0;I<A;I++)e.parameters[I].parameter.typeLink.type=b.args.members[I].type,b.args.members[I].parameterPropertySym&&b.args.members[I].parameterPropertySym.setType(b.args.members[I].type);b.fncFlags&a.FncFlags.IndexerMember&&(!A||A>1?this.checker.errorReporter.simpleError(b,"Index signatures may take only one parameter"):b.args.members[0].type==this.checker.numberType?c.index.flags|=a.SignatureFlags.IsNumberIndexer:b.args.members[0].type==this.checker.stringType?c.index.flags|=a.SignatureFlags.IsStringIndexer:this.checker.errorReporter.simpleError(b,"Index signatures may only take 'string' or 'number' as their parameter"))}if(b.bod&&!b.isSignature()){if(!b.isConstructor)this.addFormals(j,e,m);else{this.addConstructorLocalArgs(b.type.symbol,b.args,m,a.hasFlag(b.fncFlags,a.FncFlags.ClassMethod));if(this.thisClassNode&&this.thisClassNode.extendsList){var N=this.scope,O=new a.ScopedMembers(m);this.scope=new a.FilteredSymbolScopeBuilder(O,f,b.type.symbol,function(b){return b.kind()==a.SymbolKind.Parameter}),this.typeCheckBaseCalls(this.thisClassNode.extendsList),this.scope=N}}var P=this.checker.currentModDecl;b.type&&b.type.symbol&&!b.isMethod()&&b.type.symbol.declModule&&(this.checker.currentModDecl=b.type.symbol.declModule),this.typeCheck(b.bod),this.checker.currentModDecl=P;if(this.checker.checkControlFlow){var Q=b.buildControlFlow();this.checker.printControlFlowGraph&&Q.print(this.checker.errorReporter.outfile),Q.reportUnreachable(this.checker.errorReporter),this.checker.checkControlFlowUseDef&&Q.useDef(this.checker.errorReporter,b.type.symbol)}if(b.isConstructor){var R=b.scopes,S=R.members.length,T,U,V=0;for(;V<S;V++){var W=R.members[V];W.isSignature()||a.hasFlag(W.fncFlags,a.FncFlags.Method)&&!a.hasFlag(W.fncFlags,a.FncFlags.Static)&&this.checkPromoteFreeVars(W,b.type.symbol)}}}this.scope=f,this.thisFnc=g,this.thisClassNode=i,this.enclosingFncIsMethod=h,this.thisType=k,this.checker.locationInfo=l,this.checker.currentModDecl=t,e.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),b.returnTypeAnnotation?(this.checkForVoidConstructor(b.returnTypeAnnotation.type,b.returnTypeAnnotation),e.returnType.type==null&&this.checker.resolveTypeLink(this.scope,e.returnType,!1)):p&&(e.returnType.type=p);if(!(d.flags&a.SymbolFlags.RecursivelyReferenced)&&b.returnStatementsWithExpressions.length>0){var X={getLength:function(){return b.returnStatementsWithExpressions.length},setTypeAtIndex:function(a,c){b.returnStatementsWithExpressions[a].type=c},getTypeAtIndex:function(a){return b.returnStatementsWithExpressions[a].type}},Y=b.returnStatementsWithExpressions[0].type;Y=this.checker.findBestCommonType(Y,null,X);if(Y)e.returnType.type=this.checker.widenType(Y);else{for(var Z=0;Z<b.returnStatementsWithExpressions.length;Z++)this.checker.errorReporter.simpleError(b.returnStatementsWithExpressions[Z],"Incompatible return type");e.returnType.type=this.anyType}}if(e.returnType.type==null)a.hasFlag(b.fncFlags,a.FncFlags.HasReturnExpression)?(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(b,"type implicitly set to 'any'"),e.returnType.type=this.anyType):e.returnType.type=this.voidType;else if(e.returnType.type==this.nullType||e.returnType.type==this.checker.undefinedType)e.returnType.type=this.anyType;else if(e.returnType.type!=this.voidType&&e.returnType.type!=this.checker.undefinedType&&e.returnType.type!=this.anyType&&b.returnTypeAnnotation&&!b.isSignature()&&!b.isConstructor&&!a.hasFlag(b.fncFlags,a.FncFlags.HasReturnExpression)&&!a.hasFlag(b.fncFlags,a.FncFlags.IsFatArrowFunction)){var $=b.bod.members.length>0&&b.bod.members[0].nodeType==a.NodeType.Throw;$||this.checker.errorReporter.simpleError(b,"Function declared a non-void return type, but has no return expression")}n&&this.checker.unsetContextualType();if(b.accessorSymbol){var s=b.accessorSymbol.getType();s?(a.hasFlag(b.fncFlags,a.FncFlags.GetAccessor)&&s!=e.returnType.type||b.args.members.length>0&&s!=b.args.members[0].type)&&this.checker.errorReporter.simpleError(b,"Getter and setter types do not agree"):a.hasFlag(b.fncFlags,a.FncFlags.GetAccessor)?b.accessorSymbol.setType(e.returnType.type):b.args.members.length!=1?this.checker.errorReporter.simpleError(b,"Setters may have one and only one argument"):b.accessorSymbol.setType(b.args.members[0].type)}return this.typeCheckOverloadSignatures(c,b),b},c.prototype.typeCheckBases=function(b){var c=!1,d=b.extendsList;if(d){var e=d.length;this.inNewTargetTypeCheck=!0,e>0&&(b.typeFlags|=a.TypeFlags.HasBaseType);for(var f=0;f<e;f++){var g=d[f],h=g.symbol&&g.symbol.name=="Object"&&g.symbol.container==this.checker.gloMod;h&&(b.typeFlags|=a.TypeFlags.HasBaseTypeOfObject
);if(g.isClassInstance())b.isClassInstance()&&!this.checker.typeStatusIsFinished(g.symbol.typeCheckStatus)&&g.symbol.declAST&&(this.checker.errorReporter.simpleErrorFromSym(g.symbol,"Base type '"+g.symbol.name+"' is referenced before its declaration"),this.typeCheck(g.symbol.declAST)),this.currentScript&&(this.currentScript.requiresInherits=!0),b.isClassInstance()?c&&this.checker.errorReporter.simpleErrorFromSym(g.symbol,"Class may not follow interface as base type"):this.checker.errorReporter.simpleErrorFromSym(g.symbol,"Interface base type must be interface");else if(g.isModuleType())this.checker.errorReporter.simpleErrorFromSym(g.symbol,"Types may not be derived from module types");else{if(!g.members){b.isClassInstance()?this.checker.errorReporter.simpleErrorFromSym(g.symbol,"Base type must be interface or class"):this.checker.errorReporter.simpleErrorFromSym(g.symbol,"Interface base type must be interface");break}c||(c=!0)}}this.inNewTargetTypeCheck=!1}},c.prototype.checkMembersImplementInterfaces=function(b){var c=b.getInstanceType();if(c.implementsList){var d=c.implementsList.length;this.inNewTargetTypeCheck=!0;for(var e=0;e<d;e++){var f=c.implementsList[e],g=new a.TypeComparisonInfo;if(!this.checker.sourceIsSubtypeOfTarget(c,f,g)){var h="Class '"+c.getTypeName()+"' declares interface '"+f.getTypeName()+"' but does not implement it";g.message?this.checker.errorReporter.simpleErrorFromSym(c.symbol,h+": "+g.message):this.checker.errorReporter.simpleErrorFromSym(c.symbol,h)}}this.inNewTargetTypeCheck=!1}},c.prototype.typeCheckBaseCalls=function(b){if(b==null)return;var c=b.members.length;for(var d=0;d<c;d++){var e=b.members[d],f=null;e.nodeType==a.NodeType.Call&&this.typeCheckNew(e)}},c.prototype.assertUniqueNamesInBaseTypes=function(b,c,d,e){var f=this;if(c){c.members&&c.members.publicMembers.map(function(a,g,h){var i=g,j=b.lookup(i.name);j?e&&f.checker.errorReporter.simpleError(d,"duplicate member name in bases for "+d.name.text+": "+c.symbol.name+" and "+j.container.name+" both contain member with name "+i.name):b.add(i.name,i)},null);if(c.extendsList){var g=c.extendsList.length;for(var h=0;h<g;h++)c.extendsList[h].symbol.flags&a.SymbolFlags.RecursivelyReferenced||this.assertUniqueNamesInBaseTypes(b,c.extendsList[h],d,e)}}},c.prototype.checkBaseTypeMemberInheritance=function(b,c){var d=this,e=b.getInstanceType();if(e.extendsList==null)return;var f=e.extendsList.length;if(f>0){var g=new a.StringHashTable;if(e.isClassInstance())for(var h=0;h<f;h++)this.assertUniqueNamesInBaseTypes(g,e.extendsList[h],c,h>0);e.members&&e.members.publicMembers.map(function(b,g,h){var i=g;for(var j=0;j<f;j++){var k=e.extendsList[j];if(k.memberScope==null)d.checker.errorReporter.simpleError(c,"Base type '"+k.symbol.name+"' lacks an implementation.");else{var l=k.memberScope.find(i.name,!1,!1);if(l){var m=i.getType(),n=l.getType();d.checker.sourceIsSubtypeOfTarget(m,n)?i.kind()==a.SymbolKind.Type&&l.kind()==a.SymbolKind.Field&&d.checker.errorReporter.simpleErrorFromSym(i,"Cannot override field '"+i.name+"' with method"):d.checker.errorReporter.simpleErrorFromSym(i,"Type of overridden member '"+i.name+"' is not subtype of original member defined by type '"+l.container.name+"'")}}}},null)}},c.prototype.typeCheckClass=function(b){var c=b.type.symbol;if(c.typeCheckStatus==a.TypeCheckStatus.Finished)return b;if(c.typeCheckStatus==a.TypeCheckStatus.Started)return b;c.typeCheckStatus=a.TypeCheckStatus.Started,this.checker.addStartedPTO(c);var d=this.scope,e=this.thisClassNode;this.thisClassNode=b;var f=b.type;this.typeCheckBases(f.instanceType);var g=this.thisType;this.thisType=f.instanceType,this.scope=f.instanceType.containedScope;if(b.constructorDecl){this.scope=f.instanceType.constructorScope;var h=this.scope,i=h.valueMembers.allMembers;this.addConstructorLocalArgs(b.constructorDecl.type.symbol,b.constructorDecl.args,i,!0)}return this.typeCheck(b.members),c.typeCheckStatus=a.TypeCheckStatus.Finished,this.checkBaseTypeMemberInheritance(f,b),this.checkMembersImplementInterfaces(f),this.typeCheckOverloadSignatures(f,b),this.typeCheckOverloadSignatures(f.instanceType,b),b.constructorDecl||b.baseClass&&b.baseClass.members.length&&b.baseClass.members[0].type&&b.baseClass.members[0].type.symbol.type.isClass()&&a.cloneParentConstructGroupForChildType(b.type,b.baseClass.members[0].type.symbol.type),this.thisType=g,this.thisClassNode=e,this.scope=d,b},c.prototype.typeCheckOverloadSignatures=function(a,b){a.call&&a.call.typeCheck(this.checker,b,a.construct!=null),a.construct&&a.construct.typeCheck(this.checker,b,!1),a.index&&a.index.typeCheck(this.checker,b,!1)},c.prototype.typeCheckInterface=function(a){this.typeCheckBases(a.type),this.typeCheck(a.members),this.checkBaseTypeMemberInheritance(a.type,a);if(a.extendsList)for(var b=0;b<a.extendsList.members.length;b++)a.extendsList.members[b].type.call&&(a.type.call?a.type.call.signatures=a.type.call.signatures.concat(a.extendsList.members[b].type.call.signatures):a.type.call=a.extendsList.members[b].type.call),a.extendsList.members[b].type.construct&&(a.type.construct?a.type.construct.signatures=a.type.construct.signatures.concat(a.extendsList.members[b].type.construct.signatures):a.type.construct=a.extendsList.members[b].type.construct),a.extendsList.members[b].type.index&&(a.type.index?a.type.index.signatures=a.type.index.signatures.concat(a.extendsList.members[b].type.index.signatures):a.type.index=a.extendsList.members[b].type.index);return a},c.prototype.typeCheckImportDecl=function(b){var c=b.alias.type,d=null,e=this.inImportTypeCheck;return this.inImportTypeCheck=!0,this.typeCheck(b.alias),c=b.alias.type,c==null&&(this.checker.errorReporter.simpleError(b.alias,"Could not resolve module alias '"+b.id.text+"'"),c=this.checker.anyType,b.id.sym.type=c),b.id.type=c,d=c.symbol,c.isModuleType()?(d.type=c,this.checker.currentModDecl&&this.checker.currentModDecl.mod&&this.checker.currentModDecl.mod.importedModules.push(b),b.id.sym.type=c,c.symbol&&c.symbol.declAST&&(c.symbol.declAST.modFlags&=~a.ModuleFlags.ShouldEmitModuleDecl)):this.checker.errorReporter.simpleError(b.alias,"A module cannot be aliased to a non-module type"),this.inImportTypeCheck=e,b},c.prototype.typeCheckModule=function(b){if(!b.mod)return b;this.currentScript&&(this.currentScript.requiresGlobal=!0);var c=b.mod,d=null,e=this.scope,f=this.thisType,g=this.checker.currentModDecl;return this.checker.currentModDecl=b,!this.inImportTypeCheck&&g&&a.hasFlag(b.modFlags,a.ModuleFlags.IsDynamic)&&!a.hasFlag(b.modFlags,a.ModuleFlags.Ambient)&&this.checker.errorReporter.simpleError(b,"Dynamic modules may not be nested within other modules"),this.thisType=null,this.scope=c.containedScope,this.typeCheck(b.members),d=c.symbol,this.checker.currentModDecl=g,this.thisType=f,this.scope=e,b.type=c,d&&(d.typeCheckStatus=a.TypeCheckStatus.Finished),b},c.prototype.typeCheckFor=function(a){return a.init=this.typeCheck(a.init),this.nestingLevel++,a.cond=this.typeCheck(a.cond),this.typeCheckCondExpr(a.cond),a.incr=this.typeCheck(a.incr),this.nestingLevel--,a.body=this.typeCheck(a.body),this.typeCheckCompoundStmtBlock(a.body,"for statement"),a.type=this.voidType,a},c.prototype.typeCheckWith=function(a){return this.checker.errorsOnWith&&this.checker.errorReporter.simpleError(a.expr,"All symbols within a 'with' block will be typed as 'any'"),a.expr=this.typeCheck(a.expr),this.checker.inWith=!0,a.body=this.typeCheck(a.body),this.typeCheckCompoundStmtBlock(a.body,"with statement"),this.checker.inWith=!1,a},c.prototype.typeCheckForIn=function(b){b.obj=this.typeCheck(b.obj),b.lval=this.cast(this.typeCheck(b.lval),this.checker.stringType);if(b.lval.nodeType==a.NodeType.VarDecl){var c=b.lval;c.typeExpr&&this.checker.errorReporter.simpleError(c,"Variable declarations for for/in expressions may not contain a type annotation"),c.sym&&c.sym.setType(this.checker.stringType)}return b.body=this.typeCheck(b.body),this.typeCheckCompoundStmtBlock(b.body,"for in statement"),b},c.prototype.typeCheckWhile=function(a){return a.cond=this.typeCheck(a.cond),this.typeCheckCondExpr(a.cond),a.body=this.typeCheck(a.body),this.typeCheckCompoundStmtBlock(a.body,"while statement"),a.type=this.voidType,a},c.prototype.typeCheckDoWhile=function(a){return a.cond=this.typeCheck(a.cond),this.typeCheckCondExpr(a.cond),a.body=this.typeCheck(a.body),this.typeCheckCompoundStmtBlock(a.body,"do while statement"),a.type=this.voidType,a},c.prototype.typeCheckCondExpr=function(b){this.checker.styleSettings.assignmentInCond&&b!==null&&b.nodeType>=a.NodeType.Asg&&b.nodeType<=a.NodeType.LastAsg&&this.checker.errorReporter.simpleError(b,"top-level assignment statement in conditional expression")},c.prototype.typeCheckCompoundStmtBlock=function(b,c){this.checker.styleSettings.blockInCompoundStmt&&b&&b.nodeType!=a.NodeType.Block&&this.checker.errorReporter.styleError(b,c+" requires a block")},c.prototype.typeCheckIf=function(a){return a.cond=this.typeCheck(a.cond),this.typeCheckCondExpr(a.cond),a.thenBod=this.typeCheck(a.thenBod),a.elseBod=this.typeCheck(a.elseBod),this.typeCheckCompoundStmtBlock(a.thenBod,"if statement"),this.typeCheckCompoundStmtBlock(a.elseBod,"if statement"),a.type=this.voidType,a},c.prototype.typeFromAccessorFuncDecl=function(b){return b.isAccessor()?a.hasFlag(b.fncFlags,a.FncFlags.GetAccessor)?b.type.call.signatures[0].returnType.type:b.type.call.signatures[0].parameters[0].getType():null},c.prototype.typeCheckObjectLit=function(b){var c=new a.Type;c.symbol=new a.TypeSymbol(this.checker.anon,b.minChar,this.checker.locationInfo.unitIndex,c),c.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),c.memberScope=new a.SymbolTableScope(c.members,null,null,null,null);var d=new a.SymbolAggregateScope(c.symbol);d.addParentScope(c.memberScope),d.addParentScope(this.scope),c.containedScope=d;var e=b.operand,f=this.thisType,g=!1,h=null;this.checker.hasTargetType()&&(h=this.checker.getTargetTypeContext().contextualType,h&&h.symbol&&!this.checker.typeStatusIsFinished(h.symbol.typeCheckStatus)&&h.symbol.declAST&&this.typeCheck(h.symbol.declAST),g=!0);if(e)for(var i=0,j=e.members.length;i<j;i++){var k=e.members[i],l=k.operand1,m,n=null,o=null;if(l.nodeType==a.NodeType.Name)m=l.text;else{if(l.nodeType!=a.NodeType.QString){this.checker.errorReporter.simpleError(b,"malformed object literal"),c=this.anyType;break}var p=l.text;m=p.substring(1,p.length-1)}g&&h.memberScope&&(n=h.memberScope.find(m,!1,!1));if(k.operand2.nodeType==a.NodeType.FuncDecl&&k.operand2.isAccessor()){var q=k.operand2,r=c.members.publicMembers.lookup(m);r=this.checker.createAccessorSymbol(q,r,c,!0,!1,c.memberScope,null),q.accessorSymbol=r,o=r,l.nodeType==a.NodeType.Name&&(l.sym=r)}this.checker.typeCheckWithContextualType(g&&n?n.getType():null,!1,g,k.operand2);if(g&&n){if(k.operand2.type==this.anyType||this.checker.sourceIsAssignableToTarget(k.operand2.type,n.getType())||k.operand2.nodeType==a.NodeType.FuncDecl&&k.operand2.isAccessor()&&this.typeFromAccessorFuncDecl(k.operand2)==n.getType())k.operand1.type=n.getType()}else k.operand2.type=k.operand2.type==this.checker.undefinedType?this.anyType:k.operand2.type;if(o==null){var s=k.operand2.type,t=new a.ValueLocation;o=new a.FieldSymbol(m,l.minChar,this.checker.locationInfo.unitIndex,!0,t),o.flags|=a.SymbolFlags.Property,t.symbol=o,o.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),t.typeLink=new a.TypeLink,t.typeLink.type=s,c.members.publicMembers.add(m,o)}o.isObjectLitField=!0}this.thisType=f,b.type=c,h&&(b.targetType=h)},c.prototype.typeCheckArrayLit=function(b){var c=b.operand,d=this.anyType,e=null,f=new a.TypeComparisonInfo;f.onlyCaptureFirstError=!0;if(this.checker.hasTargetType()){var g=this.checker.getTargetTypeContext().contextualType;g.elementType&&(e=g.elementType)}if(c){var h=this.inArrayElementTypeCheck;this.inArrayElementTypeCheck=!0,this.checker.typeCheckWithContextualType(e,this.checker.inProvisionalTypecheckMode(),e!=null,c),this.inArrayElementTypeCheck=h,d=c.members[0].type;var i={getLength:function(){return c.members.length},setTypeAtIndex:function(a,b){c.members[a].type=b},getTypeAtIndex:function(a){return c.members[a].type}};d=this.checker.findBestCommonType(d,e,i,f);if(d==this.checker.undefinedType||!h&&d==this.nullType)d=this.anyType}if(!d){var j="Incompatible types in array literal expression";f.message?this.checker.errorReporter.simpleError(b,j+": "+f.message):this.checker.errorReporter.simpleError(b,j),d=this.anyType}else e&&this.checker.sourceIsAssignableToTarget(d,e)&&(d=e);b.type=this.checker.makeArrayType(d)},c.prototype.checkForVoidConstructor=function(a,b){if(a&&a.construct&&a.construct.signatures.length>0)for(var c=0;c<a.construct.signatures.length;c++)if(a.construct.signatures[c].returnType.type==this.checker.voidType){this.checker.errorReporter.simpleError(b,"Constructors may not have a return type of 'void'");break}},c.prototype.typeCheckReturn=function(b){if(this.thisFnc){var c=null;if(this.checker.hasTargetType()){var d=this.checker.getTargetTypeContext(),e=d.targetAccessorType;if(e)c=e;else{var f=this.checker.getTargetTypeContext().targetSig;f&&f.returnType.type!=this.voidType&&(c=f.returnType.type)}}if(b.returnExpression){this.thisFnc.fncFlags|=a.FncFlags.HasReturnExpression,c==null&&this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type&&this.thisFnc.returnTypeAnnotation.type!=this.voidType&&(c=this.thisFnc.returnTypeAnnotation.type),this.checker.typeCheckWithContextualType(c,this.checker.inProvisionalTypecheckMode(),c!=null,b.returnExpression);var g=this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type?this.thisFnc.returnTypeAnnotation.type:c;g?g==this.voidType&&b.returnExpression.type!=this.voidType?(this.checker.errorReporter.simpleError(b,"Return with value expression in void function"),b.type=b.returnExpression.type):(b.returnExpression=this.cast(b.returnExpression,g),b.type=g):(c&&(b.returnExpression.type!=this.voidType?b.returnExpression=this.cast(b.returnExpression,c):b.returnExpression.type=c),b.type=b.returnExpression.type),this.thisFnc.returnStatementsWithExpressions[this.thisFnc.returnStatementsWithExpressions.length]=b}else b.type=c==null?this.checker.voidType:c}return b},c.prototype.typeCheckInstOf=function(a){var b=a;return b.operand1=this.typeCheck(b.operand1),b.operand2=this.typeCheck(b.operand2),(b.operand1.type!=this.checker.anyType&&!this.checker.sourceIsSubtypeOfTarget(b.operand1.type,this.objectInterfaceType)||b.operand2.type!=this.anyType&&!this.checker.sourceIsSubtypeOfTarget(b.operand2.type,this.functionInterfaceType))&&this.checker.errorReporter.simpleError(a,"The instanceof operator requires the left operand to be of type Any or an object type, and the right operand to be of type Any or a subtype of the Function interface type"),b.type=this.booleanType,b},c.prototype.typeCheckCommaOperator=function(a){var b=a;return b.operand1=this.typeCheck(b.operand1),b.operand2=this.typeCheck(b.operand2),b.type=b.operand2.type,b},c.prototype.typeCheckLogOr=function(a){a.operand1=this.typeCheck(a.operand1),a.operand2=this.typeCheck(a.operand2);var b=a.operand1.type,c=a.operand2.type;return b==this.checker.anyType||c==this.checker.anyType?a.type=this.checker.anyType:b==this.checker.booleanType?c==this.checker.booleanType?a.type=this.checker.booleanType:a.type=this.checker.anyType:b==this.checker.numberType?c==this.checker.numberType?a.type=this.checker.numberType:a.type=this.checker.anyType:b==this.checker.stringType?c==this.checker.stringType?a.type=this.checker.stringType:a.type=this.checker.anyType:this.checker.sourceIsSubtypeOfTarget(b,c)?a.type=c:this.checker.sourceIsSubtypeOfTarget(c,b)?a.type=b:a.type=this.checker.anyType,a},c.prototype.typeCheckLogAnd=function(a){return a.operand1=this.typeCheck(a.operand1),a.operand2=this.typeCheck(a.operand2),a.type=a.operand2.type,a},c.prototype.tryAddCandidates=function(a,b,c,d,e){var f=a.nonOptionalParameterCount,g=a.parameters.length,h=f,i=!1;b.length>=f&&(a.hasVariableArgList||b.length<=g)&&(h=a.hasVariableArgList?a.parameters.length:b.length,i=!0);var j=null;if(i||a.hasVariableArgList){a.hasVariableArgList&&(h-=1,j=a.parameters[h].parameter.typeLink.type,j=j.elementType,i=b.length>=h);var k=b.length,l=i,m=i;for(var n=0;n<k;n++){var o;n<h?o=a.parameters[n].parameter.typeLink.type:o=j;var p=b[n];if(!o||!p||!this.checker.typesAreIdentical(o,p))l=!1;this.checker.sourceIsAssignableToTarget(p,o,e)||(m=!1);if(!l&&!m)break}l?c[c.length]=a:m&&c.length==0&&(d[d.length]=a)}},c.prototype.resolveOverload=function(b,c){var d=this.resolutionDataCache.getResolutionData(),e=d.actuals,f=d.exactCandidates,g=d.conversionCandidates,h=null,i=c.signatures.length>1,j=new a.TypeComparisonInfo,k=null,l=null;if(b.nodeType==a.NodeType.Call||b.nodeType==a.NodeType.New){var m=b;k=m.args,l=m.target;if(m.args){var n=m.args.members.length;for(var o=0;o<n;o++)e[o]=m.args.members[o].type}}else if(b.nodeType==a.NodeType.Index){var p=b;l=p.operand1,k=new a.ASTList,k.members[0]=p.operand2,e[0]=p.operand2.type}for(var q=0,r=c.signatures.length;q<r;q++){var s=c.signatures[q];if(i&&s==c.definitionSignature&&!this.checker.canCallDefinitionSignature)continue;!s.returnType.type&&s.declAST&&s.typeCheckStatus!=a.TypeCheckStatus.Finished&&this.typeCheckFunction(s.declAST),this.tryAddCandidates(s,e,f,g,j)}if(f.length==0){var t=this.checker.getApplicableSignatures(g,k,j);if(t.length>0){var u=this.checker.findMostApplicableSignature(t,k);u.ambiguous&&this.checker.errorReporter.simpleError(l,"Ambiguous call expression - could not choose overload"),h=u.sig}else{var v="Supplied parameters do not match any signature of call target";j.message?this.checker.errorReporter.simpleError(l,v+":\n\t"+j.message):this.checker.errorReporter.simpleError(l,v)}}else if(f.length>1){var w=[];for(var o=0;o<f.length;o++)w[o]={signature:f[o],hadProvisionalErrors:!1};var u=this.checker.findMostApplicableSignature(w,k);u.ambiguous&&this.checker.errorReporter.simpleError(l,"Ambiguous call expression - could not choose overload"),h=u.sig}else h=f[0];return this.resolutionDataCache.returnResolutionData(d),h},c.prototype.typeCheckNew=function(a){var b=a;b.target=this.typeCheck(b.target);var c=b.target;c.type.construct||c.type.call?this.preTypeCheckCallArgs(b.args):b.args=this.typeCheck(b.args);if(c.type==this.anyType)b.type=this.anyType,b.args=this.typeCheck(b.args);else if(c.type.construct){var d=this.resolveOverload(b,c.type.construct);d==null?b.type=this.anyType:d.returnType.type==this.voidType?(b.type=this.anyType,b.signature=d):(b.type=d.returnType.type,b.signature=d)}else if(c.type.call){var d=this.resolveOverload(b,c.type.call);d==null?b.type=this.anyType:d.returnType.type==this.voidType||d.returnType.type==this.anyType?(b.type=this.anyType,b.signature=d):this.checker.errorReporter.simpleError(b.target,"new expression only valid on constructors")}else c.type.elementType?b.type=c.type:(this.checker.errorReporter.invalidCall(b,b.nodeType,this.scope),b.type=this.anyType);return this.postTypeCheckCallArgs(b),b},c.prototype.preTypeCheckCallArgs=function(b){if(!b)return;for(var c=0;c<b.members.length;c++)switch(b.members[c].nodeType){case a.NodeType.FuncDecl:case a.NodeType.ObjectLit:case a.NodeType.ArrayLit:continue;default:this.typeCheck(b.members[c])}},c.prototype.postTypeCheckCallArgs=function(b){var c=!1,d=0;if(b.target&&b.target.type&&b.signature&&b.args){var e=b.signature;if(e&&b.args.members.length>=e.nonOptionalParameterCount){c=!0;var f=null,g=b.args.members.length<e.parameters.length?b.args.members.length:e.parameters.length;for(d=0;d<g;d++){f=e.parameters[d].getType(),f&&e.hasVariableArgList&&d>=e.nonOptionalParameterCount-1&&(f=f.elementType);switch(b.args.members[d].nodeType){case a.NodeType.FuncDecl:case a.NodeType.ObjectLit:case a.NodeType.ArrayLit:this.checker.typeCheckWithContextualType(f,this.checker.inProvisionalTypecheckMode(),!e.parameters[d].declAST.isParenthesized,b.args.members[d]);break;default:continue}}}}if(!c&&b.args){this.checker.killTargetType();for(d=0;d<b.args.members.length;d++)switch(b.args.members[d].nodeType){case a.NodeType.FuncDecl:case a.NodeType.ObjectLit:case a.NodeType.ArrayLit:this.typeCheck(b.args.members[d]);break;default:continue}}},c.prototype.typeCheckCall=function(b){var c=b;this.checker.styleSettings.newMustBeUsed&&b.nodeType==a.NodeType.New?a.hasFlag(b.flags,a.ASTFlags.IsStatement)&&this.checker.errorReporter.styleError(b,"use of new expression as a statement"):!this.checker.styleSettings.evalOK&&b.nodeType==a.NodeType.Call&&c.target.nodeType==a.NodeType.Name&&c.target.text=="eval"&&this.checker.errorReporter.styleError(c,"eval not permitted"),c.target.nodeType==a.NodeType.FuncDecl&&(c.target.isInlineCallLiteral=!0);var d=this.inSuperCall;c.target.nodeType==a.NodeType.Super&&(this.inSuperCall=!0),c.target=this.typeCheck(c.target),this.preTypeCheckCallArgs(c.args);var e=c.target;if(e.type==null||e.type==this.anyType||this.functionInterfaceType&&e.type==this.functionInterfaceType)c.type=this.anyType;else{var f=e.type;if(f.call){var g=this.resolveOverload(c,f.call);g==null?c.type=this.anyType:(c.type=g.returnType.type,c.signature=g)}else if(c.target.nodeType==a.NodeType.Super&&this.thisFnc&&this.thisFnc.isConstructor&&a.hasFlag(this.thisFnc.fncFlags,a.FncFlags.ClassMethod)){var g=f.symbol.type.construct?this.resolveOverload(c,f.symbol.type.construct):null;g==null?c.type=this.anyType:(c.flags|=a.ASTFlags.ClassBaseConstructorCall,c.type=g.returnType.type,c.signature=g)}else c.type=this.anyType,this.checker.errorReporter.invalidCall(c,c.nodeType,this.scope)}return this.postTypeCheckCallArgs(c),this.inSuperCall=d,c},c.prototype.assignScopes=function(c){var d=c;this.checker.locationInfo=d.locationInfo;var e=new b(null,null,this.globalScope),f=new a.AssignScopeContext(e,this,[this.checker.currentModDecl]);a.getAstWalkerFactory().walk(c,a.preAssignScopes,a.postAssignScopes,null,f)},c.prototype.findMemberScope=function(b,c){var d=b.getScope(),e=b.pos-b.getScriptFragmentPosition(),f=b.getScriptFragment(),g=new a.MemberScopeContext(this,e,c);return g.scope=d,f.nodeType==a.NodeType.Name?f.type.getMemberScope(this):(a.getAstWalkerFactory().walk(f,a.preFindMemberScope,null,null,g),g.ast&&b.enclosingClassDecl&&g.ast.type==b.enclosingClassDecl.type.instanceType&&(b.publicsOnly=!1),g.type?g.type.getMemberScope(this):null)},c.prototype.findMemberScopeAt=function(b){return this.findMemberScope(b,a.ASTFlags.DotLHS)},c.prototype.findMemberScopeAtFullAst=function(b){var c=a.ASTFlags.DotLHS,d=b.pos,e=null,f=function(b,f,g){return a.isValidAstNode(b)&&(a.hasFlag(b.flags,c)&&(d==b.limChar||d-1==b.limChar)&&(e=b,g.options.stopWalk()),g.options.goChildren=b.minChar<=d&&d<=b.limChar),b},g=function(b,f,g){return a.isValidAstNode(b)&&(a.hasFlag(b.flags,c)&&b.minChar<d&&d<=b.limChar&&(e=b),g.options.goChildren=b.minChar<=d&&d<=b.limChar),b};return a.getAstWalkerFactory().walk(b.script,f),e==null&&a.getAstWalkerFactory().walk(b.script,g),e&&b.enclosingClassDecl&&e.type==b.enclosingClassDecl.type.instanceType&&(b.publicsOnly=!1),e&&e.type?e.type.getMemberScope(this):null},c}();a.TypeFlow=i})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function j(a,b,c){var d=new i;return d.ast=a,a==null&&c?d.type=b.anyType:d.type=null,d}(function(a){a._map=[],a.None=0,a.Void=1,a.Double=2,a.String=4,a.Boolean=8,a.Any=16,a.Null=32,a.Undefined=64})(a.Primitive||(a.Primitive={}));var b=a.Primitive,c=function(){function a(){this.prefix="",this.suffix=""}return a.prototype.isString=function(){return!1},a.prototype.isArray=function(){return!1},a.prototype.toString=function(){return a.memberNameToString(this)},a.memberNameToString=function(c){var d=c.prefix;if(c.isString())d+=c.text;else{var e=c;for(var f=0;f<e.entries.length;f++)d+=a.memberNameToString(e.entries[f]),d+=e.delim}return d+=c.suffix,d},a.create=function(b,c,f){if(typeof b=="string")return new d(b);var g=new e;return c&&(g.prefix=c),f&&(g.suffix=f),g.entries.push(b),g},a}();a.MemberName=c;var d=function(a){function b(b){a.call(this),this.text=b}return __extends(b,a),b.prototype.isString=function(){return!0},b}(c);a.MemberNameString=d;var e=function(a){function b(){a.apply(this,arguments),this.delim="",this.entries=[]}return __extends(b,a),b.prototype.isArray=function(){return!0},b.prototype.add=function(a){this.entries.push(a)},b.prototype.addAll=function(a){for(var b=0;b<a.length;b++)this.entries.push(a[b])},b}(c);a.MemberNameArray=e;var f=-1,g=function(){function d(){this.typeID=f++,this.construct=null,this.call=null,this.index=null,this.passTypeCreated=a.CompilerDiagnostics.analysisPass,this.primitiveTypeClass=b.None,this.typeFlags=a.TypeFlags.None}return d.prototype.baseClass=function(){return this.extendsList&&this.extendsList.length>0?this.extendsList[0]:null},d.prototype.getArrayBase=function(a,b){return this.arrayCache.specialize(a,b)},d.prototype.isClass=function(){return this.instanceType!=null},d.prototype.isArray=function(){return this.elementType!=null},d.prototype.isClassInstance=function(){return this.symbol&&!this.elementType&&this.symbol.type.isClass()},d.prototype.getInstanceType=function(){return this.isClass()?this.instanceType:this},d.prototype.hasImplementation=function(){return a.hasFlag(this.typeFlags,a.TypeFlags.HasImplementation)},d.prototype.setHasImplementation=function(){this.typeFlags|=a.TypeFlags.HasImplementation},d.prototype.isDouble=function(){return a.hasFlag(this.primitiveTypeClass,b.Double)},d.prototype.isString=function(){return a.hasFlag(this.primitiveTypeClass,b.String)},d.prototype.isBoolean=function(){return a.hasFlag(this.primitiveTypeClass,b.Boolean)},d.prototype.isNull=function(){return a.hasFlag(this.primitiveTypeClass,b.Null)},d.prototype.getTypeName=function(){return this.getMemberTypeName("",!0,!1,null)},d.prototype.getScopedTypeName=function(a){return this.getMemberTypeName("",!0,!1,a)},d.prototype.getScopedTypeNameEx=function(a){return this.getMemberTypeNameEx("",!0,!1,a)},d.prototype.callCount=function(){var a=0;return this.call&&(a+=this.call.signatures.length),this.construct&&(a+=this.construct.signatures.length),this.index&&(a+=this.index.signatures.length),a},d.prototype.getMemberTypeName=function(a,b,c,d){var e=this.getMemberTypeNameEx(a,b,c,d);return e.toString()},d.prototype.getMemberTypeNameEx=function(b,d,f,g){if(this.elementType)return c.create(this.elementType.getMemberTypeNameEx(b,!1,!0,g),"","[]");if(this.symbol&&this.symbol.name&&this.symbol.name!="_anonymous"&&(this.call==null&&this.construct==null&&this.index==null||a.hasFlag(this.typeFlags,a.TypeFlags.BuildingName)||this.members&&!this.isClass())){var h=this.symbol.scopeRelativeName(g);return c.create(h=="null"?"any":h)}if(this.members||this.call||this.construct){if(a.hasFlag(this.typeFlags,a.TypeFlags.BuildingName))return c.create("this");this.typeFlags|=a.TypeFlags.BuildingName;var i="",j=new e,k=f,l=0,m=0,n="; ";this.members&&this.members.allMembers.map(function(b,d,e){var f=d;if(!a.hasFlag(f.flags,a.SymbolFlags.BuiltIn)){var h=f.getTypeName(g);h.length>=n.length&&h.substring(h.length-n.length)==n&&(h=h.substring(0,h.length-n.length)),j.add(c.create(h)),m++;if(f.kind()==a.SymbolKind.Type){var i=f.type;i.callCount()>1&&(k=!0)}else k=!0}},null);var o,p,q=0,r=m==0&&this.callCount()==1&&d;r||(j.delim=n);if(this.call){o=this.call.toStrings(b,r,g);for(p=0,q=o.length;p<q;p++)j.add(c.create(o[p])),l++}if(this.construct){o=this.construct.toStrings("new",r,g);for(p=0,q=o.length;p<q;p++)j.add(c.create(o[p])),l++}if(this.index){o=this.index.toStrings("",r,g);for(p=0,q=o.length;p<q;p++)j.add(c.create(o[p])),l++}if(k||l>1&&d)j.prefix="{ ",j.suffix="}";return this.typeFlags&=~a.TypeFlags.BuildingName,l==0&&m==0?c.create("{}"):j}return c.create("{}")},d.prototype.checkDecl=function(a){(this.isClassInstance()||this.isClass())&&this.symbol.declAST&&a.typeFlow.inScopeTypeCheckDecl(this.symbol.declAST)},d.prototype.getMemberScope=function(a){if(this==a.anyType)return null;if(this.isDouble())return a.numberInterfaceType?a.numberInterfaceType.memberScope:null;if(this.isBoolean())return a.booleanInterfaceType?a.booleanInterfaceType.memberScope:null;if(this==a.stringType)return a.stringInterfaceType?a.stringInterfaceType.memberScope:null;if(this.elementType){if(a.arrayInterfaceType){var b=this.elementType.getArrayBase(a.arrayInterfaceType,a.checker);return b.memberScope}return null}return this.memberScope},d.prototype.isReferenceType=function(){return this.members||this.extendsList||this.construct||this.call||this.index||this.elementType},d.prototype.specializeType=function(b,c,e,f){if(b==this)return c;var g=this;return f?this.isReferenceType()&&(g=new d,this.members&&(g.members=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),this.members.publicMembers.map(function(a,d,f){var h=d,i=h.specializeType(b,c,e);g.members.addPublicMember(i.name,i)},null),this.members.privateMembers.map(function(a,d,f){var h=d,i=h.specializeType(b,c,e);g.members.addPrivateMember(i.name,i)},null)),this.ambientMembers&&(g.ambientMembers=new a.ScopedMembers(new a.DualStringHashTable(new a.StringHashTable,new a.StringHashTable)),this.ambientMembers.publicMembers.map(function(a,d,f){var h=d,i=h.specializeType(b,c,e);g.ambientMembers.addPublicMember(i.name,i)},null),this.ambientMembers.privateMembers.map(function(a,d,f){var h=d,i=h.specializeType(b,c,e);g.ambientMembers.addPrivateMember(i.name,i)},null)),g.containedScope=e.scopeOf(g),g.memberScope=g.containedScope):this.elementType?this.elementType==b?g=e.makeArrayType(c):this.elementType.elementType==b&&(g=e.makeArrayType(e.makeArrayType(c))):this.call&&(g=new d,g.call=this.call.specializeType(b,c,e)),g},d.prototype.hasBase=function(a){if(a==this)return!0;if(this.extendsList)for(var b=0,c=this.extendsList.length;b<c;b++)if(this.extendsList[b].hasBase(a))return!0;return!1},d.prototype.mergeOrdered=function(a,b,c){if(this==b.anyType||a==b.anyType)return b.anyType;if(this==a)return this;if(a==b.nullType&&this!=b.nullType)return this;if(this==b.nullType&&a!=b.nullType)return a;if(a==b.voidType&&this!=b.voidType)return this;if(this==b.voidType&&a!=b.voidType)return a;if(a==b.undefinedType&&this!=b.undefinedType)return this;if(this==b.undefinedType&&a!=b.undefinedType)return a;if(this.elementType&&a.elementType){if(this.elementType==a.elementType)return this;var d=this.elementType.mergeOrdered(a.elementType,b,c);return d==null?b.makeArrayType(b.anyType):b.makeArrayType(d)}return b.sourceIsSubtypeOfTarget(this,a,c)?a:b.sourceIsSubtypeOfTarget(a,this,c)?this:null},d.prototype.isModuleType=function(){return!1},d.prototype.hasMembers=function(){return this.members!=null},d.prototype.getAllEnclosedTypes=function(){return null},d.prototype.getAllAmbientEnclosedTypes=function(){return null},d.prototype.getPublicEnclosedTypes=function(){return null},d.prototype.getpublicAmbientEnclosedTypes=function(){return null},d}();a.Type=g;var h=function(a){function b(b,c){a.call(this),this.enclosedTypes=b,this.ambientEnclosedTypes=c,this.importedModules=[]}return __extends(b,a),b.prototype.isModuleType=function(){return!0},b.prototype.hasMembers=function(){return this.members!=null||this.enclosedTypes!=null},b.prototype.getAllEnclosedTypes=function(){return this.enclosedTypes},b.prototype.getAllAmbientEnclosedTypes=function(){return this.ambientEnclosedTypes},b.prototype.getPublicEnclosedTypes=function(){return null},b.prototype.getpublicAmbientEnclosedTypes=function(){return null},b}(g);a.ModuleType=h;var i=function(){function a(){this.type=null,this.ast=null}return a}();a.TypeLink=i,a.getTypeLink=j})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function b(a){return a.replace('"',"").replace("'","").replace("'","").replace('"',"")}function c(a){return a.indexOf('"')!=-1||a.indexOf("'")!=-1||a.indexOf("'")!=-1||a.indexOf('"')!=-1}function d(a){return'"'+a+'"'}function e(a){return a.indexOf('"')!=-1?(a=a.replace('"',"'"),a=a.replace('"',"'")):(a=a.replace("'",'"'),a=a.replace("'",'"')),a}function f(a){return a.replace(/\\/g,"/")}function g(a){return a.length>6&&a.substring(a.length-6,a.length)==".d.str"?a.substring(0,a.length-6):a.length>4&&a.substring(a.length-4,a.length)==".str"?a.substring(0,a.length-4):a.length>5&&a.substring(a.length-5,a.length)==".d.ts"?a.substring(0,a.length-5):a.length>3&&a.substring(a.length-3,a.length)==".ts"?a.substring(0,a.length-3):a.length>3&&a.substring(a.length-3,a.length)==".js"?a.substring(0,a.length-3):a}function h(a){return a.length>4&&a.substring(a.length-4,a.length)==".str"}function i(a){return a.length>3&&a.substring(a.length-3,a.length)==".ts"}function j(a){return a.length>6&&a.substring(a.length-6,a.length)==".d.str"}function k(a){return a.length>5&&a.substring(a.length-5,a.length)==".d.ts"}function l(a,c,e){typeof c=="undefined"&&(c=!0
),typeof e=="undefined"&&(e=!1);var h=e?f(a):g(b(a)),i=h.split("/");return i.length?c?d(i[i.length-1]):i[i.length-1]:a}function m(a){var c=g(b(a)),e=t(c);if(e=="")return a;var f=c.split(e),h=f.length>1?1:0;return d(f[h])}function n(a){return g(b(a))+".str"}function o(a){return g(b(a))+".d.str"}function p(a){return g(b(a))+".ts"}function q(a){return g(b(a))+".d.ts"}function r(a){return a.charAt(0)=="."}function s(a){return a.charAt(0)=="\\"||a.charAt(0)=="/"||a.indexOf(":\\")!=-1||a.indexOf(":/")!=-1}function t(a){if(a=="")return a;var b=a.indexOf("/")!=-1;return b?u(a):""}function u(a){a=f(a);var b=a.split("/"),c=b.slice(0,b.length-1);return c.join("/")+"/"}function v(a){var b=/^(https?:\/\/[\-\w\.]+(:\d+)?\/)(.*)$/i,c=b.exec(a);if(c){var d=c[1],e=c[3];return d+w(e)}return w(a)}function w(a){a=f(a);var b=a.charAt(0)==="/",c=a.split("/");for(var d=0;d<c.length;d++){if(c[d]==="."||c[d]==="")c.splice(d,1),d--;d>0&&c[d]===".."&&c[d-1]!==".."&&(c.splice(d-1,2),d-=2)}return(b?"/":"")+c.join("/")}function x(a){return w(a)}a.stripQuotes=b,a.isQuoted=c,a.quoteStr=d,a.swapQuotes=e,a.switchToForwardSlashes=f,a.trimModName=g,a.isSTRFile=h,a.isTSFile=i,a.isDSTRFile=j,a.isDTSFile=k,a.getPrettyName=l,a.quoteBaseName=m,a.changePathToSTR=n,a.changePathToDSTR=o,a.changePathToTS=p,a.changePathToDTS=q,a.isRelative=r,a.isRooted=s,a.getRootFilePath=t,a.filePath=u,a.normalizeURL=v,a.pathNormalizeRegExp=/\//g,a.normalizePath=w,a.normalizeImportPath=x})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function a(a,b){this.path=a,this.content=b}return a.prototype.getText=function(a,b){return this.content.substring(a,b)},a.prototype.getLength=function(){return this.content.length},a}();a.SourceUnit=b;var c=function(){function a(a,b){this.compilationSettings=a,this.ioHost=b,this.residentCode=[],this.code=[]}return a}();a.CompilationEnvironment=c;var d=function(){function c(a){this.environment=a,this.visited={}}return c.prototype.resolveCode=function(c,d,e,f){var g={content:"",path:c},h=this.environment.ioHost,i=a.isRelative(c),j=i?!1:a.isRooted(c),k=i?h.resolvePath(d+"/"+c):j||!d||e?c:d+"/"+c;!a.isSTRFile(k)&&!a.isTSFile(k)&&(k+=".ts"),k=a.switchToForwardSlashes(a.stripQuotes(k));var l=this.environment.compilationSettings.useCaseSensitiveFileResolution?k:k.toLocaleUpperCase();if(!this.visited[l]){if(i||j||!e)try{a.CompilerDiagnostics.debugPrint("   Reading code from "+k);try{g.content=h.readFile(k)}catch(m){try{a.isSTRFile(k)?k=a.changePathToTS(k):a.isTSFile(k)&&(k=a.changePathToSTR(k)),a.CompilerDiagnostics.debugPrint("   Reading code from "+k),g.content=h.readFile(k)}catch(m){k=a.changePathToDSTR(k),a.CompilerDiagnostics.debugPrint("   Reading code from "+k);try{g.content=h.readFile(k)}catch(m){k=a.changePathToDTS(k),a.CompilerDiagnostics.debugPrint("   Reading code from "+k),g.content=h.readFile(k)}}}a.CompilerDiagnostics.debugPrint("   Found code at "+k),g.path=k,this.visited[l]=!0}catch(m){a.CompilerDiagnostics.debugPrint("   Did not find code for "+c)}else g=h.findFile(d,k),g||(a.isSTRFile(k)?k=a.changePathToTS(k):a.isTSFile(k)&&(k=a.changePathToSTR(k)),g=h.findFile(d,k)),g||(k=a.changePathToDTS(k),g=h.findFile(d,k),g||(k=a.changePathToDSTR(k),g=h.findFile(d,k))),g?(g.path=a.switchToForwardSlashes(a.stripQuotes(g.path)),a.CompilerDiagnostics.debugPrint(c+" resolved to: "+g.path),g.content=g.content,this.visited[l]=!0):a.CompilerDiagnostics.debugPrint("Could not find "+c);if(g&&g.content){var n=h.dirName(g.path),o=new b(g.path,g.content),p=a.preProcessFile(o,this.environment.compilationSettings);for(var q=0;q<p.referencedFiles.length;q++){var r=p.referencedFiles[q],k=a.isRooted(r.path)?r.path:n+"/"+r.path;k=h.resolvePath(k);if(c==k){f.postResolutionError(k,"File contains reference to itself",null);continue}this.resolveCode(r.path,n,!1,f)}for(var q=0;q<p.importedFiles.length;q++)this.resolveCode(p.importedFiles[q].path,n,!0,f);f.postResolution(o.path,o)}}},c}();a.CodeResolver=d})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function d(b){var c=/^(\/\/\/\s*<reference\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,d=c.exec(b);if(d){var e=a.normalizePath(d[3]),f=a.normalizePath(e),g=d.length>=7&&d[6]=="true";return g&&a.CompilerDiagnostics.debugPrint(e+" is resident"),{minChar:0,limChar:0,path:a.switchToForwardSlashes(f),isResident:g}}return null}function e(a){var b=/^(\/\/\/\s*<amd-dependency\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,c=b.exec(a);if(c){var d=c[3];return d}return null}function f(a,b){var c=/^(\/\/\/\s*<style\s+)(([a-zA-Z])+=('|").+('|"))\s*\/>/igm,d=c.exec(a);if(d){var e=/^([a-zA-Z]+=['"]on['|"])/igm;d=e.exec(d[2]);if(d)for(var f=0;f<d.length;f++){var g=d[f].split("="),h='"on"';switch(g[0]){case"blockInCompoundStmt":b.blockInCompoundStmt=g[1]==h;break;case"eqeqeq":b.eqeqeq=g[1]==h;break;case"forin":b.forin=g[1]==h;break;case"emptyBlocks":b.emptyBlocks=g[1]==h;break;case"newMustBeUsed":b.newMustBeUsed=g[1]==h;break;case"requireSemi":b.requireSemi=g[1]==h;break;case"assignmentInCond":b.assignmentInCond=g[1]==h;break;case"eqnull":b.eqnull=g[1]==h;break;case"evalOK":b.evalOK=g[1]==h;break;case"innerScopeDeclEscape":b.innerScopeDeclEscape=g[1]==h;break;case"funcInLoop":b.funcInLoop=g[1]==h;break;case"reDeclareLocal":b.reDeclareLocal=g[1]==h;break;case"literalSubscript":b.literalSubscript=g[1]==h;break;case"implicitAny":b.implicitAny=g[1]==h}}}}function g(b,e){typeof e=="undefined"&&(e=new c);var g=new a.Scanner;g.resetComments(),g.setSourceText(b,a.LexMode.File);var h=g.scan(),i=[],j=null,k=[],l=e,m=[],n=[],o=!1;while(h.tokenId!=a.TokenID.EOF){if(h.tokenId==a.TokenID.IMPORT){h=g.scan();if(h.tokenId==a.TokenID.ID||a.convertTokToID(h,!1)){h=g.scan();if(h.tokenId==a.TokenID.Asg){h=g.scan();if(h.tokenId==a.TokenID.MODULE){h=g.scan();if(h.tokenId==a.TokenID.LParen){h=g.scan();if(h.tokenId==a.TokenID.QString){var p={minChar:g.startPos,limChar:g.pos,path:a.stripQuotes(a.switchToForwardSlashes(h.getText())),isResident:!1};n.push(p)}}}}}}h.tokenId==a.TokenID.LCurly&&k.push(h),h.tokenId==a.TokenID.RCurly&&k.pop(),h=g.scan()}i=g.getComments();for(var q=0;q<i.length;q++){j=i[q];if(!j.isBlock){var r=d(j.getText());r&&(r.minChar=j.startPos,r.limChar=r.minChar+j.value.length,m.push(r)),f(j.getText(),l.styleSettings);var s=/^(\/\/\/\s*<reference\s+no-default-lib=)('|")(.+?)\2\s*\/>/igm,t=s.exec(j.getText());t&&(o=t[3]=="true")}}return{settings:l,referencedFiles:m,importedFiles:n,isLibFile:o}}var b=function(){function a(){this.bitwise=!1,this.blockInCompoundStmt=!1,this.eqeqeq=!1,this.forin=!1,this.emptyBlocks=!0,this.newMustBeUsed=!1,this.requireSemi=!1,this.assignmentInCond=!1,this.eqnull=!1,this.evalOK=!0,this.innerScopeDeclEscape=!0,this.funcInLoop=!0,this.reDeclareLocal=!0,this.literalSubscript=!0,this.implicitAny=!1}return a.prototype.setOption=function(a,b){var c=this[a];return c!==undefined?(this[a]=b,!0):!1},a.prototype.parseOptions=function(a){var b=a.split(";");for(var c=0,d=b.length;c<d;c++){var e=b[c],f=!0,g=e.lastIndexOf(":");if(g>=0){var h=e.substring(g+1);e=e.substring(0,g),h=="off"&&(f=!1)}if(!this.setOption(e,f))return!1}return!0},a}();a.StyleSettings=b;var c=function(){function c(){this.styleSettings=new b,this.propagateConstants=!1,this.minWhitespace=!1,this.parseOnly=!1,this.outputMany=!0,this.errorRecovery=!1,this.emitComments=!1,this.watch=!1,this.exec=!1,this.resolve=!0,this.controlFlow=!1,this.printControlFlow=!1,this.controlFlowUseDef=!1,this.errorOnWith=!0,this.preprocess=!0,this.canCallDefinitionSignature=!1,this.inferPropertiesFromThisAssignment=!1,this.useDefaultLib=!0,this.codeGenTarget=a.CodeGenTarget.ES3,this.moduleGenTarget=a.ModuleGenTarget.Synchronous,this.outputFileName="",this.errorFileName="",this.mapSourceFiles=!1,this.generateDeclarationFiles=!1,this.useCaseSensitiveFileResolution=!1}return c.prototype.setStyleOptions=function(a){this.styleSettings.parseOptions(a)},c.prototype.outputOne=function(a){this.outputFileName=a,this.outputMany=!1},c}();a.CompilationSettings=c,a.getAdditionalDependencyPath=e,a.getStyleSettings=f,a.preProcessFile=g})(TypeScript||(TypeScript={}));var TypeScript;(function(a){var b=function(){function b(b){this.logger=b,this.astLogger=new a.AstLogger(this.logger)}return b.prototype.getEnclosingScopeContextIfSingleScopeEdit=function(b,c,d,e){this.logger.log('checkEditsInsideSingleScope("'+c+'")');if(e===null)throw new Error("editRange should be valid");if(e.isUnknown())return this.logger.log("  Bailing out because edit range is unknown"),null;var f=a.findEnclosingScopeAt(this.logger,b,d,e.minChar,!1),g=a.findEnclosingScopeAt(this.logger,b,d,e.limChar,!1);if(f==null||g==null)return this.logger.log("  Bailing out because containing scopes cannot be determined"),null;if(f.scopeStartAST!==g.scopeStartAST)return this.logger.log("  Bailing out because edit overlaps 2 disctint scopes"),null;var h=f.scopeStartAST.limChar-f.scopeStartAST.minChar+e.delta;return h<=0?(this.logger.log("  Bailing out because scope has been entirely removed from new source text"),null):f},b.prototype.attemptIncrementalUpdateUnit=function(b,c,d,e){this.logger.log('attemptIncrementalUpdateUnit("'+c+'")');if(e===null)throw new Error("editRange should be valid");var f=this.getEnclosingScopeContextIfSingleScopeEdit(b,c,d,e);if(f===null)return null;var g=f.scopeStartAST.limChar-f.scopeStartAST.minChar+e.delta;if(g>=d.getLength()/2)return this.logger.log("  Bailing out because range of scope to reparse ("+g+" characters) is greater than half the size of the source text"),null;var h=[],i=function(b,c,d,e){h.push(new a.ErrorEntry(e,b,b+c,d))},j=a.quickParse(this.logger,f.scopeStartAST,d,f.scopeStartAST.minChar,f.scopeStartAST.minChar+g,i);if(j.endLexState!=a.LexState.Start)return this.logger.log("  Bailing out because scope contains unterminated comment"),null;var k=j.Script;if(k.vars.members.length!==0)return this.logger.log("  Bailing out because new source text defines variables"),null;if(k.bod.members.length!==1)return this.logger.log("  Bailing out because new source text defines more than one scope (or none)"),null;var l=f.scopeStartAST,m=k.bod.members[0];return l.nodeType!=m.nodeType?(this.logger.log("  Bailing out because new source text does not define the same scope type as the existing scope"),null):!l.leftCurlyCount||!l.rightCurlyCount?(this.logger.log("  Bailing out because sopce doesn't have left/right curly count"),null):l.leftCurlyCount!==m.leftCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) left curly braces"),null):l.rightCurlyCount!==m.rightCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) right curly braces"),null):m.minChar!==0?(this.logger.log("  Bailing out because new function declaration does not start at position 0"),null):m.limChar!==g?(this.logger.log("  Bailing out because new function declaration does not end at the new end position"),null):a.UpdateUnitResult.singleScopeEdits(b,k,l,m,e,h)},b.prototype.mergeTrees=function(b){var c=this;a.timeFunction(this.logger,"mergeTrees()",function(){var d=new a.ScriptEditRange(b.scope1.minChar,b.scope1.limChar,b.editRange.delta);c.applyDeltaPosition(b.script1,d.limChar,d.delta),c.applyDeltaPosition(b.script2,0,d.minChar),c.mergeLocationInfo(b.script1,b.script2,d),c.replaceAST(b.script1,b.scope1,b.scope2)})},b.prototype.replaceAST=function(b,c,d){var e=this,f=function(b,f,g){return b===c?(d.preComments=b.preComments,d.postComments=b.postComments,e.logger.log("replaced old AST node with new one in script AST"),g.options.stopWalk(),d):(a.isValidAstNode(b)&&(b.limChar<c.minChar||b.minChar>c.limChar)&&(g.options.goChildren=!1),b)};a.getAstWalkerFactory().walk(b,f)},b.prototype.mergeLocationInfo=function(a,b,c){var d=a.locationInfo.lineMap,e=b.locationInfo.lineMap;this.logger.information()&&(this.logger.log("lineMap1 (before):"),this.astLogger.logLinemap(d),this.logger.log("lineMap2 (quick parse):"),this.astLogger.logLinemap(e),this.logger.log("EditRange="+c));var f=2,g=2,h=d.length,i=e.length;while(f<h||g<i)f<h?d[f]<=c.minChar?f++:d[f]>=c.limChar?(d[f]+=c.delta,f++):g<i?(d.splice(f,0,e[g]+c.minChar),f++,h++,g++):(d.splice(f,1),h--):(d.push(e[g]+c.minChar),g++);this.logger.information()&&(this.logger.log("lineMap1 (after merge):"),this.astLogger.logLinemap(d))},b.prototype.applyDeltaPosition=function(b,c,d){var e=function(a){a.minChar!==-1&&a.minChar>=c&&(a.minChar+=d),a.limChar!==-1&&a.limChar>=c&&(a.limChar+=d)},f=function(a){if(a&&a.length>0)for(var b=0;b<a.length;b++)e(a[b])},g=function(a,b,d){return a.limChar!==-1&&a.limChar<c&&(d.options.goChildren=!1),e(a),f(a.preComments),f(a.postComments),a};a.getAstWalkerFactory().walk(b,g)},b}();a.IncrementalParser=b})(TypeScript||(TypeScript={}));var TypeScript;(function(a){(function(a){a._map=[],a._map[0]="Unknown",a.Unknown=0,a._map[1]="NoEdits",a.NoEdits=1,a._map[2]="EditsInsideSingleScope",a.EditsInsideSingleScope=2})(a.UpdateUnitKind||(a.UpdateUnitKind={}));var b=a.UpdateUnitKind,c=function(){function a(a,b,c){this.minChar=a,this.limChar=b,this.delta=c}return a.unknown=function(){return new a(-1,-1,-1)},a.prototype.isUnknown=function(){return this.minChar===-1&&this.limChar===-1&&this.delta===-1},a.prototype.containsPosition=function(a){return this.minChar<=a&&a<this.limChar||this.minChar<=a&&a<this.limChar+this.delta},a.prototype.toString=function(){return"editRange(minChar="+this.minChar+", limChar="+this.limChar+", delta="+this.delta+")"},a}();a.ScriptEditRange=c;var d=function(){function a(a,b,c,d){this.kind=a,this.unitIndex=b,this.script1=c,this.script2=d,this.scope1=null,this.scope2=null,this.editRange=null,this.parseErrors=[]}return a.noEdits=function(d){return new a(b.NoEdits,d,null,null)},a.unknownEdits=function(d,e,f){var g=new a(b.Unknown,d.locationInfo.unitIndex,d,e);return g.parseErrors=f,g},a.singleScopeEdits=function(d,e,f,g,h,i){var j=new a(b.EditsInsideSingleScope,d.locationInfo.unitIndex,d,e);return j.scope1=f,j.scope2=g,j.editRange=h,j.parseErrors=i,j},a}();a.UpdateUnitResult=d;var e=function(){function a(a,b,c,d){this.unitIndex=a,this.minChar=b,this.limChar=c,this.message=d}return a}();a.ErrorEntry=e,a.defaultSettings=new a.CompilationSettings;var f=function(){function c(b,c,d,e){typeof d=="undefined"&&(d=new a.NullLogger),typeof e=="undefined"&&(e=a.defaultSettings),this.outfile=b,this.errorOutput=c,this.logger=d,this.settings=e,this.parser=new a.Parser,this.typeFlow=null,this.scripts=new a.ASTList,this.units=new Array,this.errorReporter=new a.ErrorReporter(this.outfile),this.persistentTypeState=new a.PersistentGlobalTypeState(this.errorReporter),this.errorReporter.parser=this.parser,this.initTypeChecker(this.errorOutput),this.parser.style_requireSemi=this.settings.styleSettings.requireSemi,this.parser.style_funcInLoop=this.settings.styleSettings.funcInLoop,this.parser.inferPropertiesFromThisAssignment=this.settings.inferPropertiesFromThisAssignment,this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany},a.codeGenTarget=e.codeGenTarget}return c.prototype.timeFunction=function(b,c){return a.timeFunction(this.logger,b,c)},c.prototype.initTypeChecker=function(b){this.persistentTypeState.refreshPersistentState(),this.typeChecker=new a.TypeChecker(this.persistentTypeState),this.typeChecker.errorReporter=this.errorReporter,this.typeChecker.checkControlFlow=this.settings.controlFlow,this.typeChecker.checkControlFlowUseDef=this.settings.controlFlowUseDef,this.typeChecker.printControlFlowGraph=this.settings.printControlFlow,this.typeChecker.errorsOnWith=this.settings.errorOnWith,this.typeChecker.styleSettings=this.settings.styleSettings,this.typeChecker.canCallDefinitionSignature=this.settings.canCallDefinitionSignature,this.errorReporter.checker=this.typeChecker,this.setErrorOutput(this.errorOutput)},c.prototype.setErrorOutput=function(a){this.errorOutput=a,this.errorReporter.setErrOut(a),this.parser.outfile=a},c.prototype.emitCommentsToOutput=function(){this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany}},c.prototype.setErrorCallback=function(a){this.parser.errorCallback=a},c.prototype.updateUnit=function(b,c,d){return this.updateSourceUnit(new a.StringSourceText(b),c,d)},c.prototype.updateSourceUnit=function(a,b,c){var d=this;return this.timeFunction("updateSourceUnit("+b+")",function(){var e=d.partialUpdateUnit(a,b,c);return d.applyUpdateResult(e)})},c.prototype.applyUpdateResult=function(c){switch(c.kind){case b.NoEdits:return!1;case b.Unknown:this.scripts.members[c.unitIndex]=c.script2,this.units[c.unitIndex]=c.script2.locationInfo;for(var d=0,e=c.parseErrors.length;d<e;d++){var f=c.parseErrors[d];this.parser.errorCallback&&this.parser.errorCallback(f.minChar,f.limChar-f.minChar,f.message,f.unitIndex)}return!0;case b.EditsInsideSingleScope:return(new a.IncrementalParser(this.logger)).mergeTrees(c),!0}},c.prototype.partialUpdateUnit=function(a,b,c){var f=this;return this.timeFunction("partialUpdateUnit("+b+")",function(){for(var g=0,h=f.units.length;g<h;g++)if(f.units[g].filename==b){if(f.scripts.members[g].isResident)return d.noEdits(g);c&&f.parser.setErrorRecovery(null,0,0);var i,j=[],k=function(a,b,c,d){j.push(new e(d,a,a+b,c))},l=f.parser.errorCallback;l&&(f.parser.errorCallback=k);var m=f.scripts.members[g],n=f.parser.parse(a,b,g);return l&&(f.parser.errorCallback=l),i=d.unknownEdits(m,n,j),i}throw new Error('Unknown file "'+b+'"')})},c.prototype.addUnit=function(b,c,d){return typeof d=="undefined"&&(d=!1),this.addSourceUnit(new a.StringSourceText(b),c,d)},c.prototype.addSourceUnit=function(b,c,d){typeof d=="undefined"&&(d=!1);var e=this;return this.timeFunction("addSourceUnit("+c+", "+d+")",function(){var f=e.parser.parse(b,c,e.units.length,a.AllowedElements.Global);f.isResident=d,e.persistentTypeState.setCollectionMode(d?a.TypeCheckCollectionMode.Resident:a.TypeCheckCollectionMode.Transient);var g=e.units.length;return e.units[g]=f.locationInfo,e.typeChecker.collectTypes(f),e.scripts.append(f),f})},c.prototype.parseUnit=function(b,c){return this.parseSourceUnit(new a.StringSourceText(b),c)},c.prototype.parseSourceUnit=function(b,c){this.parser.setErrorRecovery(this.outfile,-1,-1);var d=this.parser.parse(b,c,0),e=new a.PrintContext(this.outfile,this.parser);a.getAstWalkerFactory().walk(d,a.prePrintAST,a.postPrintAST,null,e)},c.prototype.typeCheck=function(){var b=this;return this.timeFunction("typeCheck()",function(){var c=new a.Binder(b.typeChecker);b.typeChecker.units=b.units,c.bind(b.typeChecker.globalScope,b.typeChecker.globals),c.bind(b.typeChecker.globalScope,b.typeChecker.ambientGlobals),c.bind(b.typeChecker.globalScope,b.typeChecker.globalTypes),c.bind(b.typeChecker.globalScope,b.typeChecker.ambientGlobalTypes),b.typeFlow=new a.TypeFlow(b.logger,b.typeChecker.globalScope,b.parser,b.typeChecker);var d=0,e=null,f=b.scripts.members.length;b.persistentTypeState.setCollectionMode(a.TypeCheckCollectionMode.Resident);for(d=0;d<f;d++){e=b.scripts.members[d];if(!e.isResident||e.hasBeenTypeChecked)continue;b.typeFlow.assignScopes(e),b.typeFlow.initLibs()}for(d=0;d<f;d++){e=b.scripts.members[d];if(!e.isResident||e.hasBeenTypeChecked)continue;b.typeFlow.typeCheck(e),e.hasBeenTypeChecked=!0}b.persistentTypeState.setCollectionMode(a.TypeCheckCollectionMode.Transient),f=b.scripts.members.length;for(d=0;d<f;d++){e=b.scripts.members[d];if(e.isResident)continue;b.typeFlow.assignScopes(e),b.typeFlow.initLibs()}for(d=0;d<f;d++){e=b.scripts.members[d];if(e.isResident)continue;b.typeFlow.typeCheck(e)}return null})},c.prototype.cleanASTTypesForReTypeCheck=function(b){function c(b,c){b.type=null;if(b.nodeType==a.NodeType.VarDecl){var d=b;d.sym=null}else if(b.nodeType==a.NodeType.ArgDecl){var e=b;e.sym=null}else if(b.nodeType==a.NodeType.Name){var f=b;f.sym=null}else if(b.nodeType==a.NodeType.FuncDecl){var g=b;g.signature=null,g.freeVariables=new Array,g.symbols=null,g.accessorSymbol=null,g.scopeType=null}else if(b.nodeType==a.NodeType.Module){var h=b;h.mod=null}else b.nodeType==a.NodeType.With?b.withSym=null:b.nodeType==a.NodeType.Catch&&(b.containedScope=null);return b}a.getAstWalkerFactory().walk(b,c)},c.prototype.cleanTypesForReTypeCheck=function(){var a=this;return this.timeFunction("cleanTypesForReTypeCheck()",function(){for(var b=0,c=a.scripts.members.length;b<c;b++){var d=a.scripts.members[b];if(d.isResident)continue;a.cleanASTTypesForReTypeCheck(d),a.typeChecker.collectTypes(d)}return null})},c.prototype.attemptIncrementalTypeCheck=function(a){return this.timeFunction("attemptIncrementalTypeCheck()",function(){return!1})},c.prototype.reTypeCheck=function(){var b=this;return this.timeFunction("reTypeCheck()",function(){return a.CompilerDiagnostics.analysisPass++,b.initTypeChecker(b.errorOutput),b.persistentTypeState.setCollectionMode(a.TypeCheckCollectionMode.Transient),b.cleanTypesForReTypeCheck(),b.typeCheck()})},c.prototype.emit=function(b,c){var d=null;this.emitSettings.createFile=c;for(var e=0,f=this.scripts.members.length;e<f;e++){var g=this.scripts.members[e];if(!g.emitRequired())continue;var h=this.outfile;if(b){var i=this.units[e].filename,j=i.split(".");j.pop();var k=j.join("."),l=k+".js";this.emitSettings.path=l,h=c(l),d=new a.Emitter(this.typeChecker,h,this.emitSettings),this.settings.mapSourceFiles&&d.setSourceMappings(new a.SourceMapper(i,l,h,c(l+a.SourceMapper.MapFileExtension)));if(this.settings.generateDeclarationFiles){var m=a.isSTRFile(i)?a.changePathToDSTR(i):a.isTSFile(i)?a.changePathToDTS(i):a.changePathToDTS(i);d.setDeclarationFile(c(m))}}else if(d==null){d=new a.Emitter(this.typeChecker,this.outfile,this.emitSettings),this.settings.mapSourceFiles&&d.setSourceMappings(new a.SourceMapper(g.locationInfo.filename,this.settings.outputFileName,this.outfile,c(this.settings.outputFileName+a.SourceMapper.MapFileExtension)));if(this.settings.generateDeclarationFiles){var n=this.settings.outputFileName;n=a.isSTRFile(n)?a.changePathToDSTR(n):a.isTSFile(n)?a.changePathToDTS(n):a.changePathToDTS(n),d.setDeclarationFile(c(n))}}else this.settings.mapSourceFiles&&d.setSourceMappings(new a.SourceMapper(g.locationInfo.filename,d.sourceMapper.jsFileName,this.outfile,d.sourceMapper.sourceMapOut));this.typeChecker.locationInfo=g.locationInfo,d.emitJavascript(g,a.TokenID.Comma,!1,d.canWriteDeclFile()),b&&(this.settings.mapSourceFiles&&d.emitSourceMappings(),this.settings.generateDeclarationFiles&&d.declFile.Close(),h.Close())}b||(this.settings.mapSourceFiles&&d.emitSourceMappings(),this.settings.generateDeclarationFiles&&d.declFile.Close())},c.prototype.emitToOutfile=function(){var b=null;if(this.settings.mapSourceFiles)throw Error("Cannot generate source map");if(this.settings.generateDeclarationFiles)throw Error("Cannot generate declaration files");for(var c=0,d=this.scripts.members.length;c<d;c++){b==null&&(b=new a.Emitter(this.typeChecker,this.outfile,this.emitSettings));var e=this.scripts.members[c];this.typeChecker.locationInfo=e.locationInfo,b.emitJavascript(e,a.TokenID.Comma,!1)}},c}();a.TypeScriptCompiler=f;var g=function(){function a(a,b,c){this.name=a,this.type=b,this.sym=c}return a}();a.ScopeEntry=g;var h=function(){function b(a){this.compiler=a}return b.prototype.getScope=function(a){return a.enclosingObjectLit&&a.isMemberCompletion?a.getObjectLiteralScope():a.isMemberCompletion?a.useFullAst?this.compiler.typeFlow.findMemberScopeAtFullAst(a):this.compiler.typeFlow.findMemberScopeAt(a):a.getScope()},b.prototype.getScopeEntries=function(b){var c=this.getScope(b);if(c==null)return[];var d=new a.StringHashTable,e=c.getAllSymbolNames(b.isMemberCompletion);for(var f=0;f<e.length;f++){var g=e[f];if(g==a.globalId||g=="_Core"||g=="_element")continue;d.add(g,"")}var h=this.compiler.typeChecker.currentModDecl;this.compiler.typeChecker.currentModDecl=b.deepestModuleDecl;var i=this.getTypeNamesForNames(b,d.getAllKeys(),c);return this.compiler.typeChecker.currentModDecl=h,i},b.prototype.getTypeNamesForNames=function(b,c,d){var e=[],f=b.getScope();for(var h=0;h<c.length;h++){var i=c[h],j=b.publicsOnly&&b.isMemberCompletion,k=d.find(i,j,!1);k==null&&(k=d.find(i,j,!0));var l=k&&k.flags&a.SymbolFlags.Private?k.container==d.container:!0;if(k){if(l&&!a.isQuoted(k.name)&&!a.isRelative(k.name)){var m=k.getType().getScopedTypeName(f);e.push(new g(i,m,k))}}else(i=="true"||i=="false")&&e.push(new g(i,"bool",this.compiler.typeChecker.booleanType.symbol))}return e},b}();a.ScopeTraversal=h})(TypeScript||(TypeScript={}));var TypeScript;(function(a){function f(a,b,c){var d=+(new Date),e=c(),f=+(new Date);return a.log(b+" completed in "+(f-d)+" msec"),e}function g(a,b){var c="",d=function(b){var d=a.charCodeAt(b);switch(d){case 9:c+="\\t";break;case 10:c+="\\n";break;case 11:c+="\\v";break;case 12:c+="\\f";break;case 13:c+="\\r";break;case 34:c+='\\"';break;case 39:c+="\\'";break;case 92:c+="\\";break;default:c+=a.charAt(b)}},e=a.length>b;if(e){var f=b>>1;for(var g=0;g<f;g++)d(g);c+="(...)";for(var g=a.length-f;g<a.length;g++)d(g)}else{b=a.length;for(var g=0;g<b;g++)d(g)}return c}(function(a){function b(b){a.diagnosticWriter&&a.diagnosticWriter.Alert(b)}function c(c){a.debug&&b(c)}function d(c,d){a.debug&&(c||b(d))}a.debug=!1,a.diagnosticWriter=null,a.analysisPass=0,a.Alert=b,a.debugPrint=c,a.assert=d})(a.CompilerDiagnostics||(a.CompilerDiagnostics={}));var b=a.CompilerDiagnostics,c=function(){function a(){}return a.prototype.information=function(){return!1},a.prototype.debug=function(){return!1},a.prototype.warning=function(){return!1},a.prototype.error=function(){return!1},a.prototype.fatal=function(){return!1},a.prototype.log=function(a){},a}();a.NullLogger=c;var d=function(){function a(a){this.logger=a,this._information=this.logger.information(),this._debug=this.logger.debug(),this._warning=this.logger.warning(),this._error=this.logger.error(),this._fatal=this.logger.fatal()}return a.prototype.information=function(){return this._information},a.prototype.debug=function(){return this._debug},a.prototype.warning=function(){return this._warning},a.prototype.error=function(){return this._error},a.prototype.fatal=function(){return this._fatal},a.prototype.log=function(a){this.logger.log(a)},a}();a.LoggerAdapter=d;var e=function(){function a(){this.logContents=[]}return a.prototype.information=function(){return!1},a.prototype.debug=function(){return!1},a.prototype.warning=function(){return!1},a.prototype.error=function(){return!1},a.prototype.fatal=function(){return!1},a.prototype.log=function(a){this.logContents.push(a)},a}();a.BufferedLogger=e,a.timeFunction=f,a.stringToLiteral=g})(TypeScript||(TypeScript={}));